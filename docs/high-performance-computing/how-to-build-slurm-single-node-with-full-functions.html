<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-high-performance-computing/how-to-build-slurm-single-node-with-full-functions" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Single node | RiverXData</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://riverxdata.github.ios/river-docs/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://riverxdata.github.ios/river-docs/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://riverxdata.github.ios/river-docs/docs/high-performance-computing/how-to-build-slurm-single-node-with-full-functions"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="bioinformatics, data, infrastructure, hpc, cloud"><meta data-rh="true" name="author" content="RiverXData Team"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Single node | RiverXData"><meta data-rh="true" name="description" content="cluster"><meta data-rh="true" property="og:description" content="cluster"><link data-rh="true" rel="icon" href="/river-docs/img/logo-riverxdata-02.png"><link data-rh="true" rel="canonical" href="https://riverxdata.github.ios/river-docs/docs/high-performance-computing/how-to-build-slurm-single-node-with-full-functions"><link data-rh="true" rel="alternate" href="https://riverxdata.github.ios/river-docs/docs/high-performance-computing/how-to-build-slurm-single-node-with-full-functions" hreflang="en"><link data-rh="true" rel="alternate" href="https://riverxdata.github.ios/river-docs/docs/high-performance-computing/how-to-build-slurm-single-node-with-full-functions" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0BBYTVWQV2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0BBYTVWQV2",{anonymize_ip:!0})</script><link rel="stylesheet" href="/river-docs/assets/css/styles.3158ce5a.css">
<script src="/river-docs/assets/js/runtime~main.a600630f.js" defer="defer"></script>
<script src="/river-docs/assets/js/main.f717c5f0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/river-docs/img/logo-riverxdata-02.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/river-docs/"><div class="navbar__logo"><img src="/river-docs/img/logo-riverxdata-02.png" alt="RiverXData Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/river-docs/img/logo-riverxdata-02.png" alt="RiverXData Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">RiverXData</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/river-docs/docs/Introduction">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/riverxdata/river" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/river-docs/docs/Introduction">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/river-docs/docs/category/programming">Programming</a><button aria-label="Expand sidebar category &#x27;Programming&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/river-docs/docs/administration/environment">Administration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/river-docs/docs/high-performance-computing/high-performance-computing-overview">HPC</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/river-docs/docs/high-performance-computing/high-performance-computing-overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/river-docs/docs/high-performance-computing/slurm-architecture">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/river-docs/docs/high-performance-computing/how-to-build-slurm-single-node-with-full-functions">Single node</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/river-docs/docs/category/scalable-hpc">Scalable HPC</a><button aria-label="Expand sidebar category &#x27;Scalable HPC&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/river-docs/docs/river/challenge-to-setup-developing-environment-for-engineers">River</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/river-docs/docs/hands-on-project/River-core/smartsensor/overview">Hands-on Project</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/river-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">HPC</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Single node</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Single node</h1></header>
<div align="center"><figure markdown="span"><p><img decoding="async" loading="lazy" alt="cluster" src="/river-docs/assets/images/Slurm_logo-aa681ab3230b0e3101ed236f97071acb.svg" width="590" height="540" class="img_ev3q"></p></figure></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li>This architect is designed for single node on the Ubuntu 20.04</li>
<li>Allow all of the standard features</li>
<li>Do it manually to help you understand how Slurm work. The user can use resource without submitting job, so should not used it for production</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-slurmd-slurmctld"><strong>Install slurmd, slurmctld</strong><a href="#install-slurmd-slurmctld" class="hash-link" aria-label="Direct link to install-slurmd-slurmctld" title="Direct link to install-slurmd-slurmctld">​</a></h2>
<p>Install base softwares</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get update -y &amp;&amp; sudo apt-get install -y slurmd slurmctld</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Check required installed packages</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># find where slurmd/slurmctld is installed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">which slurmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># /usr/sbin/slurmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">which slurmctld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># /usr/sbin/slurmctld</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-slurmconf"><strong>Prepare slurm.conf</strong><a href="#prepare-slurmconf" class="hash-link" aria-label="Direct link to prepare-slurmconf" title="Direct link to prepare-slurmconf">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li>Config for all nodes.</li>
</ul></div></div>
<p>On your terminal create this file</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt; slurm.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># slurm.conf for a single-node Slurm cluster with accounting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ClusterName=localcluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmctldHost=localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MpiDefault=none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ProctrackType=proctrack/linuxproc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ReturnToService=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmctldPidFile=/run/slurmctld.pid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmctldPort=6817</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmdPidFile=/run/slurmd.pid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmdPort=6818</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmdSpoolDir=/var/lib/slurm-llnl/slurmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmUser=slurm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">StateSaveLocation=/var/lib/slurm-llnl/slurmctld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SwitchType=switch/none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TaskPlugin=task/none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># TIMERS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">InactiveLimit=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">KillWait=30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MinJobAge=300</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmctldTimeout=120</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmdTimeout=300</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Waittime=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># SCHEDULING</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SchedulerType=sched/backfill</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SelectType=select/cons_tres</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SelectTypeParameters=CR_Core</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ACCOUNTING (slurmdbd, not enable now)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AccountingStorageType=accounting_storage/none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JobAcctGatherType=jobacct_gather/none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">JobAcctGatherFrequency=30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># LOGGING</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmctldDebug=info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmctldLogFile=/var/log/slurm-llnl/slurmctld.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmdDebug=info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmdLogFile=/var/log/slurm-llnl/slurmd.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># COMPUTE NODES (Single-node configuration)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NodeName=localhost CPUs=2 Sockets=1 CoresPerSocket=2 ThreadsPerCore=1 RealMemory=1024 State=UNKNOWN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># PARTITION CONFIGURATION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PartitionName=LocalQ Nodes=ALL Default=YES MaxTime=INFINITE State=UP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Move file to correct location</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo mv slurm.conf /etc/slurm-llnl/slurm.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="start-basic-slurm"><strong>Start basic slurm</strong><a href="#start-basic-slurm" class="hash-link" aria-label="Direct link to start-basic-slurm" title="Direct link to start-basic-slurm">​</a></h2>
<p>Start slurmd service</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo service slurmd start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># check status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo service slurmd status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="cluster" src="/river-docs/assets/images/slurmd_status-27a3e648f8da8db229ed803a5229e185.png" width="1310" height="351" class="img_ev3q"></p></figure>
<p>Start slurmctld service</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo service slurmctld start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># check status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo service slurmctld status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="cluster" src="/river-docs/assets/images/slurmctld_status-4e7ed6630174c2f0bc017d60c84c72f1.png" width="1310" height="351" class="img_ev3q"></p></figure>
<p>Submit a small job, adjust the cpus and memory accordin to your resource</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">srun --mem 500MB -c 1 --pty bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># checking detail on submitted job</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">squeue -o &quot;%i %P %u %T %M %l %D %C %m %R %Z %N&quot; | column -t</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Before submitting job, it takes less than 200MB RAM</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="cluster" src="/river-docs/assets/images/memory_before_stress-3a4b03c93c2340876dc5a870fe15d2e7.png" width="2432" height="434" class="img_ev3q"></p></figure>
<p>Allocate the 100MB everytime to memory to array</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">declare -a mem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while :; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mem[$i]=$(head -c 100M &lt;/dev/zero | tr &#x27;\000&#x27; &#x27;x&#x27;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ((i++))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Allocated: $((i * 100)) MB&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Memory after loading 1GB, it is weird because of it should be out of memory. But the slurm seems to not to be killed. It is because this setup and similar setup on single node
forget to add the control group plugin to control the computing resources. It does not work as you expected. It this cluste</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="cluster" src="/river-docs/assets/images/overresource_limit-4d711b28cf5adccae532ca1c9aa28286.png" width="2432" height="434" class="img_ev3q"></p></figure>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="limit-resource-by-cgroup"><strong>Limit resource by cgroup</strong><a href="#limit-resource-by-cgroup" class="hash-link" aria-label="Direct link to limit-resource-by-cgroup" title="Direct link to limit-resource-by-cgroup">​</a></h2>
<p>Prepare cgroup config file, restrict on the swap region, if the process is out of memory, it will be</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt;cgroup.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CgroupAutomount=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CgroupMountpoint=/sys/fs/cgroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConstrainCores=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConstrainRAMSpace=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConstrainDevices=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ConstrainSwapSpace=yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MaxSwapPercent=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MemorySwappiness=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Move to correct directory</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo mv cgroup.conf /etc/slurm-llnl/cgroup.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Add your task plugin to slurm config</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># sed to replace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sed -i -e &quot;s|ProctrackType=proctrack/linuxproc|ProctrackType=proctrack/cgroup|&quot; -e &quot;s|TaskPlugin=task/none|TaskPlugin=task/cgroup|&quot; /etc/slurm-llnl/slurm.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># add cgroup to grub to enable it, reboot is required</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sed -i &#x27;s/^GRUB_CMDLINE_LINUX=&quot;/GRUB_CMDLINE_LINUX=&quot;cgroup_enable=memory swapaccount=1 /&#x27; /etc/default/grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo update-grub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo reboot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># restart all services</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo service slurmctld status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo service slurmd status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Rerun the small memory job, that will exeed the memory limit, you job will be killed as expected</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">srun --mem 500MB -c 1 --pty bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">declare -a mem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while :; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mem[$i]=$(head -c 100M &lt;/dev/zero | tr &#x27;\000&#x27; &#x27;x&#x27;)  # Allocate 100MB at a time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ((i++))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &quot;Allocated: $((i * 100)) MB&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="cluster" src="/river-docs/assets/images/oom-06f78a37e67a2fb7a3547efffd709e59.png" width="1305" height="434" class="img_ev3q"></p></figure>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="enable-slurm-accounting"><strong>Enable slurm accounting</strong><a href="#enable-slurm-accounting" class="hash-link" aria-label="Direct link to enable-slurm-accounting" title="Direct link to enable-slurm-accounting">​</a></h2>
<p>To monitor old job, to track the resource allocation, permissons to launch job. The accounting should be enable.</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="cluster" src="/river-docs/assets/images/sacct_disable-3536da7262517e12af0bb6c732d8d3ea.png" width="1310" height="351" class="img_ev3q"></p></figure>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="install-slurmdbd">Install slurmdbd<a href="#install-slurmdbd" class="hash-link" aria-label="Direct link to Install slurmdbd" title="Direct link to Install slurmdbd">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt-get install slurmdbd mariadb-server -y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="prepare-slurmdbdconf">Prepare slurmdbd.conf<a href="#prepare-slurmdbdconf" class="hash-link" aria-label="Direct link to Prepare slurmdbd.conf" title="Direct link to Prepare slurmdbd.conf">​</a></h3>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li>Is is used to enable the accounting plugin. It allows to store the relative account informations.</li>
<li>Mapping the linux user to the relative accounts in slurm account database. Users can not submit job directly if they are not added</li>
<li>It is useful for monitor existed jobs to optimize the usage</li>
</ul></div></div>
<p>Create slurmdbd.conf</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat &lt;&lt;EOF &gt;slurmdbd.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PidFile=/run/slurmdbd.pid</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LogFile=/var/log/slurm/slurmdbd.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DebugLevel=error</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DbdHost=localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DbdPort=6819</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># DB connection data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">StorageType=accounting_storage/mysql</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">StorageHost=localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">StoragePort=3306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">StorageUser=slurm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">StoragePass=slurm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">StorageLoc=slurm_acct_db</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SlurmUser=slurm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Move the config file to the correct location</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo mv slurmdbd.conf /etc/slurm-llnl/slurmdbd.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="create-an-sql-database">Create an sql database<a href="#create-an-sql-database" class="hash-link" aria-label="Direct link to Create an sql database" title="Direct link to Create an sql database">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Create relative db with credentials specify in the slurmdbd.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo service mysql start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mysql -e &quot;CREATE DATABASE slurm_acct_db;&quot; &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mysql -e &quot;CREATE USER &#x27;slurm&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;slurm&#x27;;&quot; &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mysql -e &quot;GRANT ALL PRIVILEGES ON slurm_acct_db.* TO &#x27;slurm&#x27;@&#x27;localhost&#x27;;&quot; &amp;&amp; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mysql -e &quot;FLUSH PRIVILEGES;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Checking the database</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Verify the database and user creation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mysql -e &quot;SHOW DATABASES;&quot; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mysql -e &quot;SELECT User, Host FROM mysql.user;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check privileges for the slurm user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo mysql -e &quot;SHOW GRANTS FOR &#x27;slurm&#x27;@&#x27;localhost&#x27;;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="cluster" src="/river-docs/assets/images/add_db-12d303160989d2beda2434df173597ee.png" width="1314" height="539" class="img_ev3q"></p></figure>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="start-slurmdbd-service">Start slurmdbd service<a href="#start-slurmdbd-service" class="hash-link" aria-label="Direct link to Start slurmdbd service" title="Direct link to Start slurmdbd service">​</a></h3>
<p>Start slurmdbd service to allow the slurmctl to interact with it</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo service slurmdbd start</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Enable in slurm.conf</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo sed -i -e &quot;s|AccountingStorageType=accounting_storage/none|AccountingStorageType=accounting_storage/slurmdbd\nAccountingStorageEnforce=associations,limits,qos\nAccountingStorageHost=localhost\nAccountingStoragePort=6819|&quot; /etc/slurm-llnl/slurm.conf </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># gather acct from cgroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sed -i -e &quot;s|JobAcctGatherType=jobacct_gather/none|JobAcctGatherType=jobacct_gather/cgroup|&quot; /etc/slurm-llnl/slurm.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># restart service from slurmd, slurmctl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart slurmctl slurmd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Add the linux users to accounting-where the linux user will be granted to the relative permission to run job</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># $USER will be the current users</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sacctmgr -i add cluster localcluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sacctmgr -i --quiet add account $USER Cluster=localcluster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo sacctmgr -i --quiet add user $USER account=$USER DefaultAccount=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># restart again</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo systemctl restart slurmctl slurmd</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="cluster" src="/river-docs/assets/images/add_account-29ee0d7948684467ad5ebbaf8ac1b09c.png" width="1327" height="511" class="img_ev3q"></p></figure>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="submit-new-job-and-get-the-metrics">Submit new job and get the metrics<a href="#submit-new-job-and-get-the-metrics" class="hash-link" aria-label="Direct link to Submit new job and get the metrics" title="Direct link to Submit new job and get the metrics">​</a></h3>
<p>Get relative information</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">srun --mem 500MB -c 1 --pty bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="cluster" src="/river-docs/assets/images/add_account-29ee0d7948684467ad5ebbaf8ac1b09c.png" width="1327" height="511" class="img_ev3q"></p></figure>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion"><strong>Conclusion</strong><a href="#conclusion" class="hash-link" aria-label="Direct link to conclusion" title="Direct link to conclusion">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li>Slurm is a widely used orchestrator in both academic and industrial settings. It facilitates running distributed jobs across multiple computers and aggregating results to address real-world problems.</li>
<li>While Slurm is relatively easy to set up, some critical steps are often overlooked. For instance, resource requests and limits may not function as expected without proper configuration.</li>
<li>Slurm integrates seamlessly with various distributed computing frameworks such as Spark, Ray, Dask, and Flink enabling efficient and effective resource utilization for local development.</li>
</ul></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/riverxdata/docs/3.high-performance-computing/3.how-to-build-slurm-single-node-with-full-functions.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/river-docs/docs/high-performance-computing/slurm-architecture"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Architecture</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/river-docs/docs/category/scalable-hpc"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Scalable HPC</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#install-slurmd-slurmctld" class="table-of-contents__link toc-highlight"><strong>Install slurmd, slurmctld</strong></a></li><li><a href="#prepare-slurmconf" class="table-of-contents__link toc-highlight"><strong>Prepare slurm.conf</strong></a></li><li><a href="#start-basic-slurm" class="table-of-contents__link toc-highlight"><strong>Start basic slurm</strong></a></li><li><a href="#limit-resource-by-cgroup" class="table-of-contents__link toc-highlight"><strong>Limit resource by cgroup</strong></a></li><li><a href="#enable-slurm-accounting" class="table-of-contents__link toc-highlight"><strong>Enable slurm accounting</strong></a><ul><li><a href="#install-slurmdbd" class="table-of-contents__link toc-highlight">Install slurmdbd</a></li><li><a href="#prepare-slurmdbdconf" class="table-of-contents__link toc-highlight">Prepare slurmdbd.conf</a></li><li><a href="#create-an-sql-database" class="table-of-contents__link toc-highlight">Create an sql database</a></li><li><a href="#start-slurmdbd-service" class="table-of-contents__link toc-highlight">Start slurmdbd service</a></li><li><a href="#submit-new-job-and-get-the-metrics" class="table-of-contents__link toc-highlight">Submit new job and get the metrics</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight"><strong>Conclusion</strong></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/river-docs/docs/Introduction">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.facebook.com/groups/1134438583997171" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 RiverXData</div></div></div></footer></div>
</body>
</html>