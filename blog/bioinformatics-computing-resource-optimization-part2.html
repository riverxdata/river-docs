<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Bioinformatics Cost Optimization For Input Using Nextflow (Part 2) | RiverXData</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="bioinformatics, data, infrastructure, hpc, cloud"><meta data-rh="true" name="author" content="RiverXData Team"><meta data-rh="true" property="og:title" content="Bioinformatics Cost Optimization For Input Using Nextflow (Part 2) | RiverXData"><meta data-rh="true" name="description" content="Amazon S3 (Simple Storage Service) is built around the concept of storing files as objects, where each file is identified by a unique key rather than a traditional file system path. While this architecture offers scalability and flexibility for storage, it can present challenges when used as a standard file system, especially in bioinformatics workflows. When running Nextflow with S3 as the input/output backend, there are trade-offs to consider—particularly when dealing with large numbers of small files. In such cases, Nextflow may spend significant time handling downloads and uploads via the AWS CLI v2, which can impact overall workflow performance.On this blog post, we will start with downloading input first. Let’s explore this in more detail."><meta data-rh="true" property="og:description" content="Amazon S3 (Simple Storage Service) is built around the concept of storing files as objects, where each file is identified by a unique key rather than a traditional file system path. While this architecture offers scalability and flexibility for storage, it can present challenges when used as a standard file system, especially in bioinformatics workflows. When running Nextflow with S3 as the input/output backend, there are trade-offs to consider—particularly when dealing with large numbers of small files. In such cases, Nextflow may spend significant time handling downloads and uploads via the AWS CLI v2, which can impact overall workflow performance.On this blog post, we will start with downloading input first. Let’s explore this in more detail."><meta data-rh="true" property="og:image" content="https://riverxdata.github.io/river-docs/assets/images/nextflow_optimization-fe3c2c1da10d871e8be47657ef3626c9.svg"><meta data-rh="true" name="twitter:image" content="https://riverxdata.github.io/river-docs/assets/images/nextflow_optimization-fe3c2c1da10d871e8be47657ef3626c9.svg"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2026-01-19T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://www.facebook.com/nttg8100"><meta data-rh="true" property="article:tag" content="nextflow,hpc,workflow-optimization"><link data-rh="true" rel="icon" href="/river-docs/img/logo-riverxdata-02.png"><link data-rh="true" rel="canonical" href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2"><link data-rh="true" rel="alternate" href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2" hreflang="en"><link data-rh="true" rel="alternate" href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2","mainEntityOfPage":"https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2","url":"https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2","headline":"Bioinformatics Cost Optimization For Input Using Nextflow (Part 2)","name":"Bioinformatics Cost Optimization For Input Using Nextflow (Part 2)","description":"Amazon S3 (Simple Storage Service) is built around the concept of storing files as objects, where each file is identified by a unique key rather than a traditional file system path. While this architecture offers scalability and flexibility for storage, it can present challenges when used as a standard file system, especially in bioinformatics workflows. When running Nextflow with S3 as the input/output backend, there are trade-offs to consider—particularly when dealing with large numbers of small files. In such cases, Nextflow may spend significant time handling downloads and uploads via the AWS CLI v2, which can impact overall workflow performance.On this blog post, we will start with downloading input first. Let’s explore this in more detail.","datePublished":"2026-01-19T00:00:00.000Z","author":{"@type":"Person","name":"Thanh-Giang Tan Nguyen","description":"Founder at RIVER","url":"https://www.facebook.com/nttg8100","email":"nttg8100@gmail.com","image":"https://avatars.githubusercontent.com/u/64969412?v=4"},"image":{"@type":"ImageObject","@id":"https://riverxdata.github.io/river-docs/assets/images/nextflow_optimization-fe3c2c1da10d871e8be47657ef3626c9.svg","url":"https://riverxdata.github.io/river-docs/assets/images/nextflow_optimization-fe3c2c1da10d871e8be47657ef3626c9.svg","contentUrl":"https://riverxdata.github.io/river-docs/assets/images/nextflow_optimization-fe3c2c1da10d871e8be47657ef3626c9.svg","caption":"title image for the blog post: Bioinformatics Cost Optimization For Input Using Nextflow (Part 2)"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://riverxdata.github.io/river-docs/blog","name":"RiverXData Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/river-docs/blog/rss.xml" title="RiverXData RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/river-docs/blog/atom.xml" title="RiverXData Atom Feed">





<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0BBYTVWQV2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0BBYTVWQV2",{anonymize_ip:!0})</script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/river-docs/assets/css/styles.486b8637.css">
<script src="/river-docs/assets/js/runtime~main.63d9807a.js" defer="defer"></script>
<script src="/river-docs/assets/js/main.c967cf1d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><link rel="preload" as="image" href="/river-docs/img/logo-riverxdata-02.png"><link rel="preload" as="image" href="https://avatars.githubusercontent.com/u/64969412?v=4"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="theme-announcement-bar announcementBar_mb4j" style="background-color:#667eea;color:#ffffff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">Comming soon: Support us on GitHub Sponsors! ❤️</div></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/river-docs/"><div class="navbar__logo"><img src="/river-docs/img/logo-riverxdata-02.png" alt="RiverXData" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/river-docs/img/logo-riverxdata-02.png" alt="RiverXData" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/river-docs/docs/overview">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/river-docs/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/riverxdata/river" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="paper" style="width:95%;margin:auto;margin-top:50px"><div class="row" style="width:100%"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2026</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/setup-local-nextflow-training">Setting Up a Local Nextflow Training Environment with Code-Server and HPC</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/docker-out-docker-bioinformatics-web-apps">Docker Out of Docker: Running Interactive Web Applications for Data Analysis</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/containers-hpc-docker-singularity-apptainer">Containers on HPC: From Docker to Singularity and Apptainer</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline">How to Migrate from In-House Pipelines to Enterprise-Level Workflows: A Proven 3-Step Validation Framework</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/unix-pipes-bioinformatics-streaming-data">Unix Pipes in Bioinformatics: How Streaming Data Reduces Memory and Storage</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/bioinformatics-containers-build-efficient-docker">Containers in Bioinformatics: Community Tooling and Efficient Docker Building</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/bioinformatics-containers-build-efficient-docker">Containers in Bioinformatics: Community Tooling and Efficient Docker Building</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices">Bioinformatics Workflow Template: Standardizing Python Pipelines with Modular Design</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/cicd-bioinformatics-act-local-github-action">Running GitHub Actions Locally with act: 5x Faster Development</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/machine-learning-bioinformatics-part1-knn">Machine Learning in Bioinformatics Part 1: Building KNN from Scratch</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/intro-ai-ml-bioinformatics-applications">Introduction to AI/ML in Bioinformatics: Classification Models &amp; Evaluation</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/river-docs/blog/bioinformatics-computing-resource-optimization-part2">Bioinformatics Cost Optimization For Input Using Nextflow (Part 2)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/bioinformatics-computing-resource-optimization-part1">Bioinformatics Cost Optimization for Computing Resources Using Nextflow (Part 1)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/pixi-is-new-conda-based-era">Pixi- New conda era</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/how-to-version-control-git-bioinformatics-part-2">The Evolution of Version Control - CI/CD in bioinformatics (Part 2)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/how-to-version-control-git-bioinformatics-part-1">The Evolution of Version Control - Git&#x27;s Role in Reproducible Bioinformatics (Part 1)</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/how-to-build-slurm-hpc-part-3">Building a Slurm HPC Cluster (Part 3) - Administration and Best Practices</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/how-to-build-slurm-hpc-part-2">Building a Slurm HPC Cluster (Part 2) - Scaling to Production with Ansible</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/how-to-build-slurm-hpc-part-1">Building a Slurm HPC Cluster (Part 1) - Single Node Setup and Fundamentals</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/river-docs/blog/river-platform-and-nextflow">RIVER- A Web Application to Run Nf-Core</a></li></ul></div></nav></aside><main class="col col--6"><article class=""><header><h1 class="title_f1Hy">Bioinformatics Cost Optimization For Input Using Nextflow (Part 2)</h1><div class="container_mt6G margin-vert--md"><time datetime="2026-01-19T00:00:00.000Z">January 19, 2026</time> · <!-- -->18 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a class="avatar__photo-link" href="/river-docs/blog/authors/river"><img class="avatar__photo authorImage_XqGP" src="https://avatars.githubusercontent.com/u/64969412?v=4" alt="Thanh-Giang Tan Nguyen"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="/river-docs/blog/authors/river"><span class="authorName_yefp" translate="no">Thanh-Giang Tan Nguyen</span></a></div><small class="authorTitle_nd0D" title="Founder at RIVER">Founder at RIVER</small><div class="authorSocials_rSDt"><a href="https://www.linkedin.com/in/thanh-giang-tan-nguyen-761b28190/" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" preserveAspectRatio="xMidYMid" viewBox="0 0 256 256" style="--dark:#0a66c2;--light:#ffffffe6" class="authorSocialIcon_XYv3 linkedinSvg_FCgI"><path d="M218.123 218.127h-37.931v-59.403c0-14.165-.253-32.4-19.728-32.4-19.756 0-22.779 15.434-22.779 31.369v60.43h-37.93V95.967h36.413v16.694h.51a39.907 39.907 0 0 1 35.928-19.733c38.445 0 45.533 25.288 45.533 58.186l-.016 67.013ZM56.955 79.27c-12.157.002-22.014-9.852-22.016-22.009-.002-12.157 9.851-22.014 22.008-22.016 12.157-.003 22.014 9.851 22.016 22.008A22.013 22.013 0 0 1 56.955 79.27m18.966 138.858H37.95V95.967h37.97v122.16ZM237.033.018H18.89C8.58-.098.125 8.161-.001 18.471v219.053c.122 10.315 8.576 18.582 18.89 18.474h218.144c10.336.128 18.823-8.139 18.966-18.474V18.454c-.147-10.33-8.635-18.588-18.966-18.453"></path></svg></a><a href="https://github.com/nttg8100" target="_blank" rel="noopener noreferrer" class="authorSocialLink_owbf" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 256 250" preserveAspectRatio="xMidYMid" style="--dark:#000;--light:#fff" class="authorSocialIcon_XYv3 githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path></svg></a></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p>Amazon S3 (Simple Storage Service) is built around the concept of storing files as objects, where each file is identified by a unique key rather than a traditional file system path. While this architecture offers scalability and flexibility for storage, it can present challenges when used as a standard file system, especially in bioinformatics workflows. When running Nextflow with S3 as the input/output backend, there are trade-offs to consider—particularly when dealing with large numbers of small files. In such cases, Nextflow may spend significant time handling downloads and uploads via the AWS CLI v2, which can impact overall workflow performance.On this blog post, we will start with downloading input first. Let’s explore this in more detail.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="aws-cli">AWS CLI<a href="#aws-cli" class="hash-link" aria-label="Direct link to AWS CLI" title="Direct link to AWS CLI" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="install">Install<a href="#install" class="hash-link" aria-label="Direct link to Install" title="Direct link to Install" translate="no">​</a></h3>
<p>AWS CLI is the command line tools that helps work with AWS services. With nextflow, it can help for downloading inputs, uploading outputs.
To install this tool and the tutorial on this blog, clone this repo. The repo uses the pixi and dokcer to quickly setup</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> clone git@github.com:nttg8100/nextflow-cost-optimization.git</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> nextflow-cost-optimization</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi shell</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> aws</span><br></span></code></pre></div></div>
<p>Explain <code>Makefile</code>, the below, we will run to start the docker service, upload files and the tar file of 10k files that can be used for benchmarking later</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws-config: start-minio</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ACCESS_KEY_ID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;minioadmin&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_SECRET_ACCESS_KEY</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;minioadmin&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_DEFAULT_REGION</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;us-east-1&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ENDPOINT_URL</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;http://localhost:9000&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">sleep</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> aws s3 mb s3://io-benchmark --endpoint-url http://localhost:9000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">results/tarball.tar:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@mkdir </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> results/tarball</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@count</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">1M</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">index</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">k</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> $</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">seq</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> $$count</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token function" style="color:hsl(221, 87%, 60%)">dd</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">if</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">/dev/zero </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">of</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">results/tarball/$</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${size}</span><span class="token plain">-$</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${index}</span><span class="token plain">-</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$$</span><span class="token plain">k.data </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">bs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">count</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">seek</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$$</span><span class="token plain">size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-cvf</span><span class="token plain"> results/tarball.tar </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> results/tarball </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">upload-tar:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> results/tarball.tar s3://io-benchmark/ --endpoint-url http://localhost:9000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">upload-10k-files:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> results/tarball  s3://io-benchmark/tarball --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="start-s3-service">Start S3 service<a href="#start-s3-service" class="hash-link" aria-label="Direct link to Start S3 service" title="Direct link to Start S3 service" translate="no">​</a></h3>
<p>Now you are ready to work with S3 object storage, this one will launch the minio, the simulated compatible S3 service with AWS. That will help to minimize the error related to your local computer and the remote bucket. This will create bucket called io-benchmark. Also simulated a lot of small files that we use later for proof of concept of this issue</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> aws-config</span><br></span></code></pre></div></div>
<p>To test the s3 service</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># export env</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ACCESS_KEY_ID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;minioadmin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_SECRET_ACCESS_KEY</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;minioadmin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_DEFAULT_REGION</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;us-east-1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ENDPOINT_URL</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;http://localhost:9000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># configure threads</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws configure </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> default.s3.max_concurrent_requests </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># test bucket</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain">  --endpoint-url http://localhost:9000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1026-01-27 10:29:58 io-benchmark</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-download-independently">Testing Download Independently<a href="#testing-download-independently" class="hash-link" aria-label="Direct link to Testing Download Independently" title="Direct link to Testing Download Independently" translate="no">​</a></h3>
<p>The above file content is the <code>Makefile</code> which simulates to create 1GB in total for a folder with 10k files, each file is 1MB. Nextflow is usually has the slow performance for input by 2 main reason:</p>
<ul>
<li class="">Verify download for each file</li>
<li class="">Calculate inputs cache for all small files</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>It will create the additional tar file of these 10k files, that I will show you later why we create it and how it make your workflow easier</p></div></div>
<p>Without nextflow intervection, we want to test how long does it takes using aws cli v2 only</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="download-10k-files">Download 10k files<a href="#download-10k-files" class="hash-link" aria-label="Direct link to Download 10k files" title="Direct link to Download 10k files" translate="no">​</a></h4>
<p>Run this command to download</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> upload-10k-files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;%e&quot;</span><span class="token plain"> aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> s3://io-benchmark/tarball ./tarball --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes around 110 seconds to download files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">110.62</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">109.62</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">110.59</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="download-tarfile">Download tarfile<a href="#download-tarfile" class="hash-link" aria-label="Direct link to Download tarfile" title="Direct link to Download tarfile" translate="no">​</a></h4>
<p>Run this command to download, it will be much faster</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> upload-tar</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;%e&quot;</span><span class="token plain"> aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> s3://io-benchmark/tarball.tar </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"> --endpoint-url http://localhost:9000 </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball.tar</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 30 seconds to download this large file.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">27.50</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">26.96</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">25.35</span><br></span></code></pre></div></div>
<p>However, we need to have the small file inside, we can use pipe &quot;|&quot; to do it when we download file quickly</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;%e&quot;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;mkdir -p tarball &amp;&amp; aws s3 cp s3://io-benchmark/tarball.tar - --endpoint-url http://localhost:9000 | tar -xvf - -C tarball&#x27;</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 35 seconds to download and untar to get all small files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">33.43</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">31.80</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">33.20</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="fuse-based-system">Fuse based system<a href="#fuse-based-system" class="hash-link" aria-label="Direct link to Fuse based system" title="Direct link to Fuse based system" translate="no">​</a></h4>
<p>Beside using the aws command to download individual files or tar file, using fuse based system is the alternative approach.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">For small files: FUSE enables applications to access individual files on demand without needing to download an entire archive or use complex commands, reducing overhead and making access fast and convenient.</li>
<li class="">For large files: FUSE filesystems can fetch only the needed data chunks, allowing for efficient partial reads, sequential streaming, and avoiding unnecessary full downloads.</li>
<li class="">General advantage: Since FUSE exposes cloud storage as a standard directory tree, workflows and tools that use local files work seamlessly, enabling parallel access and integration with caching and prefetching optimizations.</li>
</ul></div></div>
<p>It can be used for using in the application that works with the large file or the folder contains many small files but it does not load entirely. For example, we annotate the variant for whole exome data but the annotation database
is used for entire genome. We can use the tool to get only a few annotated variants region. Beside, distributed engine with fuse based system can be useful for distributed loading.</p>
<p><code>Makefile</code> to quickly install mount-s3 via pixi. It will mount the whole bucket to the <code>/mnt/vep_cache</code>. This mount point is named after <code>vep</code> later it will be used direclty with VEP annotation example</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">mount-s3-vep-cache: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./mnt/vep_cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./mnt/tmp</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">mount</span><span class="token plain"> mount-s3 --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--region</span><span class="token plain"> us-east-1 --force-path-style io-benchmark ./mnt/vep_cache --read-only </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cache</span><span class="token plain"> ./mnt/tmp --max-threads </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><br></span></code></pre></div></div>
<p>Run this command to allow mount the remote s3 bucket</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> mount-s3-vep-cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># check</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">df</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Filesystem                            1K-blocks      Used     Available Use% Mounted on</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># udev                                  131907828         0     131907828   0% /dev</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                  26401936      3052      26398884   1% /run</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/mapper/ubuntu--vg-ubuntu--lv     980760096 936881112       2913808 100% /</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                 132009668         0     132009668   0% /dev/shm</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                      5120         0          5120   0% /run/lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                 132009668         0     132009668   0% /run/qemu</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop0                                65408     65408             0 100% /snap/core20/2682</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop1                                65408     65408             0 100% /snap/core20/2686</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop2                                75776     75776             0 100% /snap/core22/2216</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop3                                75776     75776             0 100% /snap/core22/2292</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop4                                93696     93696             0 100% /snap/lxd/35819</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop5                                93696     93696             0 100% /snap/lxd/36918</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop6                                52224     52224             0 100% /snap/snapd/25577</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop7                                49280     49280             0 100% /snap/snapd/25935</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/nvme0n1p2                          1992552    433904       1437408  24% /boot</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/nvme0n1p1                          1098632      6228       1092404   1% /boot/efi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># controller-01:/home                   476973568 349766144     106714624  77% /home</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                  26401932         4      26401928   1% /run/user/1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># io-benchmark                      1099511627776         0 1099511627776   0% /scratch/data/nextflow-cost-optimization/mnt/vep_cache</span><br></span></code></pre></div></div>
<p>Now we can use this to simply download 10k files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;%e&quot;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;cp -r ./mnt/vep_cache/tarball tarball &#x27;</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 45 seconds to download small files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">44.94</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">46.06</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">45.46</span><br></span></code></pre></div></div>
<p>Again, download only 10 GB tar file to see how it work</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;%e&quot;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;mkdir -p tarball &amp;&amp; cp ./mnt/vep_cache/tarball.tar tarball&#x27;</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 45 seconds to download small files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">15.60</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">15.37</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">15.74</span><br></span></code></pre></div></div>
<p>Again, download only 10 GB tar file to see how it work</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;%e&quot;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;mkdir -p tarball &amp;&amp; cat ./mnt/vep_cache/tarball.tar|tar -xvf - -C tarball&#x27;</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 45 seconds to download small files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">19.68</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">21.86</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">20.31</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap">Recap<a href="#recap" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h3>
<p>Here is a summary table of the different approaches for downloading 10k small files (1GB total) from S3, with their typical performance and recommended use cases:</p>
<table><thead><tr><th>Method</th><th>Download Time (s)</th><th>Pros</th><th>Cons</th><th>When to Use</th></tr></thead><tbody><tr><td><strong>AWS CLI (recursive, 10k files)</strong></td><td>~110</td><td>Simple, no extra setup</td><td>Very slow for many small files</td><td>Rarely; only for small numbers of files</td></tr><tr><td><strong>AWS CLI (tarball + untar via pipe)</strong></td><td>~33</td><td>Fast, single download + extraction</td><td>Needs tar/untar logic</td><td>When workflow can handle tar extraction</td></tr><tr><td><strong>FUSE (cp -r 10k files)</strong></td><td>~45</td><td>Transparent, works like local FS</td><td>Needs FUSE setup, not always fastest</td><td>When random access or partial reads are needed</td></tr><tr><td><strong>FUSE (cat tarball | tar -xvf -)</strong></td><td>~20</td><td>Fast, combines FUSE and streaming untar</td><td>Needs FUSE setup, tar logic</td><td>For large archives with extraction</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>Recommendations:</strong></p><ul>
<li class="">For many small files, avoid direct recursive downloads; use tarballs or FUSE-based solutions.</li>
<li class="">Use tarball + untar (via pipe) for best performance if you can bundle files.</li>
<li class="">FUSE is ideal for workflows needing random access or partial reads, or when you can&#x27;t change file structure.</li>
<li class="">Nextflow (v25.04+) improves small file handling, but bundling or FUSE still offers significant gains for large numbers of files.</li>
</ul></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="nextflow-integration">Nextflow integration<a href="#nextflow-integration" class="hash-link" aria-label="Direct link to Nextflow integration" title="Direct link to Nextflow integration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow">Workflow<a href="#workflow" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow" translate="no">​</a></h3>
<p>We will simply run the workflow below that will accept the inputs from S3, download to use in this process and count the number of files inside</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> COUNT_FILES </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain">  from </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;./modules/count_files_tar.nf&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> COUNT_FILES_TAR </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;./modules/count_files_tar.nf&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">workflow </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    main:        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // benchmark files input</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // normal files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.benchmark_input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            ch_files </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> COUNT_FILES</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Channel.fromPath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.inputs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">.collect</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // tarball and untar</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.benchmark_input_tar</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            ch_files </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> COUNT_FILES_TAR</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Channel.fromPath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.inputs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">.collect</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="modules">Modules<a href="#modules" class="hash-link" aria-label="Direct link to Modules" title="Direct link to Modules" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="count_files">COUNT_FILES<a href="#count_files" class="hash-link" aria-label="Direct link to COUNT_FILES" title="Direct link to COUNT_FILES" translate="no">​</a></h4>
<p>It will accept a list of files directly from s3</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process COUNT_FILES </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lah</span><span class="token plain"> tarball/**.data</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> num_files.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="count_files_tar">COUNT_FILES_TAR<a href="#count_files_tar" class="hash-link" aria-label="Direct link to COUNT_FILES_TAR" title="Direct link to COUNT_FILES_TAR" translate="no">​</a></h4>
<p>It will download the tar file first, then inside the process untar later</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>For downloading file and use pipe to quickly untar will be applied later</p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process COUNT_FILES_ </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-xf</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${file_path}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lah</span><span class="token plain"> tarball/**.data</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> num_files.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="remaining-materials">Remaining materials<a href="#remaining-materials" class="hash-link" aria-label="Direct link to Remaining materials" title="Direct link to Remaining materials" translate="no">​</a></h3>
<p>It will includes the configuration with nextflow configs, include:</p>
<ul>
<li class="">nextflow.config: Standard config to run with docker, singularity and different platform</li>
<li class="">nextflow_s3.config: S3 credential for minio storage</li>
<li class="">nextflow_tar.config: The config that run with the local file later</li>
</ul>
<p>These are the standard setup so I will not explain too much detail here, check at the below structure</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── benchmark_computing_resource.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── benchmark_input.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── inputs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── 1_samplesheet.csv</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── full_samplsheet.csv</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── LICENSE</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── modules</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── count_files.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── count_files_tar.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── fastp.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── fastqc.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── vep.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── nextflow.config</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── nextflow_s3.config</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── nextflow_tar.config</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── pixi.lock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── pixi.toml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── README.md</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing">Testing<a href="#testing" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing" translate="no">​</a></h3>
<p>Using <code>Makefile</code> to simplify the process, it will run with different configuration. For proof of concepts, run once</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-input-standard: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> standard nextflow run benchmark_input.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--benchmark_input</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--inputs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;s3://io-benchmark/tarball&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-input-tar: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> standard nextflow run benchmark_input.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--benchmark_input_tar</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--inputs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;s3://io-benchmark/tmp.txt&quot;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-with-10k-files-as-input">Running with 10k files as input<a href="#running-with-10k-files-as-input" class="hash-link" aria-label="Direct link to Running with 10k files as input" title="Direct link to Running with 10k files as input" translate="no">​</a></h4>
<p>Run the command below</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-input-standard</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 42,34s user 7,04s system 77% cpu 1:03,97 total</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-with-1-large-file-untar-in-the-process">Running with 1 large file, untar in the process<a href="#running-with-1-large-file-untar-in-the-process" class="hash-link" aria-label="Direct link to Running with 1 large file, untar in the process" title="Direct link to Running with 1 large file, untar in the process" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-input-tar</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 11,80s user 3,42s system 66% cpu 22,965 total</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="magic-improvement">Magic improvement<a href="#magic-improvement" class="hash-link" aria-label="Direct link to Magic improvement" title="Direct link to Magic improvement" translate="no">​</a></h3>
<p>Although we have show that we can use the single large tar file as input and download inside. However, we have to change the module. Is there any
configuration can help ? Linking with previous section on using pipe after downloading, we can use this config</p>
<p>What it does it that it will use the same module while the files can be ingested using <code>beforeScript</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process{</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:COUNT_FILES{</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        beforeScript = &quot;mkdir -p tarball &amp;&amp; aws s3 cp s3://io-benchmark/tarball.tar - --endpoint-url http://localhost:9000 | tar -xvf - -C tarball&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>The command to run workflow, we can use a file to keep a place holder for nextflow to accept the input and also we add the config <code>nextflow_tar.config</code></p>
<div class="language-Makefile language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-input-tar-pipe: ${HOME}/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	${HOME}/.pixi/bin/pixi run -e standard nextflow run benchmark_input.nf \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		-c nextflow_s3.config -c nextflow_tar.config \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		--benchmark_input \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		--inputs=&quot;s3://io-benchmark/tmp.txt&quot;</span><br></span></code></pre></div></div>
<p>Remember to create the temp file and upload to the bucket</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> tmp.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> tmp.txt  s3://io-benchmark --endpoint-url http://localhost:9000 </span><br></span></code></pre></div></div>
<p>Running the new setup</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-input-tar-pipe</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 11,33s user 2,85s system 82% cpu 17,166 total</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap-1">Recap<a href="#recap-1" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">Using tar file and nextflow config can help reduce x3 times for downloading multiple small files as input</li>
<li class="">We do not need to modify the existing module</li>
</ul></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="genomics-england-case-study">Genomics England case study<a href="#genomics-england-case-study" class="hash-link" aria-label="Direct link to Genomics England case study" title="Direct link to Genomics England case study" translate="no">​</a></h2>
<p>Reference: <strong><a href="https://aws.amazon.com/blogs/hpc/optimize-nextflow-workflows-on-aws-batch-with-mountpoint-for-amazon-s3/" target="_blank" rel="noopener noreferrer" class="">https://aws.amazon.com/blogs/hpc/optimize-nextflow-workflows-on-aws-batch-with-mountpoint-for-amazon-s3/</a></strong>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="issues">Issues<a href="#issues" class="hash-link" aria-label="Direct link to Issues" title="Direct link to Issues" translate="no">​</a></h3>
<p>Now we can consider on what can be the issue that we can face with in the real problem. And how can we apply this
Here, I found that the blog that how Genomic England can solve the similar issue when they want to use VEP to annotate their variants.
The database that they used has many small files with 500GB in total. It will take more time to download data while takes a few minutes to annotate.</p>
<p>The pseudo code</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process VEP </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">vcf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">vep_cache</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    vep </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--input_file</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$vcf</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--fasta</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$params</span><span class="token plain">.human_reference_fasta </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--dir_cache</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$vep_cache</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow-and-modules">Workflow and modules<a href="#workflow-and-modules" class="hash-link" aria-label="Direct link to Workflow and modules" title="Direct link to Workflow and modules" translate="no">​</a></h3>
<p>Worflow is written simply to use only VEP module. Here to quickly reproduce, all parameters are hard coded</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> ENSEMBLVEP_VEP </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;./modules/vep.nf&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">workflow </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    main:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ENSEMBLVEP_VEP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.of</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">tuple</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">id: </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;HCC1395N&#x27;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">, file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;inputs/vep_test_data.vcf.gz&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;inputs/vep_test_data.vcf.gz.tbi&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">vcf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">custom_extra_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.value</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;GRCh38&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // val genome</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.value</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;homo_sapiens&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // val species</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.value</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">114</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // val cache_version</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.fromPath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;s3://io-benchmark/vep_cache&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // path cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.of</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">tuple</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">, </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token plain">, // tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fasta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.of</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> // path extra_files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>VEP module is collected from <a href="https://github.com/nf-core/sarek/blob/20f41d1ce8b7ba296ee22adc71fe2da2ebcae93f/modules/nf-core/ensemblvep/vep/main.nf" target="_blank" rel="noopener noreferrer" class=""><strong>nf-core</strong></a></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process ENSEMBLVEP_VEP </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tag </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    label </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;process_medium&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    conda </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${moduleDir}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/environment.yml&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${workflow.containerEngine == &#x27;singularity&#x27; &amp;&amp; </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">task.ext.singularity_pull_docker_container</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        ? &#x27;https</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">community-cr-prod.seqera.io</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">docker</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">registry</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">v2</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">blobs</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">sha256</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">4b</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">4b5a8c173dc9beaa93effec76b99687fc926b1bd7be47df5d6ce19d7d6b4d6b7</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">data&#x27;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> &#x27;community.wave.seqera.io</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">library</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">ensembl-vep</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">115.2--90ec797ecb088e9a&#x27;}</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">vcf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">custom_extra_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val genome</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val species</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val cache_version</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fasta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path extra_files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;*.vcf.gz&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: vcf, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;*.vcf.gz.tbi&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: tbi, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;*.tab.gz&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: tab, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;*.json.gz&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: json, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;*.html&quot;</span><span class="token plain">, emit: report, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;versions.yml&quot;</span><span class="token plain">, emit: versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    when:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    task.ext.when </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> task.ext.when</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def args </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.args ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def args2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.args2 ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def file_extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;--vcf&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;vcf&#x27;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;--json&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;json&#x27;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;--tab&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;tab&#x27;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;vcf&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def compress_cmd </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;--compress_output&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;&#x27;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;--compress_output bgzip&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def dir_cache </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> cache ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token string variable environment constant" style="color:hsl(35, 99%, 36%)">PWD</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${cache}</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;/.vep&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def reference </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> fasta ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;--fasta </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${fasta}</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def create_index </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> file_extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;vcf&quot;</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;tabix </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${args2}</span><span class="token string" style="color:hsl(119, 34%, 47%)"> </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${file_extension}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.gz&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    vep </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${vcf}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${file_extension}</span><span class="token plain">.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${args}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${compress_cmd}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${reference}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--assembly</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${genome}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--species</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${species}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cache</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cache_version</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${cache_version}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--dir_cache</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${dir_cache}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--fork</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${task.cpus}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${create_index}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ensemblvep: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">vep </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--help</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">&#x27;s/^.*Versions:.*ensembl-vep : //;s/ .*\$//&#x27;</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        tabix: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">tabix </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-h</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">&#x27;s/^.*Version: //; s/ .*\$//&#x27;</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    stub:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def file_extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;--vcf&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;vcf&#x27;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;--json&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;json&#x27;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;--tab&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;tab&#x27;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&#x27;vcf&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def create_index </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> file_extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;vcf&quot;</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;touch </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${file_extension}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.gz.tbi&quot;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">gzip</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${file_extension}</span><span class="token plain">.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${create_index}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_summary.html</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ensemblvep: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">vep </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--help</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">&#x27;s/^.*Versions:.*ensembl-vep : //;s/ .*\$//&#x27;</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        tabix: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">tabix </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-h</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">&#x27;s/^.*Version: //; s/ .*\$//&#x27;</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&quot;</span><span class="token plain">&quot;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>Their solution is showed below
<img decoding="async" loading="lazy" alt="solution" src="/river-docs/assets/images/variant_annotation_aws-15d43bdb7357f6f01ab875ad3c907ba6.png" width="1024" height="811" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="inputs">Inputs<a href="#inputs" class="hash-link" aria-label="Direct link to Inputs" title="Direct link to Inputs" translate="no">​</a></h3>
<p>The vcf file is prepared on the <code>inputs</code> folder, while the vep cache database (25.GB) can be prepared as below on Makefile.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">vep/114_GRCh38: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> vep</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> vep/vep_cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> vep </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core aws s3 --no-sign-request </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> s3://annotation-cache/vep_cache/114_GRCh38 114_GRCh38 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">vep/vep_cache.tar: vep/114_GRCh38</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-cvf</span><span class="token plain"> vep/vep_cache.tar </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> vep/114_GRCh38 </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">upload-vep-cache: vep/vep_cache.tar</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> vep/114_GRCh38 s3://io-benchmark/ --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> vep/vep_cache.tar s3://io-benchmark/ --endpoint-url http://localhost:9000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">mount-s3-vep-cache: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./mnt/vep_cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./mnt/tmp</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">mount</span><span class="token plain"> mount-s3 --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--region</span><span class="token plain"> us-east-1 --force-path-style io-benchmark ./mnt/vep_cache --read-only </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cache</span><span class="token plain"> ./mnt/tmp --max-threads </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><br></span></code></pre></div></div>
<p>Simply run</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># download and upload to local s3</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> upload-vep-cach</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># mount to local folder from local s3 via mountpoint-s3 </span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> mount-s3-vep-cache</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="benchmark">Benchmark<a href="#benchmark" class="hash-link" aria-label="Direct link to Benchmark" title="Direct link to Benchmark" translate="no">​</a></h3>
<p>Here, I prepred the <code>Makefile</code> command to benchmark it quickly</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-local: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core nextflow run benchmark_vep.nf </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;./vep/114_GRCh38&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-mount-cache: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core nextflow run benchmark_vep.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_vep_mount.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;./mnt/vep_cache/114_GRCh38&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-direct-s3: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core  nextflow run benchmark_vep.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;s3://io-benchmark/114_GRCh38&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-tar-cache: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core nextflow run benchmark_vep.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_vep_tar.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;s3://io-benchmark/vep_cache&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-mount-tar: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core nextflow run benchmark_vep.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_vep_mount_tar.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;s3://io-benchmark/vep_cache&quot;</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><br></span></code></pre></div></div>
<p>Now we can simply run the relative example test</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">test-vep-benchmarl</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><br></span></code></pre></div></div>
<p>The following table summarizes the benchmark results for different approaches to accessing the VEP cache database during analysis:</p>
<table><thead><tr><th>Method</th><th>Command</th><th style="text-align:center">Time (min<!-- -->:sec<!-- -->)</th></tr></thead><tbody><tr><td>Local cache</td><td><code>make test-vep-local</code></td><td style="text-align:center">2:26.20</td></tr><tr><td>S3 mount (FUSE)</td><td><code>make test-vep-mount-cache</code></td><td style="text-align:center">2:31.08</td></tr><tr><td>S3 mount tar (FUSE)</td><td><code>make test-vep-mount-tar</code></td><td style="text-align:center">5:57.18</td></tr><tr><td>Direct S3 access</td><td><code>make test-vep-direct-s3</code></td><td style="text-align:center">6:32.63</td></tr><tr><td>S3 tar cache</td><td><code>make test-vep-tar-cache</code></td><td style="text-align:center">6:02.52</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li class="">As mentioned above, it does not need to download all of the database cache to annotate for the small vcf region files. That&#x27;s why mounting the whole database is the best solution in this case</li>
<li class="">Replacing the VEP command with <code>cp \$(readlink $cache) tmp -r</code> in the module shows that it takes <code>4:16.09</code> to read from mount point and copy the whole folder to the new temporary folder.</li>
<li class="">Depended on your specific infrastructure, customize based on your need</li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap-2">Recap<a href="#recap-2" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h3>
<ul>
<li class="">Using tar files and untarring large inputs does not always guarantee significant performance improvements. The benefit depends on the number of files and the total size of your input folder.</li>
<li class="">If your tool only accesses a subset of the input files (rather than the entire folder), performance may be similar to having the database already available locally.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap-3">Recap<a href="#recap-3" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h2>
<p>This comprehensive exploration of Nextflow&#x27;s S3 integration revealed several key insights:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-analysis">Performance Analysis<a href="#performance-analysis" class="hash-link" aria-label="Direct link to Performance Analysis" title="Direct link to Performance Analysis" translate="no">​</a></h3>
<ul>
<li class=""><strong>Small files vs Large files</strong>: Nextflow handles large single files efficiently but struggles with many small files due to per-file operations</li>
<li class=""><strong>Download methods</strong>: Tar files significantly outperform recursive downloads for small file collections (5x faster)</li>
<li class=""><strong>FUSE benefits</strong>: Mount points provide transparent access with better performance and does not require large disk size for local storage.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="optimization-strategies">Optimization Strategies<a href="#optimization-strategies" class="hash-link" aria-label="Direct link to Optimization Strategies" title="Direct link to Optimization Strategies" translate="no">​</a></h3>
<ul>
<li class=""><strong>Bundle small files</strong>: Use tar archives when dealing with numerous files (10k+ small files)</li>
<li class=""><strong>Stream processing</strong>: Pipe extraction for immediate processing without full download</li>
<li class=""><strong>Smart caching</strong>: Leverage FUSE-based caching for databases and reference data</li>
<li class=""><strong>Choose the right tool</strong>: Select download method based on file count and access patterns</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="practical-applications">Practical Applications<a href="#practical-applications" class="hash-link" aria-label="Direct link to Practical Applications" title="Direct link to Practical Applications" translate="no">​</a></h3>
<ul>
<li class=""><strong>Genomics England case study</strong>: FUSE-based VEP annotation</li>
<li class=""><strong>Bioinformatics pipelines</strong>: The principles apply to any workflow using remote data storage</li>
<li class=""><strong>Cost considerations</strong>: Reduced download time + smaller disk size = lower compute costs on cloud platforms.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h3>
<ol>
<li class=""><strong>Profile before optimizing</strong>: Measure actual bottlenecks in your specific workflows</li>
<li class=""><strong>Consider file distribution</strong>: Many small ≠ few large when choosing download strategies</li>
<li class=""><strong>Use Nextflow v25.04+</strong>: Improved small file handling reduces need for workarounds</li>
<li class=""><strong>Leverage FUSE</strong>: Provides transparent access with better performance than CLI tools</li>
<li class=""><strong>Design for scale</strong>: Build workflows that work efficiently with your data characteristics</li>
</ol>
<p>Whether you&#x27;re working with thousands of small files or terabytes of reference data, understanding these patterns helps you design more efficient, cost-effective bioinformatics workflows.</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/river-docs/blog/tags/nextflow">nextflow</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/river-docs/blog/tags/hpc">hpc</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/river-docs/blog/tags/workflow-optimization">workflow-optimization</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/river-docs/blog/intro-ai-ml-bioinformatics-applications"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Introduction to AI/ML in Bioinformatics: Classification Models &amp; Evaluation</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/river-docs/blog/bioinformatics-computing-resource-optimization-part1"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Bioinformatics Cost Optimization for Computing Resources Using Nextflow (Part 1)</div></a></nav></main><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#aws-cli" class="table-of-contents__link toc-highlight">AWS CLI</a><ul><li><a href="#install" class="table-of-contents__link toc-highlight">Install</a></li><li><a href="#start-s3-service" class="table-of-contents__link toc-highlight">Start S3 service</a></li><li><a href="#testing-download-independently" class="table-of-contents__link toc-highlight">Testing Download Independently</a><ul><li><a href="#download-10k-files" class="table-of-contents__link toc-highlight">Download 10k files</a></li><li><a href="#download-tarfile" class="table-of-contents__link toc-highlight">Download tarfile</a></li><li><a href="#fuse-based-system" class="table-of-contents__link toc-highlight">Fuse based system</a></li></ul></li><li><a href="#recap" class="table-of-contents__link toc-highlight">Recap</a></li></ul></li><li><a href="#nextflow-integration" class="table-of-contents__link toc-highlight">Nextflow integration</a><ul><li><a href="#workflow" class="table-of-contents__link toc-highlight">Workflow</a></li><li><a href="#modules" class="table-of-contents__link toc-highlight">Modules</a><ul><li><a href="#count_files" class="table-of-contents__link toc-highlight">COUNT_FILES</a></li><li><a href="#count_files_tar" class="table-of-contents__link toc-highlight">COUNT_FILES_TAR</a></li></ul></li><li><a href="#remaining-materials" class="table-of-contents__link toc-highlight">Remaining materials</a></li><li><a href="#testing" class="table-of-contents__link toc-highlight">Testing</a><ul><li><a href="#running-with-10k-files-as-input" class="table-of-contents__link toc-highlight">Running with 10k files as input</a></li><li><a href="#running-with-1-large-file-untar-in-the-process" class="table-of-contents__link toc-highlight">Running with 1 large file, untar in the process</a></li></ul></li><li><a href="#magic-improvement" class="table-of-contents__link toc-highlight">Magic improvement</a></li><li><a href="#recap-1" class="table-of-contents__link toc-highlight">Recap</a></li></ul></li><li><a href="#genomics-england-case-study" class="table-of-contents__link toc-highlight">Genomics England case study</a><ul><li><a href="#issues" class="table-of-contents__link toc-highlight">Issues</a></li><li><a href="#workflow-and-modules" class="table-of-contents__link toc-highlight">Workflow and modules</a></li><li><a href="#inputs" class="table-of-contents__link toc-highlight">Inputs</a></li><li><a href="#benchmark" class="table-of-contents__link toc-highlight">Benchmark</a></li><li><a href="#recap-2" class="table-of-contents__link toc-highlight">Recap</a></li></ul></li><li><a href="#recap-3" class="table-of-contents__link toc-highlight">Recap</a><ul><li><a href="#performance-analysis" class="table-of-contents__link toc-highlight">Performance Analysis</a></li><li><a href="#optimization-strategies" class="table-of-contents__link toc-highlight">Optimization Strategies</a></li><li><a href="#practical-applications" class="table-of-contents__link toc-highlight">Practical Applications</a></li><li><a href="#key-takeaways" class="table-of-contents__link toc-highlight">Key Takeaways</a></li></ul></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/river-docs/docs/overview">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/river-docs/blog">Blog</a></li><li class="footer__item"><a href="https://www.facebook.com/groups/1134438583997171" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://github.com/riverxdata/river" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://riverxdata.github.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">About RiverXData<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2026 RiverXData</div></div></div></footer></div>
</body>
</html>