<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="atom.xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://riverxdata.github.io/river-docs/blog</id>
    <title>RiverXData Blog</title>
    <updated>2026-02-02T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://riverxdata.github.io/river-docs/blog"/>
    <subtitle>RiverXData Blog</subtitle>
    <icon>https://riverxdata.github.io/river-docs/img/logo-riverxdata-02.png</icon>
    <entry>
        <title type="html"><![CDATA[Machine Learning in Bioinformatics Part 1: Building KNN from Scratch]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn</id>
        <link href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn"/>
        <updated>2026-02-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Machine learning is transforming bioinformatics, enabling us to discover patterns in biological data. In this first part, we'll build a K-Nearest Neighbors (KNN) classifier from scratch using only Python, then apply it to simulated gene expression data. This post is designed for anyone who knows basic Python and biology—no advanced ML experience required!]]></summary>
        <content type="html"><![CDATA[<p>Machine learning is transforming bioinformatics, enabling us to discover patterns in biological data. In this first part, we'll build a K-Nearest Neighbors (KNN) classifier from scratch using only Python, then apply it to simulated gene expression data. This post is designed for anyone who knows basic Python and biology—no advanced ML experience required!</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-machine-learning-in-bioinformatics">Why Machine Learning in Bioinformatics?<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#why-machine-learning-in-bioinformatics" class="hash-link" aria-label="Direct link to Why Machine Learning in Bioinformatics?" title="Direct link to Why Machine Learning in Bioinformatics?" translate="no">​</a></h2>
<p>Biologists today collect massive amounts of data:</p>
<ul>
<li class=""><strong>Gene expression</strong> from thousands of genes across different conditions</li>
<li class=""><strong>Patient samples</strong> with different disease states or treatment responses</li>
<li class=""><strong>Protein sequences</strong> that need classification</li>
<li class=""><strong>Imaging data</strong> from microscopy or medical scans</li>
</ul>
<p>Manually analyzing this data is impossible. Machine learning helps us:</p>
<ol>
<li class=""><strong>Find patterns</strong>: Automatically discover which genes distinguish disease types</li>
<li class=""><strong>Make predictions</strong>: Classify new patients based on gene expression patterns</li>
<li class=""><strong>Understand biology</strong>: Identify important features in biological systems</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-knn">What is KNN?<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#what-is-knn" class="hash-link" aria-label="Direct link to What is KNN?" title="Direct link to What is KNN?" translate="no">​</a></h2>
<p>K-Nearest Neighbors (KNN) is one of the simplest yet powerful machine learning algorithms:</p>
<p><strong>The Idea</strong>: To classify a new sample, look at its K closest neighbors in your training data and vote on the class.</p>
<p><strong>Simple Example</strong>:</p>
<ul>
<li class="">Imagine you have cancer and normal patient samples plotted by gene expression</li>
<li class="">A new patient arrives</li>
<li class="">You find the 3 nearest patient samples (K=3)</li>
<li class="">If 2 are cancer and 1 is normal, you classify the new patient as cancer</li>
</ul>
<p><strong>Why start with KNN?</strong></p>
<ul>
<li class="">Easy to understand (no complex math)</li>
<li class="">Works well for bioinformatics data</li>
<li class="">Teaches core ML concepts: distance metrics, classification, and parameter tuning</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-1-building-knn-from-scratch">Part 1: Building KNN from Scratch<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#part-1-building-knn-from-scratch" class="hash-link" aria-label="Direct link to Part 1: Building KNN from Scratch" title="Direct link to Part 1: Building KNN from Scratch" translate="no">​</a></h2>
<p>Let's code KNN step-by-step in Python. You'll understand exactly what's happening.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1-import-libraries-and-create-simulated-gene-expression-data">Step 1: Import Libraries and Create Simulated Gene Expression Data<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#step-1-import-libraries-and-create-simulated-gene-expression-data" class="hash-link" aria-label="Direct link to Step 1: Import Libraries and Create Simulated Gene Expression Data" title="Direct link to Step 1: Import Libraries and Create Simulated Gene Expression Data" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> collections </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> Counter</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Set random seed for reproducibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">42</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Simulate gene expression data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Let's say we have 100 samples with 2 genes (for easy visualization)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># In reality, we'd have thousands of genes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">create_gene_expression_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Simulate gene expression data for two disease types</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Gene expression = measured as normalized counts (e.g., from RNA-seq)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Class 0: Normal samples</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># These samples show low expression in both genes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    normal </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">loc</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> scale</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Class 1: Disease samples</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># These samples show higher expression, especially in gene 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    disease </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">loc</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> scale</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Combine data and create labels</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    X </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">vstack</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">normal</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> disease</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Features (gene expression)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    y </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">hstack</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ones</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Labels (0=normal, 1=disease)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Load data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> create_gene_expression_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Split into training and test sets</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">train_size </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_test </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">train_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">train_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_test </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">train_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">train_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Training set: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X_train</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> samples with </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X_train</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> genes"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Test set: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X_test</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> samples with </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X_test</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> genes"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Training set: 80 samples with 2 genes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Test set: 20 samples with 2 genes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Classes: 50 Normal, 50 Disease</span><br></span></code></pre></div></div>
<p><strong>What we did:</strong></p>
<ul>
<li class="">Created 100 simulated patients (50 normal, 50 disease)</li>
<li class="">Each patient has expression levels for 2 genes</li>
<li class="">Normal patients: ~5 expression (biologically, lower expression)</li>
<li class="">Disease patients: ~8 expression (biologically, higher expression)</li>
<li class="">Split 80 samples for training, 20 for testing</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-2-calculate-distance-between-samples">Step 2: Calculate Distance Between Samples<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#step-2-calculate-distance-between-samples" class="hash-link" aria-label="Direct link to Step 2: Calculate Distance Between Samples" title="Direct link to Step 2: Calculate Distance Between Samples" translate="no">​</a></h3>
<p>KNN finds the "closest" neighbors. We need a distance metric. Let's implement <strong>Euclidean distance</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">euclidean_distance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> sample2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Calculate Euclidean distance between two samples.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Distance = sqrt((x1-x2)² + (y1-y2)² + ...)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    This measures "how different" two patients' gene expression profiles are.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">sqrt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> sample2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Test distance calculation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sample_a </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">5.2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4.8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Normal patient (low expression)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sample_b </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">8.1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8.3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Disease patient (high expression)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sample_c </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">5.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4.9</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Another normal patient (similar to A)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">dist_a_to_b </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> euclidean_distance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_a</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> sample_b</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">dist_a_to_c </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> euclidean_distance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_a</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> sample_c</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Distance from normal A to disease B: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">dist_a_to_b</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Distance from normal A to normal C: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">dist_a_to_c</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"→ A is closer to C (similar class) than B"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Distance from normal A to disease B: 4.55</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Distance from normal A to normal C: 0.32</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">→ A is closer to C (similar class) than B ✓</span><br></span></code></pre></div></div>
<p>This is the key insight: <strong>samples from the same class are closer together!</strong></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-3-find-k-nearest-neighbors">Step 3: Find K Nearest Neighbors<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#step-3-find-k-nearest-neighbors" class="hash-link" aria-label="Direct link to Step 3: Find K Nearest Neighbors" title="Direct link to Step 3: Find K Nearest Neighbors" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">find_nearest_neighbors</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">query_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> training_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> training_labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Find the K nearest neighbors to a query sample.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Returns:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    - distances: distance to each training sample</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    - indices: index of each training sample</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    - neighbor_labels: class labels of the K nearest neighbors</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate distance from query to all training samples</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> train_sample </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">enumerate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">training_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        dist </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> euclidean_distance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">query_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> train_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">dist</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Find indices of K smallest distances</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># argsort returns indices in ascending order</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    k_indices </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">argsort</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Get labels of K nearest neighbors</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    neighbor_labels </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> training_labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">k_indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    neighbor_distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">k_indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> neighbor_distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k_indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> neighbor_labels</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Test with a new patient (test sample)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">new_patient </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># First test patient</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">k </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> labels </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> find_nearest_neighbors</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">new_patient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"New patient gene expression: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">new_patient</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nK=</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">k</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> nearest neighbors:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">idx</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> dist</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">enumerate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">zip</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    class_name </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Normal"</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> label </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Disease"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Neighbor </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">class_name</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> patient (distance: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">dist</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">New patient gene expression: [6.53797749 9.18062691]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K=3 nearest neighbors:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Neighbor 1: Disease patient (distance: 0.38)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Neighbor 2: Disease patient (distance: 0.49)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Neighbor 3: Disease patient (distance: 0.94)</span><br></span></code></pre></div></div>
<p><strong>What's happening</strong>: All 3 nearest neighbors are disease patients, so the KNN algorithm will predict "Disease" for this new patient.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-4-vote-for-the-class">Step 4: Vote for the Class<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#step-4-vote-for-the-class" class="hash-link" aria-label="Direct link to Step 4: Vote for the Class" title="Direct link to Step 4: Vote for the Class" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">predict_single_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">query_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> training_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> training_labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Predict the class of a query sample using KNN voting.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Algorithm:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    1. Find K nearest neighbors</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    2. Count votes for each class</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    3. Return the most common class (majority vote)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> neighbor_labels </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> find_nearest_neighbors</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        query_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> training_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> training_labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Count votes for each class</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    votes </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Counter</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">neighbor_labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Return class with most votes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    prediction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> votes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">most_common</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> prediction</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Predict on a new patient</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">prediction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> predict_single_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">new_patient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">true_label </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Predicted class: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'Normal'</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token string-interpolation interpolation"> prediction </span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'Disease'</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"True class: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'Normal'</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token string-interpolation interpolation"> true_label </span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'Disease'</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Correct: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">prediction </span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation"> true_label</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> ✓"</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> prediction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> true_label </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Correct: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">prediction </span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation"> true_label</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> ✗"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Predicted class: Disease</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">True class: Disease</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Correct: True ✓</span><br></span></code></pre></div></div>
<p>Perfect! Our KNN classifier correctly predicted this patient as having the disease. This shows the power of voting: even though one neighbor had distance 0.94, the majority (2 out of 3) voted for disease, leading to the correct prediction.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-5-build-the-complete-knn-classifier">Step 5: Build the Complete KNN Classifier<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#step-5-build-the-complete-knn-classifier" class="hash-link" aria-label="Direct link to Step 5: Build the Complete KNN Classifier" title="Direct link to Step 5: Build the Complete KNN Classifier" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">KNNClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    A simple KNN classifier for bioinformatics data classification.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Parameters:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    - k: number of nearest neighbors to consider</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    - distance_metric: 'euclidean' (default) or 'manhattan'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> distance_metric</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">'euclidean'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">k </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> k</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">distance_metric </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> distance_metric</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">X_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">distance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> sample1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> sample2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Calculate distance between two samples."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">distance_metric </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'euclidean'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Euclidean: sqrt(sum of squared differences)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">sqrt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> sample2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">elif</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">distance_metric </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'manhattan'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Manhattan: sum of absolute differences</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Like walking on a city grid instead of straight line</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">abs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> sample2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">raise</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Unknown distance metric"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">        Store training data.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">        KNN is a "lazy learner" - it doesn't learn patterns,</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">        it just memorizes the training data.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">        """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">X_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X_train</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> y_train</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"✓ Stored </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation">X_train</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> training samples"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Predict class for all test samples."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> sample </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate distances to all training samples</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">distance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> train_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> train_sample </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">X_train</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Find K nearest neighbors</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            k_indices </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">argsort</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            neighbor_labels </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">k_indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Vote for the most common class</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            votes </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Counter</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">neighbor_labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            prediction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> votes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">most_common</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            predictions</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">prediction</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">score</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Calculate accuracy on test set."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        accuracy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> accuracy</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create and train the classifier</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">knn </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> KNNClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Make predictions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">accuracy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">score</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nKNN Classifier Performance:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"K = 3"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Accuracy on test set: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">accuracy</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Correct predictions: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation">y_pred </span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation"> y_test</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation">y_test</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">✓ Stored 80 training samples</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">KNN Classifier Performance:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K = 3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Accuracy on test set: 90.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Correct predictions: 18/20</span><br></span></code></pre></div></div>
<p>Excellent! Our KNN classifier achieves 90% accuracy on the test set—correctly predicting the disease status of 18 out of 20 patients based on gene expression patterns.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-2-tuning-parameters">Part 2: Tuning Parameters<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#part-2-tuning-parameters" class="hash-link" aria-label="Direct link to Part 2: Tuning Parameters" title="Direct link to Part 2: Tuning Parameters" translate="no">​</a></h2>
<p>The power of KNN comes from parameter tuning. Let's experiment!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="experiment-1-effect-of-k-value">Experiment 1: Effect of K Value<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#experiment-1-effect-of-k-value" class="hash-link" aria-label="Direct link to Experiment 1: Effect of K Value" title="Direct link to Experiment 1: Effect of K Value" translate="no">​</a></h3>
<p>K controls how many neighbors to consider. What's the best value?</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Test different K values</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">k_values </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">7</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">9</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">15</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">train_accuracies </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test_accuracies </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> k </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> k_values</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    knn </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> KNNClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    train_acc </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">score</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    test_acc </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">score</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    train_accuracies</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">train_acc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    test_accuracies</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">test_acc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"K=</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">k</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">2d</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> | Train: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">train_acc</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> | Test: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">test_acc</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K= 1 | Train: 100.00% | Test: 90.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K= 3 | Train: 96.25% | Test: 90.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K= 5 | Train: 97.50% | Test: 95.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K= 7 | Train: 93.75% | Test: 95.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K= 9 | Train: 96.25% | Test: 95.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K=15 | Train: 95.00% | Test: 90.00%</span><br></span></code></pre></div></div>
<p><strong>Observations:</strong></p>
<ul>
<li class=""><strong>K=1</strong>: Perfect on training (100%) but may overfit (memorizing individual patients)</li>
<li class=""><strong>K=3-5</strong>: Good balance on both training and test sets</li>
<li class=""><strong>K=7-9</strong>: Smoother, robust predictions</li>
<li class=""><strong>K=15</strong>: All neighbors voted, might be too general (underfit)</li>
</ul>
<p><strong>Biological interpretation:</strong></p>
<ul>
<li class="">Small K (1-3): Very sensitive to each patient's unique gene expression</li>
<li class="">Medium K (5-7): Balanced—considers local gene expression patterns while being robust</li>
<li class="">Large K (15): Very general—might miss subtle disease signatures but robust to noise</li>
</ul>
<p>The sweet spot for this dataset appears to be <strong>K=5-7</strong>, where test accuracy plateaus at 95%.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="experiment-2-distance-metric-comparison">Experiment 2: Distance Metric Comparison<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#experiment-2-distance-metric-comparison" class="hash-link" aria-label="Direct link to Experiment 2: Distance Metric Comparison" title="Direct link to Experiment 2: Distance Metric Comparison" translate="no">​</a></h3>
<p>Does it matter how we measure distance?</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Compare Euclidean vs Manhattan distance</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'euclidean'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'manhattan'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">results </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"\nComparing Distance Metrics:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"-"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> dist_metric </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    accuracies </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> k </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> k_values</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        knn </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> KNNClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> distance_metric</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">dist_metric</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        test_acc </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">score</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        accuracies</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">test_acc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    results</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">dist_metric</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> accuracies</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"\nDistance Metric Comparison:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'K'</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">&lt;5</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'Euclidean'</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">&lt;15</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'Manhattan'</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">&lt;15</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"-"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">35</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> eucl_acc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> manh_acc </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">zip</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">k_values</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> results</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'euclidean'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> results</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'manhattan'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">k</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">&lt;5</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">eucl_acc</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">&lt;14.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">manh_acc</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">&lt;14.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"\nBest parameters:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> dist_metric </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    best_k </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> k_values</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">results</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">dist_metric</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    best_acc </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">max</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">results</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">dist_metric</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">dist_metric</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">: K=</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">best_k</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">, Accuracy=</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">best_acc</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Comparing Distance Metrics:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">--------------------------------------------------</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Distance Metric Comparison:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K     Euclidean       Manhattan       </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-------------------------------------</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1     90.00%          90.00%          </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">3     90.00%          90.00%          </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">5     95.00%          95.00%          </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">7     95.00%          95.00%          </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">9     95.00%          95.00%          </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">15    90.00%          90.00%          </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Best parameters:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  euclidean: K=5, Accuracy=95.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  manhattan: K=5, Accuracy=95.00%</span><br></span></code></pre></div></div>
<p><strong>Key Findings:</strong></p>
<ul>
<li class=""><strong>Both metrics perform identically</strong> for this gene expression dataset</li>
<li class=""><strong>Euclidean distance</strong> is generally preferred for continuous data like gene expression</li>
<li class=""><strong>Manhattan distance</strong> (sum of absolute differences) can be useful for high-dimensional data or when features have different scales</li>
<li class="">For bioinformatics applications with normalized gene expression data, <strong>Euclidean distance is the safer default</strong></li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-knn-learns-the-decision-boundary">How KNN Learns the Decision Boundary<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#how-knn-learns-the-decision-boundary" class="hash-link" aria-label="Direct link to How KNN Learns the Decision Boundary" title="Direct link to How KNN Learns the Decision Boundary" translate="no">​</a></h2>
<p>Even though KNN is a "lazy learner" that doesn't explicitly learn patterns, it implicitly learns decision boundaries through distance-based voting.</p>
<p><strong>What happened in our experiment:</strong></p>
<ul>
<li class="">Normal patients cluster around gene expression ≈ [5, 5]</li>
<li class="">Disease patients cluster around gene expression ≈ [8, 8]</li>
<li class="">When classifying a new patient, KNN votes based on proximity to these clusters</li>
<li class="">This creates a natural decision boundary between the two classes</li>
</ul>
<p><strong>For our 2-gene example with K=5:</strong></p>
<ul>
<li class="">Test accuracy: 95% (18 out of 20 patients correct)</li>
<li class="">The 2 misclassified patients were likely on the boundary between normal and disease</li>
<li class="">In real bioinformatics with thousands of genes, KNN works even better because true disease signatures are stronger across many genes</li>
</ul>
<p><strong>Why KNN works for gene expression data:</strong></p>
<ol>
<li class=""><strong>Genes cluster by function</strong>: Genes involved in the same pathway have correlated expression</li>
<li class=""><strong>Disease is distinctive</strong>: Disease samples show consistent expression patterns different from normal</li>
<li class=""><strong>K controls smoothness</strong>: Small K captures local patterns, large K finds global trends</li>
<li class=""><strong>Distance captures similarity</strong>: Euclidean distance naturally measures how different two gene expression profiles are</li>
</ol>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h2>
<ol>
<li class=""><strong>KNN is intuitive</strong>: "You are similar to your neighbors" - easy to explain to biologists</li>
<li class=""><strong>K matters</strong>: Small K is sensitive, large K is robust. K=3-5 often works well</li>
<li class=""><strong>Distance metrics matter</strong>: Euclidean works well for continuous data like gene expression</li>
<li class=""><strong>No learning phase</strong>: KNN just memorizes training data and votes at prediction time</li>
<li class=""><strong>Works for bioinformatics</strong>: Genes naturally cluster by function and disease state</li>
</ol>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="whats-next">What's Next?<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#whats-next" class="hash-link" aria-label="Direct link to What's Next?" title="Direct link to What's Next?" translate="no">​</a></h2>
<p>In Part 2, we'll:</p>
<ul>
<li class="">Use <strong>real gene expression data</strong> (not simulated)</li>
<li class="">Scale to <strong>thousands of genes</strong></li>
<li class="">Learn about <strong>feature selection</strong> (which genes matter?)</li>
<li class="">Evaluate using <strong>cross-validation</strong> for robust performance estimates</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary-code-full-example">Summary Code: Full Example<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#summary-code-full-example" class="hash-link" aria-label="Direct link to Summary Code: Full Example" title="Direct link to Summary Code: Full Example" translate="no">​</a></h2>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Quick reference - full KNN from scratch</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> collections </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> Counter</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">SimpleKNN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">k </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> k</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">X_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">X_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> sample </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">sqrt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">X_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> axis</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            k_indices </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">argsort</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            labels </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">k_indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            prediction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Counter</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">most_common</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            predictions</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">prediction</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Usage</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">knn </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> SimpleKNN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">accuracy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Accuracy: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">accuracy</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p>By coding KNN from scratch, you've learned machine learning fundamentals that apply to every algorithm. You now understand distance metrics, classification, and parameter tuning—all essential concepts in bioinformatics!</p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="machine-learning" term="machine-learning"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="python" term="python"/>
        <category label="knn" term="knn"/>
        <category label="gene-expression" term="gene-expression"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Introduction to AI/ML in Bioinformatics: Classification Models & Evaluation]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications</id>
        <link href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications"/>
        <updated>2026-02-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Machine learning is transforming bioinformatics by automating pattern discovery from biological data. But what problems can it actually solve? This post shows real-world applications of classification models, then builds the simplest possible classifiers to understand how they work and how to evaluate them. This is Part 0—the practical foundation before diving into complex algorithms like KNN.]]></summary>
        <content type="html"><![CDATA[<p>Machine learning is transforming bioinformatics by automating pattern discovery from biological data. But what problems can it actually solve? This post shows real-world applications of classification models, then builds the simplest possible classifiers to understand how they work and how to evaluate them. This is Part 0—the practical foundation before diving into complex algorithms like KNN.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="real-world-classification-problems-in-bioinformatics">Real-World Classification Problems in Bioinformatics<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#real-world-classification-problems-in-bioinformatics" class="hash-link" aria-label="Direct link to Real-World Classification Problems in Bioinformatics" title="Direct link to Real-World Classification Problems in Bioinformatics" translate="no">​</a></h2>
<p>Let's start by understanding what classification problems machine learning actually solves:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="problem-1-disease-diagnosis-from-gene-expression">Problem 1: Disease Diagnosis from Gene Expression<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#problem-1-disease-diagnosis-from-gene-expression" class="hash-link" aria-label="Direct link to Problem 1: Disease Diagnosis from Gene Expression" title="Direct link to Problem 1: Disease Diagnosis from Gene Expression" translate="no">​</a></h3>
<ul>
<li class=""><strong>Input</strong>: Gene expression levels from patient blood sample</li>
<li class=""><strong>Output</strong>: Normal or Disease (binary classification)</li>
<li class=""><strong>Real application</strong>: Cancer subtypes, Alzheimer's stages, COVID severity</li>
<li class=""><strong>Goal</strong>: Classify new patients into disease categories automatically</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Patient A: [Gene1=2.3, Gene2=1.5, Gene3=4.2, ...] → Normal</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Patient B: [Gene1=8.1, Gene2=6.3, Gene3=1.9, ...] → Disease</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Patient C: [Gene1=3.1, Gene2=2.2, Gene3=5.1, ...] → Normal</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="problem-2-protein-function-prediction">Problem 2: Protein Function Prediction<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#problem-2-protein-function-prediction" class="hash-link" aria-label="Direct link to Problem 2: Protein Function Prediction" title="Direct link to Problem 2: Protein Function Prediction" translate="no">​</a></h3>
<ul>
<li class=""><strong>Input</strong>: Amino acid sequence</li>
<li class=""><strong>Output</strong>: Enzyme, Structural protein, or Transport protein (multi-class)</li>
<li class=""><strong>Real application</strong>: Annotating newly sequenced genomes</li>
<li class=""><strong>Goal</strong>: Predict function of unknown proteins</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="problem-3-pathogenic-variant-detection">Problem 3: Pathogenic Variant Detection<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#problem-3-pathogenic-variant-detection" class="hash-link" aria-label="Direct link to Problem 3: Pathogenic Variant Detection" title="Direct link to Problem 3: Pathogenic Variant Detection" translate="no">​</a></h3>
<ul>
<li class=""><strong>Input</strong>: DNA mutation information, population frequency, conservation score</li>
<li class=""><strong>Output</strong>: Pathogenic or Benign (binary classification)</li>
<li class=""><strong>Real application</strong>: Clinical variant interpretation</li>
<li class=""><strong>Goal</strong>: Identify disease-causing mutations from huge variant databases</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-build-classification-models-the-power-of-automation">Why Build Classification Models? The Power of Automation<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#why-build-classification-models-the-power-of-automation" class="hash-link" aria-label="Direct link to Why Build Classification Models? The Power of Automation" title="Direct link to Why Build Classification Models? The Power of Automation" translate="no">​</a></h2>
<p>Before machine learning, biologists manually analyzed data:</p>
<ul>
<li class="">❌ <strong>Slow</strong>: Analyzing 20,000 genes one-by-one takes months</li>
<li class="">❌ <strong>Subjective</strong>: Different experts might disagree on classification</li>
<li class="">❌ <strong>Doesn't scale</strong>: 10,000 patient samples requires endless manual work</li>
</ul>
<p>With ML classification models:</p>
<ul>
<li class="">✅ <strong>Fast</strong>: Classify 10,000 samples in seconds</li>
<li class="">✅ <strong>Objective</strong>: Same rules applied consistently to every sample</li>
<li class="">✅ <strong>Scalable</strong>: Works for any dataset size without additional effort</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-1-the-simplest-classification-models">Part 1: The Simplest Classification Models<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#part-1-the-simplest-classification-models" class="hash-link" aria-label="Direct link to Part 1: The Simplest Classification Models" title="Direct link to Part 1: The Simplest Classification Models" translate="no">​</a></h2>
<p>Let's build real but minimal classification models, starting from the simplest to more sophisticated.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="setup-simulated-gene-expression-data">Setup: Simulated Gene Expression Data<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#setup-simulated-gene-expression-data" class="hash-link" aria-label="Direct link to Setup: Simulated Gene Expression Data" title="Direct link to Setup: Simulated Gene Expression Data" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Set seed for reproducibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">42</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Simulate gene expression data for disease classification</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 50 normal patients, 50 disease patients</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3 genes measured via RNA-seq</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Normal patients: lower expression</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">normal_samples </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">loc</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> scale</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Disease patients: higher expression (especially gene 1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">disease_samples </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">loc</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> scale</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Combine data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">X </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">vstack</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">normal_samples</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> disease_samples</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Features (gene expression)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">hstack</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ones</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Labels (0=normal, 1=disease)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create DataFrame for easier inspection</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">gene_names </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'Gene_A'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'Gene_B'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'Gene_C'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">df </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> columns</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">gene_names</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">df</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'Label'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">df</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'Label_name'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'Label'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">map</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'Normal'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'Disease'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Gene Expression Data Sample:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">head</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nDataset shape: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> patients, </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> genes"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Classes: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation">y</span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> Normal, </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation">y</span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> Disease"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Split data: 80% train, 20% test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">split_idx </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_test </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">split_idx</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">split_idx</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_test </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">split_idx</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">split_idx</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nTraining set: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X_train</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> samples"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Test set: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X_test</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> samples"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Gene Expression Data Sample:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">   Gene_A  Gene_B  Gene_C Label Label_name</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">0    4.86    7.02    4.23      0     Normal</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1    5.12    3.54    5.67      0     Normal</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">2    3.45    4.89    6.12      0     Normal</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Dataset shape: 100 patients, 3 genes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Classes: 50 Normal, 50 Disease</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Training set: 80 samples</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Test set: 20 samples</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="model-1-rule-based-classifier-simplest-possible">Model 1: Rule-Based Classifier (Simplest Possible)<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#model-1-rule-based-classifier-simplest-possible" class="hash-link" aria-label="Direct link to Model 1: Rule-Based Classifier (Simplest Possible)" title="Direct link to Model 1: Rule-Based Classifier (Simplest Possible)" translate="no">​</a></h3>
<p>The simplest classifier is just a rule based on one gene:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">SimpleRuleClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Classify patients based on a simple threshold rule.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    If Gene_A &gt; threshold: predict disease</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Else: predict normal</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    This is how a biologist might manually classify before ML!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> gene_index</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> threshold</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">6.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">gene_index </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> gene_index</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">threshold </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> threshold</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">gene_name </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> gene_names</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">gene_index</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Make predictions based on simple rule."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">gene_index</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">threshold</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">astype</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> predictions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__repr__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Rule: If </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">gene_name</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> &gt; </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">threshold</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">, predict Disease"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create and test the rule-based model</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">model1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> SimpleRuleClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">gene_index</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> threshold</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">6.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y_pred1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> model1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nModel 1: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">model1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Sample predictions: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">y_pred1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">10]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="model-2-multi-gene-mean-classifier">Model 2: Multi-Gene Mean Classifier<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#model-2-multi-gene-mean-classifier" class="hash-link" aria-label="Direct link to Model 2: Multi-Gene Mean Classifier" title="Direct link to Model 2: Multi-Gene Mean Classifier" translate="no">​</a></h3>
<p>Slightly better: use the average of all genes:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">MeanClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Classify based on mean expression across all genes.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    If mean(all genes) &gt; threshold: predict disease</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Else: predict normal</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    This combines information from multiple genes!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> threshold</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">6.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">threshold </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> threshold</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Make predictions based on mean expression."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        mean_expression </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">axis</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Average across genes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">mean_expression </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">threshold</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">astype</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> predictions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Test mean-based model</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">model2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> MeanClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">threshold</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">6.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y_pred2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> model2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nModel 2: Mean-based classifier (threshold=6.5)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Sample predictions: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">y_pred2</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">10]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="model-3-distance-based-classifier-nearest-centroid">Model 3: Distance-Based Classifier (Nearest Centroid)<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#model-3-distance-based-classifier-nearest-centroid" class="hash-link" aria-label="Direct link to Model 3: Distance-Based Classifier (Nearest Centroid)" title="Direct link to Model 3: Distance-Based Classifier (Nearest Centroid)" translate="no">​</a></h3>
<p>Even better: find the center of each class, classify by distance:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">NearestCentroidClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Classify based on distance to class centroids.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Algorithm:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    1. During training: Calculate mean (centroid) of each class</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    2. During prediction: For new sample, predict class of nearest centroid</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    This is the foundation for more complex algorithms like KNN!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Think of it as: "Find which disease type the patient is closest to"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">centroids </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Learn the centroid (average) of each class."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> class_label </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">unique</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">centroids</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">class_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">y </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> class_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">axis</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"✓ Learned </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">centroids</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> class centroids"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Normal centroid: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">centroids</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Disease centroid: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">centroids</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Predict by finding nearest centroid."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> sample </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate distance to each centroid</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> class_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> centroid </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">centroids</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">items</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Euclidean distance</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                distance </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">sqrt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> centroid</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">class_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> distance</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Predict class of nearest centroid</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            prediction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">min</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> key</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            predictions</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">prediction</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Train and test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">model3 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> NearestCentroidClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">model3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y_pred3 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> model3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nModel 3: Nearest Centroid Classifier"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Sample predictions: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">y_pred3</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">10]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">✓ Learned 2 class centroids</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Normal centroid: [4.87 4.92 5.11]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Disease centroid: [7.98 8.15 8.23]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Model 3: Nearest Centroid Classifier</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Sample predictions: [1 1 0 1 0 0 0 0 1 0]</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-2-evaluating-classification-models">Part 2: Evaluating Classification Models<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#part-2-evaluating-classification-models" class="hash-link" aria-label="Direct link to Part 2: Evaluating Classification Models" title="Direct link to Part 2: Evaluating Classification Models" translate="no">​</a></h2>
<p>Now that we have predictions, how do we know which model is good? We need evaluation metrics!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-metrics-explained-especially-for-imbalanced-data">Key Metrics Explained (Especially for Imbalanced Data)<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#key-metrics-explained-especially-for-imbalanced-data" class="hash-link" aria-label="Direct link to Key Metrics Explained (Especially for Imbalanced Data)" title="Direct link to Key Metrics Explained (Especially for Imbalanced Data)" translate="no">​</a></h3>
<p><strong>Confusion Matrix</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 Predicted</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 Disease  Healthy</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Actual</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Disease      TP         FN</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Healthy      FP         TN</span><br></span></code></pre></div></div>
<p><strong>Definitions:</strong></p>
<ul>
<li class=""><strong>TP (True Positive)</strong>: Correctly identified disease → Good! ✓</li>
<li class=""><strong>TN (True Negative)</strong>: Correctly identified healthy → Good! ✓</li>
<li class=""><strong>FP (False Positive)</strong>: Healthy person predicted as disease → False alarm ✗</li>
<li class=""><strong>FN (False Negative)</strong>: Disease person predicted as healthy → Dangerous! ✗</li>
</ul>
<p><strong>Metrics (Importance for Imbalanced Data):</strong></p>
<table><thead><tr><th>Metric</th><th>Formula</th><th>Meaning</th><th>Best For</th></tr></thead><tbody><tr><td><strong>Accuracy</strong></td><td>(TP+TN)/(TP+TN+FP+FN)</td><td>Overall correctness</td><td>❌ <strong>MISLEADING for imbalanced data</strong></td></tr><tr><td><strong>Sensitivity/Recall</strong></td><td>TP/(TP+FN)</td><td>% of disease cases caught</td><td>✅ Essential for imbalanced data</td></tr><tr><td><strong>Specificity</strong></td><td>TN/(TN+FP)</td><td>% of healthy cases caught</td><td>✅ Reveals when model ignores minority class</td></tr><tr><td><strong>Precision</strong></td><td>TP/(TP+FP)</td><td>% of disease predictions correct</td><td>✅ Shows cost of false alarms</td></tr></tbody></table>
<p><strong>Why Recall + Specificity Matter More Than Accuracy for Imbalanced Data:</strong></p>
<p>In our test set: 19 disease, 1 healthy (95% disease cases)</p>
<ul>
<li class="">Model predicts "disease" for everything</li>
<li class="">Accuracy = 95% (looks good!)</li>
<li class="">But Specificity = 0% (completely missed the healthy person!)</li>
</ul>
<p><strong>Recall</strong> and <strong>Specificity</strong> immediately show the problem.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">evaluate_classification</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_pred</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> model_name</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Model"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Evaluate a classification model using confusion matrix and metrics."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate confusion matrix</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    FP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    FN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    accuracy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> TN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    sensitivity </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># True Positive Rate</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    specificity </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># True Negative Rate</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    precision </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># "When we predict disease, are we right?"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    recall </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> sensitivity  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Same as sensitivity - "Did we catch disease cases?"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Print results</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\n</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'='</span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">70</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Classification Evaluation: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">model_name</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'='</span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">70</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nConfusion Matrix:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  True Positives (TP):   </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">TP</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">3d</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">  → correctly identified disease patients"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  True Negatives (TN):   </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">TN</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">3d</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">  → correctly identified healthy people"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  False Positives (FP):  </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">FP</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">3d</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">  → false alarms (healthy → disease)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  False Negatives (FN):  </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">FN</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">3d</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">  → missed cases (disease → healthy)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nPerformance Metrics:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Accuracy:         </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">accuracy</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">   (overall correctness - MISLEADING for imbalanced data!)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Sensitivity/Recall: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">recall</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">   (disease detection rate - % of disease cases caught)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Specificity:      </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">specificity</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">   (healthy detection rate - % of healthy cases caught)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Precision:        </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">precision</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">   (positive predictive value - % of disease predictions correct)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Rating based on both recall and precision</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> recall </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.90</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">and</span><span class="token plain"> precision </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.90</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        rating </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"✓ Excellent classifier"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">elif</span><span class="token plain"> recall </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.80</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">and</span><span class="token plain"> precision </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.70</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        rating </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"✓ Good classifier"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">elif</span><span class="token plain"> recall </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.70</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">or</span><span class="token plain"> precision </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.70</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        rating </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"△ Acceptable classifier"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        rating </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"✗ Poor classifier"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  → </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">rating</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\n  💡 Insight: High accuracy (</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">accuracy</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.0%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">) but low specificity (</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">specificity</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.0%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"             This shows CLASS IMBALANCE—model predicts disease for almost everything!"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'accuracy'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> accuracy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'sensitivity'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> recall</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'specificity'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> specificity</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'precision'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> precision</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'recall'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> recall</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'TP'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> TP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'TN'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> TN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'FP'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'FN'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> FN</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Evaluate all three models</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"\n"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"="</span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token number" style="color:hsl(35, 99%, 36%)">70</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"CLASSIFICATION MODEL COMPARISON"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"="</span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token number" style="color:hsl(35, 99%, 36%)">70</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">results1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> evaluate_classification</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_pred1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Model 1: Rule-Based (Gene_A &gt; 6.5)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">results2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> evaluate_classification</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_pred2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Model 2: Mean-Based Classifier"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">results3 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> evaluate_classification</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_pred3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Model 3: Nearest Centroid"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">CLASSIFICATION MODEL COMPARISON</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Classification Evaluation: Model 1: Rule-Based (Gene_A &gt; 6.5)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Confusion Matrix:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  True Positives (TP):    17  → correctly identified disease patients</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  True Negatives (TN):     0  → correctly identified healthy people</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  False Positives (FP):    0  → false alarms (healthy → disease)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  False Negatives (FN):    3  → missed cases (disease → healthy)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Performance Metrics:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Accuracy:         85.00%   (overall correctness - MISLEADING for imbalanced data!)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Sensitivity/Recall: 85.00%   (disease detection rate - % of disease cases caught)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Specificity:      0.00%   (healthy detection rate - % of healthy cases caught)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Precision:        0.00%   (positive predictive value - % of disease predictions correct)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  → ✗ Poor classifier</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  💡 Insight: High accuracy (85%) but 0% specificity!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">             This shows CLASS IMBALANCE—model predicts disease for almost everything!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Classification Evaluation: Model 2: Mean-Based Classifier</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Confusion Matrix:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  True Positives (TP):    19  → correctly identified disease patients</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  True Negatives (TN):     0  → correctly identified healthy people</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  False Positives (FP):    0  → false alarms (healthy → disease)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  False Negatives (FN):    1  → missed cases (disease → healthy)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Performance Metrics:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Accuracy:         95.00%   (overall correctness - MISLEADING for imbalanced data!)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Sensitivity/Recall: 95.00%   (disease detection rate - % of disease cases caught)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Specificity:      0.00%   (healthy detection rate - % of healthy cases caught)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Precision:       100.00%   (positive predictive value - % of disease predictions correct)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  → ✗ Poor classifier</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  💡 Insight: 95% accuracy + 100% precision looks great, but 0% specificity is a RED FLAG!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">             Model is essentially predicting disease for everyone—it's cheating!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Classification Evaluation: Model 3: Nearest Centroid</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Confusion Matrix:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  True Positives (TP):    19  → correctly identified disease patients</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  True Negatives (TN):     0  → correctly identified healthy people</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  False Positives (FP):    0  → false alarms (healthy → disease)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  False Negatives (FN):    1  → missed cases (disease → healthy)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Performance Metrics:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Accuracy:         95.00%   (overall correctness - MISLEADING for imbalanced data!)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Sensitivity/Recall: 95.00%   (disease detection rate - % of disease cases caught)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Specificity:      0.00%   (healthy detection rate - % of healthy cases caught)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Precision:       100.00%   (positive predictive value - % of disease predictions correct)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  → ✗ Poor classifier</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  💡 Insight: 95% accuracy + 100% precision looks great, but 0% specificity is a RED FLAG!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">             Model is essentially predicting disease for everyone—it's cheating!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">**KEY LEARNING:** All three models fail in the same way! They essentially learned the trivial solution:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">"Predict disease for almost everything." This gets 95% accuracy because 95% of the dataset is disease cases.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">**Why This Happens with Imbalanced Data:**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">- Naive models learn the easiest shortcut</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">- Accuracy rewards predicting the majority class</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">- Specificity (or Recall for minority class) immediately exposes this problem!</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-metric-tradeoffs">Understanding Metric Tradeoffs<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#understanding-metric-tradeoffs" class="hash-link" aria-label="Direct link to Understanding Metric Tradeoffs" title="Direct link to Understanding Metric Tradeoffs" translate="no">​</a></h2>
<p>Different situations require different metrics:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="sensitivity-vs-specificity-tradeoff">Sensitivity vs Specificity Tradeoff<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#sensitivity-vs-specificity-tradeoff" class="hash-link" aria-label="Direct link to Sensitivity vs Specificity Tradeoff" title="Direct link to Sensitivity vs Specificity Tradeoff" translate="no">​</a></h3>
<p><strong>High Sensitivity (Catch disease):</strong></p>
<ul>
<li class="">Better for: Disease screening, diagnostic tests</li>
<li class="">Accept more false alarms to avoid missing disease</li>
<li class="">Example: Cancer screening — missing cancer is worse than false alarms</li>
</ul>
<p><strong>High Specificity (Avoid false alarms):</strong></p>
<ul>
<li class="">Better for: Confirmatory tests, expensive procedures</li>
<li class="">Accept missing some cases to avoid unnecessary treatment</li>
<li class="">Example: Confirming cancer diagnosis before chemotherapy</li>
</ul>
<p><strong>Balanced (Youden Index):</strong></p>
<ul>
<li class="">Better for: General-purpose classification</li>
<li class="">No one goal is more important than the other</li>
<li class="">Example: Gene expression phenotyping</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="connecting-to-part-1-building-knn">Connecting to Part 1: Building KNN<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#connecting-to-part-1-building-knn" class="hash-link" aria-label="Direct link to Connecting to Part 1: Building KNN" title="Direct link to Connecting to Part 1: Building KNN" translate="no">​</a></h2>
<p>You now understand:</p>
<ul>
<li class="">✓ Real classification problems in bioinformatics</li>
<li class="">✓ Simple classification models (rules, means, nearest centroid)</li>
<li class="">✓ How to evaluate models with metrics</li>
<li class="">✓ Sensitivity vs specificity tradeoffs</li>
</ul>
<p><strong>What's next?</strong> In <a class="" href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn">Part 1: Building KNN from Scratch</a>, we'll extend the nearest centroid idea:</p>
<ul>
<li class=""><strong>Nearest Centroid</strong>: Find the 1 closest class center</li>
<li class=""><strong>KNN</strong>: Find the K closest individual training samples and vote</li>
</ul>
<p>The evaluation metrics you learned here apply directly to KNN and all other classifiers!</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary-key-concepts">Summary: Key Concepts<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#summary-key-concepts" class="hash-link" aria-label="Direct link to Summary: Key Concepts" title="Direct link to Summary: Key Concepts" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="confusion-matrix">Confusion Matrix<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#confusion-matrix" class="hash-link" aria-label="Direct link to Confusion Matrix" title="Direct link to Confusion Matrix" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 Predicted</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 Disease  Healthy</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Actual</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Disease      TP         FN</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Healthy      FP         TN</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="metrics-quick-reference">Metrics Quick Reference<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#metrics-quick-reference" class="hash-link" aria-label="Direct link to Metrics Quick Reference" title="Direct link to Metrics Quick Reference" translate="no">​</a></h3>
<table><thead><tr><th>Metric</th><th>Formula</th><th>Meaning</th><th>When to Use</th></tr></thead><tbody><tr><td><strong>Accuracy</strong></td><td>(TP+TN)/(TP+TN+FP+FN)</td><td>Overall correctness</td><td>❌ Avoid for imbalanced data</td></tr><tr><td><strong>Sensitivity/Recall</strong></td><td>TP/(TP+FN)</td><td>% of disease cases caught</td><td>✅ Essential for imbalanced data</td></tr><tr><td><strong>Specificity</strong></td><td>TN/(TN+FP)</td><td>% of healthy cases caught</td><td>✅ Reveals minority class performance</td></tr><tr><td><strong>Precision</strong></td><td>TP/(TP+FP)</td><td>% of disease predictions correct</td><td>✅ Cost of false positives</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-imbalanced-data-problem">The Imbalanced Data Problem<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#the-imbalanced-data-problem" class="hash-link" aria-label="Direct link to The Imbalanced Data Problem" title="Direct link to The Imbalanced Data Problem" translate="no">​</a></h3>
<p>When classes are imbalanced (e.g., 95% disease, 5% healthy):</p>
<ul>
<li class=""><strong>Accuracy is misleading</strong>: Predicting "disease" for everything gives 95% accuracy</li>
<li class=""><strong>Sensitivity/Recall reveals the truth</strong>: Shows if model handles majority class</li>
<li class=""><strong>Specificity shows minority class</strong>: Critical for detecting if model fails on rare class</li>
<li class=""><strong>Precision shows false alarm cost</strong>: How many predicted diseases are actually wrong?</li>
</ul>
<p>💡 <strong>In our example</strong>: All models got 95% accuracy but 0% specificity—they're useless!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="quick-code-reference">Quick Code Reference<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#quick-code-reference" class="hash-link" aria-label="Direct link to Quick Code Reference" title="Direct link to Quick Code Reference" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate confusion matrix</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">FP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">FN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate metrics for imbalanced data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sensitivity </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Recall - catch disease?</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">specificity </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Handle healthy people?</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">precision </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># When we predict disease, are we right?</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">accuracy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> TN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Don't trust this for imbalanced data!</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-this-matters-for-bioinformatics">Why This Matters for Bioinformatics<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#why-this-matters-for-bioinformatics" class="hash-link" aria-label="Direct link to Why This Matters for Bioinformatics" title="Direct link to Why This Matters for Bioinformatics" translate="no">​</a></h2>
<p>Classification is everywhere in biology:</p>
<ul>
<li class=""><strong>Disease diagnosis</strong>: Predict if patient has disease from omics data</li>
<li class=""><strong>Protein annotation</strong>: Predict protein function from sequence</li>
<li class=""><strong>Variant interpretation</strong>: Predict if mutation is pathogenic</li>
<li class=""><strong>Cell type classification</strong>: Predict cell type from gene expression</li>
</ul>
<p>But we must evaluate properly:</p>
<ul>
<li class="">Different diseases need different metrics</li>
<li class="">Simple baselines reveal if our model actually learned</li>
<li class="">Understanding metrics prevents misleading conclusions</li>
</ul>
<p>You now have the foundation to build, evaluate, and deploy classification models in bioinformatics! 🧬🤖</p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="machine-learning" term="machine-learning"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="classification" term="classification"/>
        <category label="evaluation" term="evaluation"/>
        <category label="disease-prediction" term="disease-prediction"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Bioinformatics Cost Optimization For Input Using Nextflow (Part 2)]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2</id>
        <link href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2"/>
        <updated>2026-01-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Amazon S3 (Simple Storage Service) is built around the concept of storing files as objects, where each file is identified by a unique key rather than a traditional file system path. While this architecture offers scalability and flexibility for storage, it can present challenges when used as a standard file system, especially in bioinformatics workflows. When running Nextflow with S3 as the input/output backend, there are trade-offs to consider—particularly when dealing with large numbers of small files. In such cases, Nextflow may spend significant time handling downloads and uploads via the AWS CLI v2, which can impact overall workflow performance.On this blog post, we will start with downloading input first. Let’s explore this in more detail.]]></summary>
        <content type="html"><![CDATA[<p>Amazon S3 (Simple Storage Service) is built around the concept of storing files as objects, where each file is identified by a unique key rather than a traditional file system path. While this architecture offers scalability and flexibility for storage, it can present challenges when used as a standard file system, especially in bioinformatics workflows. When running Nextflow with S3 as the input/output backend, there are trade-offs to consider—particularly when dealing with large numbers of small files. In such cases, Nextflow may spend significant time handling downloads and uploads via the AWS CLI v2, which can impact overall workflow performance.On this blog post, we will start with downloading input first. Let’s explore this in more detail.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="aws-cli">AWS CLI<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#aws-cli" class="hash-link" aria-label="Direct link to AWS CLI" title="Direct link to AWS CLI" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="install">Install<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#install" class="hash-link" aria-label="Direct link to Install" title="Direct link to Install" translate="no">​</a></h3>
<p>AWS CLI is the command line tools that helps work with AWS services. With nextflow, it can help for downloading inputs, uploading outputs.
To install this tool and the tutorial on this blog, clone this repo. The repo uses the pixi and dokcer to quickly setup</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> clone git@github.com:nttg8100/nextflow-cost-optimization.git</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> nextflow-cost-optimization</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi shell</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> aws</span><br></span></code></pre></div></div>
<p>Explain <code>Makefile</code>, the below, we will run to start the docker service, upload files and the tar file of 10k files that can be used for benchmarking later</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws-config: start-minio</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ACCESS_KEY_ID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"minioadmin"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_SECRET_ACCESS_KEY</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"minioadmin"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_DEFAULT_REGION</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"us-east-1"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ENDPOINT_URL</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"http://localhost:9000"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">sleep</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> aws s3 mb s3://io-benchmark --endpoint-url http://localhost:9000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">results/tarball.tar:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@mkdir </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> results/tarball</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@count</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">1M</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">index</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">k</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> $</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">seq</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> $$count</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token function" style="color:hsl(221, 87%, 60%)">dd</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">if</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">/dev/zero </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">of</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">results/tarball/$</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${size}</span><span class="token plain">-$</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${index}</span><span class="token plain">-</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$$</span><span class="token plain">k.data </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">bs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">count</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">seek</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$$</span><span class="token plain">size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-cvf</span><span class="token plain"> results/tarball.tar </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> results/tarball </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">upload-tar:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> results/tarball.tar s3://io-benchmark/ --endpoint-url http://localhost:9000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">upload-10k-files:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> results/tarball  s3://io-benchmark/tarball --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="start-s3-service">Start S3 service<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#start-s3-service" class="hash-link" aria-label="Direct link to Start S3 service" title="Direct link to Start S3 service" translate="no">​</a></h3>
<p>Now you are ready to work with S3 object storage, this one will launch the minio, the simulated compatible S3 service with AWS. That will help to minimize the error related to your local computer and the remote bucket. This will create bucket called io-benchmark. Also simulated a lot of small files that we use later for proof of concept of this issue</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> aws-config</span><br></span></code></pre></div></div>
<p>To test the s3 service</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># export env</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ACCESS_KEY_ID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"minioadmin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_SECRET_ACCESS_KEY</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"minioadmin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_DEFAULT_REGION</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"us-east-1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ENDPOINT_URL</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"http://localhost:9000"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># configure threads</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws configure </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> default.s3.max_concurrent_requests </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># test bucket</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain">  --endpoint-url http://localhost:9000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1026-01-27 10:29:58 io-benchmark</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-download-independently">Testing Download Independently<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#testing-download-independently" class="hash-link" aria-label="Direct link to Testing Download Independently" title="Direct link to Testing Download Independently" translate="no">​</a></h3>
<p>The above file content is the <code>Makefile</code> which simulates to create 1GB in total for a folder with 10k files, each file is 1MB. Nextflow is usually has the slow performance for input by 2 main reason:</p>
<ul>
<li class="">Verify download for each file</li>
<li class="">Calculate inputs cache for all small files</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>It will create the additional tar file of these 10k files, that I will show you later why we create it and how it make your workflow easier</p></div></div>
<p>Without nextflow intervection, we want to test how long does it takes using aws cli v2 only</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="download-10k-files">Download 10k files<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#download-10k-files" class="hash-link" aria-label="Direct link to Download 10k files" title="Direct link to Download 10k files" translate="no">​</a></h4>
<p>Run this command to download</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> upload-10k-files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%e"</span><span class="token plain"> aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> s3://io-benchmark/tarball ./tarball --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes around 110 seconds to download files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">110.62</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">109.62</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">110.59</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="download-tarfile">Download tarfile<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#download-tarfile" class="hash-link" aria-label="Direct link to Download tarfile" title="Direct link to Download tarfile" translate="no">​</a></h4>
<p>Run this command to download, it will be much faster</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> upload-tar</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%e"</span><span class="token plain"> aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> s3://io-benchmark/tarball.tar </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"> --endpoint-url http://localhost:9000 </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball.tar</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 30 seconds to download this large file.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">27.50</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">26.96</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">25.35</span><br></span></code></pre></div></div>
<p>However, we need to have the small file inside, we can use pipe "|" to do it when we download file quickly</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%e"</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'mkdir -p tarball &amp;&amp; aws s3 cp s3://io-benchmark/tarball.tar - --endpoint-url http://localhost:9000 | tar -xvf - -C tarball'</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 35 seconds to download and untar to get all small files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">33.43</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">31.80</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">33.20</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="fuse-based-system">Fuse based system<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#fuse-based-system" class="hash-link" aria-label="Direct link to Fuse based system" title="Direct link to Fuse based system" translate="no">​</a></h4>
<p>Beside using the aws command to download individual files or tar file, using fuse based system is the alternative approach.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">For small files: FUSE enables applications to access individual files on demand without needing to download an entire archive or use complex commands, reducing overhead and making access fast and convenient.</li>
<li class="">For large files: FUSE filesystems can fetch only the needed data chunks, allowing for efficient partial reads, sequential streaming, and avoiding unnecessary full downloads.</li>
<li class="">General advantage: Since FUSE exposes cloud storage as a standard directory tree, workflows and tools that use local files work seamlessly, enabling parallel access and integration with caching and prefetching optimizations.</li>
</ul></div></div>
<p>It can be used for using in the application that works with the large file or the folder contains many small files but it does not load entirely. For example, we annotate the variant for whole exome data but the annotation database
is used for entire genome. We can use the tool to get only a few annotated variants region. Beside, distributed engine with fuse based system can be useful for distributed loading.</p>
<p><code>Makefile</code> to quickly install mount-s3 via pixi. It will mount the whole bucket to the <code>/mnt/vep_cache</code>. This mount point is named after <code>vep</code> later it will be used direclty with VEP annotation example</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">mount-s3-vep-cache: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./mnt/vep_cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./mnt/tmp</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">mount</span><span class="token plain"> mount-s3 --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--region</span><span class="token plain"> us-east-1 --force-path-style io-benchmark ./mnt/vep_cache --read-only </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cache</span><span class="token plain"> ./mnt/tmp --max-threads </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><br></span></code></pre></div></div>
<p>Run this command to allow mount the remote s3 bucket</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> mount-s3-vep-cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># check</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">df</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Filesystem                            1K-blocks      Used     Available Use% Mounted on</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># udev                                  131907828         0     131907828   0% /dev</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                  26401936      3052      26398884   1% /run</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/mapper/ubuntu--vg-ubuntu--lv     980760096 936881112       2913808 100% /</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                 132009668         0     132009668   0% /dev/shm</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                      5120         0          5120   0% /run/lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                 132009668         0     132009668   0% /run/qemu</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop0                                65408     65408             0 100% /snap/core20/2682</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop1                                65408     65408             0 100% /snap/core20/2686</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop2                                75776     75776             0 100% /snap/core22/2216</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop3                                75776     75776             0 100% /snap/core22/2292</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop4                                93696     93696             0 100% /snap/lxd/35819</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop5                                93696     93696             0 100% /snap/lxd/36918</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop6                                52224     52224             0 100% /snap/snapd/25577</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop7                                49280     49280             0 100% /snap/snapd/25935</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/nvme0n1p2                          1992552    433904       1437408  24% /boot</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/nvme0n1p1                          1098632      6228       1092404   1% /boot/efi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># controller-01:/home                   476973568 349766144     106714624  77% /home</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                  26401932         4      26401928   1% /run/user/1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># io-benchmark                      1099511627776         0 1099511627776   0% /scratch/data/nextflow-cost-optimization/mnt/vep_cache</span><br></span></code></pre></div></div>
<p>Now we can use this to simply download 10k files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%e"</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'cp -r ./mnt/vep_cache/tarball tarball '</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 45 seconds to download small files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">44.94</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">46.06</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">45.46</span><br></span></code></pre></div></div>
<p>Again, download only 10 GB tar file to see how it work</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%e"</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'mkdir -p tarball &amp;&amp; cp ./mnt/vep_cache/tarball.tar tarball'</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 45 seconds to download small files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">15.60</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">15.37</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">15.74</span><br></span></code></pre></div></div>
<p>Again, download only 10 GB tar file to see how it work</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%e"</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'mkdir -p tarball &amp;&amp; cat ./mnt/vep_cache/tarball.tar|tar -xvf - -C tarball'</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 45 seconds to download small files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">19.68</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">21.86</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">20.31</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap">Recap<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#recap" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h3>
<p>Here is a summary table of the different approaches for downloading 10k small files (1GB total) from S3, with their typical performance and recommended use cases:</p>
<table><thead><tr><th>Method</th><th>Download Time (s)</th><th>Pros</th><th>Cons</th><th>When to Use</th></tr></thead><tbody><tr><td><strong>AWS CLI (recursive, 10k files)</strong></td><td>~110</td><td>Simple, no extra setup</td><td>Very slow for many small files</td><td>Rarely; only for small numbers of files</td></tr><tr><td><strong>AWS CLI (tarball + untar via pipe)</strong></td><td>~33</td><td>Fast, single download + extraction</td><td>Needs tar/untar logic</td><td>When workflow can handle tar extraction</td></tr><tr><td><strong>FUSE (cp -r 10k files)</strong></td><td>~45</td><td>Transparent, works like local FS</td><td>Needs FUSE setup, not always fastest</td><td>When random access or partial reads are needed</td></tr><tr><td><strong>FUSE (cat tarball | tar -xvf -)</strong></td><td>~20</td><td>Fast, combines FUSE and streaming untar</td><td>Needs FUSE setup, tar logic</td><td>For large archives with extraction</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>Recommendations:</strong></p><ul>
<li class="">For many small files, avoid direct recursive downloads; use tarballs or FUSE-based solutions.</li>
<li class="">Use tarball + untar (via pipe) for best performance if you can bundle files.</li>
<li class="">FUSE is ideal for workflows needing random access or partial reads, or when you can't change file structure.</li>
<li class="">Nextflow (v25.04+) improves small file handling, but bundling or FUSE still offers significant gains for large numbers of files.</li>
</ul></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="nextflow-integration">Nextflow integration<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#nextflow-integration" class="hash-link" aria-label="Direct link to Nextflow integration" title="Direct link to Nextflow integration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow">Workflow<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#workflow" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow" translate="no">​</a></h3>
<p>We will simply run the workflow below that will accept the inputs from S3, download to use in this process and count the number of files inside</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> COUNT_FILES </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain">  from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/count_files_tar.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> COUNT_FILES_TAR </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/count_files_tar.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">workflow </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    main:        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // benchmark files input</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // normal files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.benchmark_input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            ch_files </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> COUNT_FILES</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Channel.fromPath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.inputs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">.collect</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // tarball and untar</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.benchmark_input_tar</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            ch_files </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> COUNT_FILES_TAR</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Channel.fromPath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.inputs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">.collect</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="modules">Modules<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#modules" class="hash-link" aria-label="Direct link to Modules" title="Direct link to Modules" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="count_files">COUNT_FILES<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#count_files" class="hash-link" aria-label="Direct link to COUNT_FILES" title="Direct link to COUNT_FILES" translate="no">​</a></h4>
<p>It will accept a list of files directly from s3</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process COUNT_FILES </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lah</span><span class="token plain"> tarball/**.data</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> num_files.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="count_files_tar">COUNT_FILES_TAR<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#count_files_tar" class="hash-link" aria-label="Direct link to COUNT_FILES_TAR" title="Direct link to COUNT_FILES_TAR" translate="no">​</a></h4>
<p>It will download the tar file first, then inside the process untar later</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>For downloading file and use pipe to quickly untar will be applied later</p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process COUNT_FILES_ </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-xf</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${file_path}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lah</span><span class="token plain"> tarball/**.data</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> num_files.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="remaining-materials">Remaining materials<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#remaining-materials" class="hash-link" aria-label="Direct link to Remaining materials" title="Direct link to Remaining materials" translate="no">​</a></h3>
<p>It will includes the configuration with nextflow configs, include:</p>
<ul>
<li class="">nextflow.config: Standard config to run with docker, singularity and different platform</li>
<li class="">nextflow_s3.config: S3 credential for minio storage</li>
<li class="">nextflow_tar.config: The config that run with the local file later</li>
</ul>
<p>These are the standard setup so I will not explain too much detail here, check at the below structure</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── benchmark_computing_resource.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── benchmark_input.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── inputs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── 1_samplesheet.csv</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── full_samplsheet.csv</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── LICENSE</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── modules</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── count_files.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── count_files_tar.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── fastp.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── fastqc.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── vep.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── nextflow.config</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── nextflow_s3.config</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── nextflow_tar.config</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── pixi.lock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── pixi.toml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── README.md</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing">Testing<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#testing" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing" translate="no">​</a></h3>
<p>Using <code>Makefile</code> to simplify the process, it will run with different configuration. For proof of concepts, run once</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-input-standard: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> standard nextflow run benchmark_input.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--benchmark_input</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--inputs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"s3://io-benchmark/tarball"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-input-tar: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> standard nextflow run benchmark_input.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--benchmark_input_tar</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--inputs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"s3://io-benchmark/tmp.txt"</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-with-10k-files-as-input">Running with 10k files as input<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#running-with-10k-files-as-input" class="hash-link" aria-label="Direct link to Running with 10k files as input" title="Direct link to Running with 10k files as input" translate="no">​</a></h4>
<p>Run the command below</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-input-standard</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 42,34s user 7,04s system 77% cpu 1:03,97 total</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-with-1-large-file-untar-in-the-process">Running with 1 large file, untar in the process<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#running-with-1-large-file-untar-in-the-process" class="hash-link" aria-label="Direct link to Running with 1 large file, untar in the process" title="Direct link to Running with 1 large file, untar in the process" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-input-tar</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 11,80s user 3,42s system 66% cpu 22,965 total</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="magic-improvement">Magic improvement<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#magic-improvement" class="hash-link" aria-label="Direct link to Magic improvement" title="Direct link to Magic improvement" translate="no">​</a></h3>
<p>Although we have show that we can use the single large tar file as input and download inside. However, we have to change the module. Is there any
configuration can help ? Linking with previous section on using pipe after downloading, we can use this config</p>
<p>What it does it that it will use the same module while the files can be ingested using <code>beforeScript</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process{</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:COUNT_FILES{</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        beforeScript = "mkdir -p tarball &amp;&amp; aws s3 cp s3://io-benchmark/tarball.tar - --endpoint-url http://localhost:9000 | tar -xvf - -C tarball"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>The command to run workflow, we can use a file to keep a place holder for nextflow to accept the input and also we add the config <code>nextflow_tar.config</code></p>
<div class="language-Makefile language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-input-tar-pipe: ${HOME}/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	${HOME}/.pixi/bin/pixi run -e standard nextflow run benchmark_input.nf \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		-c nextflow_s3.config -c nextflow_tar.config \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		--benchmark_input \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		--inputs="s3://io-benchmark/tmp.txt"</span><br></span></code></pre></div></div>
<p>Remember to create the temp file and upload to the bucket</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> tmp.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> tmp.txt  s3://io-benchmark --endpoint-url http://localhost:9000 </span><br></span></code></pre></div></div>
<p>Running the new setup</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-input-tar-pipe</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 11,33s user 2,85s system 82% cpu 17,166 total</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap-1">Recap<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#recap-1" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">Using tar file and nextflow config can help reduce x3 times for downloading multiple small files as input</li>
<li class="">We do not need to modify the existing module</li>
</ul></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="genomics-england-case-study">Genomics England case study<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#genomics-england-case-study" class="hash-link" aria-label="Direct link to Genomics England case study" title="Direct link to Genomics England case study" translate="no">​</a></h2>
<p>Reference: <strong><a href="https://aws.amazon.com/blogs/hpc/optimize-nextflow-workflows-on-aws-batch-with-mountpoint-for-amazon-s3/" target="_blank" rel="noopener noreferrer" class="">https://aws.amazon.com/blogs/hpc/optimize-nextflow-workflows-on-aws-batch-with-mountpoint-for-amazon-s3/</a></strong>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="issues">Issues<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#issues" class="hash-link" aria-label="Direct link to Issues" title="Direct link to Issues" translate="no">​</a></h3>
<p>Now we can consider on what can be the issue that we can face with in the real problem. And how can we apply this
Here, I found that the blog that how Genomic England can solve the similar issue when they want to use VEP to annotate their variants.
The database that they used has many small files with 500GB in total. It will take more time to download data while takes a few minutes to annotate.</p>
<p>The pseudo code</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process VEP </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">vcf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">vep_cache</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    vep </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--input_file</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$vcf</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--fasta</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$params</span><span class="token plain">.human_reference_fasta </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--dir_cache</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$vep_cache</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow-and-modules">Workflow and modules<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#workflow-and-modules" class="hash-link" aria-label="Direct link to Workflow and modules" title="Direct link to Workflow and modules" translate="no">​</a></h3>
<p>Worflow is written simply to use only VEP module. Here to quickly reproduce, all parameters are hard coded</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> ENSEMBLVEP_VEP </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/vep.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">workflow </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    main:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ENSEMBLVEP_VEP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.of</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">tuple</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">id: </span><span class="token string" style="color:hsl(119, 34%, 47%)">'HCC1395N'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">, file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"inputs/vep_test_data.vcf.gz"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"inputs/vep_test_data.vcf.gz.tbi"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">vcf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">custom_extra_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.value</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"GRCh38"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // val genome</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.value</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"homo_sapiens"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // val species</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.value</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">114</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // val cache_version</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.fromPath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"s3://io-benchmark/vep_cache"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // path cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.of</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">tuple</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">, </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token plain">, // tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fasta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.of</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> // path extra_files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>VEP module is collected from <a href="https://github.com/nf-core/sarek/blob/20f41d1ce8b7ba296ee22adc71fe2da2ebcae93f/modules/nf-core/ensemblvep/vep/main.nf" target="_blank" rel="noopener noreferrer" class=""><strong>nf-core</strong></a></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process ENSEMBLVEP_VEP </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tag </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    label </span><span class="token string" style="color:hsl(119, 34%, 47%)">'process_medium'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    conda </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${moduleDir}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/environment.yml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${workflow.containerEngine == 'singularity' &amp;&amp; </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">task.ext.singularity_pull_docker_container</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        ? 'https</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">community-cr-prod.seqera.io</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">docker</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">registry</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">v2</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">blobs</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">sha256</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">4b</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">4b5a8c173dc9beaa93effec76b99687fc926b1bd7be47df5d6ce19d7d6b4d6b7</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">data'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> 'community.wave.seqera.io</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">library</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">ensembl-vep</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">115.2--90ec797ecb088e9a'}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">vcf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">custom_extra_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val genome</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val species</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val cache_version</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fasta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path extra_files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.vcf.gz"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: vcf, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.vcf.gz.tbi"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: tbi, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.tab.gz"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: tab, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.json.gz"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: json, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path </span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.html"</span><span class="token plain">, emit: report, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path </span><span class="token string" style="color:hsl(119, 34%, 47%)">"versions.yml"</span><span class="token plain">, emit: versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    when:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    task.ext.when </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> task.ext.when</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def args </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.args ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def args2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.args2 ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def file_extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--vcf"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'vcf'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--json"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'json'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--tab"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'tab'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'vcf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def compress_cmd </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--compress_output"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'--compress_output bgzip'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def dir_cache </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> cache ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token string variable environment constant" style="color:hsl(35, 99%, 36%)">PWD</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${cache}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"/.vep"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def reference </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> fasta ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--fasta </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${fasta}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def create_index </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> file_extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"vcf"</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"tabix </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${args2}</span><span class="token string" style="color:hsl(119, 34%, 47%)"> </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${file_extension}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    vep </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${vcf}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${file_extension}</span><span class="token plain">.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${args}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${compress_cmd}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${reference}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--assembly</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${genome}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--species</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${species}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cache</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cache_version</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${cache_version}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--dir_cache</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${dir_cache}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--fork</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${task.cpus}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${create_index}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ensemblvep: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">vep </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--help</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'s/^.*Versions:.*ensembl-vep : //;s/ .*\$//'</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        tabix: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">tabix </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-h</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'s/^.*Version: //; s/ .*\$//'</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    stub:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def file_extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--vcf"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'vcf'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--json"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'json'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--tab"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'tab'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'vcf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def create_index </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> file_extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"vcf"</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"touch </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${file_extension}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.gz.tbi"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">gzip</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${file_extension}</span><span class="token plain">.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${create_index}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_summary.html</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ensemblvep: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">vep </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--help</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'s/^.*Versions:.*ensembl-vep : //;s/ .*\$//'</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        tabix: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">tabix </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-h</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'s/^.*Version: //; s/ .*\$//'</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>Their solution is showed below
<img decoding="async" loading="lazy" alt="solution" src="https://riverxdata.github.io/river-docs/assets/images/variant_annotation_aws-15d43bdb7357f6f01ab875ad3c907ba6.png" width="1024" height="811" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="inputs">Inputs<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#inputs" class="hash-link" aria-label="Direct link to Inputs" title="Direct link to Inputs" translate="no">​</a></h3>
<p>The vcf file is prepared on the <code>inputs</code> folder, while the vep cache database (25.GB) can be prepared as below on Makefile.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">vep/114_GRCh38: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> vep</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> vep/vep_cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> vep </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core aws s3 --no-sign-request </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> s3://annotation-cache/vep_cache/114_GRCh38 114_GRCh38 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">vep/vep_cache.tar: vep/114_GRCh38</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-cvf</span><span class="token plain"> vep/vep_cache.tar </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> vep/114_GRCh38 </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">upload-vep-cache: vep/vep_cache.tar</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> vep/114_GRCh38 s3://io-benchmark/ --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> vep/vep_cache.tar s3://io-benchmark/ --endpoint-url http://localhost:9000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">mount-s3-vep-cache: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./mnt/vep_cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./mnt/tmp</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">mount</span><span class="token plain"> mount-s3 --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--region</span><span class="token plain"> us-east-1 --force-path-style io-benchmark ./mnt/vep_cache --read-only </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cache</span><span class="token plain"> ./mnt/tmp --max-threads </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><br></span></code></pre></div></div>
<p>Simply run</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># download and upload to local s3</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> upload-vep-cach</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># mount to local folder from local s3 via mountpoint-s3 </span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> mount-s3-vep-cache</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="benchmark">Benchmark<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#benchmark" class="hash-link" aria-label="Direct link to Benchmark" title="Direct link to Benchmark" translate="no">​</a></h3>
<p>Here, I prepred the <code>Makefile</code> command to benchmark it quickly</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-local: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core nextflow run benchmark_vep.nf </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"./vep/114_GRCh38"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-mount-cache: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core nextflow run benchmark_vep.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_vep_mount.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"./mnt/vep_cache/114_GRCh38"</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-direct-s3: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core  nextflow run benchmark_vep.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s3://io-benchmark/114_GRCh38"</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-tar-cache: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core nextflow run benchmark_vep.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_vep_tar.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s3://io-benchmark/vep_cache"</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-mount-tar: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core nextflow run benchmark_vep.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_vep_mount_tar.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s3://io-benchmark/vep_cache"</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><br></span></code></pre></div></div>
<p>Now we can simply run the relative example test</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">test-vep-benchmarl</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><br></span></code></pre></div></div>
<p>The following table summarizes the benchmark results for different approaches to accessing the VEP cache database during analysis:</p>
<table><thead><tr><th>Method</th><th>Command</th><th style="text-align:center">Time (min<!-- -->:sec<!-- -->)</th></tr></thead><tbody><tr><td>Local cache</td><td><code>make test-vep-local</code></td><td style="text-align:center">2:26.20</td></tr><tr><td>S3 mount (FUSE)</td><td><code>make test-vep-mount-cache</code></td><td style="text-align:center">2:31.08</td></tr><tr><td>S3 mount tar (FUSE)</td><td><code>make test-vep-mount-tar</code></td><td style="text-align:center">5:57.18</td></tr><tr><td>Direct S3 access</td><td><code>make test-vep-direct-s3</code></td><td style="text-align:center">6:32.63</td></tr><tr><td>S3 tar cache</td><td><code>make test-vep-tar-cache</code></td><td style="text-align:center">6:02.52</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li class="">As mentioned above, it does not need to download all of the database cache to annotate for the small vcf region files. That's why mounting the whole database is the best solution in this case</li>
<li class="">Replacing the VEP command with <code>cp \$(readlink $cache) tmp -r</code> in the module shows that it takes <code>4:16.09</code> to read from mount point and copy the whole folder to the new temporary folder.</li>
<li class="">Depended on your specific infrastructure, customize based on your need</li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap-2">Recap<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#recap-2" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h3>
<ul>
<li class="">Using tar files and untarring large inputs does not always guarantee significant performance improvements. The benefit depends on the number of files and the total size of your input folder.</li>
<li class="">If your tool only accesses a subset of the input files (rather than the entire folder), performance may be similar to having the database already available locally.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap-3">Recap<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#recap-3" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h2>
<p>This comprehensive exploration of Nextflow's S3 integration revealed several key insights:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-analysis">Performance Analysis<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#performance-analysis" class="hash-link" aria-label="Direct link to Performance Analysis" title="Direct link to Performance Analysis" translate="no">​</a></h3>
<ul>
<li class=""><strong>Small files vs Large files</strong>: Nextflow handles large single files efficiently but struggles with many small files due to per-file operations</li>
<li class=""><strong>Download methods</strong>: Tar files significantly outperform recursive downloads for small file collections (5x faster)</li>
<li class=""><strong>FUSE benefits</strong>: Mount points provide transparent access with better performance and does not require large disk size for local storage.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="optimization-strategies">Optimization Strategies<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#optimization-strategies" class="hash-link" aria-label="Direct link to Optimization Strategies" title="Direct link to Optimization Strategies" translate="no">​</a></h3>
<ul>
<li class=""><strong>Bundle small files</strong>: Use tar archives when dealing with numerous files (10k+ small files)</li>
<li class=""><strong>Stream processing</strong>: Pipe extraction for immediate processing without full download</li>
<li class=""><strong>Smart caching</strong>: Leverage FUSE-based caching for databases and reference data</li>
<li class=""><strong>Choose the right tool</strong>: Select download method based on file count and access patterns</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="practical-applications">Practical Applications<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#practical-applications" class="hash-link" aria-label="Direct link to Practical Applications" title="Direct link to Practical Applications" translate="no">​</a></h3>
<ul>
<li class=""><strong>Genomics England case study</strong>: FUSE-based VEP annotation</li>
<li class=""><strong>Bioinformatics pipelines</strong>: The principles apply to any workflow using remote data storage</li>
<li class=""><strong>Cost considerations</strong>: Reduced download time + smaller disk size = lower compute costs on cloud platforms.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h3>
<ol>
<li class=""><strong>Profile before optimizing</strong>: Measure actual bottlenecks in your specific workflows</li>
<li class=""><strong>Consider file distribution</strong>: Many small ≠ few large when choosing download strategies</li>
<li class=""><strong>Use Nextflow v25.04+</strong>: Improved small file handling reduces need for workarounds</li>
<li class=""><strong>Leverage FUSE</strong>: Provides transparent access with better performance than CLI tools</li>
<li class=""><strong>Design for scale</strong>: Build workflows that work efficiently with your data characteristics</li>
</ol>
<p>Whether you're working with thousands of small files or terabytes of reference data, understanding these patterns helps you design more efficient, cost-effective bioinformatics workflows.</p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="nextflow" term="nextflow"/>
        <category label="hpc" term="hpc"/>
        <category label="workflow-optimization" term="workflow-optimization"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Bioinformatics Cost Optimization for Computing Resources Using Nextflow (Part 1)]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1</id>
        <link href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1"/>
        <updated>2026-01-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Many bioinformatics tools provide options to adjust the number of threads or CPU cores, which can reduce execution time with a modest increase in resource cost. But does doubling computational resources always result in processes running twice as fast? In practice, the speed-up is often less than linear, and each tool behaves differently.]]></summary>
        <content type="html"><![CDATA[<p>Many bioinformatics tools provide options to adjust the number of threads or CPU cores, which can reduce execution time with a modest increase in resource cost. But does doubling computational resources always result in processes running twice as fast? In practice, the speed-up is often less than linear, and each tool behaves differently.</p>
<p>In this post, I'll demonstrate how to optimize resource usage for individual tools, using a simple benchmarking workflow as a case study. The goal is to help you tune your workflow for efficient, production-ready execution.</p>
<p>With Nextflow—now one of the most widely used workflow managers—you gain powerful built-in features for tracing and reporting resource usage. By leveraging these capabilities, you can accurately measure CPU, memory, and run time for each step, helping you make informed optimization decisions to save both time and cost.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="getting-started-with-a-simple-workflow">Getting Started with a Simple Workflow<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#getting-started-with-a-simple-workflow" class="hash-link" aria-label="Direct link to Getting Started with a Simple Workflow" title="Direct link to Getting Started with a Simple Workflow" translate="no">​</a></h2>
<p>nf-core and Nextflow have become increasingly complex. Therefore, instead of jumping directly to nf-core/rnaseq, I'll use a simple workflow to demonstrate the concepts and what we need to know first. Later, we can apply the lessons learned from this workflow to improve more complex pipelines.</p>
<p>I created a simple workflow using two common tools that support thread/core options.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li class=""><strong>Tools</strong>: FastQC and fastp</li>
<li class=""><strong>Benchmarking approach</strong>: Run tools with increasing CPU and memory allocations (2x and 3x) to observe resource consumption and execution time</li>
<li class=""><strong>Repository</strong>: <a href="https://github.com/nttg8100/nextflow-cost-optimization" target="_blank" rel="noopener noreferrer" class="">https://github.com/nttg8100/nextflow-cost-optimization</a></li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow-structure">Workflow Structure<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#workflow-structure" class="hash-link" aria-label="Direct link to Workflow Structure" title="Direct link to Workflow Structure" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── LICENSE</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── README.md</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── benchmark.nf    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Main workflow file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── inputs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── 1_samplesheet.csv</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── full_samplesheet.csv</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── modules</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── fastp.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── fastqc.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── nextflow.config</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── pixi.lock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── pixi.toml</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow-overview">Workflow Overview<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#workflow-overview" class="hash-link" aria-label="Direct link to Workflow Overview" title="Direct link to Workflow Overview" translate="no">​</a></h2>
<p>The following is a simple workflow with FastQC and fastp. It accepts a CSV file containing metadata and file paths for each sample, then performs FastQC and fastp independently.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class=""><strong>Aliasing strategy</strong>: Use aliases with prefix <code>_\&lt;number&gt;</code> (e.g., FASTQC_1, FASTQC_2) to configure increasing computing resources for benchmarking</li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> FASTQC as FASTQC_1 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/fastqc.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> FASTQC as FASTQC_2 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/fastqc.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> FASTQC as FASTQC_3 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/fastqc.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> FASTP as FASTP_1 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/fastp.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> FASTP as FASTP_2 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/fastp.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> FASTP as FASTP_3 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/fastp.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">// Parse CSV</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> skip header, </span><span class="token function" style="color:hsl(221, 87%, 60%)">split</span><span class="token plain"> by comma, </span><span class="token function" style="color:hsl(221, 87%, 60%)">expand</span><span class="token plain"> to tuple </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> process</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Channel</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    .fromPath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    .splitCsv</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">header:true</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    .map </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> row -</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // Compose the meta map and reads list</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        def meta </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> id: row.sample, strandedness: row.strandedness </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        def reads </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> row.fastq_1, row.fastq_2 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        tuple</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta, reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    .set </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> sample_ch </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">workflow </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.run_fastqc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // fastqc benchmarks</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        FASTQC_1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_ch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        FASTQC_2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_ch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        FASTQC_3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_ch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.run_fastp</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // fastp benchmarks</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        FASTP_1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_ch,</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">, false, false, </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        FASTP_2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_ch,</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">, false, false, </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        FASTP_3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_ch,</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">, false, false, </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="modules">Modules<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#modules" class="hash-link" aria-label="Direct link to Modules" title="Direct link to Modules" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fastqc">FastQC<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#fastqc" class="hash-link" aria-label="Direct link to FastQC" title="Direct link to FastQC" translate="no">​</a></h3>
<p>This module uses containers to run FastQC with configurable resources.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process FASTQC </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tag </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    label </span><span class="token string" style="color:hsl(119, 34%, 47%)">'process_medium'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    conda </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${moduleDir}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/environment.yml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${ workflow.containerEngine == 'singularity' &amp;&amp; </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">task.ext.singularity_pull_docker_container ?</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        'https</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">depot.galaxyproject.org</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">singularity</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">fastqc</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">0.12.1--hdfd78af_0' </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        'biocontainers</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">fastqc</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">0.12.1--hdfd78af_0' }</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.html"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: html</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.zip"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> , emit: </span><span class="token function" style="color:hsl(221, 87%, 60%)">zip</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path  </span><span class="token string" style="color:hsl(119, 34%, 47%)">"versions.yml"</span><span class="token plain">           , emit: versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    when:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    task.ext.when </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> task.ext.when</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def args          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.args ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // Make list of old name and new name pairs to use </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">renaming</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> the </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">while</span><span class="token plain"> loop</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def old_new_pairs </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> reads instanceof Path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> reads.size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> ? </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> reads, </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${reads.extension}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> reads.withIndex</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">.collect </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> entry, index -</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> entry, </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${index + 1}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${entry.extension}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def rename_to     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> old_new_pairs*.join</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">.join</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def renamed_files </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> old_new_pairs.collect</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> _old_name, new_name -</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> new_name </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain">.join</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // The total amount of allocated RAM by FastQC equals the number of threads defined </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">--threads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">times</span><span class="token plain"> the amount of RAM defined </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">--memory</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // https://github.com/s-andrews/FastQC/blob/1faeea0412093224d7f6a07f777fad60a5650795/fastqc</span><span class="token comment" style="color:hsl(230, 4%, 64%)">#L211-L222</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // Dividing task.memory by task.cpus allows us to stick to the requested amount of RAM </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> the label</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def memory_in_mb </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.memory ? task.memory.toUnit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'MB'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> / task.cpus </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> null</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // FastQC memory value allowed range </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"> - </span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def fastqc_memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> memory_in_mb </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token plain"> ? </span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">memory_in_mb </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"> ? </span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> memory_in_mb</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">printf</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%s %s</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\\</span><span class="token string" style="color:hsl(119, 34%, 47%)">n"</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${rename_to}</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">while</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">read</span><span class="token plain"> old_name new_name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${new_name}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$old_name</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$new_name</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastqc </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${args}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--threads</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${task.cpus}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--memory</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${fastqc_memory}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${renamed_files}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        fastqc: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> fastqc </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'/FastQC v/!d; s/.*v//'</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    stub:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.html</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.zip</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        fastqc: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> fastqc </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'/FastQC v/!d; s/.*v//'</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>Overall, this script creates a command to run with threads and memory options. Here, memory is allocated per thread instead of total memory.
If I allocate 8 threads and 16 GB RAM, it will run the command as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash -ue</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">printf</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%s %s</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\n</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> SRX1603630_T1_1.fastq.gz GM12878_REP2_1.gz SRX1603630_T1_2.fastq.gz GM12878_REP2_2.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">while</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">read</span><span class="token plain"> old_name new_name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${new_name}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$old_name</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$new_name</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastqc </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--threads</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--memory</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2048</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    GM12878_REP2_1.gz GM12878_REP2_2.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token string" style="color:hsl(119, 34%, 47%)">END_VERSIONS</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> versions.yml</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">"FASTQC_3":</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    fastqc: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> fastqc </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable string" style="color:hsl(119, 34%, 47%)">'/FastQC v/!d; s/.*v//'</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">END_VERSIONS</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fastp">FASTP<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#fastp" class="hash-link" aria-label="Direct link to FASTP" title="Direct link to FASTP" translate="no">​</a></h3>
<p>fastp is simpler regarding CPUs and memory. It allows direct specification without needing to recalculate memory per thread.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process FASTP </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tag </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$meta</span><span class="token string" style="color:hsl(119, 34%, 47%)">.id"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    label </span><span class="token string" style="color:hsl(119, 34%, 47%)">'process_medium'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    conda </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${moduleDir}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/environment.yml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${ workflow.containerEngine == 'singularity' &amp;&amp; </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">task.ext.singularity_pull_docker_container ?</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        'https</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">community-cr-prod.seqera.io</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">docker</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">registry</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">v2</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">blobs</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">sha256</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">88</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">889a182b8066804f4799f3808a5813ad601381a8a0e3baa4ab8d73e739b97001</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">data' </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        'community.wave.seqera.io</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">library</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">fastp</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">0.24.0--62c97b06e8447690' }</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path  adapter_fasta</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val   discard_trimmed_pass</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val   save_trimmed_fail</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val   save_merged</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'*.fastp.fastq.gz'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> , optional:true, emit: reads</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'*.json'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">           , emit: json</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'*.html'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">           , emit: html</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'*.log'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">            , emit: log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'*.fail.fastq.gz'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  , optional:true, emit: reads_fail</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'*.merged.fastq.gz'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, optional:true, emit: reads_merged</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path </span><span class="token string" style="color:hsl(119, 34%, 47%)">"versions.yml"</span><span class="token plain">                       , emit: versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    when:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    task.ext.when </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> task.ext.when</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def args </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.args ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def adapter_list </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> adapter_fasta ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--adapter_fasta </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${adapter_fasta}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def fail_fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> save_trimmed_fail </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> meta.single_end ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--failed_out </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fail.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> save_trimmed_fail </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">meta.single_end ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--failed_out </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.paired.fail.fastq.gz --unpaired1 </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_1.fail.fastq.gz --unpaired2 </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_2.fail.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def out_fq1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> discard_trimmed_pass ?: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"> meta.single_end ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--out1 </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fastp.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--out1 </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_1.fastp.fastq.gz"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def out_fq2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> discard_trimmed_pass ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--out2 </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_2.fastp.fastq.gz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // Added soft-links to original fastqs </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> consistent naming </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> MultiQC</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // Use single ended </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> interleaved. Add </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--interleaved_in</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> config.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"> task.ext.args?.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'--interleaved_in'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain">  </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sf</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$reads</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        fastp </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--stdout</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--in1</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--thread</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$task</span><span class="token plain">.cpus </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--json</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.json </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--html</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.html </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$adapter_list</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$fail_fastq</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$args</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.log </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">gzip</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            fastp: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">fastp </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"s/fastp //g"</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta.single_end</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain">  </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sf</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$reads</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        fastp </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--in1</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$out_fq1</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--thread</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$task</span><span class="token plain">.cpus </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--json</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.json </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--html</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.html </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$adapter_list</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$fail_fastq</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$args</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.log </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            fastp: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">fastp </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"s/fastp //g"</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        def merge_fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> save_merged ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"-m --merged_out </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.merged.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain">  </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_1.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sf</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${reads</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token variable" style="color:hsl(221, 87%, 60%)">0</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_1.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain">  </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_2.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sf</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${reads</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token variable" style="color:hsl(221, 87%, 60%)">1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        fastp </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--in1</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_1.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--in2</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_2.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$out_fq1</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$out_fq2</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--json</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.json </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--html</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.html </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$adapter_list</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$fail_fastq</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$merge_fastq</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--thread</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$task</span><span class="token plain">.cpus </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--detect_adapter_for_pe</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$args</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.log </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            fastp: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">fastp </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"s/fastp //g"</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    stub:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix              </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def is_single_output    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.args?.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'--interleaved_in'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> meta.single_end</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def touch_reads         </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">discard_trimmed_pass</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">is_single_output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fastp.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_1.fastp.fastq.gz ; echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_2.fastp.fastq.gz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def touch_merged        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">is_single_output </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> save_merged</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"echo '' | gzip &gt;  </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.merged.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def touch_fail_fastq    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">save_trimmed_fail</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> meta.single_end ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fail.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.paired.fail.fastq.gz ; echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_1.fail.fastq.gz ; echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_2.fail.fastq.gz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$touch_reads</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$touch_fail_fastq</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$touch_merged</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fastp.json"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fastp.html"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fastp.log"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        fastp: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">fastp </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"s/fastp //g"</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>This generates the command to run fastp with 2 reads, where memory is allocated automatically.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash -ue</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain">  GM12878_REP2_1.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sf</span><span class="token plain"> SRX1603630_T1_1.fastq.gz GM12878_REP2_1.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain">  GM12878_REP2_2.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sf</span><span class="token plain"> SRX1603630_T1_2.fastq.gz GM12878_REP2_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastp </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--in1</span><span class="token plain"> GM12878_REP2_1.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--in2</span><span class="token plain"> GM12878_REP2_2.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--out1</span><span class="token plain"> GM12878_REP2_1.fastp.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--out2</span><span class="token plain"> GM12878_REP2_2.fastp.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--json</span><span class="token plain"> GM12878_REP2.fastp.json </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--html</span><span class="token plain"> GM12878_REP2.fastp.html </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--thread</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--detect_adapter_for_pe</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> GM12878_REP2.fastp.log </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token string" style="color:hsl(119, 34%, 47%)">END_VERSIONS</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> versions.yml</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">"FASTP_1":</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    fastp: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">fastp </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable string" style="color:hsl(119, 34%, 47%)">"s/fastp //g"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">END_VERSIONS</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration">Configuration<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration" translate="no">​</a></h2>
<p>This configuration allows the workflow to run with:</p>
<ul>
<li class="">Docker/Singularity for containerization</li>
<li class="">Tracing and reporting capabilities</li>
<li class="">Named processes for memory and CPU allocation</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">params</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    outdir </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"result"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    trace_report_suffix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> new java.util.Date</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">.format</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'yyyy-MM-dd_HH-mm-ss'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"inputs/full_samplsheet.csv"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">profiles </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    singularity </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        singularity.enabled     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        singularity.autoMounts  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        conda.enabled           </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        docker.enabled          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        podman.enabled          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        shifter.enabled         </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        charliecloud.enabled    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        apptainer.enabled       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        docker.enabled          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        conda.enabled           </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        singularity.enabled     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        podman.enabled          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        shifter.enabled         </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        charliecloud.enabled    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        apptainer.enabled       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        docker.runOptions       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'-u $(id -u):$(id -g)'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    emulate_amd64 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // Run AMD64 containers on ARM hardware using emulation </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">slower but </span><span class="token function" style="color:hsl(221, 87%, 60%)">more</span><span class="token plain"> compatible</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        docker.runOptions       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'-u $(id -u):$(id -g) --platform=linux/amd64'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">singularity.registry </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'quay.io'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">docker.registry </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'quay.io'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:FASTQC_1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:FASTQC_2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain">.GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:FASTQC_3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain"> .GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:FASTP_1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:FASTP_2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain">.GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:FASTP_3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain"> .GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">timeline </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    enabled </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${params.outdir}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/pipeline_info/execution_timeline_</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${params.trace_report_suffix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.html"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">report </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    enabled </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${params.outdir}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/pipeline_info/execution_report_</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${params.trace_report_suffix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.html"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">trace </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    enabled </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${params.outdir}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/pipeline_info/execution_trace_</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${params.trace_report_suffix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.txt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="input-data">Input Data<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#input-data" class="hash-link" aria-label="Direct link to Input Data" title="Direct link to Input Data" translate="no">​</a></h2>
<p>The sample sheet below includes two RNA-seq samples, each with input files ranging from 6 to 7 GB, representing real-world data sizes.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sample,fastq_1,fastq_2,strandedness</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">GM12878_REP1,s3://ngi-igenomes/test-data/rnaseq/SRX1603629_T1_1.fastq.gz,s3://ngi-igenomes/test-data/rnaseq/SRX1603629_T1_2.fastq.gz,reverse</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">GM12878_REP2,s3://ngi-igenomes/test-data/rnaseq/SRX1603630_T1_1.fastq.gz,s3://ngi-igenomes/test-data/rnaseq/SRX1603630_T1_2.fastq.gz,reverse</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-the-benchmark">Running the Benchmark<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#running-the-benchmark" class="hash-link" aria-label="Direct link to Running the Benchmark" title="Direct link to Running the Benchmark" translate="no">​</a></h2>
<p>The above scripts are stored in the GitHub repository: <a href="https://github.com/nttg8100/nextflow-cost-optimization" target="_blank" rel="noopener noreferrer" class="">https://github.com/nttg8100/nextflow-cost-optimization</a></p>
<p>Clone the repository:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> clone https://github.com/nttg8100/nextflow-cost-optimization.git</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> nextflow-cost-optimization</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class=""><strong>Requirements</strong>: At least 8 CPUs and 16 GB RAM (adjust based on your computing resources in <code>nextflow.config</code>)</li>
<li class=""><strong>Alternative</strong>: If you don't have Docker, run with Singularity</li>
</ul></div></div>
<p>Run the workflow, which will execute commands using Nextflow (installed via pixi). Docker is required on your machine.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-fastqc-docker-amd64</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-fastp-docker-amd64</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># if you use MacBook with ARM</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-fastqc-docker-arm64</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-fastp-docker-arm64</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># if you do not have Docker installed, use Singularity</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-fastqc-singularity</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-fastp-singularity</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="run workflow" src="https://riverxdata.github.io/river-docs/assets/images/run_simple_workflow-42cfbfc6380f739a1e0887d87226f1e6.png" width="1123" height="580" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-evaluate-performance">How to Evaluate Performance<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#how-to-evaluate-performance" class="hash-link" aria-label="Direct link to How to Evaluate Performance" title="Direct link to How to Evaluate Performance" translate="no">​</a></h2>
<p>What we need to optimize is finding the minimal CPUs and memory that can run tasks efficiently without being too slow.
Open the HTML reports generated when you run the workflow to analyze performance. Below are the metrics we should use for evaluation:</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li class="">
<p><strong><code>%cpu</code></strong>:<br>
<!-- -->The average percentage of CPU usage by the process during its execution. For multi-threaded jobs, this value can exceed 100% (e.g., 400% for a process using all 4 allocated CPUs fully).</p>
</li>
<li class="">
<p><strong><code>rss</code></strong>:<br>
<!-- -->"Resident Set Size" — the maximum amount of physical memory (RAM) used by the process, measured in bytes. This shows how much memory your process actually consumed at peak.</p>
</li>
<li class="">
<p><strong><code>realtime</code></strong>:<br>
<!-- -->The total elapsed (wall-clock) time taken by the process, from start to finish, including waiting and processing time.</p>
</li>
</ul><p>These metrics help you tune and optimize your pipeline by revealing the true resource usage for each step.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fastqc-1">FastQC<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#fastqc-1" class="hash-link" aria-label="Direct link to FastQC" title="Direct link to FastQC" translate="no">​</a></h3>
<p>Interestingly, the execution time barely changes even when memory and CPUs are increased. From this experiment, we should consider using the minimal setup with 2 CPUs and 4 GB RAM while achieving nearly the same performance.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><ul>
<li class=""><strong>Note</strong>: The module is taken directly from nf-core. There may be a bug related to FastQC that hasn't been identified yet.</li>
<li class=""><strong>Finding</strong>: With real datasets, we can use minimal resources (much cheaper) without significant impact on running time!</li>
</ul></div></div>
<p><img decoding="async" loading="lazy" alt="report_fastqc" src="https://riverxdata.github.io/river-docs/assets/images/fastqc-b1524f902c60d6d461195238764d229c.png" width="1121" height="706" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fastp-1">FASTP<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#fastp-1" class="hash-link" aria-label="Direct link to FASTP" title="Direct link to FASTP" translate="no">​</a></h3>
<p>With fastp, increasing memory and CPUs shows a slight reduction in running time.
<img decoding="async" loading="lazy" alt="report_fastp" src="https://riverxdata.github.io/river-docs/assets/images/fastp-8f6715db45ea345fdcd8e0fbbc5d58f5.png" width="1121" height="706" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="external-benchmark">External benchmark<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#external-benchmark" class="hash-link" aria-label="Direct link to External benchmark" title="Direct link to External benchmark" translate="no">​</a></h2>
<p>The simple example above can be modified appropriately for more tools. Here are external benchmarks showing that adjusting computing resources helps reduce running time while keeping costs nearly the same:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="trimgalore">Trimgalore<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#trimgalore" class="hash-link" aria-label="Direct link to Trimgalore" title="Direct link to Trimgalore" translate="no">​</a></h3>
<p>Reference: <a href="https://github.com/FelixKrueger/TrimGalore/blob/master/CHANGELOG.md#version-060-release-on-1-mar-2019" target="_blank" rel="noopener noreferrer" class="">https://github.com/FelixKrueger/TrimGalore/blob/master/CHANGELOG.md#version-060-release-on-1-mar-2019</a>,
Using 4 CPUs is a good choice as it can reduce time by nearly 4x when compared with 1 CPU only.
<img decoding="async" loading="lazy" alt="report_trimgalore" src="https://riverxdata.github.io/river-docs/assets/images/trimgalore-3ba46f53dec2b72135acd67d8859f450.png" width="1810" height="541" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="star">STAR<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#star" class="hash-link" aria-label="Direct link to STAR" title="Direct link to STAR" translate="no">​</a></h3>
<p>Reference: <a href="https://academic.oup.com/bioinformatics/article/29/1/15/272537" target="_blank" rel="noopener noreferrer" class="">https://academic.oup.com/bioinformatics/article/29/1/15/272537</a>
Using 12 threads can align nearly 2x the reads when compared with 6 threads, while memory usage remains unchanged.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="nf-core-application">Nf-core application<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#nf-core-application" class="hash-link" aria-label="Direct link to Nf-core application" title="Direct link to Nf-core application" translate="no">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">If you run workflow with HPC, consider the ratio between CPUs and memory. If you spend all of memory, there is no cpus left for another jobs</li>
</ul></div></div>
<p>nf-core is one of the largest and most active bioinformatics workflow communities. However, their pipelines often use generic resource labels to define CPU and memory requirements for each process. For instance, the <a href="https://github.com/nf-core/rnaseq/blob/master/conf/base.config" target="_blank" rel="noopener noreferrer" class=""><strong>nf-core/rnaseq</strong></a> pipeline assigns default resources using labels like medium for tools such as FASTQC and FASTP.</p>
<p>Without tuning these settings for each specific tool, your workflow can waste resources and increase costs. In practice, both FASTQC and FASTP typically only need 2 CPUs and 4 GB RAM—much less than the default medium allocation.</p>
<p>This is especially important when running batch jobs in the cloud (AWS, Google Cloud, Azure, etc.), where virtual machines are often configured with a CPU<!-- -->:Memory<!-- --> ratio of 1:2. Requesting resources with a higher ratio, like 1:6, can increase queue times and lead to inefficient use of resources, as you may wait longer for an available instance and not fully utilize the extra memory.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">withLabel:process_single </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">                   </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">6</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.h  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">withLabel:process_low </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">     * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">12</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.h   * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">withLabel:process_medium </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">6</span><span class="token plain">     * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">36</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain">.h   * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">withLabel:process_high </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">12</span><span class="token plain">    * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">72</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain">.h  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">withLabel:process_long </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token plain">.h  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">withLabel:process_high_memory </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">200</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>To overwrite the existing worflow process cpus and memory, use the withName for specific tasks or adjust the label resources</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">      * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">.GB   * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.h    * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    errorStrategy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> task.exitStatus </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">((</span><span class="token number" style="color:hsl(35, 99%, 36%)">130</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">145</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> + </span><span class="token number" style="color:hsl(35, 99%, 36%)">104</span><span class="token plain"> + </span><span class="token number" style="color:hsl(35, 99%, 36%)">175</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'retry'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'finish'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    maxRetries    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    maxErrors     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'-1'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:process_single </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">                   </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.h  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:process_low </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">     * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.h   * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:process_medium </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain">     * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain">.h   * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:process_high </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain">    * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain">.h  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:process_long </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token plain">.h  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:process_high_memory </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:error_ignore </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        errorStrategy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'ignore'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:error_retry </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        errorStrategy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'retry'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        maxRetries    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel: process_gpu </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ext.use_gpu </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> workflow.profile.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'gpu'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        accelerator </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> workflow.profile.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'gpu'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> null </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName: FASTQC</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">     * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.GB  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.h   * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName: </span><span class="token string" style="color:hsl(119, 34%, 47%)">'.*:ALIGN_STAR:STAR_ALIGN|.*:ALIGN_STAR:STAR_ALIGN_IGENOMES'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        container </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"docker.io/nttg8100/star:2.7.11b"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="lessons-learned">Lessons Learned<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#lessons-learned" class="hash-link" aria-label="Direct link to Lessons Learned" title="Direct link to Lessons Learned" translate="no">​</a></h2>
<p>The two simple modules above help us select CPU and memory more easily. To optimize based on cost, here are some tips:</p>
<ul>
<li class="">For tasks shorter than 20 minutes, increasing CPUs and memory doesn't significantly reduce running time—use minimal resources instead</li>
<li class="">Some tools benefit greatly from multiple CPUs and memory. For these, you should increase computing resources.</li>
<li class="">Using 80% of available resources is typically sufficient. Sometimes when the input is slightly larger, tools can still run without crashing.</li>
</ul>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="nextflow" term="nextflow"/>
        <category label="hpc" term="hpc"/>
        <category label="workflow-optimization" term="workflow-optimization"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Pixi- New conda era]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era</id>
        <link href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era"/>
        <updated>2026-01-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Pixi is a fast, modern package management tool built on the conda ecosystem. Whether you're on a personal laptop or an HPC cluster, Pixi makes environment setup simple and reproducible. Here’s a primer on using Pixi. For a full workflow, see: Setting up single-cell RNA-seq analysis with Pixi as collaboration between RIVERXDATA and NGS101]]></summary>
        <content type="html"><![CDATA[<p>Pixi is a fast, modern package management tool built on the conda ecosystem. Whether you're on a personal laptop or an HPC cluster, Pixi makes environment setup simple and reproducible. Here’s a primer on using Pixi. For a full workflow, see: <a href="https://ngs101.com/setting-up-single-cell-rna-seq-analysis-environment-with-pixi-10x-faster-setup-zero-version-conflicts/" target="_blank" rel="noopener noreferrer" class=""><strong>Setting up single-cell RNA-seq analysis with Pixi</strong></a> as collaboration between <strong>RIVERXDATA</strong> and <strong>NGS101</strong></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="installing-pixi">Installing Pixi<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#installing-pixi" class="hash-link" aria-label="Direct link to Installing Pixi" title="Direct link to Installing Pixi" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="system-requirements">System Requirements<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#system-requirements" class="hash-link" aria-label="Direct link to System Requirements" title="Direct link to System Requirements" translate="no">​</a></h3>
<ul>
<li class=""><strong>OS</strong>: Any modern Unix (Ubuntu, Debian, CentOS, Fedora, Arch, MacOS, etc.)</li>
<li class=""><strong>Disk Space</strong>: 50–100 MB for Pixi, plus space for packages/cache</li>
<li class=""><strong>Privileges</strong>: No sudo/root needed—Pixi installs in user space</li>
</ul>
<p>Ideal for shared environments without admin access.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="one-line-installation">One-Line Installation<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#one-line-installation" class="hash-link" aria-label="Direct link to One-Line Installation" title="Direct link to One-Line Installation" translate="no">​</a></h3>
<p>Run in your terminal:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-fsSL</span><span class="token plain"> https://pixi.sh/install.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><br></span></code></pre></div></div>
<p>This downloads Pixi, installs it to <code>~/.pixi/bin</code>, and updates your shell config. After install, restart your terminal or run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> ~/.bashrc  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># or ~/.zshrc</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="verify-installation">Verify Installation<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#verify-installation" class="hash-link" aria-label="Direct link to Verify Installation" title="Direct link to Verify Installation" translate="no">​</a></h3>
<p>Check Pixi is working:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--help</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="hpc-configuration">HPC Configuration<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#hpc-configuration" class="hash-link" aria-label="Direct link to HPC Configuration" title="Direct link to HPC Configuration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="custom-cache-location">Custom Cache Location<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#custom-cache-location" class="hash-link" aria-label="Direct link to Custom Cache Location" title="Direct link to Custom Cache Location" translate="no">​</a></h3>
<p>To avoid home directory quotas, set a custom cache:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PIXI_CACHE_DIR</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">/scratch/</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain">/pixi-cache</span><br></span></code></pre></div></div>
<p>Add to your <code>~/.bashrc</code> or <code>~/.bash_profile</code> for persistence.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="proxy-settings">Proxy Settings<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#proxy-settings" class="hash-link" aria-label="Direct link to Proxy Settings" title="Direct link to Proxy Settings" translate="no">​</a></h3>
<p>If your cluster uses a proxy, edit <code>$HOME/.pixi/config.toml</code>:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[proxy-config]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">http = "http://proxy.example.com:8080/"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">https = "http://proxy.example.com:8080/"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">non-proxy-hosts = [".cn", "localhost", "[::1]"]</span><br></span></code></pre></div></div>
<p>See <a href="https://pixi.prefix.dev/latest/reference/pixi_configuration/" target="_blank" rel="noopener noreferrer" class="">Pixi configuration docs</a> for details.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="parallel-downloads">Parallel Downloads<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#parallel-downloads" class="hash-link" aria-label="Direct link to Parallel Downloads" title="Direct link to Parallel Downloads" translate="no">​</a></h3>
<p>Speed up downloads on fast networks:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[concurrency]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">downloads = 5</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="project-activation">Project Activation<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#project-activation" class="hash-link" aria-label="Direct link to Project Activation" title="Direct link to Project Activation" translate="no">​</a></h2>
<p>Pixi helps you create reproducible environments with lock files.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="initialize-a-project">Initialize a Project<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#initialize-a-project" class="hash-link" aria-label="Direct link to Initialize a Project" title="Direct link to Initialize a Project" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi init</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi workspace channel </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> conda-forge bioconda</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi workspace platform </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> osx-arm64 linux-64</span><br></span></code></pre></div></div>
<p>Example <code>pixi.toml</code>:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[workspace]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">channels = ["bioconda", "conda-forge"]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">name = "&lt;your project&gt;"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">platforms = ["linux-64", "osx-arm64"]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">version = "0.1.0"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[tasks]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[dependencies]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="add-tools">Add Tools<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#add-tools" class="hash-link" aria-label="Direct link to Add Tools" title="Direct link to Add Tools" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> fastqc multiqc</span><br></span></code></pre></div></div>
<p>Updates dependencies in <code>pixi.toml</code>:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastqc = "&gt;=0.12.1,&lt;0.13"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">multiqc = "&gt;=1.17,&lt;2"</span><br></span></code></pre></div></div>
<p>A <code>pixi.lock</code> file is created for reproducibility, specifying exact package versions and checksums.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="run-tools">Run Tools<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#run-tools" class="hash-link" aria-label="Direct link to Run Tools" title="Direct link to Run Tools" translate="no">​</a></h3>
<p>Run tools directly:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run fastqc </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--help</span><br></span></code></pre></div></div>
<p>Or activate the environment shell:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi shell</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastqc </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--help</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap">Recap<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#recap" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h2>
<ul>
<li class="">Pixi is a user-space, conda-based package manager ideal for laptops and HPC clusters.</li>
<li class="">Easy one-line installation, no admin rights needed.</li>
<li class="">Supports custom cache and proxy settings for HPC environments.</li>
<li class="">Enables reproducible project environments with lock files.</li>
<li class="">Simple commands to add tools and run them in isolated environments.</li>
</ul>
<p>Enjoy your Pixi-powered workflow!</p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="s3" term="s3"/>
        <category label="data-analysis" term="data-analysis"/>
        <category label="slurm" term="slurm"/>
        <category label="hpc" term="hpc"/>
        <category label="web-platform" term="web-platform"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[The Evolution of Version Control - CI/CD in bioinformatics (Part 2)]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2</id>
        <link href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2"/>
        <updated>2026-01-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Welcome to Part 2 of our series on version control in bioinformatics. In Part 1, we introduced Git fundamentals, branching strategies, and collaborative workflows. In this post, we'll dive into how Continuous Integration and Continuous Deployment (CI/CD) can transform your bioinformatics projects. If these concepts are new to you, don't worry—this guide will walk you through managing your bioinformatics repository to ensure your work is easily reproducible on any machine. Whether your server is wiped or you need to spin up a new virtual machine, you'll be able to quickly rerun your pipeline. With CI/CD, every code update can automatically trigger tests on a small dataset to verify everything works before scaling up, ensuring that new changes don't break your results or workflows.]]></summary>
        <content type="html"><![CDATA[<p>Welcome to Part 2 of our series on version control in bioinformatics. In <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1">Part 1</a>, we introduced Git fundamentals, branching strategies, and collaborative workflows. In this post, we'll dive into how Continuous Integration and Continuous Deployment (CI/CD) can transform your bioinformatics projects. If these concepts are new to you, don't worry—this guide will walk you through managing your bioinformatics repository to ensure your work is easily reproducible on any machine. Whether your server is wiped or you need to spin up a new virtual machine, you'll be able to quickly rerun your pipeline. With CI/CD, every code update can automatically trigger tests on a small dataset to verify everything works before scaling up, ensuring that new changes don't break your results or workflows.</p>
<ul>
<li class=""><strong>Part 1</strong>: History, basics, GitHub integration, and hands-on tutorials</li>
<li class=""><strong>Part 2 (This Post)</strong>: Local testing, CI/CD implementation, automated testing, and reproducible pipelines</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>In this tutorial, we will:</p><ul>
<li class="">Add code to download data</li>
<li class="">Write scripts to use FastQC and MultiQC</li>
</ul></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="git-commands">Git commands<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#git-commands" class="hash-link" aria-label="Direct link to Git commands" title="Direct link to Git commands" translate="no">​</a></h2>
<p>This tutorial is fully committed via a GitHub repository. You can clone and checkout to specific branches to see how it is developed and committed.
First, clone the repository, then:</p>
<ul>
<li class="">Learn how to view commit history (branches are referenced by their names)</li>
<li class="">Learn how to checkout to a specific commit</li>
<li class="">Learn how to see the difference between the current commit and a specific commit</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">To quit the git prompt, type <code>q</code></li>
<li class="">Create your own repository for a more practical approach</li>
<li class="">Check the differences in files, then copy them to your own repository to follow the tutorial</li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># clone</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> clone git@github.com:nttg8100/ngs-quality-control-for-blog-example.git</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> ngs-quality-control-for-blog-example</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># checkout to branch for the relevant tutorial step, e.g. feature/add-data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout feature/add-data</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-show-commit-log">How to show commit log<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#how-to-show-commit-log" class="hash-link" aria-label="Direct link to How to show commit log" title="Direct link to How to show commit log" translate="no">​</a></h3>
<p>Git provides commands to view the history and check the difference between two commits.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> log</span><br></span></code></pre></div></div>
<p>It will show details as below:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">commit ca29351295a4148bda73b6bf76a42cc7b834d1b6 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">HEAD -</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> feature/add-data, origin/feature/add-data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Author: Thanh-Giang </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">River</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> Tan Nguyen </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">nttg8100@gmail.com</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Date:   Mon Jan </span><span class="token number" style="color:hsl(35, 99%, 36%)">19</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">23</span><span class="token plain">:34:58 </span><span class="token number" style="color:hsl(35, 99%, 36%)">2026</span><span class="token plain"> +0700</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    feat: </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> makefile to get data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">commit 70d584a726fb5418274448a4f51ca07d94b104be </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">origin/main, origin/HEAD, main, feature/testing-rebase</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Merge: c731b9a 230795b</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Author: Thanh Giang Nguyen Tan </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token number" style="color:hsl(35, 99%, 36%)">64969412</span><span class="token plain">+nttg8100@users.noreply.github.com</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Date:   Sat Jan </span><span class="token number" style="color:hsl(35, 99%, 36%)">17</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain">:42:11 </span><span class="token number" style="color:hsl(35, 99%, 36%)">2026</span><span class="token plain"> +0700</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    Merge pull request </span><span class="token comment" style="color:hsl(230, 4%, 64%)">#1 from nttg8100/feature/environment-setup</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    feat: </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> pixi setup</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">commit 230795b7b8b03087ef7ee938d333161c9fcc0731 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">origin/feature/environment-setup</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Author: Thanh-Giang </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">River</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> Tan Nguyen </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">nttg8100@gmail.com</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Date:   Sat Jan </span><span class="token number" style="color:hsl(35, 99%, 36%)">17</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">15</span><span class="token plain">:05:28 </span><span class="token number" style="color:hsl(35, 99%, 36%)">2026</span><span class="token plain"> +0700</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    feat: </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> pixi setup</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">commit c731b9a80dfb22936bfcf94442bdf9b488a90d3c </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feature/tesing-rebase</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Author: Thanh Giang Nguyen Tan </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token number" style="color:hsl(35, 99%, 36%)">64969412</span><span class="token plain">+nttg8100@users.noreply.github.com</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Date:   Wed Jan </span><span class="token number" style="color:hsl(35, 99%, 36%)">14</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">23</span><span class="token plain">:09:30 </span><span class="token number" style="color:hsl(35, 99%, 36%)">2026</span><span class="token plain"> +0700</span><br></span></code></pre></div></div>
<p>To see more precisely what you need:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> log </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--oneline</span><br></span></code></pre></div></div>
<p>The one-line format is good enough:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ca29351 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">HEAD -</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> feature/add-data, origin/feature/add-data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> feat: </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> makefile to get data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">70d584a </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">origin/main, origin/HEAD, main, feature/testing-rebase</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> Merge pull request </span><span class="token comment" style="color:hsl(230, 4%, 64%)">#1 from nttg8100/feature/environment-setup</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">230795b </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">origin/feature/environment-setup</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> feat: </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> pixi setup</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">c731b9a </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feature/tesing-rebase</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> Initial commit</span><br></span></code></pre></div></div>
<p>Now you can see what I did on the repository. Following this tutorial, you can change to a specific commit to track it.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-checkout-to-specific-commit">How to checkout to specific commit<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#how-to-checkout-to-specific-commit" class="hash-link" aria-label="Direct link to How to checkout to specific commit" title="Direct link to How to checkout to specific commit" translate="no">​</a></h3>
<p>You can simply use the commit hash. For example, if I want to see all files from commit <code>230795b</code> which is on the branch <code>feature/testing-rebase</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout 230795b</span><br></span></code></pre></div></div>
<p>Now your code editor will show the files with content related to this commit.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-view-the-difference-between-two-commits-or-your-current-state">How to view the difference between two commits or your current state<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#how-to-view-the-difference-between-two-commits-or-your-current-state" class="hash-link" aria-label="Direct link to How to view the difference between two commits or your current state" title="Direct link to How to view the difference between two commits or your current state" translate="no">​</a></h3>
<p>If you have made changes to your files but have not committed them yet:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><br></span></code></pre></div></div>
<p>I made a change and have not committed it here:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--git</span><span class="token plain"> a/Makefile b/Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">index ae08113</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">c2e5b87 </span><span class="token number" style="color:hsl(35, 99%, 36%)">100644</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">--- a/Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+++ b/Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@@ -10,4 +10,6 @@ data/GSE110004:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> clean:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"> No newline at end of </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+       </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+Change here</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"> No newline at end of </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><br></span></code></pre></div></div>
<p>If you want to compare between two branches/commits:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><span class="token plain"> ca29351</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">70d584a</span><br></span></code></pre></div></div>
<p>The changes between the above commits:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--git</span><span class="token plain"> a/.gitignore b/.gitignore</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">index cfca1e8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">1c3ecb3 </span><span class="token number" style="color:hsl(35, 99%, 36%)">100644</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">--- a/.gitignore</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+++ b/.gitignore</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@@ -19,5 +19,3 @@ bin-release/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># pixi environments</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> .pixi/*</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">.pixi/config.toml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--git</span><span class="token plain"> a/Makefile b/Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">index ae08113</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">bcaa6d7 </span><span class="token number" style="color:hsl(35, 99%, 36%)">100644</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">--- a/Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+++ b/Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@@ -1,13 +1,3 @@</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sSL</span><span class="token plain"> https://pixi.dev/install.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-data/GSE110004:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> data/GSE110004 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_1.fastq.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-clean:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"> No newline at end of </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+       </span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sSL</span><span class="token plain"> https://pixi.dev/install.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"> No newline at end of </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-roll-back">How to roll back<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#how-to-roll-back" class="hash-link" aria-label="Direct link to How to roll back" title="Direct link to How to roll back" translate="no">​</a></h3>
<p>If you checkout a specific commit and add a few changes to test according to the tutorial, <code>git</code> requires you to commit your changes.
You can simply roll back to the original version:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout -- </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><br></span></code></pre></div></div>
<p>Sometimes you want to get files from another branch. You can use:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">branch name</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">relative </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain"> path</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># ex: git checkout main .gitignore</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="add-data">Add data<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#add-data" class="hash-link" aria-label="Direct link to Add data" title="Direct link to Add data" translate="no">​</a></h2>
<p>We need to create a new branch from updated main</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout main</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> pull origin main</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> switch </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> feature/add-data</span><br></span></code></pre></div></div>
<p>Now we'll add a few target setups to the Makefile to automate data download and cleanup tasks for your pipeline:</p>
<ul>
<li class=""><strong><code>data/GSE110004</code> target</strong>: Downloads example FASTQ files from a public test dataset into the <code>data/GSE110004</code> directory. This ensures everyone working on the project uses the same input data, improving reproducibility.</li>
<li class=""><strong><code>clean</code> target</strong>: Removes the downloaded data directory, making it easy to reset your environment or save disk space.</li>
</ul>
<p>This approach helps standardize data management and makes it easier for collaborators (and CI/CD systems) to set up and test the pipeline with minimal manual steps.</p>
<p>Update your <code>Makefile</code> with the following:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sSL</span><span class="token plain"> https://pixi.dev/install.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">data:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> data/GSE110004/SRR6351937_1.fastq.gz https://ftp.sra.ebi.ac.uk/vol1/fastq/SRR635/007/SRR6351937/SRR6351937_1.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> data/GSE110004/SRR6351937_2.fastq.gz https://ftp.sra.ebi.ac.uk/vol1/fastq/SRR635/007/SRR6351937/SRR6351937_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> data</span><br></span></code></pre></div></div>
<p>Following tutorial 1, you can commit, push, create a PR, and merge to main:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"feat: add makefile to get data"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> push origin feature/add-data</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="add-workflow">Add workflow<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#add-workflow" class="hash-link" aria-label="Direct link to Add workflow" title="Direct link to Add workflow" translate="no">​</a></h2>
<p>Create new branch</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout main</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> pull</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> switch </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> feature/workflow</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="add-workflow-mainsh-script-and-testing">Add workflow main.sh script and testing<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#add-workflow-mainsh-script-and-testing" class="hash-link" aria-label="Direct link to Add workflow main.sh script and testing" title="Direct link to Add workflow main.sh script and testing" translate="no">​</a></h3>
<p>Here I create a simple bash script that will run using command lines with inputs as arguments.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># create workflow file using bash script, this runs for only paired reads of 1 sample</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> main.sh</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">#!/bin/bash</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># Usage: ./main.sh &lt;read1.fastq.gz&gt; &lt;read2.fastq.gz&gt; &lt;output_folder&gt;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">set -e</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">if [ "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$#</span><span class="token string" style="color:hsl(119, 34%, 47%)">" -ne 3 ]; then</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    echo "Usage: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$0</span><span class="token string" style="color:hsl(119, 34%, 47%)"> &lt;read1.fastq.gz&gt; &lt;read2.fastq.gz&gt; &lt;output_folder&gt;"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    exit 1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">fi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">READ1="\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$1</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">READ2="\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$2</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">OUTDIR="\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$3</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">mkdir -p "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">echo "Running FastQC on \</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$READ1</span><span class="token string" style="color:hsl(119, 34%, 47%)"> and \</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$READ2</span><span class="token string" style="color:hsl(119, 34%, 47%)">..."</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">fastqc "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$READ1</span><span class="token string" style="color:hsl(119, 34%, 47%)">" "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$READ2</span><span class="token string" style="color:hsl(119, 34%, 47%)">" -o "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">echo "Running MultiQC in \</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">..."</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">multiqc "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">" -o "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">echo "All done. Results are in \</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># chmod to be executed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">chmod</span><span class="token plain"> +x main.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># get help script</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> main.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Usage: zsh &lt;read1.fastq.gz&gt; &lt;read2.fastq.gz&gt; &lt;output_folder&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># test it with your data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># activate pixi </span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi shell</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># run interactively</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> main.sh data/GSE110004/*_1.fastq.gz data/GSE110004/*_2.fastq.gz result</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># run with pixi directly</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> main.sh data/GSE110004/*_1.fastq.gz data/GSE110004/*_2.fastq.gz result</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="qc_wf" src="https://riverxdata.github.io/river-docs/assets/images/qc_workflow-9a92452d2aaa1a2b5a25d1da3c212a57.png" width="1519" height="1036" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="use-makefile-to-add-tests">Use Makefile to add tests<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#use-makefile-to-add-tests" class="hash-link" aria-label="Direct link to Use Makefile to add tests" title="Direct link to Use Makefile to add tests" translate="no">​</a></h3>
<p>Now we can quickly run tests after updating the <code>Makefile</code>:</p>
<div class="language-Makefile language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">.PHONY: install-pixi test-e2e clean</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">${HOME}/.pixi/bin/pixi:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	mkdir -p ${HOME}/.pixi/bin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	curl -sSL https://pixi.dev/install.sh | sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">data/GSE110004:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	mkdir -p data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	cd data/GSE110004 &amp;&amp; \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	wget https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_1.fastq.gz &amp;&amp; \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	wget https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-e2e: data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	${HOME}/.pixi/bin/pixi run bash main.sh data/GSE110004/*_1.fastq.gz data/GSE110004/*_2.fastq.gz result</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	rm -rf data/GSE110004</span><br></span></code></pre></div></div>
<p>Quickly run the test:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-e2e</span><br></span></code></pre></div></div>
<p>Update your <code>.gitignore</code> to avoid committing the results:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Build and Release Folders</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bin-debug/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bin-release/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">Oo</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">bj/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">Bb</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">in/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Other files and folders</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">.settings/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Executables</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">*.swf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">*.air</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">*.ipa</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">*.apk</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Project files, i.e. `.project`, `.actionScriptProperties` and `.flexProperties`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># should NOT be excluded as they contain compiler settings and other important</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># information for Eclipse / Flash Builder.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># pixi environments</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">.pixi/*</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">.pixi/config.toml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">result</span><br></span></code></pre></div></div>
<p>Following tutorial 1, you can commit, push, create a PR, and merge to main:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"feat: add workflow"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> push origin feature/workflow </span><br></span></code></pre></div></div>
<p>Then, in your repository root folder, run these commands to get the data:</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">Currently, a few make target commands are simple and can be run directly, but in the future, it would be better to update them with more commands</li>
<li class="">Ex: <code>make clean</code> can be used to delete more files/folders</li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># download data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># test that data is downloaded</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lah</span><span class="token plain">  data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># total 4.3M</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># drwxrwxr-x 2 giangnguyen giangnguyen 4.0K Jan 19 01:00 .</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># drwxrwxr-x 3 giangnguyen giangnguyen 4.0K Jan 19 01:00 ..</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># -rw-rw-r-- 1 giangnguyen giangnguyen 2.2M Jan 19 01:00 SRR6357070_1.fastq.gz</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># -rw-rw-r-- 1 giangnguyen giangnguyen 2.2M Jan 19 01:00 SRR6357070_2.fastq.gz</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># delete data folder</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> clean</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="configure-testing">Configure testing<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#configure-testing" class="hash-link" aria-label="Direct link to Configure testing" title="Direct link to Configure testing" translate="no">​</a></h2>
<p>So far, everything has been done locally. However, when you add new features—for example, adding <code>trimmomatic</code> to trim the FastQC files—you need to run the tests again to ensure they can be executed without errors. This is the simplest testing practice for developing bioinformatics projects.</p>
<p>GitHub provides GitHub Actions to help with this:</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li class="">For more detailed examples on GitHub Actions, follow the official documentation: <a href="https://docs.github.com/en/actions/get-started/quickstart" target="_blank" rel="noopener noreferrer" class="">https://docs.github.com/en/actions/get-started/quickstart</a></li>
<li class="">Here, we introduce how it works and how we can apply it simply</li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="create-github-action-files">Create GitHub Action files<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#create-github-action-files" class="hash-link" aria-label="Direct link to Create GitHub Action files" title="Direct link to Create GitHub Action files" translate="no">​</a></h3>
<p>Create a new branch for CI/CD:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout main</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> pull</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> switch </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> feature/cicd</span><br></span></code></pre></div></div>
<p>Configure the workflow:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> .github/workflows</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># create workflow file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> .github/workflows/test-e2e.yaml</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">name: Testing e2e</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">on:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  push:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    branches: [ main ]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  pull_request:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    branches: [ main ]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">jobs:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  clone:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    runs-on: ubuntu-latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    steps:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">      - name: Checkout repository</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">        uses: actions/checkout@v4</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">      - name: Running testing</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">        run: |</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">          make test-e2e</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><br></span></code></pre></div></div>
<p>What it does:</p>
<ul>
<li class="">Runs workflow named Testing e2e</li>
<li class="">Triggers on pull requests to main</li>
<li class="">Triggers on push or merge into main</li>
<li class="">Starts a job on ubuntu-latest runner</li>
<li class="">Clones the repository using actions/checkout</li>
<li class="">Runs end-to-end tests via make test-e2e</li>
<li class="">Passes if tests succeed</li>
<li class="">Fails if tests return a non-zero exit code</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-github-actions-locally">Running GitHub Actions locally<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#running-github-actions-locally" class="hash-link" aria-label="Direct link to Running GitHub Actions locally" title="Direct link to Running GitHub Actions locally" translate="no">​</a></h3>
<p>If we only run tests when creating a PR or pushing to <code>main</code>, you may make mistakes and create many commits just to trigger testing. Here, we can use <code>act</code>, a local command line tool that can help:</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li class="">For more details on how to use <code>act</code>: <a href="https://nektosact.com/" target="_blank" rel="noopener noreferrer" class="">https://nektosact.com</a></li>
<li class="">Install Docker on your local machine first</li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># install</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> act</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># run e2e test locally, it will run this on your local machine</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-W</span><span class="token plain"> .github/workflows/test-e2e.yaml</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="act_failed" src="https://riverxdata.github.io/river-docs/assets/images/act_failed-afc9d4fa6bcd8fd64420bfe5598a61d5.png" width="1519" height="864" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><ul>
<li class="">As you can see, it failed because pixi is not installed. This is because the <code>make test-e2e</code> target does not trigger pixi installation</li>
<li class="">Also, there is a wrong URL for installing pixi: <code>https://pixi.dev/install.sh</code> should be replaced with <code>https://pixi.sh/install.sh</code></li>
<li class="">You should add pixi installation as a dependency for <code>test-e2e</code></li>
</ul></div></div>
<p>Update dependencies of <code>test-e2e</code> in the <code>Makefile</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">.PHONY: test-e2e clean</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sSL</span><span class="token plain"> https://pixi.sh/install.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">data/GSE110004:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> data/GSE110004 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_1.fastq.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-e2e: data/GSE110004 </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> main.sh data/GSE110004/*_1.fastq.gz data/GSE110004/*_2.fastq.gz result</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> data/GSE110004</span><br></span></code></pre></div></div>
<p>Now you can rerun to test successfully, as shown below:
<img decoding="async" loading="lazy" alt="act_success1" src="https://riverxdata.github.io/river-docs/assets/images/act_success1-c6c94a384f9f52c48c288f723338945c.png" width="1519" height="864" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="act_success2" src="https://riverxdata.github.io/river-docs/assets/images/act_success2-66c5e05f88d51a5c3604ba0fa4fd927a.png" width="1519" height="864" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-cicd-in-bioinformatics">What is CI/CD in bioinformatics?<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#what-is-cicd-in-bioinformatics" class="hash-link" aria-label="Direct link to What is CI/CD in bioinformatics?" title="Direct link to What is CI/CD in bioinformatics?" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-cicd-in-software-development">What is CI/CD in software development<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#what-is-cicd-in-software-development" class="hash-link" aria-label="Direct link to What is CI/CD in software development" title="Direct link to What is CI/CD in software development" translate="no">​</a></h3>
<p><img decoding="async" loading="lazy" alt="cicd" src="https://riverxdata.github.io/river-docs/assets/images/cicd-85c944e1969870ad96df0a1b7d04d315.webp" width="825" height="399" class="img_ev3q">
Reference: <a href="https://viblo.asia/p/cau-hinh-cicd-voi-github-phan-1-mot-it-ly-thuyet-Qbq5Q9NL5D8" target="_blank" rel="noopener noreferrer" class="">https://viblo.asia/p/cau-hinh-cicd-voi-github-phan-1-mot-it-ly-thuyet-Qbq5Q9NL5D8</a></p>
<p>What exactly are CI (Continuous Integration) and CD (Continuous Delivery)? These terms are commonly used in software development.
In the figure above, software can be developed with many new features, which will trigger specific jobs with actions.
For example, we can the workflow to clone the repository on a GitHub Actions instance and run tests. This approach depends on many use cases.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-does-it-work-in-bioinformatics">How does it work in bioinformatics?<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#how-does-it-work-in-bioinformatics" class="hash-link" aria-label="Direct link to How does it work in bioinformatics?" title="Direct link to How does it work in bioinformatics?" translate="no">​</a></h3>
<p>That is exactly what I showed you above. If you want to develop software, follow the standard CI/CD software development process. In contrast,
bioinformatics typically combines these tools together. This means they will run scripts (bash, Nextflow, WDL, Snakemake, etc.) to combine tools
in a workflow manner. The release is the repository itself with the scripts inside (CD), while the CI is the process we set up to run
the pipeline with testing datasets.</p>
<p>Now you can create a PR, which will always trigger the testing that helps you validate whether your changes may fail the pipeline.
<img decoding="async" loading="lazy" alt="PR_GHA" src="https://riverxdata.github.io/river-docs/assets/images/PR_GHA-3f6f906f7d1600d69ba6fe6bd331ffe3.png" width="1061" height="1071" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">Use secrets in <code>Settings</code> to work with credentials (passwords, usernames, keys)</li>
<li class="">Use the Makefile to help sync the local environment with the GitHub Actions environment. This makes it easy to change the CI/CD runner</li>
<li class="">Use matrix strategy to run tests faster</li>
</ul></div></div>
<p>Check GitHub Actions logs for debugging:
<img decoding="async" loading="lazy" alt="GHA" src="https://riverxdata.github.io/river-docs/assets/images/GHA_log-275ac35c8fdbaf250724faba33aaee7c.png" width="1381" height="1356" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="review">Review<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#review" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review" translate="no">​</a></h2>
<p>In this tutorial, we explored how to transform a basic bioinformatics project into a reproducible, testable pipeline using Git, Makefiles, and CI/CD practices. Here are the key takeaways:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="git-commands-for-project-management">Git Commands for Project Management<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#git-commands-for-project-management" class="hash-link" aria-label="Direct link to Git Commands for Project Management" title="Direct link to Git Commands for Project Management" translate="no">​</a></h3>
<ul>
<li class="">Use <code>git log</code> and <code>git log --oneline</code> to view commit history</li>
<li class="">Checkout to specific commits to track development progress</li>
<li class="">Use <code>git diff</code> to compare changes between commits or branches</li>
<li class="">Roll back to original states with <code>git checkout -- .</code></li>
<li class="">Copy files from other branches using <code>git checkout &lt;branch&gt; &lt;file&gt;</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="makefile-automation">Makefile Automation<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#makefile-automation" class="hash-link" aria-label="Direct link to Makefile Automation" title="Direct link to Makefile Automation" translate="no">​</a></h3>
<ul>
<li class="">Create targets for data download (<code>make data</code>) and cleanup (<code>make clean</code>)</li>
<li class="">Add test targets (<code>make test-e2e</code>) that chain dependencies together</li>
<li class="">Ensure reproducibility by standardizing commands across environments</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow-scripts">Workflow Scripts<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#workflow-scripts" class="hash-link" aria-label="Direct link to Workflow Scripts" title="Direct link to Workflow Scripts" translate="no">​</a></h3>
<ul>
<li class="">Create bash scripts that accept command-line arguments</li>
<li class="">Combine tools like FastQC and MultiQC in a workflow</li>
<li class="">Test workflows locally before pushing to remote</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cicd-with-github-actions">CI/CD with GitHub Actions<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#cicd-with-github-actions" class="hash-link" aria-label="Direct link to CI/CD with GitHub Actions" title="Direct link to CI/CD with GitHub Actions" translate="no">​</a></h3>
<ul>
<li class="">Create workflow files in <code>.github/workflows/</code></li>
<li class="">Trigger tests on push to main or pull requests</li>
<li class="">Use the same Makefile commands in CI as in local development</li>
<li class="">Check GitHub Actions logs for debugging failed tests</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="local-testing-with-act">Local Testing with <code>act</code><a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#local-testing-with-act" class="hash-link" aria-label="Direct link to local-testing-with-act" title="Direct link to local-testing-with-act" translate="no">​</a></h3>
<ul>
<li class="">Test GitHub Actions workflows locally using <code>act</code></li>
<li class="">Catch issues before pushing to remote repositories</li>
<li class="">Reduce the number of commits needed to fix CI failures</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cicd-in-bioinformatics-context">CI/CD in Bioinformatics Context<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#cicd-in-bioinformatics-context" class="hash-link" aria-label="Direct link to CI/CD in Bioinformatics Context" title="Direct link to CI/CD in Bioinformatics Context" translate="no">​</a></h3>
<ul>
<li class="">Unlike traditional software, bioinformatics CI/CD often focuses on pipeline validation</li>
<li class="">The "delivery" is often the repository itself with reproducible workflows</li>
<li class="">Testing involves running entire pipelines on test datasets</li>
<li class="">This ensures changes don't break existing analyses</li>
</ul>
<p>By implementing these practices, you create a robust bioinformatics project that is:</p>
<ul>
<li class=""><strong>Reproducible</strong>: Anyone can reproduce your results on any machine</li>
<li class=""><strong>Testable</strong>: Automated tests catch errors before they reach production</li>
<li class=""><strong>Maintainable</strong>: Clear history and documentation make updates easier</li>
<li class=""><strong>Collaborative</strong>: CI/CD ensures all changes are validated before merging</li>
</ul>
<p>Ready to implement CI/CD in your own bioinformatics projects? Start by adding a simple Makefile target, then gradually build up your testing and automation capabilities.</p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="git" term="git"/>
        <category label="version-control" term="version-control"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="reproducibility" term="reproducibility"/>
        <category label="pipelines" term="pipelines"/>
        <category label="ci-cd" term="ci-cd"/>
        <category label="github-actions" term="github-actions"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[The Evolution of Version Control - Git's Role in Reproducible Bioinformatics (Part 1)]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1</id>
        <link href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1"/>
        <updated>2026-01-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In Part 1 (this post), we explore the history of Git, its integration with GitHub, and basic hands-on tutorials. Part 2 (coming soon) will cover real-world bioinformatics examples and advanced workflows with best practices.]]></summary>
        <content type="html"><![CDATA[<p>In Part 1 (this post), we explore the history of Git, its integration with GitHub, and basic hands-on tutorials. Part 2 (coming soon) will cover real-world bioinformatics examples and advanced workflows with best practices.</p>
<p>This part focuses on practical applications, including NGS quality control using multiqc and fastqc.</p>
<ul>
<li class=""><strong>Part 1 (This Post)</strong>: History, basics, GitHub integration, and hands-on tutorials</li>
<li class=""><strong>Part 2 (Coming Soon)</strong>: Real-world bioinformatics examples and advanced workflows with best practices</li>
</ul>
<p>Here I provide a real-world example of how to create a simple repository that enables reproducible work for NGS short read data quality control. I'll explain each step using a GitHub repository.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="create-a-repository">Create a Repository<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#create-a-repository" class="hash-link" aria-label="Direct link to Create a Repository" title="Direct link to Create a Repository" translate="no">​</a></h2>
<p>As the creator, you are the admin of the repository. You can configure permissions to control who can read or modify it. Here are some common setup tips:</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class=""><strong>Visibility</strong>: If you want to share your work with the community, use <code>public</code>. Otherwise, use <code>private</code></li>
<li class=""><strong>Add README</strong>: A README file helps others understand how your repository is structured. Beyond the standard <code>README.md</code> for general users, consider adding <code>README.developer.md</code> for developer-specific information</li>
<li class=""><strong>.gitignore</strong>: This file specifies which files or folders should not be pushed to GitHub</li>
<li class=""><strong>License</strong>: This determines how others can use your work. For example, MIT allows free usage, while other licenses may require purchase for commercial use</li>
</ul></div></div>
<p><img decoding="async" loading="lazy" alt="create_repo" src="https://riverxdata.github.io/river-docs/assets/images/create_repository-e2056ec5eb975ee5076cc215b76581cf.png" width="802" height="1235" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="clone">Clone<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#clone" class="hash-link" aria-label="Direct link to Clone" title="Direct link to Clone" translate="no">​</a></h2>
<p>Cloning creates a copy of your repository on your local computer. When working in a team, each member has their own local copy. GitHub serves as a central location, similar to Google Drive, that allows you to sync your source code.</p>
<p>GitHub provides SSH protocol authentication for downloading resources, but it doesn't work like a remote server with shell access.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li class="">After creating a repository, clone it to start working</li>
<li class="">You'll need to authenticate with GitHub on your local computer or HPC first. I recommend using SSH keys</li>
<li class="">Click the green "Code" button, select the "SSH" tab, copy the URL, and use it to clone the repository</li>
</ul></div></div>
<p><img decoding="async" loading="lazy" alt="created" src="https://riverxdata.github.io/river-docs/assets/images/created_clone-847299d374b67dd2ead6159ab13ca0d2.png" width="1973" height="911" class="img_ev3q"></p>
<p>For authentication, follow the official GitHub documentation: <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account" target="_blank" rel="noopener noreferrer" class="">https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account</a></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">This site also has documentation on connecting to remote servers using SSH: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/administration/ssh-remote-server"><strong>SSH setup</strong></a></li>
<li class="">You can stop after creating the key pair</li>
</ul></div></div>
<p>Add your public key to GitHub by navigating to <code>Settings</code> → <code>SSH</code> section</p>
<p><img decoding="async" loading="lazy" alt="ssh" src="https://riverxdata.github.io/river-docs/assets/images/add_ssh_key-3e0aad975cfda9eedf750303c36b86c2.png" width="1374" height="911" class="img_ev3q"></p>
<p>Now test your connection to GitHub:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> git@github.com</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># PTY allocation request failed on channel 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Hi nttg8100! You've successfully authenticated, but GitHub does not provide shell access.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Connection to github.com closed.</span><br></span></code></pre></div></div>
<p>You're ready to clone. Open your terminal, navigate to your working directory, and clone the repository:</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">To clone a specific branch or tag, add <code>-b &lt;branch-name&gt;</code></li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># clone (equivalent to: git clone git@github.com:nttg8100/ngs-quality-control-for-blog-example.git -b main)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> clone git@github.com:nttg8100/ngs-quality-control-for-blog-example.git</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> ngs-quality-control-for-blog-example</span><br></span></code></pre></div></div>
<p>Open the code with your editor. Here I use Visual Studio Code:</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Download and install Visual Studio Code: <a href="https://code.visualstudio.com/download" target="_blank" rel="noopener noreferrer" class="">https://code.visualstudio.com/download</a></p></div></div>
<p><img decoding="async" loading="lazy" alt="download_vscode" src="https://riverxdata.github.io/river-docs/assets/images/visual_studio_code-e5f1105eab16be8a6a6a51ff90efacde.png" width="1374" height="911" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="your-code-editor">Your Code Editor<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#your-code-editor" class="hash-link" aria-label="Direct link to Your Code Editor" title="Direct link to Your Code Editor" translate="no">​</a></h2>
<p>In your terminal, you can open the entire repository (which is just a folder). Simply use your mouse to select the terminal icon in the footer.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">Now you can select any file you want to edit—everything is a text file</li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">code </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="editor" src="https://riverxdata.github.io/river-docs/assets/images/editor-62a54435276d5a2a10b60dd04f6ef7ba.png" width="1433" height="894" class="img_ev3q"></p>
<p>Now follow these steps to establish good version control practices.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="branching-strategy">Branching Strategy<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#branching-strategy" class="hash-link" aria-label="Direct link to Branching Strategy" title="Direct link to Branching Strategy" translate="no">​</a></h2>
<p><img decoding="async" loading="lazy" alt="branch" src="https://riverxdata.github.io/river-docs/assets/images/git_branch-e9d4d8cd28ce32661c296af5c8fd85ec.png" width="1280" height="719" class="img_ev3q"></p>
<p>A branching strategy is a workflow that helps teams manage codebase changes in a structured way. Git branches allow you to work on new features, bug fixes, or experiments without affecting the main codebase.</p>
<p><strong>Common branching strategies:</strong></p>
<ul>
<li class="">
<p><strong>Main (or <code>master</code>) branch:</strong>
The stable branch that always contains production-ready code</p>
</li>
<li class="">
<p><strong>Feature branches:</strong>
Create a new branch for each feature or task (e.g., <code>feature/quality-control</code>). This keeps development isolated until the feature is complete</p>
</li>
<li class="">
<p><strong>Development branch:</strong>
Some teams use a <code>develop</code> branch as an integration branch for features before merging into <code>main</code></p>
</li>
<li class="">
<p><strong>Hotfix/bugfix branches:</strong>
For urgent fixes, create a branch from <code>main</code> (e.g., <code>hotfix/fix-typo</code>) and merge back after testing</p>
</li>
</ul>
<p><strong>Typical workflow:</strong></p>
<ol>
<li class="">Create a new branch from <code>main</code> for your feature or fix</li>
<li class="">Work on your changes and commit them to your branch</li>
<li class="">Open a pull request (PR) to merge your branch into <code>main</code> (or <code>develop</code>)</li>
<li class="">Review, test, and merge the PR</li>
</ol>
<p>This approach:</p>
<ul>
<li class="">Keeps the <code>main</code> branch stable</li>
<li class="">Makes collaboration easier</li>
<li class="">Helps track changes and review code before merging</li>
</ul>
<p>Now let's create a new branch. Our goal is to set up easy installation of fastqc and multiqc. We'll write a bash script for analysis later. For simplicity, we'll develop feature branches and merge them directly to main, which works well for small projects like this.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create and switch to a new branch from main</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> switch </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> feature/environment-setup</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="new-branch-environment-setup">New Branch: Environment Setup<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#new-branch-environment-setup" class="hash-link" aria-label="Direct link to New Branch: Environment Setup" title="Direct link to New Branch: Environment Setup" translate="no">​</a></h2>
<p>Instead of conda, I prefer to install pixi, then install multiqc and fastqc. Create a Makefile for installation—you can either edit a new <code>Makefile</code> manually or generate it with bash.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>A Makefile is a special file used by the make build automation tool. It defines rules and instructions for building and managing projects, especially in languages like C/C++. However, it can be used for any project, including Node.js, React, and TypeScript, to automate repetitive tasks.</p><p><strong>Key Concepts:</strong></p><ul>
<li class=""><strong>Targets</strong>: What you want to build (e.g., a file or a label for a task)</li>
<li class=""><strong>Dependencies</strong>: Files or targets that must be up-to-date before the target can be built</li>
<li class=""><strong>Recipes</strong>: Shell commands to run to build the target</li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> Makefile</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token string variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/.pixi/bin/pixi:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  mkdir -p </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token string variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/.pixi/bin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  curl -sSL https://pixi.dev/install.sh | sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify the newly created file content</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> Makefile</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p><strong>Pro Tip:</strong>
When writing your <code>Makefile</code>, use <code>.PHONY</code> targets for commands that don't produce files with the same name. This prevents conflicts and ensures your commands always run as expected. Keep installation steps modular—separate environment setup, tool installation, and analysis scripts into different targets for clarity and reusability.</p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install pixi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> ~/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Initialize pixi in your current repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi init </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--channel</span><span class="token plain"> conda-forge </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--channel</span><span class="token plain"> bioconda</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install multiqc and fastqc</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> fastqc multiqc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Activate the pixi shell</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi shell</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify tools are installed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> fastqc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> multiqc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /home/giangnguyen/Documents/dev/docs/ngs-quality-control-for-blog-example/.pixi/envs/default/bin/fastqc</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /home/giangnguyen/Documents/dev/docs/ngs-quality-control-for-blog-example/.pixi/envs/default/bin/multiqc</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-git-commands">Common Git Commands<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#common-git-commands" class="hash-link" aria-label="Direct link to Common Git Commands" title="Direct link to Common Git Commands" translate="no">​</a></h2>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>You can check git history to see who made changes—useful for accountability when needed</p></div></div>
<p>Check your current status to see uncommitted files. Use command line to add files to your commit:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> status</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="uncommited" src="https://riverxdata.github.io/river-docs/assets/images/status_uncommit-a95910e3649a2fedc8c2f9a005b295d4.png" width="1364" height="266" class="img_ev3q"></p>
<p>Add files to commit and review changes:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add files one by one</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> .gitignore</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> .gitattributes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> pixi.lock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> pixi.toml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or add all files/folders in the current repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify staged files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> status</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="committed" src="https://riverxdata.github.io/river-docs/assets/images/status_after_add-d297b354af1341187b0eb93b9d8b48b4.png" width="1364" height="172" class="img_ev3q"></p>
<p>Sometimes you might accidentally stage the wrong files. Remove them from the current commit:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create a wrong file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> wrong_file.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> wrong_file.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Restore it to unstaged status</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> restore </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--staged</span><span class="token plain"> wrong_file.txt</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="restore" src="https://riverxdata.github.io/river-docs/assets/images/restore-06b0ba67bbee8210236bd8781d9b078d.png" width="1364" height="461" class="img_ev3q"></p>
<p>If you need files locally but don't want to commit them, add them to .gitignore. This prevents them from being committed even when using <code>git add .</code>. .gitignore can ignore both files and folders.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">For better control, create .gitignore in the specific folder/subfolder where unwanted files/folders are located</li>
<li class="">Common .gitignore patterns: environment folders (<code>.env</code>, <code>.pixi</code>), <code>node_modules</code>, data folders (<code>data</code>), <code>*.tar.gz</code>, cache folders (<code>__pycache__</code>)</li>
<li class="">To ignore an entire folder but keep specific files, use <code>!&lt;filename&gt;</code> to keep only needed files</li>
</ul><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">folder</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">!folder/file.txt</span><br></span></code></pre></div></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add to gitignore</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"wrong_file.txt"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> .gitignore</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View the file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .gitignore</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Try to add the file again—it won't be staged now and will show a warning</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> wrong_file.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check status</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> status</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="gitignore" src="https://riverxdata.github.io/river-docs/assets/images/gitignore-d69a2c152f3921ff1f862bb7c4143c1f.png" width="1364" height="325" class="img_ev3q"></p>
<p>Now create a commit with all your staged files:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"feat: add pixi setup"</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="commit" src="https://riverxdata.github.io/river-docs/assets/images/commit-580a0eebc26baf34fe9ee1128bf1de12.png" width="1364" height="132" class="img_ev3q"></p>
<p>Push your changes to GitHub, the remote server that tracks your development progress:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Push to remote</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> push origin feature/environment-setup</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View your remote origin to confirm where updates are pushed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># This shows I cloned using the SSH credential</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--get</span><span class="token plain"> remote.origin.url</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># git@github.com:nttg8100/ngs-quality-control-for-blog-example.git</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="push" src="https://riverxdata.github.io/river-docs/assets/images/push_origin-7d1a96c158019affbf96e1db19fa5d8d.png" width="1364" height="263" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="check-updates-on-github">Check Updates on GitHub<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#check-updates-on-github" class="hash-link" aria-label="Direct link to Check Updates on GitHub" title="Direct link to Check Updates on GitHub" translate="no">​</a></h2>
<p>Visit your GitHub repository to see the new branch. In this example:
<a href="https://github.com/nttg8100/ngs-quality-control-for-blog-example" target="_blank" rel="noopener noreferrer" class="">https://github.com/nttg8100/ngs-quality-control-for-blog-example</a></p>
<p><img decoding="async" loading="lazy" alt="updated_branch" src="https://riverxdata.github.io/river-docs/assets/images/new_branch_created-c0ee2d99a07901b63dfdcc78cf69b947.png" width="1364" height="643" class="img_ev3q"></p>
<p>Now let's move on to remote collaboration with your team.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="pull-request">Pull Request<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#pull-request" class="hash-link" aria-label="Direct link to Pull Request" title="Direct link to Pull Request" translate="no">​</a></h2>
<p>A Pull Request (PR) compares your changes with the target branch. GitHub provides a concise PR interface that shows what's been added or removed. You can review your own PR, use Copilot, or have teammates review. They can comment on your PR to suggest improvements or identify issues.</p>
<p><strong>Best practices for creating a Pull Request:</strong></p>
<ul>
<li class=""><strong>Keep PRs Small</strong>: Focus on a single feature or fix. Small PRs are easier to review and merge</li>
<li class=""><strong>Clear Description</strong>: Write a concise summary of what the PR does, why it's needed, and any relevant context</li>
<li class=""><strong>Reference Issues</strong>: Link related issues or tickets (e.g., Closes #123)</li>
<li class=""><strong>Self-Review</strong>: Check your code for errors, style, and unnecessary changes before submitting</li>
<li class=""><strong>Add Tests</strong>: Include or update tests to cover your changes</li>
<li class=""><strong>Follow Conventions</strong>: Stick to your team's coding and commit message guidelines</li>
</ul>
<p>To create a PR, select the "Pull requests" tab, click "New pull request", then select your current branch and target branch. We'll continue with our current branch:</p>
<p><img decoding="async" loading="lazy" alt="new_pr" src="https://riverxdata.github.io/river-docs/assets/images/new_pr-7e37441ae6dc22a405f3ca4a33b8c345.png" width="1364" height="643" class="img_ev3q"></p>
<p>The PR is now created:</p>
<p><img decoding="async" loading="lazy" alt="created_pr" src="https://riverxdata.github.io/river-docs/assets/images/created_pr-28d0bdc552e44ddfd3e63057c0524b53.png" width="1364" height="823" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="review">Review<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#review" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review" translate="no">​</a></h2>
<p><strong>Best practices for reviewing a Pull Request:</strong></p>
<ul>
<li class=""><strong>Understand the Context</strong>: Read the PR description and related issues</li>
<li class=""><strong>Check for Clarity</strong>: Ensure code is readable, well-structured, and commented where necessary</li>
<li class=""><strong>Test Locally</strong>: Run the code if possible to verify it works as intended</li>
<li class=""><strong>Suggest Improvements</strong>: Be constructive and specific in your feedback</li>
<li class=""><strong>Check for Side Effects</strong>: Make sure changes don't break existing functionality</li>
<li class=""><strong>Be Respectful</strong>: Keep feedback positive and focused on the code, not the person</li>
</ul>
<p>Click on "File changes" to start your review. You can comment on specific lines of changed files. In the end, comment on whether changes should be modified or merged. Here I'm the PR creator, so GitHub disables self-approval. In best practice, another person should review your work. <code>LGTM</code> (Looks Good To Me) indicates approval and allows merging your changes into the target branch.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">Request PR review from teammates</li>
<li class="">PR must be approved before merging</li>
</ul></div></div>
<p><img decoding="async" loading="lazy" alt="review" src="https://riverxdata.github.io/river-docs/assets/images/review-28ddf50fe6daebb3b518033e9cc302e1.png" width="2559" height="823" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="merge">Merge<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#merge" class="hash-link" aria-label="Direct link to Merge" title="Direct link to Merge" translate="no">​</a></h2>
<p>Although your PR is ready to merge without approval in this example, you should configure branch protection rules in your repository settings:
<a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/configuring-pull-request-merges" target="_blank" rel="noopener noreferrer" class="">https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/configuring-pull-request-merges</a></p>
<p>When merging a pull request on GitHub, you can choose from several strategies. Each has advantages depending on your workflow:</p>
<table><thead><tr><th>Strategy</th><th>Description</th><th>Use Case</th></tr></thead><tbody><tr><td><strong>Merge Commit</strong></td><td>Combines all commits from the feature branch into the target branch, preserving full history.</td><td>Default; keeps detailed commit history.</td></tr><tr><td><strong>Squash and Merge</strong></td><td>Combines all changes from the feature branch into a single commit on the target branch.</td><td>Clean, concise history for small features.</td></tr><tr><td><strong>Rebase and Merge</strong></td><td>Reapplies your branch's commits on top of the target branch, creating a linear history.</td><td>Linear history, avoids merge commits.</td></tr></tbody></table>
<p><img decoding="async" loading="lazy" alt="merge" src="https://riverxdata.github.io/river-docs/assets/images/merge-53fc5e6914e0a508107da8e8ea6006b6.png" width="1411" height="1225" class="img_ev3q"></p>
<p>When working with a large team, using a merge commit directly integrates your branch into the target branch. This works well if the target branch hasn't changed significantly since you started. For example, if you branched off <code>main</code> when it only had <code>feature A</code> and <code>feature B</code>, and you're adding <code>feature C</code>, merging is straightforward.</p>
<p>However, if other team members have merged new features (e.g., <code>feature C1</code>) into <code>main</code> that modify the same files you're working on, you may encounter conflicts. In such cases, it's best to use rebase to update your branch with the latest changes from the target branch before merging. If your branch contains many small, incremental commits, consider using squash and merge to combine them into a single, clean commit for a tidier history.</p>
<p><img decoding="async" loading="lazy" alt="merge_type" src="https://riverxdata.github.io/river-docs/assets/images/merge-types-3da71d48920fdcbff6af463eb0c8221b.png" width="1607" height="1560" class="img_ev3q"></p>
<p>Now the main branch shows the update from your PR:</p>
<p><img decoding="async" loading="lazy" alt="updated_main" src="https://riverxdata.github.io/river-docs/assets/images/merged_to_main-3d73172135c260d72cee0f707b9a4bb1.png" width="1411" height="766" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="rebase">Rebase<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#rebase" class="hash-link" aria-label="Direct link to Rebase" title="Direct link to Rebase" translate="no">​</a></h2>
<p>When working in a team, the <code>main</code> branch (or your target branch) may receive updates from other contributors while you're developing your feature branch. To keep your branch up-to-date and avoid conflicts later, regularly update your branch with the latest changes from <code>main</code>. This is where <code>rebase</code> is useful.</p>
<p><strong>Use case:</strong>
Suppose you started working on a feature branch (<code>feature/testing-rebase</code>) based on an older version of <code>main</code>. Meanwhile, new commits have been added to <code>main</code> by others. Rebasing allows you to "replay" your changes on top of the latest <code>main</code>, resulting in a linear and clean history.</p>
<p><strong>How to update your feature branch after <code>main</code> is updated:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Make sure you're on your feature branch</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout feature/testing-rebase</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Fetch the latest changes from the remote repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> fetch origin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Rebase your branch onto the updated main branch</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> rebase origin/main</span><br></span></code></pre></div></div>
<p>During the rebase, if there are conflicts, Git will pause and let you resolve them. After fixing conflicts, continue the rebase:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">resolved-files</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> rebase </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--continue</span><br></span></code></pre></div></div>
<p>If you want to abort the rebase at any point:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> rebase </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--abort</span><br></span></code></pre></div></div>
<p><strong>Why use rebase?</strong></p>
<ul>
<li class="">Keeps your branch history clean and linear</li>
<li class="">Makes it easier to review and merge changes</li>
<li class="">Reduces the chance of complex merge conflicts later</li>
</ul>
<p><strong>Tip:</strong>
After rebasing and before pushing, you may need to force-push your branch since the commit history has changed:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> push --force-with-lease</span><br></span></code></pre></div></div>
<p>Use force-push with care, especially on shared branches.</p>
<p><img decoding="async" loading="lazy" alt="rebase" src="https://riverxdata.github.io/river-docs/assets/images/rebase_on_local-fc01fd9233ff9afeadf0ac790c86629e.png" width="1411" height="260" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="new-branch-again">New branch again<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#new-branch-again" class="hash-link" aria-label="Direct link to New branch again" title="Direct link to New branch again" translate="no">​</a></h2>
<p>Now you can sync with your team, next step is creating the new branch again to have more updates (features, fix bug, documentation, testing, etc)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># check out on base branch where feature is updated</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout main</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># pull to update, add rebase for better organization on commits</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> pull </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rebase</span><span class="token plain"> origin main</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># create new branch</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> switch </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> feature/add-cicd-setup</span><br></span></code></pre></div></div>
<p><em>This concludes Part 1 of the RiverXData series on version control in bioinformatics. Stay tuned for Part 2!</em></p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="git" term="git"/>
        <category label="version-control" term="version-control"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="reproducibility" term="reproducibility"/>
        <category label="pipelines" term="pipelines"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building a Slurm HPC Cluster (Part 3) - Administration and Best Practices]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3</id>
        <link href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3"/>
        <updated>2026-01-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In Part 1 and Part 2, we built a complete Slurm HPC cluster from a single node to a production-ready multi-node system. Now let's learn how to manage, maintain, and secure it effectively.]]></summary>
        <content type="html"><![CDATA[<p>In <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1">Part 1</a> and <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2">Part 2</a>, we built a complete Slurm HPC cluster from a single node to a production-ready multi-node system. Now let's learn how to manage, maintain, and secure it effectively.</p>
<p>This final post covers daily administration tasks, troubleshooting, security hardening, and integration with data processing frameworks.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="series-overview">Series Overview<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#series-overview" class="hash-link" aria-label="Direct link to Series Overview" title="Direct link to Series Overview" translate="no">​</a></h2>
<ul>
<li class=""><strong><a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1">Part 1</a></strong>: Introduction, Architecture, and Single Node Setup</li>
<li class=""><strong><a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2">Part 2</a></strong>: Scaling to Production with Ansible</li>
<li class=""><strong>Part 3 (This Post)</strong>: Administration and Best Practices</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="administration-overview">Administration Overview<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#administration-overview" class="hash-link" aria-label="Direct link to Administration Overview" title="Direct link to Administration Overview" translate="no">​</a></h2>
<p>Managing a Slurm cluster involves several key areas:</p>
<ul>
<li class=""><strong>Cluster Management</strong>: Build, maintain, and update the cluster via Ansible</li>
<li class=""><strong>User Management</strong>: Synchronize users across nodes with proper permissions</li>
<li class=""><strong>Login Security</strong>: Implement SSH hardening with 2FA or key pairs</li>
<li class=""><strong>Resource Management</strong>: Enforce limits and fair-share policies</li>
<li class=""><strong>Monitoring</strong>: Track performance and resource utilization</li>
<li class=""><strong>Troubleshooting</strong>: Diagnose and resolve issues</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="user-and-resource-management">User and Resource Management<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#user-and-resource-management" class="hash-link" aria-label="Direct link to User and Resource Management" title="Direct link to User and Resource Management" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="adding-users-and-groups">Adding Users and Groups<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#adding-users-and-groups" class="hash-link" aria-label="Direct link to Adding Users and Groups" title="Direct link to Adding Users and Groups" translate="no">​</a></h3>
<p>Slurm uses accounts (groups) to organize users and apply resource policies:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add a new account/group</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> account research_team </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Description</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Research Team"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add a user to an account</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> user john </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">account</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">research_team</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add user with multiple accounts</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> user alice </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">account</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">research_team,dev_team </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">DefaultAccount</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">research_team</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View accounts</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr show account</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View users</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr show user</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="setting-resource-limits">Setting Resource Limits<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#setting-resource-limits" class="hash-link" aria-label="Direct link to Setting Resource Limits" title="Direct link to Setting Resource Limits" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="account-level-limits">Account-Level Limits<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#account-level-limits" class="hash-link" aria-label="Direct link to Account-Level Limits" title="Direct link to Account-Level Limits" translate="no">​</a></h4>
<p>Control resources for entire groups:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit CPU minutes (prevents monopolizing cluster)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">GrpCPUMins</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">100000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit memory (in MB)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">GrpMem</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">500000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit concurrent jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">GrpJobs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit concurrent running jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">GrpJobsRun</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit number of nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">GrpNodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="user-level-limits">User-Level Limits<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#user-level-limits" class="hash-link" aria-label="Direct link to User-Level Limits" title="Direct link to User-Level Limits" translate="no">​</a></h4>
<p>Control individual user behavior:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit jobs in queue</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify user john </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxJobs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit running jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify user john </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxJobsRun</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit wall time (in minutes)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify user john </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxWall</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1440</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 24 hours</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit CPUs per job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify user john </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxCPUs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View user limits</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr show user john withassoc </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">format</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">user,account,maxjobs,maxsubmit,maxwall</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="quality-of-service-qos">Quality of Service (QoS)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#quality-of-service-qos" class="hash-link" aria-label="Direct link to Quality of Service (QoS)" title="Direct link to Quality of Service (QoS)" translate="no">​</a></h3>
<p>QoS allows you to create service tiers with different priorities:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create QoS levels</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> qos normal </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> qos high </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">500</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxWall</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">-00:00:00 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxJobs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> qos low </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Assign QoS to account</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">qos</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">normal,high</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Users can specify QoS when submitting</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sbatch </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--qos</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">high job_script.sh</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fair-share-scheduling">Fair-Share Scheduling<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#fair-share-scheduling" class="hash-link" aria-label="Direct link to Fair-Share Scheduling" title="Direct link to Fair-Share Scheduling" translate="no">​</a></h3>
<p>Ensure equitable resource distribution:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Set fair-share values (higher = more priority)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">fairshare</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account dev_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">fairshare</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View fair-share tree</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sshare </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View detailed fair-share info</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sshare </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-A</span><span class="token plain"> research_team </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--all</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="node-management">Node Management<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#node-management" class="hash-link" aria-label="Direct link to Node Management" title="Direct link to Node Management" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="checking-node-status">Checking Node Status<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#checking-node-status" class="hash-link" aria-label="Direct link to Checking Node Status" title="Direct link to Checking Node Status" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># View all nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Detailed node information</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-Nel</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Show node states</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-N</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%N %T %C %m %e %f"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View specific node details</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol show </span><span class="token function" style="color:hsl(221, 87%, 60%)">node</span><span class="token plain"> worker-01</span><br></span></code></pre></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Job sinfo" src="https://riverxdata.github.io/river-docs/assets/images/job_sinfo-36f054ef9651148a5f22d7075a11829c.png" width="1310" height="351" class="img_ev3q"></p></figure>
<p>Node states you'll encounter:</p>
<ul>
<li class=""><strong>IDLE</strong>: Available for jobs</li>
<li class=""><strong>ALLOCATED</strong>: Running jobs</li>
<li class=""><strong>MIXED</strong>: Partially allocated</li>
<li class=""><strong>DRAIN</strong>: Won't accept new jobs (draining)</li>
<li class=""><strong>DRAINED</strong>: Fully drained</li>
<li class=""><strong>DOWN</strong>: Not responding</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="node-maintenance">Node Maintenance<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#node-maintenance" class="hash-link" aria-label="Direct link to Node Maintenance" title="Direct link to Node Maintenance" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="draining-a-node">Draining a Node<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#draining-a-node" class="hash-link" aria-label="Direct link to Draining a Node" title="Direct link to Draining a Node" translate="no">​</a></h4>
<p>When you need to perform maintenance:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Drain node (won't accept new jobs, allows running jobs to finish)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NodeName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-01 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">drain </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Reason</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Hardware upgrade"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Force drain (terminate running jobs)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NodeName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-01 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">drain </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Reason</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Emergency maintenance"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check drain reason</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-R</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="resuming-a-node">Resuming a Node<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#resuming-a-node" class="hash-link" aria-label="Direct link to Resuming a Node" title="Direct link to Resuming a Node" translate="no">​</a></h4>
<p>After maintenance:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Resume node</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NodeName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-01 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">resume</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify it's back</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> worker-01</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="forcing-node-down">Forcing Node Down<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#forcing-node-down" class="hash-link" aria-label="Direct link to Forcing Node Down" title="Direct link to Forcing Node Down" translate="no">​</a></h4>
<p>If a node is misbehaving:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Mark node as down</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NodeName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-01 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">down </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Reason</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Hardware failure"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># When fixed, resume</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NodeName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-01 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">resume</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="adding-new-compute-nodes">Adding New Compute Nodes<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#adding-new-compute-nodes" class="hash-link" aria-label="Direct link to Adding New Compute Nodes" title="Direct link to Adding New Compute Nodes" translate="no">​</a></h3>
<ol>
<li class="">Update Ansible inventory (<code>inventories/hosts</code>):</li>
</ol>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token section section-name selector" style="color:hsl(119, 34%, 47%)">slurm_worker</span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">worker-01 ansible_host</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">192.168.58.11</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">worker-02 ansible_host</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">192.168.58.12</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">worker-03 ansible_host</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">192.168.58.13  # NEW</span><br></span></code></pre></div></div>
<ol start="2">
<li class="">Run Ansible playbook:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-playbook </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts river_cluster.yml </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--limit</span><span class="token plain"> worker-03</span><br></span></code></pre></div></div>
<ol start="3">
<li class="">
<p>Update <code>slurm.conf</code> on controller and all nodes (Ansible handles this)</p>
</li>
<li class="">
<p>Restart slurmctld:</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl restart slurmctld</span><br></span></code></pre></div></div>
<ol start="5">
<li class="">Verify the new node:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol show </span><span class="token function" style="color:hsl(221, 87%, 60%)">node</span><span class="token plain"> worker-03</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="monitoring-and-troubleshooting">Monitoring and Troubleshooting<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#monitoring-and-troubleshooting" class="hash-link" aria-label="Direct link to Monitoring and Troubleshooting" title="Direct link to Monitoring and Troubleshooting" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="checking-slurm-logs">Checking Slurm Logs<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#checking-slurm-logs" class="hash-link" aria-label="Direct link to Checking Slurm Logs" title="Direct link to Checking Slurm Logs" translate="no">​</a></h3>
<p>Logs are essential for diagnosing issues:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Controller logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> /var/log/slurm/slurmctld.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Worker node logs (on compute nodes)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> /var/log/slurm/slurmd.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Database logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> /var/log/slurm/slurmdbd.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Filter for errors</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"error"</span><span class="token plain"> /var/log/slurm/*.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Filter for specific node</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"worker-01"</span><span class="token plain"> /var/log/slurm/slurmctld.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Last 100 lines with context</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-100</span><span class="token plain"> /var/log/slurm/slurmctld.log</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-issues-and-solutions">Common Issues and Solutions<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#common-issues-and-solutions" class="hash-link" aria-label="Direct link to Common Issues and Solutions" title="Direct link to Common Issues and Solutions" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="issue-node-shows-as-down">Issue: Node Shows as DOWN<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#issue-node-shows-as-down" class="hash-link" aria-label="Direct link to Issue: Node Shows as DOWN" title="Direct link to Issue: Node Shows as DOWN" translate="no">​</a></h4>
<p><strong>Diagnosis:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># OUTPUT: worker-01    down   ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol show </span><span class="token function" style="color:hsl(221, 87%, 60%)">node</span><span class="token plain"> worker-01</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check "Reason" field</span><br></span></code></pre></div></div>
<p><strong>Solutions:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Check if slurmd is running</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> worker-01 </span><span class="token string" style="color:hsl(119, 34%, 47%)">"sudo systemctl status slurmd"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Restart slurmd</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> worker-01 </span><span class="token string" style="color:hsl(119, 34%, 47%)">"sudo systemctl restart slurmd"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Check network connectivity</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ping</span><span class="token plain"> worker-01</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Check logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> worker-01 </span><span class="token string" style="color:hsl(119, 34%, 47%)">"sudo tail -50 /var/log/slurm/slurmd.log"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 5. Resume the node</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NodeName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-01 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">resume</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="issue-jobs-stuck-in-pending">Issue: Jobs Stuck in Pending<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#issue-jobs-stuck-in-pending" class="hash-link" aria-label="Direct link to Issue: Jobs Stuck in Pending" title="Direct link to Issue: Jobs Stuck in Pending" translate="no">​</a></h4>
<p><strong>Diagnosis:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">squeue</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># See jobs in PD (pending) state</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check why job is pending</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">squeue </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--start</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-j</span><span class="token plain"> JOB_ID</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View detailed job info</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol show job JOB_ID</span><br></span></code></pre></div></div>
<p><strong>Common reasons:</strong></p>
<ul>
<li class=""><code>Resources</code>: Not enough resources available</li>
<li class=""><code>Priority</code>: Lower priority than other jobs</li>
<li class=""><code>Dependency</code>: Waiting for another job to complete</li>
<li class=""><code>QOSMaxJobsPerUser</code>: User has too many jobs running</li>
</ul>
<p><strong>Solutions:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Check available resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%P %a %l %D %N %C"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. View job requirements</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol show job JOB_ID </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-E</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Partition|NumNodes|MinMemory"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Cancel job if needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scancel JOB_ID</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Modify pending job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">JobId</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">JOB_ID </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NumNodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="issue-jobs-failing-immediately">Issue: Jobs Failing Immediately<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#issue-jobs-failing-immediately" class="hash-link" aria-label="Direct link to Issue: Jobs Failing Immediately" title="Direct link to Issue: Jobs Failing Immediately" translate="no">​</a></h4>
<p><strong>Diagnosis:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check job status</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacct </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-j</span><span class="token plain"> JOB_ID</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View job output files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> slurm-JOB_ID.out</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> slurm-JOB_ID.err</span><br></span></code></pre></div></div>
<p><strong>Common causes:</strong></p>
<ul>
<li class="">Script errors (check shebang line)</li>
<li class="">Missing executables</li>
<li class="">Resource limits exceeded</li>
<li class="">Permission issues</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="issue-accounting-database-not-working">Issue: Accounting Database Not Working<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#issue-accounting-database-not-working" class="hash-link" aria-label="Direct link to Issue: Accounting Database Not Working" title="Direct link to Issue: Accounting Database Not Working" translate="no">​</a></h4>
<p><strong>Diagnosis:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check slurmdbd status</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl status slurmdbd</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Test database connection</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> slurm </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> slurm_acct_db </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"SHOW TABLES;"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check slurmdbd logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-50</span><span class="token plain"> /var/log/slurm/slurmdbd.log</span><br></span></code></pre></div></div>
<p><strong>Solutions:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Restart slurmdbd</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl restart slurmdbd</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Verify database credentials in slurmdbd.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> /etc/slurm-llnl/slurmdbd.conf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Check database permissions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"SHOW GRANTS FOR 'slurm'@'localhost';"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Restart slurmctld to reconnect</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl restart slurmctld</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="system-logs-with-rsyslog">System Logs with rsyslog<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#system-logs-with-rsyslog" class="hash-link" aria-label="Direct link to System Logs with rsyslog" title="Direct link to System Logs with rsyslog" translate="no">​</a></h3>
<p>Our Ansible setup configures centralized logging:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># On controller (rsyslog server)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> /var/log/syslog</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Filter by hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"worker-01"</span><span class="token plain"> /var/log/syslog</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Filter by service</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"slurmd"</span><span class="token plain"> /var/log/syslog</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check authentication logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> /var/log/auth.log</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="security-best-practices">Security Best Practices<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#security-best-practices" class="hash-link" aria-label="Direct link to Security Best Practices" title="Direct link to Security Best Practices" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ssh-hardening">SSH Hardening<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#ssh-hardening" class="hash-link" aria-label="Direct link to SSH Hardening" title="Direct link to SSH Hardening" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Secure your login nodes! HPC clusters are attractive targets for attackers.</p></div></div>
<p>For detailed SSH security setup, see our <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/administration/ssh-remote-server">SSH Remote Server documentation</a>.</p>
<p>Key recommendations:</p>
<ol>
<li class=""><strong>Disable Password Authentication</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># /etc/ssh/sshd_config</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">PasswordAuthentication no</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">PubkeyAuthentication </span><span class="token function" style="color:hsl(221, 87%, 60%)">yes</span><br></span></code></pre></div></div>
<ol start="2">
<li class="">
<p><strong>Implement 2FA</strong> with Google Authenticator or similar</p>
</li>
<li class="">
<p><strong>Use SSH Key Pairs</strong>:</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Generate key on your machine</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ssh-keygen </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><span class="token plain"> ed25519 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"your_email@example.com"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Copy to cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ssh-copy-id user@controller-node</span><br></span></code></pre></div></div>
<ol start="4">
<li class=""><strong>Limit SSH Access</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># /etc/ssh/sshd_config</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">AllowUsers alice bob charlie</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">AllowGroups cluster_users</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or deny specific users</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">DenyUsers baduser</span><br></span></code></pre></div></div>
<ol start="5">
<li class=""><strong>Change Default Port</strong> (security through obscurity):</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># /etc/ssh/sshd_config</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Port </span><span class="token number" style="color:hsl(35, 99%, 36%)">2222</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="munge-authentication">Munge Authentication<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#munge-authentication" class="hash-link" aria-label="Direct link to Munge Authentication" title="Direct link to Munge Authentication" translate="no">​</a></h3>
<p>Munge provides authentication between Slurm components:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify munge is running</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl status munge</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Test munge</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">munge </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> unmunge</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Generate new key (do this on controller, then distribute)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> /usr/sbin/create-munge-key</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Copy key to all nodes (Ansible does this automatically)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">scp</span><span class="token plain"> /etc/munge/munge.key worker-01:/etc/munge/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Restart munge on all nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl restart munge</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>Critical</strong>: The munge key must be identical on all nodes and have proper permissions (0400, owned by munge<!-- -->:munge<!-- -->).</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="docker-security">Docker Security<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#docker-security" class="hash-link" aria-label="Direct link to Docker Security" title="Direct link to Docker Security" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p><strong>Critical Security Issue</strong>: Users in the <code>docker</code> group can gain root privileges!</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># DON'T DO THIS (unless they're admins)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">usermod</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-aG</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> regular_user</span><br></span></code></pre></div></div><p>Why? Because they can run:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /:/hostfs </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--privileged</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> ubuntu </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Now they have root access to the host filesystem!</span><br></span></code></pre></div></div></div></div>
<p><strong>Solutions</strong>:</p>
<ol>
<li class=""><strong>Use Docker Rootless Mode</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install rootless docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-fsSL</span><span class="token plain"> https://get.docker.com/rootless </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sh</span><br></span></code></pre></div></div>
<ol start="2">
<li class=""><strong>Use Apptainer/Singularity</strong> (designed for HPC):</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install Apptainer</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> apptainer</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run containers without root</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer run docker://ubuntu:latest</span><br></span></code></pre></div></div>
<ol start="3">
<li class=""><strong>Restrict Docker Group</strong>: Only add administrators to docker group</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="firewall-configuration">Firewall Configuration<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#firewall-configuration" class="hash-link" aria-label="Direct link to Firewall Configuration" title="Direct link to Firewall Configuration" translate="no">​</a></h3>
<p>Restrict access to Slurm ports:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Allow Slurm ports only from cluster network</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> ufw allow from </span><span class="token number" style="color:hsl(35, 99%, 36%)">192.168</span><span class="token plain">.58.0/24 to any port </span><span class="token number" style="color:hsl(35, 99%, 36%)">6817</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># slurmctld</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> ufw allow from </span><span class="token number" style="color:hsl(35, 99%, 36%)">192.168</span><span class="token plain">.58.0/24 to any port </span><span class="token number" style="color:hsl(35, 99%, 36%)">6818</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># slurmd</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> ufw allow from </span><span class="token number" style="color:hsl(35, 99%, 36%)">192.168</span><span class="token plain">.58.0/24 to any port </span><span class="token number" style="color:hsl(35, 99%, 36%)">6819</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># slurmdbd</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Allow SSH from anywhere</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> ufw allow </span><span class="token number" style="color:hsl(35, 99%, 36%)">22</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Enable firewall</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> ufw </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">enable</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="shared-storage-best-practices">Shared Storage Best Practices<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#shared-storage-best-practices" class="hash-link" aria-label="Direct link to Shared Storage Best Practices" title="Direct link to Shared Storage Best Practices" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="nfs-performance-tuning">NFS Performance Tuning<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#nfs-performance-tuning" class="hash-link" aria-label="Direct link to NFS Performance Tuning" title="Direct link to NFS Performance Tuning" translate="no">​</a></h3>
<p>Optimize NFS for your workload:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># /etc/fstab on compute nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">controller-01:/home /home nfs4 rw,soft,rsize</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">262144</span><span class="token plain">,wsize</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">262144</span><span class="token plain">,timeo</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">14</span><span class="token plain">,intr </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><br></span></code></pre></div></div>
<p>Parameters explained:</p>
<ul>
<li class=""><code>soft</code>: Timeout after retry (vs <code>hard</code> which waits forever)</li>
<li class=""><code>rsize/wsize</code>: Read/write buffer size (larger = better performance)</li>
<li class=""><code>timeo</code>: Timeout value</li>
<li class=""><code>intr</code>: Allow interrupts</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="storage-layout">Storage Layout<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#storage-layout" class="hash-link" aria-label="Direct link to Storage Layout" title="Direct link to Storage Layout" translate="no">​</a></h3>
<p>Recommended directory structure:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/home/          # User home directories (SSD/NVMe)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ├─ alice/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ├─ bob/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  └─ charlie/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/mnt/data/      # Large datasets (HDD or object storage)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ├─ shared/    # Common datasets</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ├─ projects/  # Project-specific data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  └─ scratch/   # Temporary data (auto-cleanup)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/opt/           # Shared software/modules</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ├─ anaconda/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ├─ modules/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  └─ apps/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="quotas">Quotas<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#quotas" class="hash-link" aria-label="Direct link to Quotas" title="Direct link to Quotas" translate="no">​</a></h3>
<p>Prevent users from filling up shared storage:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Set user quotas</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> setquota </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> alice 50G 60G </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> /home</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> setquota </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> alice 500G 550G </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> /mnt/data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check quotas</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">quota</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> alice</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View all quotas</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> repquota </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="integration-with-data-processing-frameworks">Integration with Data Processing Frameworks<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#integration-with-data-processing-frameworks" class="hash-link" aria-label="Direct link to Integration with Data Processing Frameworks" title="Direct link to Integration with Data Processing Frameworks" translate="no">​</a></h2>
<p>One of Slurm's greatest strengths is integration with modern computing frameworks:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="apache-spark">Apache Spark<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#apache-spark" class="hash-link" aria-label="Direct link to Apache Spark" title="Direct link to Apache Spark" translate="no">​</a></h3>
<p>Submit Spark jobs to Slurm:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=spark-job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --nodes=4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks-per-node=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=8</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --mem=32G</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Load Spark module</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load spark/3.5.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run Spark application</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">spark-submit </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--master</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">yarn</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  --num-executors </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  --executor-cores </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  --executor-memory 28G </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  my_spark_app.py</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ray-distributed-ml">Ray (Distributed ML)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#ray-distributed-ml" class="hash-link" aria-label="Direct link to Ray (Distributed ML)" title="Direct link to Ray (Distributed ML)" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=ray-job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --nodes=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks-per-node=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=16</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --gpus-per-node=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Start Ray cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ray start </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--head</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--port</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">6379</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--ntasks</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> ray start </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--address</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$HEAD_NODE</span><span class="token plain">:6379</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run Ray application</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">python ray_train.py</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="dask">Dask<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#dask" class="hash-link" aria-label="Direct link to Dask" title="Direct link to Dask" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> dask_jobqueue </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> SLURMCluster</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> dask</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">distributed </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> Client</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">cluster </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> SLURMCluster</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cores</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"16GB"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    processes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    walltime</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"02:00:00"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    queue</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"compute"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">cluster</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">scale</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">jobs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Request 10 jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">client </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Client</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">cluster</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Your Dask code here</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="nextflow-bioinformatics">Nextflow (Bioinformatics)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#nextflow-bioinformatics" class="hash-link" aria-label="Direct link to Nextflow (Bioinformatics)" title="Direct link to Nextflow (Bioinformatics)" translate="no">​</a></h3>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)">// nextflow.config</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    executor </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'slurm'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    queue </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'compute'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'8 GB'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    time </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'2h'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>Run with:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nextflow run nf-core/rnaseq </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> slurm</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="maintenance-tasks">Maintenance Tasks<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#maintenance-tasks" class="hash-link" aria-label="Direct link to Maintenance Tasks" title="Direct link to Maintenance Tasks" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="regular-updates">Regular Updates<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#regular-updates" class="hash-link" aria-label="Direct link to Regular Updates" title="Direct link to Regular Updates" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Update cluster via Ansible</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-playbook </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts river_cluster.yml </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--tags</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Update specific nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-playbook </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts river_cluster.yml </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--limit</span><span class="token plain"> worker-01,worker-02</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="backup-critical-data">Backup Critical Data<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#backup-critical-data" class="hash-link" aria-label="Direct link to Backup Critical Data" title="Direct link to Backup Critical Data" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Backup Slurm configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> /etc/slurm-llnl/slurm.conf /backup/slurm.conf.</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">date</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> +%Y%m%d</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Backup accounting database</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysqldump </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> slurm </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> slurm_acct_db </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> slurm_acct_backup_</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">date</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> +%Y%m%d</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain">.sql</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Backup user data (use rsync for efficiency)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rsync</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-av</span><span class="token plain"> /home/ /backup/home/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="monitoring-disk-space">Monitoring Disk Space<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#monitoring-disk-space" class="hash-link" aria-label="Direct link to Monitoring Disk Space" title="Direct link to Monitoring Disk Space" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check disk usage on all nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible all </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> shell </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"df -h"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check specific directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible all </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> shell </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"du -sh /var/log/slurm"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Find large files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">find</span><span class="token plain"> /home </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-type</span><span class="token plain"> f </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-size</span><span class="token plain"> +1G </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-exec</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lh</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-optimization-tips">Performance Optimization Tips<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#performance-optimization-tips" class="hash-link" aria-label="Direct link to Performance Optimization Tips" title="Direct link to Performance Optimization Tips" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-tune-scheduler-parameters">1. Tune Scheduler Parameters<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#1-tune-scheduler-parameters" class="hash-link" aria-label="Direct link to 1. Tune Scheduler Parameters" title="Direct link to 1. Tune Scheduler Parameters" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># /etc/slurm-llnl/slurm.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Increase scheduling frequency</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SchedulerTimeSlice</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Prioritize recent submitters less</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PriorityWeightAge</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PriorityWeightFairshare</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Enable backfill scheduling with larger window</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SchedulerType</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">sched/backfill</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">bf_window</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1440</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 24 hours</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-optimize-job-packing">2. Optimize Job Packing<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#2-optimize-job-packing" class="hash-link" aria-label="Direct link to 2. Optimize Job Packing" title="Direct link to 2. Optimize Job Packing" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use CR_CPU for CPU-bound jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SelectType</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">select/cons_tres</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SelectTypeParameters</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">CR_CPU</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or CR_Memory for memory-bound jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SelectTypeParameters</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">CR_Memory</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or CR_Core for mixed workloads</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SelectTypeParameters</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">CR_Core</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-create-multiple-partitions">3. Create Multiple Partitions<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#3-create-multiple-partitions" class="hash-link" aria-label="Direct link to 3. Create Multiple Partitions" title="Direct link to 3. Create Multiple Partitions" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># /etc/slurm-llnl/slurm.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Fast partition for short jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PartitionName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">quick </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">01-02</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Default</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">NO </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxTime</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">01:00:00 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">UP </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Standard partition</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PartitionName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">standard </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">01-04</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Default</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">YES </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxTime</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">-00:00:00 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">UP </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Long partition for extended jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PartitionName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">long </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">03-04</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Default</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">NO </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxTime</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">7</span><span class="token plain">-00:00:00 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">UP </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">25</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># GPU partition</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PartitionName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">gpu </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">gpu-</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">01-02</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Default</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">NO </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxTime</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">-00:00:00 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">UP </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">75</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-enable-job-arrays-for-batch-processing">4. Enable Job Arrays for Batch Processing<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#4-enable-job-arrays-for-batch-processing" class="hash-link" aria-label="Direct link to 4. Enable Job Arrays for Batch Processing" title="Direct link to 4. Enable Job Arrays for Batch Processing" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --array=1-100%10  # 100 tasks, max 10 concurrent</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Process task based on array index</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">python process.py </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--input</span><span class="token plain"> data_</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${SLURM_ARRAY_TASK_ID}</span><span class="token plain">.txt</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="conclusion">Conclusion<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" translate="no">​</a></h2>
<p>Congratulations! You now have the knowledge to build, deploy, and manage a production Slurm HPC cluster. Let's recap the journey:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-1-foundations">Part 1: Foundations<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#part-1-foundations" class="hash-link" aria-label="Direct link to Part 1: Foundations" title="Direct link to Part 1: Foundations" translate="no">​</a></h3>
<ul>
<li class="">Understanding Slurm architecture</li>
<li class="">Single-node setup for learning</li>
<li class="">Critical cgroup configuration</li>
<li class="">Job accounting basics</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-2-production-deployment">Part 2: Production Deployment<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#part-2-production-deployment" class="hash-link" aria-label="Direct link to Part 2: Production Deployment" title="Direct link to Part 2: Production Deployment" translate="no">​</a></h3>
<ul>
<li class="">Ansible automation</li>
<li class="">Multi-node cluster setup</li>
<li class="">Monitoring with Grafana</li>
<li class="">Slack alerting</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-3-administration-this-post">Part 3: Administration (This Post)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#part-3-administration-this-post" class="hash-link" aria-label="Direct link to Part 3: Administration (This Post)" title="Direct link to Part 3: Administration (This Post)" translate="no">​</a></h3>
<ul>
<li class="">User and resource management</li>
<li class="">Node maintenance and troubleshooting</li>
<li class="">Security hardening</li>
<li class="">Performance optimization</li>
<li class="">Framework integration</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h2>
<ol>
<li class=""><strong>Start Simple, Scale Smart</strong>: Master single-node before going multi-node</li>
<li class=""><strong>Automate Everything</strong>: Use Ansible for reproducible deployments</li>
<li class=""><strong>Monitor Proactively</strong>: Set up alerting before problems occur</li>
<li class=""><strong>Security First</strong>: SSH hardening, proper permissions, Docker caution</li>
<li class=""><strong>Regular Maintenance</strong>: Backups, updates, and log monitoring</li>
<li class=""><strong>Documentation</strong>: Document your cluster configuration and procedures</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="whats-next">What's Next?<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#whats-next" class="hash-link" aria-label="Direct link to What's Next?" title="Direct link to What's Next?" translate="no">​</a></h2>
<p>Consider these advanced topics:</p>
<ul>
<li class=""><strong>High Availability</strong>: Redundant controllers with failover</li>
<li class=""><strong>LDAP Integration</strong>: Centralized authentication for large organizations</li>
<li class=""><strong>GPU Scheduling</strong>: Optimize for machine learning workloads</li>
<li class=""><strong>Cloud Bursting</strong>: Expand to cloud resources during peak demand</li>
<li class=""><strong>Custom Plugins</strong>: Extend Slurm with custom scheduling policies</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="resources">Resources<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources" translate="no">​</a></h2>
<ul>
<li class=""><strong>Part 1</strong>: <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1">Single Node Setup</a></li>
<li class=""><strong>Part 2</strong>: <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2">Production Deployment</a></li>
<li class=""><strong>Documentation</strong>: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/how-to-build-slurm-scalable-using-ansible/administration">Administration Guide</a></li>
<li class=""><strong>GitHub</strong>: <a href="https://github.com/riverxdata/river-slurm" target="_blank" rel="noopener noreferrer" class="">RiverXData Slurm Ansible</a></li>
<li class=""><strong>Official Docs</strong>: <a href="https://slurm.schedmd.com/" target="_blank" rel="noopener noreferrer" class="">SchedMD Slurm Documentation</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="contact">Contact<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#contact" class="hash-link" aria-label="Direct link to Contact" title="Direct link to Contact" translate="no">​</a></h2>
<p>Have questions or need help with your cluster? Reach out at: <a href="mailto:nttg8100@gmail.com" target="_blank" rel="noopener noreferrer" class="">nttg8100@gmail.com</a></p>
<hr>
<p><em>This concludes the RiverXData series on building Slurm HPC clusters. Thank you for following along! We hope this guide helps you build and manage effective HPC infrastructure.</em></p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="slurm" term="slurm"/>
        <category label="hpc" term="hpc"/>
        <category label="administration" term="administration"/>
        <category label="security" term="security"/>
        <category label="best-practices" term="best-practices"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building a Slurm HPC Cluster (Part 2) - Scaling to Production with Ansible]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2</id>
        <link href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2"/>
        <updated>2026-01-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In Part 1, we learned the fundamentals by building a single-node Slurm cluster. Now it's time to scale up to a production-ready, multi-node cluster with automated deployment, monitoring, and alerting.]]></summary>
        <content type="html"><![CDATA[<p>In <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1">Part 1</a>, we learned the fundamentals by building a single-node Slurm cluster. Now it's time to scale up to a production-ready, multi-node cluster with automated deployment, monitoring, and alerting.</p>
<p>In this post, we'll use Ansible to automate the entire deployment process, making it reproducible and maintainable.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="series-overview">Series Overview<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#series-overview" class="hash-link" aria-label="Direct link to Series Overview" title="Direct link to Series Overview" translate="no">​</a></h2>
<ul>
<li class=""><strong><a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1">Part 1</a></strong>: Introduction, Architecture, and Single Node Setup</li>
<li class=""><strong>Part 2 (This Post)</strong>: Scaling to Production with Ansible</li>
<li class=""><strong><a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3">Part 3</a></strong>: Administration and Best Practices</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-ansible-for-hpc-clusters">Why Ansible for HPC Clusters?<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#why-ansible-for-hpc-clusters" class="hash-link" aria-label="Direct link to Why Ansible for HPC Clusters?" title="Direct link to Why Ansible for HPC Clusters?" translate="no">​</a></h2>
<p>Moving from a single-node setup to a multi-node production cluster involves:</p>
<ul>
<li class="">Configuring multiple machines identically</li>
<li class="">Managing dependencies and installation order</li>
<li class="">Keeping configurations synchronized</li>
<li class="">Handling user management across nodes</li>
<li class="">Setting up monitoring and logging infrastructure</li>
</ul>
<p>Doing this manually is error-prone and time-consuming. Infrastructure automation tools like Ansible, Puppet, or Terraform solve this problem. We chose <strong>Ansible</strong> because:</p>
<ul>
<li class=""><strong>Agentless</strong>: No software to install on managed nodes</li>
<li class=""><strong>Declarative</strong>: Describe the desired state, not the steps</li>
<li class=""><strong>Idempotent</strong>: Safe to run multiple times</li>
<li class=""><strong>YAML-based</strong>: Easy to read and version control</li>
<li class=""><strong>Large ecosystem</strong>: Many pre-built roles available</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-ansible-quick-primer">What is Ansible? (Quick Primer)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#what-is-ansible-quick-primer" class="hash-link" aria-label="Direct link to What is Ansible? (Quick Primer)" title="Direct link to What is Ansible? (Quick Primer)" translate="no">​</a></h3>
<p>If you're new to Ansible, watch this excellent 100-second introduction:</p>
<div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;background:#000"><iframe src="https://www.youtube.com/embed/xRMPKQweySE" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" style="position:absolute;top:0;left:0;width:100%;height:100%"></iframe></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="production-cluster-architecture">Production Cluster Architecture<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#production-cluster-architecture" class="hash-link" aria-label="Direct link to Production Cluster Architecture" title="Direct link to Production Cluster Architecture" translate="no">​</a></h2>
<p>Our production setup includes these components:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Small HPC Cluster" src="https://riverxdata.github.io/river-docs/assets/images/small_HPC-ee51275c1193ebc8a4abe061b1fafbc6.jpg" width="1386" height="933" class="img_ev3q"></p></figure>
<p>Source: <a href="https://cs.phenikaa-uni.edu.vn/vi/post/gioi-thieu/co-so-vat-chat/he-thong-tinh-toan-hieu-nang-cao-phenikaa-hpc" target="_blank" rel="noopener noreferrer" class="">https://cs.phenikaa-uni.edu.vn/vi/post/gioi-thieu/co-so-vat-chat/he-thong-tinh-toan-hieu-nang-cao-phenikaa-hpc</a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="head-node-controller--login">Head Node (Controller + Login)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#head-node-controller--login" class="hash-link" aria-label="Direct link to Head Node (Controller + Login)" title="Direct link to Head Node (Controller + Login)" translate="no">​</a></h3>
<p>The head node manages the cluster and provides user access:</p>
<ul>
<li class=""><strong>slurmctld</strong>: Job scheduling and resource management</li>
<li class=""><strong>slurmdbd</strong>: Accounting database</li>
<li class=""><strong>NFS Server</strong>: Shares directories to compute nodes</li>
<li class=""><strong>Prometheus</strong>: Metrics collection</li>
<li class=""><strong>Grafana</strong>: Monitoring dashboards</li>
<li class=""><strong>Alertmanager</strong>: Slack notifications</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="compute-nodes">Compute Nodes<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#compute-nodes" class="hash-link" aria-label="Direct link to Compute Nodes" title="Direct link to Compute Nodes" translate="no">​</a></h3>
<p>Worker nodes that execute jobs:</p>
<ul>
<li class=""><strong>slurmd</strong>: Job execution daemon</li>
<li class=""><strong>NFS Client</strong>: Mounts shared storage</li>
<li class=""><strong>Node Exporter</strong>: Exposes system metrics</li>
<li class=""><strong>Slurm Exporter</strong>: Exposes Slurm-specific metrics</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="shared-storage-nfs">Shared Storage (NFS)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#shared-storage-nfs" class="hash-link" aria-label="Direct link to Shared Storage (NFS)" title="Direct link to Shared Storage (NFS)" translate="no">​</a></h3>
<p>NFS provides unified file system access across all nodes:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="NFS Architecture" src="https://riverxdata.github.io/river-docs/assets/images/NFS-41d4079c304dac75689e6ecdc6063d02.png" width="1200" height="675" class="img_ev3q"></p></figure>
<p>Source: <a href="https://thuanbui.me/cai-dat-nfs-server-va-nfs-client-tren-ubuntu-22-04/" target="_blank" rel="noopener noreferrer" class="">https://thuanbui.me/cai-dat-nfs-server-va-nfs-client-tren-ubuntu-22-04/</a></p>
<ul>
<li class=""><code>/home</code>: User home directories (fast SSD/NVMe storage)</li>
<li class=""><code>/mnt/data</code>: Large datasets (high-capacity HDD)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="monitoring-stack">Monitoring Stack<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#monitoring-stack" class="hash-link" aria-label="Direct link to Monitoring Stack" title="Direct link to Monitoring Stack" translate="no">​</a></h3>
<p>Complete observability for your cluster:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Grafana Dashboard" src="https://riverxdata.github.io/river-docs/assets/images/grafana-7dace9efecdbf46b14c5e25c659f17ad.png" width="1168" height="863" class="img_ev3q"></p></figure>
<p>Source: <a href="https://swsmith.cc/posts/grafana-slurm.html" target="_blank" rel="noopener noreferrer" class="">https://swsmith.cc/posts/grafana-slurm.html</a></p>
<ul>
<li class=""><strong>Prometheus</strong>: Time-series metrics database</li>
<li class=""><strong>Grafana</strong>: Beautiful dashboards for visualization</li>
<li class=""><strong>Alertmanager</strong>: Sends alerts to Slack when issues occur</li>
<li class=""><strong>Node Exporter</strong>: System-level metrics (CPU, memory, disk)</li>
<li class=""><strong>Slurm Exporter</strong>: Slurm-specific metrics (jobs, partitions, nodes)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="setting-up-the-riverxdata-slurm-cluster">Setting Up the RiverXData Slurm Cluster<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#setting-up-the-riverxdata-slurm-cluster" class="hash-link" aria-label="Direct link to Setting Up the RiverXData Slurm Cluster" title="Direct link to Setting Up the RiverXData Slurm Cluster" translate="no">​</a></h2>
<p>We've created a comprehensive Ansible playbook that automates everything. Let's get started!</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slurm Deployment Architecture" src="https://riverxdata.github.io/river-docs/assets/images/slurm-e2bd62c31ed705955e53c1a6cbfc917f.svg" class="img_ev3q"></p></figure>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites">Prerequisites<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h3>
<ul>
<li class="">Multiple Ubuntu 20.04 or 24.04 machines (or VMs)</li>
<li class="">SSH access to all nodes</li>
<li class="">Sudo privileges on all nodes</li>
<li class="">A Slack workspace (for alerts)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1-clone-the-repository">Step 1: Clone the Repository<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-1-clone-the-repository" class="hash-link" aria-label="Direct link to Step 1: Clone the Repository" title="Direct link to Step 1: Clone the Repository" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> clone https://github.com/riverxdata/river-slurm.git </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1.0</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> river-slurm</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-2-install-ansible-and-dependencies">Step 2: Install Ansible and Dependencies<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-2-install-ansible-and-dependencies" class="hash-link" aria-label="Direct link to Step 2: Install Ansible and Dependencies" title="Direct link to Step 2: Install Ansible and Dependencies" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Ubuntu 24.04, without Vagrant</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> scripts/setup.sh </span><span class="token number" style="color:hsl(35, 99%, 36%)">24.04</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># For Ubuntu 20.04</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> scripts/setup.sh </span><span class="token number" style="color:hsl(35, 99%, 36%)">20.04</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># For developers: Install with Vagrant support</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> scripts/setup.sh </span><span class="token number" style="color:hsl(35, 99%, 36%)">24.04</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><br></span></code></pre></div></div>
<p>This script installs:</p>
<ul>
<li class="">Ansible and required Python packages</li>
<li class="">Community Ansible collections</li>
<li class="">Galaxy roles (geerlingguy.docker, etc.)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-3-set-up-slack-alerts">Step 3: Set Up Slack Alerts<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-3-set-up-slack-alerts" class="hash-link" aria-label="Direct link to Step 3: Set Up Slack Alerts" title="Direct link to Step 3: Set Up Slack Alerts" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>In production environments, even small teams benefit from proactive monitoring. Slack is perfect for this - you'll get notifications when nodes go down, jobs fail, or resources run low.</p></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="create-a-slack-app">Create a Slack App<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#create-a-slack-app" class="hash-link" aria-label="Direct link to Create a Slack App" title="Direct link to Create a Slack App" translate="no">​</a></h4>
<ol>
<li class="">Go to <a href="https://api.slack.com/apps" target="_blank" rel="noopener noreferrer" class="">Slack API</a> and create a new app</li>
<li class="">Choose "From scratch"</li>
<li class="">Name it (e.g., "Slurm Cluster Monitor")</li>
<li class="">Select your workspace</li>
</ol>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Create Slack App" src="https://riverxdata.github.io/river-docs/assets/images/create_app-5f947edfa49ffbdf36fe676be2c07ec2.png" width="1093" height="731" class="img_ev3q"></p></figure>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="enable-incoming-webhooks">Enable Incoming Webhooks<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#enable-incoming-webhooks" class="hash-link" aria-label="Direct link to Enable Incoming Webhooks" title="Direct link to Enable Incoming Webhooks" translate="no">​</a></h4>
<ol>
<li class="">Navigate to "Incoming Webhooks" in your app settings</li>
<li class="">Activate incoming webhooks</li>
<li class="">Click "Add New Webhook to Workspace"</li>
<li class="">Select the channel for notifications (e.g., <code>#cluster-alerts</code>)</li>
<li class="">Copy the webhook URL</li>
</ol>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slack Config Step 1" src="https://riverxdata.github.io/river-docs/assets/images/config_1-9d474b122b801e342837ef04c9f5830e.png" width="1093" height="1115" class="img_ev3q"></p></figure>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slack Config Step 2" src="https://riverxdata.github.io/river-docs/assets/images/config_2-00d5027252e91dfd879cc3493c03dec6.png" width="1093" height="1115" class="img_ev3q"></p></figure>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slack Config Step 3" src="https://riverxdata.github.io/river-docs/assets/images/config_3-d3746310237e6ce3e41c3e02e9659122.png" width="1093" height="1115" class="img_ev3q"></p></figure>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-your-webhook">Test Your Webhook<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-your-webhook" class="hash-link" aria-label="Direct link to Test Your Webhook" title="Direct link to Test Your Webhook" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-X</span><span class="token plain"> POST </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-H</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'Content-type: application/json'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--data</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'{"text":"Hello from Slurm cluster!"}'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  https://hooks.slack.com/services/YOUR/WEBHOOK/URL</span><br></span></code></pre></div></div>
<p>You should see the message appear in your Slack channel!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-4-configure-your-inventory">Step 4: Configure Your Inventory<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-4-configure-your-inventory" class="hash-link" aria-label="Direct link to Step 4: Configure Your Inventory" title="Direct link to Step 4: Configure Your Inventory" translate="no">​</a></h3>
<p>Create <code>inventories/hosts</code> (or copy from <code>inventories/hosts.example</code>):</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token section section-name selector" style="color:hsl(119, 34%, 47%)">slurm_master</span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">controller-01 ansible_host</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">192.168.58.10</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token section section-name selector" style="color:hsl(119, 34%, 47%)">slurm_worker</span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">worker-01 ansible_host</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">192.168.58.11</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">worker-02 ansible_host</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">192.168.58.12</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token section section-name selector" style="color:hsl(119, 34%, 47%)">slurm:children</span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">slurm_master</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">slurm_worker</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token section section-name selector" style="color:hsl(119, 34%, 47%)">all:vars</span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">ansible_user</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">your_username</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">slurm_password</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">secure_munge_password</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">slurm_account_db_pass</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">secure_db_password</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">slack_api_url</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">https://hooks.slack.com/services/YOUR/WEBHOOK/URL</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">slack_channel</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">#cluster-alerts</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">admin_user</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">admin</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">admin_password</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">secure_grafana_password</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>Security Best Practice</strong>: Use <a href="https://docs.ansible.com/ansible/latest/user_guide/vault.html" target="_blank" rel="noopener noreferrer" class="">Ansible Vault</a> to encrypt sensitive variables like passwords and API keys.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create encrypted vault</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-vault create inventories/vault.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or encrypt existing file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-vault encrypt inventories/hosts</span><br></span></code></pre></div></div></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="optional-parameters">Optional Parameters<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#optional-parameters" class="hash-link" aria-label="Direct link to Optional Parameters" title="Direct link to Optional Parameters" translate="no">​</a></h4>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">default_password</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">temporary_user_password  # Forces change on first login</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">users</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">alice,bob,charlie                   # Comma-separated list</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-5-deploy-the-cluster">Step 5: Deploy the Cluster<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-5-deploy-the-cluster" class="hash-link" aria-label="Direct link to Step 5: Deploy the Cluster" title="Direct link to Step 5: Deploy the Cluster" translate="no">​</a></h3>
<p>Now for the magic moment - deploy your entire cluster with one command!</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># If you have passwordless sudo configured</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-playbook </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts river_cluster.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># If you need to enter sudo password</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-playbook </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts river_cluster.yml --ask-become-pass</span><br></span></code></pre></div></div>
<p>What this playbook does:</p>
<ol>
<li class="">
<p><strong>Prepares all nodes</strong>:</p>
<ul>
<li class="">Updates packages</li>
<li class="">Installs dependencies</li>
<li class="">Configures firewalls</li>
</ul>
</li>
<li class="">
<p><strong>Sets up the controller</strong>:</p>
<ul>
<li class="">Installs slurmctld and slurmdbd</li>
<li class="">Configures MariaDB for accounting</li>
<li class="">Sets up NFS server</li>
<li class="">Installs monitoring stack</li>
</ul>
</li>
<li class="">
<p><strong>Configures compute nodes</strong>:</p>
<ul>
<li class="">Installs slurmd</li>
<li class="">Mounts NFS shares</li>
<li class="">Configures metrics exporters</li>
</ul>
</li>
<li class="">
<p><strong>Deploys monitoring</strong>:</p>
<ul>
<li class="">Prometheus for metrics collection</li>
<li class="">Grafana with pre-configured dashboards</li>
<li class="">Alertmanager with Slack integration</li>
</ul>
</li>
<li class="">
<p><strong>Synchronizes configurations</strong>:</p>
<ul>
<li class="">Copies slurm.conf to all nodes</li>
<li class="">Sets up Munge authentication</li>
<li class="">Configures log aggregation</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-6-add-users">Step 6: Add Users<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-6-add-users" class="hash-link" aria-label="Direct link to Step 6: Add Users" title="Direct link to Step 6: Add Users" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-playbook </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts river_users.yml</span><br></span></code></pre></div></div>
<p>This creates Linux users on all nodes with:</p>
<ul>
<li class="">Synchronized UID/GID across nodes</li>
<li class="">Home directories on shared NFS</li>
<li class="">Slurm accounting associations</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>Note on User Management</strong>: For production, consider integrating with LDAP or Active Directory. However, NIS and LDAP setup can be complex on Ubuntu. Our Ansible approach provides a simpler alternative that works well for small to medium clusters.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-7-verify-the-setup">Step 7: Verify the Setup<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-7-verify-the-setup" class="hash-link" aria-label="Direct link to Step 7: Verify the Setup" title="Direct link to Step 7: Verify the Setup" translate="no">​</a></h3>
<p>SSH into the controller node and run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check cluster status</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Expected output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># PARTITION AVAIL  TIMELIMIT  NODES  STATE NODELIST</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># compute*     up   infinite      2   idle worker-01,worker-02</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View job queue</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">squeue</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Submit a test job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--ntasks</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check accounting</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacct</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View cluster configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol show config </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-20</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-8-access-grafana-dashboards">Step 8: Access Grafana Dashboards<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-8-access-grafana-dashboards" class="hash-link" aria-label="Direct link to Step 8: Access Grafana Dashboards" title="Direct link to Step 8: Access Grafana Dashboards" translate="no">​</a></h3>
<p>Grafana runs on the controller node at port 3000. To access it securely from your local machine:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create SSH tunnel</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-N</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-L</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3001</span><span class="token plain">:localhost:3000 your_user@controller_ip</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Now open in browser: http://localhost:3001</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Login: admin / your_grafana_password</span><br></span></code></pre></div></div>
<p>You'll see pre-configured dashboards showing:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="node-metrics-dashboard">Node Metrics Dashboard<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#node-metrics-dashboard" class="hash-link" aria-label="Direct link to Node Metrics Dashboard" title="Direct link to Node Metrics Dashboard" translate="no">​</a></h4>
<ul>
<li class="">CPU usage per node</li>
<li class="">Memory utilization</li>
<li class="">Disk I/O</li>
<li class="">Network traffic</li>
<li class="">System load</li>
</ul>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Node Grafana Dashboard" src="https://riverxdata.github.io/river-docs/assets/images/node_grafana-1be3b4d9f0352987567947a207197a5a.png" width="2559" height="1293" class="img_ev3q"></p></figure>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="slurm-metrics-dashboard">Slurm Metrics Dashboard<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#slurm-metrics-dashboard" class="hash-link" aria-label="Direct link to Slurm Metrics Dashboard" title="Direct link to Slurm Metrics Dashboard" translate="no">​</a></h4>
<ul>
<li class="">Active jobs</li>
<li class="">Job queue length</li>
<li class="">Node states (idle, allocated, down)</li>
<li class="">CPU allocation</li>
<li class="">Memory usage</li>
<li class="">Job completion rates</li>
</ul>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slurm Grafana Dashboard" src="https://riverxdata.github.io/river-docs/assets/images/slurm_grafana-d38acb72e98a3d7cd3a9fa5fbfcfd88e.png" width="2559" height="1293" class="img_ev3q"></p></figure>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-about-alerts">What About Alerts?<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#what-about-alerts" class="hash-link" aria-label="Direct link to What About Alerts?" title="Direct link to What About Alerts?" translate="no">​</a></h3>
<p>Alertmanager is configured to send Slack notifications for:</p>
<ul>
<li class=""><strong>Node down</strong>: When a compute node becomes unresponsive</li>
<li class=""><strong>Node resumed</strong>: When a node comes back online</li>
<li class=""><strong>High CPU usage</strong>: Sustained high CPU across cluster</li>
<li class=""><strong>High memory usage</strong>: Memory pressure warnings</li>
<li class=""><strong>Disk space low</strong>: Storage running out</li>
</ul>
<p>Example alert in Slack when a node goes down:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Node Resume Alert" src="https://riverxdata.github.io/river-docs/assets/images/resume_node-7e21b97ade95598e247fe80abd75ce91.png" width="1059" height="420" class="img_ev3q"></p></figure>
<p>For detailed information, check the Grafana dashboard:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Grafana Node Down" src="https://riverxdata.github.io/river-docs/assets/images/grafana_down-e246254641a25b9312cfa3800cc99bb1.png" width="2560" height="1283" class="img_ev3q"></p></figure>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-your-cluster">Testing Your Cluster<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#testing-your-cluster" class="hash-link" aria-label="Direct link to Testing Your Cluster" title="Direct link to Testing Your Cluster" translate="no">​</a></h2>
<p>Let's run some tests to ensure everything works:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-1-simple-job">Test 1: Simple Job<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-1-simple-job" class="hash-link" aria-label="Direct link to Test 1: Simple Job" title="Direct link to Test 1: Simple Job" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token function" style="color:hsl(221, 87%, 60%)">hostname</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-2-multi-node-job">Test 2: Multi-node Job<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-2-multi-node-job" class="hash-link" aria-label="Direct link to Test 2: Multi-node Job" title="Direct link to Test 2: Multi-node Job" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--ntasks</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">hostname</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-3-interactive-session">Test 3: Interactive Session<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-3-interactive-session" class="hash-link" aria-label="Direct link to Test 3: Interactive Session" title="Direct link to Test 3: Interactive Session" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> --cpus-per-task</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mem</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">2G </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pty</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Inside the session</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nproc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">free</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-h</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exit</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-4-batch-job">Test 4: Batch Job<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-4-batch-job" class="hash-link" aria-label="Direct link to Test 4: Batch Job" title="Direct link to Test 4: Batch Job" translate="no">​</a></h3>
<p>Create <code>test_job.sh</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --output=test_%j.out</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --error=test_%j.err</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --nodes=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --mem=1G</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --time=00:05:00</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Job started at </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">date</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Running on node: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">hostname</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"CPUs allocated: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$SLURM_CPUS_PER_TASK</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Memory allocated: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$SLURM_MEM_PER_NODE</span><span class="token string" style="color:hsl(119, 34%, 47%)"> MB"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Do some work</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sleep</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Job finished at </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">date</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span></code></pre></div></div>
<p>Submit it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sbatch test_job.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check status</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">squeue</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># When done, view output</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> test_*.out</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-5-resource-limits">Test 5: Resource Limits<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-5-resource-limits" class="hash-link" aria-label="Direct link to Test 5: Resource Limits" title="Direct link to Test 5: Resource Limits" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Submit job requesting more resources than available</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mem</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">999999</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pty</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Should fail with:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># srun: error: Unable to allocate resources: Requested node configuration is not available</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-6-accounting">Test 6: Accounting<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-6-accounting" class="hash-link" aria-label="Direct link to Test 6: Accounting" title="Direct link to Test 6: Accounting" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># View your jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacct</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Detailed accounting info</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacct </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--format</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">JobID,JobName,User,State,Start,End,Elapsed,CPUTime,MaxRSS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Cluster usage summary</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sreport cluster utilization</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="architecture-diagram">Architecture Diagram<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#architecture-diagram" class="hash-link" aria-label="Direct link to Architecture Diagram" title="Direct link to Architecture Diagram" translate="no">​</a></h2>
<p>Here's what you've built:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">┌─────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│           Users SSH to Controller           │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">└─────────────────┬───────────────────────────┘</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                  │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ┌─────────────▼────────────────┐</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │   Controller Node (Head)     │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  ┌────────────────────────┐  │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  │ slurmctld              │  │  Job Scheduling</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  │ slurmdbd + MariaDB     │  │  Accounting</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  │ NFS Server             │  │  Shared Storage</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  │ Prometheus + Grafana   │  │  Monitoring</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  │ Alertmanager           │  │  Alerts</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  └────────────────────────┘  │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    └────┬──────────────────┬──────┘</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">         │                  │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ┌────▼─────┐       ┌───▼──────┐</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │ worker-01│       │ worker-02│</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │ ┌──────┐ │       │ ┌──────┐ │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │ │slurmd│ │       │ │slurmd│ │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │ │NFS ↑ │ │       │ │NFS ↑ │ │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │ └──────┘ │       │ └──────┘ │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    └──────────┘       └──────────┘</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="for-developers-local-testing-with-vagrant">For Developers: Local Testing with Vagrant<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#for-developers-local-testing-with-vagrant" class="hash-link" aria-label="Direct link to For Developers: Local Testing with Vagrant" title="Direct link to For Developers: Local Testing with Vagrant" translate="no">​</a></h2>
<p>If you want to test the deployment locally using VMs:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install Vagrant with libvirt provider</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> scripts/setup.sh </span><span class="token number" style="color:hsl(35, 99%, 36%)">24.04</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create local VMs and deploy cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">vagrant up</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># SSH to controller</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">vagrant </span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> controller-01</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Destroy VMs when done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">vagrant destroy </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h2>
<p>In this post, we've covered:</p>
<ol>
<li class=""><strong>Why Automation</strong>: The benefits of using Ansible for cluster management</li>
<li class=""><strong>Production Architecture</strong>: Multi-node setup with monitoring and alerting</li>
<li class=""><strong>Slack Integration</strong>: Proactive monitoring with notifications</li>
<li class=""><strong>Automated Deployment</strong>: One command to deploy the entire cluster</li>
<li class=""><strong>Verification</strong>: Testing your cluster thoroughly</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>What's Next?</strong></p><p>In <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3">Part 3</a>, we'll cover daily administration tasks, troubleshooting, security best practices, and advanced resource management.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="resources">Resources<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources" translate="no">​</a></h2>
<ul>
<li class=""><strong>GitHub Repository</strong>: <a href="https://github.com/riverxdata/river-slurm" target="_blank" rel="noopener noreferrer" class="">RiverXData Slurm Ansible</a></li>
<li class=""><strong>Deployment Docs</strong>: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/how-to-build-slurm-scalable-using-ansible/deployment">Scalable Slurm Deployment</a></li>
<li class=""><strong>Architecture Overview</strong>: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/how-to-build-slurm-scalable-using-ansible/overview">Slurm Architecture</a></li>
<li class=""><strong>Ansible Documentation</strong>: <a href="https://docs.ansible.com/" target="_blank" rel="noopener noreferrer" class="">docs.ansible.com</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="contact">Contact<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#contact" class="hash-link" aria-label="Direct link to Contact" title="Direct link to Contact" translate="no">​</a></h2>
<p>Questions about the deployment? Reach out at: <a href="mailto:nttg8100@gmail.com" target="_blank" rel="noopener noreferrer" class="">nttg8100@gmail.com</a></p>
<hr>
<p><em>This is Part 2 of the RiverXData series on building Slurm HPC clusters. Continue to <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3">Part 3</a> for administration and best practices.</em></p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="slurm" term="slurm"/>
        <category label="hpc" term="hpc"/>
        <category label="ansible" term="ansible"/>
        <category label="automation" term="automation"/>
        <category label="devops" term="devops"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building a Slurm HPC Cluster (Part 1) - Single Node Setup and Fundamentals]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1</id>
        <link href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1"/>
        <updated>2026-01-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Building a High-Performance Computing (HPC) cluster can seem daunting, but with the right approach, you can create a robust system for managing computational workloads. This is Part 1 of a 3-part series where we'll build a complete Slurm cluster from scratch.]]></summary>
        <content type="html"><![CDATA[<p>Building a High-Performance Computing (HPC) cluster can seem daunting, but with the right approach, you can create a robust system for managing computational workloads. This is <strong>Part 1</strong> of a 3-part series where we'll build a complete Slurm cluster from scratch.</p>
<p>In this first post, we'll cover the fundamentals by setting up a single-node Slurm cluster and understanding the core concepts.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="series-overview">Series Overview<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#series-overview" class="hash-link" aria-label="Direct link to Series Overview" title="Direct link to Series Overview" translate="no">​</a></h2>
<ul>
<li class=""><strong>Part 1 (This Post)</strong>: Introduction, Architecture, and Single Node Setup</li>
<li class=""><strong><a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2">Part 2</a></strong>: Scaling to Production with Ansible</li>
<li class=""><strong><a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3">Part 3</a></strong>: Administration and Best Practices</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-slurm">Why Slurm?<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#why-slurm" class="hash-link" aria-label="Direct link to Why Slurm?" title="Direct link to Why Slurm?" translate="no">​</a></h2>
<p>When it comes to job scheduling in HPC environments, several options exist including PBS, Grid Engine, and IBM's LSF. However, Slurm (Simple Linux Utility for Resource Management) stands out for several compelling reasons:</p>
<ul>
<li class=""><strong>Open Source</strong>: Free to use with a large, active community</li>
<li class=""><strong>Scalability</strong>: Designed to scale from small clusters to the world's largest supercomputers</li>
<li class=""><strong>Flexibility</strong>: Fine-grained control over job scheduling, resource allocation, and priority settings</li>
<li class=""><strong>Integration</strong>: Works seamlessly with MPI, distributed computing frameworks (Spark, Ray, Dask), and monitoring tools</li>
<li class=""><strong>Performance</strong>: Optimized for high throughput with minimal overhead</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-slurm-architecture">Understanding Slurm Architecture<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#understanding-slurm-architecture" class="hash-link" aria-label="Direct link to Understanding Slurm Architecture" title="Direct link to Understanding Slurm Architecture" translate="no">​</a></h2>
<p>Before diving into the implementation, it's crucial to understand the key components of a Slurm cluster:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="HPC Architecture" src="https://riverxdata.github.io/river-docs/assets/images/HPC_architecture-41812b9d27b4da09fa4b92ab9cabd700.png" width="1440" height="960" class="img_ev3q"></p></figure>
<p>source: <a href="https://www.marquette.edu/high-performance-computing/architecture.php" target="_blank" rel="noopener noreferrer" class="">https://www.marquette.edu/high-performance-computing/architecture.php</a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="core-components">Core Components<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#core-components" class="hash-link" aria-label="Direct link to Core Components" title="Direct link to Core Components" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>slurmctld (Controller Daemon)</strong>: The brain of the cluster, running on the controller node. It handles job scheduling, resource tracking, and communicates with compute nodes.</p>
</li>
<li class="">
<p><strong>slurmd (Node Daemon)</strong>: Runs on compute nodes to execute jobs and report status back to the controller.</p>
</li>
<li class="">
<p><strong>slurmdbd (Database Daemon)</strong>: Optional but recommended for storing job accounting data, resource usage tracking, and fair-share scheduling.</p>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="node-types">Node Types<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#node-types" class="hash-link" aria-label="Direct link to Node Types" title="Direct link to Node Types" translate="no">​</a></h3>
<table><thead><tr><th>Node Type</th><th>Services</th><th>Purpose</th></tr></thead><tbody><tr><td>Controller</td><td>slurmctld</td><td>Manages job scheduling and resources</td></tr><tr><td>Compute</td><td>slurmd</td><td>Executes submitted jobs</td></tr><tr><td>Login</td><td>Slurm clients</td><td>User access point for job submission</td></tr><tr><td>Database</td><td>slurmdbd, MySQL/MariaDB</td><td>Stores accounting data</td></tr></tbody></table>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slurm Architecture" src="https://riverxdata.github.io/river-docs/assets/images/slurm_arch-83c1c084e3e6e81e2babfd383b976d6d.gif" width="811" height="681" class="img_ev3q"></p></figure>
<p>source: <a href="https://www.schedmd.com/" target="_blank" rel="noopener noreferrer" class="">https://www.schedmd.com/</a></p>
<p>For a deeper understanding of Slurm architecture, check our <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/slurm-architecture">Slurm Architecture documentation</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="single-node-setup---understanding-the-fundamentals">Single Node Setup - Understanding the Fundamentals<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#single-node-setup---understanding-the-fundamentals" class="hash-link" aria-label="Direct link to Single Node Setup - Understanding the Fundamentals" title="Direct link to Single Node Setup - Understanding the Fundamentals" translate="no">​</a></h2>
<p>Starting with a single-node setup helps you understand how Slurm works before scaling up. This approach is perfect for learning and local development.</p>
<div align="center"><figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slurm Logo" src="https://riverxdata.github.io/river-docs/assets/images/Slurm_logo-aa681ab3230b0e3101ed236f97071acb.svg" width="590" height="540" class="img_ev3q"></p></figure></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>This setup runs on Ubuntu 20.04 and includes all standard Slurm features. Note that this configuration is for learning purposes - for production environments, you'll want the multi-node setup covered in Part 2.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="basic-installation">Basic Installation<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#basic-installation" class="hash-link" aria-label="Direct link to Basic Installation" title="Direct link to Basic Installation" translate="no">​</a></h3>
<p>First, install the required Slurm components:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">apt-get</span><span class="token plain"> update </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-y</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-y</span><span class="token plain"> slurmd slurmctld</span><br></span></code></pre></div></div>
<p>Verify the installation:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Locate slurmd and slurmctld</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> slurmd</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: /usr/sbin/slurmd</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> slurmctld</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: /usr/sbin/slurmctld</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuring-slurmconf">Configuring slurm.conf<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#configuring-slurmconf" class="hash-link" aria-label="Direct link to Configuring slurm.conf" title="Direct link to Configuring slurm.conf" translate="no">​</a></h3>
<p>The <code>slurm.conf</code> file is the heart of your Slurm configuration. This file must be identical across all nodes in a cluster (but for now, we just have one node).</p>
<p>Create your <code>slurm.conf</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> slurm.conf</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># slurm.conf for a single-node Slurm cluster</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ClusterName=localcluster</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmctldHost=localhost</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">MpiDefault=none</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ProctrackType=proctrack/linuxproc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ReturnToService=2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmctldPidFile=/run/slurmctld.pid</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmctldPort=6817</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmdPidFile=/run/slurmd.pid</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmdPort=6818</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmdSpoolDir=/var/lib/slurm-llnl/slurmd</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmUser=slurm</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StateSaveLocation=/var/lib/slurm-llnl/slurmctld</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SwitchType=switch/none</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">TaskPlugin=task/none</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># TIMERS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">InactiveLimit=0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">KillWait=30</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">MinJobAge=300</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmctldTimeout=120</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmdTimeout=300</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">Waittime=0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># SCHEDULING</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SchedulerType=sched/backfill</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SelectType=select/cons_tres</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SelectTypeParameters=CR_Core</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># ACCOUNTING (not enabled yet)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">AccountingStorageType=accounting_storage/none</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">JobAcctGatherType=jobacct_gather/none</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">JobAcctGatherFrequency=30</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># LOGGING</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmctldDebug=info</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmctldLogFile=/var/log/slurm-llnl/slurmctld.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmdDebug=info</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmdLogFile=/var/log/slurm-llnl/slurmd.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># COMPUTE NODES (adjust CPUs and RealMemory to match your system)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">NodeName=localhost CPUs=2 Sockets=1 CoresPerSocket=2 ThreadsPerCore=1 RealMemory=1024 State=UNKNOWN</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># PARTITION CONFIGURATION</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">PartitionName=LocalQ Nodes=ALL Default=YES MaxTime=INFINITE State=UP</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">mv</span><span class="token plain"> slurm.conf /etc/slurm-llnl/slurm.conf</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="starting-services">Starting Services<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#starting-services" class="hash-link" aria-label="Direct link to Starting Services" title="Direct link to Starting Services" translate="no">​</a></h3>
<p>Start the Slurm daemons:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Start slurmd (compute daemon)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmd start</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmd status</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Start slurmctld (controller daemon)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmctld start</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmctld status</span><br></span></code></pre></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="slurmd status" src="https://riverxdata.github.io/river-docs/assets/images/slurmd_status-27a3e648f8da8db229ed803a5229e185.png" width="1310" height="351" class="img_ev3q"></p></figure>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="slurmctld status" src="https://riverxdata.github.io/river-docs/assets/images/slurmctld_status-4e7ed6630174c2f0bc017d60c84c72f1.png" width="1310" height="351" class="img_ev3q"></p></figure>
<p>Test your setup by submitting a simple interactive job:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mem</span><span class="token plain"> 500MB </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pty</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check job details</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">squeue </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%i %P %u %T %M %l %D %C %m %R %Z %N"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">column</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="critical-resource-limiting-with-cgroups">Critical: Resource Limiting with cgroups<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#critical-resource-limiting-with-cgroups" class="hash-link" aria-label="Direct link to Critical: Resource Limiting with cgroups" title="Direct link to Critical: Resource Limiting with cgroups" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>This is a critical step that's often overlooked!</strong></p><p>Without proper cgroup configuration, jobs can exceed their allocated resources, potentially causing system instability or crashes. The job scheduler will accept resource limits, but won't actually enforce them.</p></div></div>
<p>Let's test this problem first. Submit a job requesting 500MB and try to allocate much more:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mem</span><span class="token plain"> 500MB </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pty</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Try to allocate 1GB of memory (exceeding the 500MB limit)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">declare</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"> mem</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">while</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    mem</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$i</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">head</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> 100M </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token variable" style="color:hsl(221, 87%, 60%)">/dev/zero </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">tr</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'\000'</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'x'</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">((</span><span class="token variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">++</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Allocated: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$((</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">i </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable number" style="color:hsl(35, 99%, 36%)">100</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">))</span><span class="token string" style="color:hsl(119, 34%, 47%)"> MB"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>Before submitting the job, memory usage is less than 200MB:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Memory before stress" src="https://riverxdata.github.io/river-docs/assets/images/memory_before_stress-3a4b03c93c2340876dc5a870fe15d2e7.png" width="2432" height="434" class="img_ev3q"></p></figure>
<p>After allocating 1GB, the job is not killed due to missing control group (cgroup) configuration:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Over resource limit" src="https://riverxdata.github.io/river-docs/assets/images/overresource_limit-4d711b28cf5adccae532ca1c9aa28286.png" width="2432" height="434" class="img_ev3q"></p></figure>
<p>You'll notice the job continues running even after exceeding 500MB - that's the problem!</p>
<p>Now let's fix it with cgroups:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> cgroup.conf</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">CgroupAutomount=yes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">CgroupMountpoint=/sys/fs/cgroup</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ConstrainCores=yes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ConstrainRAMSpace=yes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ConstrainDevices=yes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ConstrainSwapSpace=yes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">MaxSwapPercent=5</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">MemorySwappiness=0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">mv</span><span class="token plain"> cgroup.conf /etc/slurm-llnl/cgroup.conf</span><br></span></code></pre></div></div>
<p>Update <code>slurm.conf</code> to use cgroup plugins:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s|ProctrackType=proctrack/linuxproc|ProctrackType=proctrack/cgroup|"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s|TaskPlugin=task/none|TaskPlugin=task/cgroup|"</span><span class="token plain"> /etc/slurm-llnl/slurm.conf</span><br></span></code></pre></div></div>
<p>Enable cgroup in GRUB and reboot:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'s/^GRUB_CMDLINE_LINUX="/GRUB_CMDLINE_LINUX="cgroup_enable=memory swapaccount=1 /'</span><span class="token plain"> /etc/default/grub</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">update-grub</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">reboot</span><br></span></code></pre></div></div>
<p>After reboot, restart Slurm services:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmctld restart</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmd restart</span><br></span></code></pre></div></div>
<p>Now test again with the same memory allocation script - this time, the job will be killed when it exceeds the limit!</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Out of Memory" src="https://riverxdata.github.io/river-docs/assets/images/oom-06f78a37e67a2fb7a3547efffd709e59.png" width="1305" height="434" class="img_ev3q"></p></figure>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="enabling-accounting">Enabling Accounting<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#enabling-accounting" class="hash-link" aria-label="Direct link to Enabling Accounting" title="Direct link to Enabling Accounting" translate="no">​</a></h3>
<p>Job accounting is essential for:</p>
<ul>
<li class="">Tracking who is using resources</li>
<li class="">Monitoring job completion and failures</li>
<li class="">Enforcing resource limits per user/group</li>
<li class="">Fair-share scheduling</li>
</ul>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Accounting disabled" src="https://riverxdata.github.io/river-docs/assets/images/sacct_disable-3536da7262517e12af0bb6c732d8d3ea.png" width="1310" height="351" class="img_ev3q"></p></figure>
<p>Install the required packages:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> slurmdbd mariadb-server </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-y</span><br></span></code></pre></div></div>
<p>Create the database and user:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> mysql start</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"CREATE DATABASE slurm_acct_db;"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"CREATE USER 'slurm'@'localhost' IDENTIFIED BY 'slurm';"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"GRANT ALL PRIVILEGES ON slurm_acct_db.* TO 'slurm'@'localhost';"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"FLUSH PRIVILEGES;"</span><br></span></code></pre></div></div>
<p>Verify the database was created:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"SHOW DATABASES;"</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"SELECT User, Host FROM mysql.user;"</span><br></span></code></pre></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Add database" src="https://riverxdata.github.io/river-docs/assets/images/add_db-12d303160989d2beda2434df173597ee.png" width="1314" height="539" class="img_ev3q"></p></figure>
<p>Configure <code>slurmdbd</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> slurmdbd.conf</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">PidFile=/run/slurmdbd.pid</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">LogFile=/var/log/slurm/slurmdbd.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">DebugLevel=error</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">DbdHost=localhost</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">DbdPort=6819</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># DB connection data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StorageType=accounting_storage/mysql</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StorageHost=localhost</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StoragePort=3306</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StorageUser=slurm</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StoragePass=slurm</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StorageLoc=slurm_acct_db</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmUser=slurm</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">mv</span><span class="token plain"> slurmdbd.conf /etc/slurm-llnl/slurmdbd.conf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmdbd start</span><br></span></code></pre></div></div>
<p>Update <code>slurm.conf</code> to enable accounting:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s|AccountingStorageType=accounting_storage/none|AccountingStorageType=accounting_storage/slurmdbd</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\n</span><span class="token string" style="color:hsl(119, 34%, 47%)">AccountingStorageEnforce=associations,limits,qos</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\n</span><span class="token string" style="color:hsl(119, 34%, 47%)">AccountingStorageHost=localhost</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\n</span><span class="token string" style="color:hsl(119, 34%, 47%)">AccountingStoragePort=6819|"</span><span class="token plain"> /etc/slurm-llnl/slurm.conf </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s|JobAcctGatherType=jobacct_gather/none|JobAcctGatherType=jobacct_gather/cgroup|"</span><span class="token plain"> /etc/slurm-llnl/slurm.conf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl restart slurmctld slurmd</span><br></span></code></pre></div></div>
<p>Add your cluster and user to accounting:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> sacctmgr </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> cluster localcluster</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add account for your user</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> sacctmgr </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> account </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Cluster</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">localcluster</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add your user to the account</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> sacctmgr </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> user </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">account</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">DefaultAccount</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl restart slurmctld slurmd</span><br></span></code></pre></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Add account" src="https://riverxdata.github.io/river-docs/assets/images/add_account-29ee0d7948684467ad5ebbaf8ac1b09c.png" width="1327" height="511" class="img_ev3q"></p></figure>
<p>Now test accounting by submitting a job and viewing its details:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Submit a test job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mem</span><span class="token plain"> 500MB </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View accounting information</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacct</span><br></span></code></pre></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Account usage" src="https://riverxdata.github.io/river-docs/assets/images/account_usage-97842aa935556fdd317294c67a737847.png" width="1327" height="171" class="img_ev3q"></p></figure>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h2>
<p>In this first part of our series, we've covered:</p>
<ol>
<li class=""><strong>Why Slurm</strong>: Understanding the advantages of Slurm over alternatives</li>
<li class=""><strong>Architecture</strong>: Core components (slurmctld, slurmd, slurmdbd) and their roles</li>
<li class=""><strong>Basic Setup</strong>: Installing and configuring a single-node cluster</li>
<li class=""><strong>Critical cgroups</strong>: Why resource limiting is essential (and how to enable it)</li>
<li class=""><strong>Accounting</strong>: Setting up job tracking and resource monitoring</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>What's Next?</strong></p><p>In <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2">Part 2</a>, we'll take this knowledge and scale to a multi-node production cluster using Ansible automation. We'll add monitoring with Grafana, alerting via Slack, and shared storage with NFS.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="resources">Resources<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources" translate="no">​</a></h2>
<ul>
<li class=""><strong>Full Documentation</strong>: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/how-to-build-slurm-single-node-with-full-functions">Single Node Slurm Setup</a></li>
<li class=""><strong>Architecture Details</strong>: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/slurm-architecture">Slurm Architecture</a></li>
<li class=""><strong>HPC Overview</strong>: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/high-performance-computing-overview">High-Performance Computing Overview</a></li>
<li class=""><strong>Official Docs</strong>: <a href="https://slurm.schedmd.com/" target="_blank" rel="noopener noreferrer" class="">SchedMD Slurm Documentation</a></li>
</ul>
<hr>
<p><em>This is Part 1 of the RiverXData series on building Slurm HPC clusters. Continue to <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2">Part 2</a> to learn about production deployment with Ansible.</em></p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="slurm" term="slurm"/>
        <category label="hpc" term="hpc"/>
        <category label="tutorial" term="tutorial"/>
        <category label="getting-started" term="getting-started"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[RIVER- A Web Application to Run Nf-Core]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/river-platform-and-nextflow</id>
        <link href="https://riverxdata.github.io/river-docs/blog/river-platform-and-nextflow"/>
        <updated>2026-01-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Simply, I just want a web application. This is an all-in-one application similar to Google Drive, but more advanced. It allows me to select files and put them into a workflow obtained directly from GitHub. For example, rnaseq from nf-core. The web application allows me to run and monitor Nextflow jobs. Then, it puts the results back to Google Drive, where I can view the results. It is useful for sharing results with my team or external teams. I can develop pipelines independently. My data can be stored on the cloud for backup. It is a simple and standard procedure for bioinformatics analysis. But I have not found any solution that fits these requirements is EASY, FREE, OPEN-SOURCE]]></summary>
        <content type="html"><![CDATA[<p>Simply, I just want a web application. This is an all-in-one application similar to Google Drive, but more advanced. It allows me to select files and put them into a workflow obtained directly from GitHub. For example, rnaseq from nf-core. The web application allows me to run and monitor Nextflow jobs. Then, it puts the results back to Google Drive, where I can view the results. It is useful for sharing results with my team or external teams. I can develop pipelines independently. My data can be stored on the cloud for backup. It is a simple and standard procedure for bioinformatics analysis. But I have not found any solution that fits these requirements is <code>EASY</code>, <code>FREE</code>, <code>OPEN-SOURCE</code></p>
<p>If you feel the same, <strong>RIVER</strong> may be your choice.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>This blog post is intended for the general community, show cases only. I'll focus on the big picture rather than diving deep into technical details.</p></div></div>
<p>To use it, you can follow the below tutorial</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="quick-review">Quick review<a href="https://riverxdata.github.io/river-docs/blog/river-platform-and-nextflow#quick-review" class="hash-link" aria-label="Direct link to Quick review" title="Direct link to Quick review" translate="no">​</a></h2>
<p>First, you can take a look at how it work first. In breif, it will allows the users to interact with S3 bucket, select inputs from S3 buckets, run and put back results to s3 that
RIVER platform can visualize. After watching this, you are able to configure the RIVER platform as contributor, add your interested workflows and allow you to run tools</p>
<div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;background:#000"><iframe src="https://www.youtube.com/embed/boabEFNIkNA" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" style="position:absolute;top:0;left:0;width:100%;height:100%"></iframe></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="get-started">Get started<a href="https://riverxdata.github.io/river-docs/blog/river-platform-and-nextflow#get-started" class="hash-link" aria-label="Direct link to Get started" title="Direct link to Get started" translate="no">​</a></h2>
<p>Your raw data should be uploaded to the platform. The fastq files are downloaded from the below url, then upload to the platform</p>
<p>The samplesheet.csv on test profile</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sample,fastq_1,fastq_2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">SAMPLE1_PE,https://raw.githubusercontent.com/nf-core/test-datasets/viralrecon/illumina/amplicon/sample1_R1.fastq.gz,https://raw.githubusercontent.com/nf-core/test-datasets/viralrecon/illumina/amplicon/sample1_R2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">SAMPLE2_PE,https://raw.githubusercontent.com/nf-core/test-datasets/viralrecon/illumina/amplicon/sample2_R1.fastq.gz,https://raw.githubusercontent.com/nf-core/test-datasets/viralrecon/illumina/amplicon/sample2_R2.fastq.gz</span><br></span></code></pre></div></div>
<p>The samplesheet.csv on RIVER</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sample,fastq_1,fastq_2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test,s3://genomics/demo/resources/fastq_files/sample1_R1.fastq.gz,s3://genomics/demo/resources/fastq_files/sample1_R2.fastq.gz</span><br></span></code></pre></div></div>
<div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;background:#000"><iframe src="https://www.youtube.com/embed/Fujhi6ZnHQQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" style="position:absolute;top:0;left:0;width:100%;height:100%"></iframe></div>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="s3" term="s3"/>
        <category label="data-analysis" term="data-analysis"/>
        <category label="slurm" term="slurm"/>
        <category label="hpc" term="hpc"/>
        <category label="web-platform" term="web-platform"/>
    </entry>
</feed>