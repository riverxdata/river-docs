"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[4425],{86763(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var i=s(62e3),t=s(74848),r=s(28453);const l={slug:"remote-files-htslib-bcftools-samtools",title:"Working with Remote Files using bcftools and samtools (HTSlib)",authors:["river"],tags:["bioinformatics","htslib","bcftools","samtools","s3","remote-files","cloud","genomics"],image:"./imgs/intro.png"},o="Working with Remote Files using bcftools and samtools (HTSlib)",a={image:s(29831).A,authorsImageUrls:[void 0]},c=[{value:"1. How HTSlib Handles Remote Files with Random Access",id:"1-how-htslib-handles-remote-files-with-random-access",level:2},{value:"1.1 Random Access Mechanism: The Foundation",id:"11-random-access-mechanism-the-foundation",level:3},{value:"1.2 All Supported URL Schemes",id:"12-all-supported-url-schemes",level:3},{value:"1.3 Typical Bioinformatics Protocols (Covered in This Blog)",id:"13-typical-bioinformatics-protocols-covered-in-this-blog",level:3},{value:"S3 (Amazon S3 and compatible)",id:"s3-amazon-s3-and-compatible",level:4},{value:"HTTPS (Web servers)",id:"https-web-servers",level:4},{value:"FTP (File Transfer Protocol)",id:"ftp-file-transfer-protocol",level:4},{value:"GCS (Google Cloud Storage)",id:"gcs-google-cloud-storage",level:4},{value:"1.4 Key Advantages of Remote Access",id:"14-key-advantages-of-remote-access",level:3},{value:"1.5 Performance Considerations: Why Indexes Matter",id:"15-performance-considerations-why-indexes-matter",level:3},{value:"1.6 Setting Up bcftools and samtools with Pixi",id:"16-setting-up-bcftools-and-samtools-with-pixi",level:3},{value:"Installation Steps",id:"installation-steps",level:4},{value:"Verify Installation",id:"verify-installation",level:4},{value:"Why Pixi for Remote File Access?",id:"why-pixi-for-remote-file-access",level:4},{value:"1.7 Protocol Verification: HTTP Range Requests",id:"17-protocol-verification-http-range-requests",level:3},{value:"2. S3 Remote File Access",id:"2-s3-remote-file-access",level:2},{value:"2.1 S3 Authentication",id:"21-s3-authentication",level:3},{value:"Using AWS Credentials",id:"using-aws-credentials",level:4},{value:"Using AWS IAM Roles (EC2 Instances)",id:"using-aws-iam-roles-ec2-instances",level:4},{value:"Using AWS CLI Configuration",id:"using-aws-cli-configuration",level:4},{value:"2.2 Querying S3-hosted VCF Files",id:"22-querying-s3-hosted-vcf-files",level:3},{value:"2.3 Querying S3-hosted BAM Files",id:"23-querying-s3-hosted-bam-files",level:3},{value:"2.4 Region-based Subsetting Workflow",id:"24-region-based-subsetting-workflow",level:3},{value:"2.5 Working with Public Genomic Data",id:"25-working-with-public-genomic-data",level:3},{value:"3. FTP Remote File Access",id:"3-ftp-remote-file-access",level:2},{value:"3.1 FTP Authentication",id:"31-ftp-authentication",level:3},{value:"Anonymous Access",id:"anonymous-access",level:4},{value:"Authenticated FTP",id:"authenticated-ftp",level:4},{value:"3.2 Querying FTP-hosted Files",id:"32-querying-ftp-hosted-files",level:3},{value:"NCBI FTP Repository",id:"ncbi-ftp-repository",level:4},{value:"Ensembl FTP Repository",id:"ensembl-ftp-repository",level:4},{value:"3.3 FTP Performance Tips",id:"33-ftp-performance-tips",level:3},{value:"4. HTTPS Remote File Access",id:"4-https-remote-file-access",level:2},{value:"4.1 HTTPS Authentication Methods",id:"41-https-authentication-methods",level:3},{value:"Bearer Token Authentication",id:"bearer-token-authentication",level:4},{value:"API Keys in Headers",id:"api-keys-in-headers",level:4},{value:"Basic HTTP Authentication",id:"basic-http-authentication",level:4},{value:"4.2 Practical HTTPS Workflows",id:"42-practical-https-workflows",level:3},{value:"Query Public HTTPS-hosted Data",id:"query-public-https-hosted-data",level:4},{value:"Download Indexed Files Locally",id:"download-indexed-files-locally",level:4},{value:"4.3 SSL/TLS Certificate Issues",id:"43-ssltls-certificate-issues",level:3},{value:"5. Indexing and Efficient Region Queries",id:"5-indexing-and-efficient-region-queries",level:2},{value:"5.1 Creating Indexes",id:"51-creating-indexes",level:3},{value:"Create Tabix Index for VCF Files",id:"create-tabix-index-for-vcf-files",level:4},{value:"Create CSI Index for BCF Files",id:"create-csi-index-for-bcf-files",level:4},{value:"Create BAI Index for BAM Files",id:"create-bai-index-for-bam-files",level:4},{value:"5.2 Verifying Index Integrity",id:"52-verifying-index-integrity",level:3},{value:"5.3 Performance: Indexed vs Unindexed Remote Access",id:"53-performance-indexed-vs-unindexed-remote-access",level:3},{value:"5.4 Testing Remote File Access with Local Files",id:"54-testing-remote-file-access-with-local-files",level:3},{value:"6. Common Workflows and Recipes",id:"6-common-workflows-and-recipes",level:2},{value:"6.1 Extract Variants for Specific Genes",id:"61-extract-variants-for-specific-genes",level:3},{value:"6.2 Compare Samples Across Remote Files",id:"62-compare-samples-across-remote-files",level:3},{value:"6.3 Annotate Remote VCF with Remote Annotations",id:"63-annotate-remote-vcf-with-remote-annotations",level:3},{value:"6.4 Extract BAM Regions for Multiple Samples",id:"64-extract-bam-regions-for-multiple-samples",level:3},{value:"6.5 Stream Processing Without Local Storage",id:"65-stream-processing-without-local-storage",level:3},{value:"7. Troubleshooting and Optimization",id:"7-troubleshooting-and-optimization",level:2},{value:"7.1 Common Issues",id:"71-common-issues",level:3},{value:"7.2 Optimization Tips",id:"72-optimization-tips",level:3},{value:"7.3 Debugging with Verbose Output",id:"73-debugging-with-verbose-output",level:3},{value:"8. Recap and Key Takeaways",id:"8-recap-and-key-takeaways",level:2},{value:"8.1 What We&#39;ve Covered",id:"81-what-weve-covered",level:3},{value:"8.2 Key Takeaways",id:"82-key-takeaways",level:3},{value:"8.3 Quick Reference Workflow",id:"83-quick-reference-workflow",level:3},{value:"8.4 Next Steps",id:"84-next-steps",level:3},{value:"8.5 Additional Resources",id:"85-additional-resources",level:3}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["HTSlib-based tools like ",(0,t.jsx)(n.code,{children:"bcftools"})," and ",(0,t.jsx)(n.code,{children:"samtools"})," provide powerful capabilities for working with genomic data stored on remote servers. Whether your data is in AWS S3, accessible via FTP, or hosted on HTTPS endpoints, these tools allow you to efficiently query and subset remote files without downloading entire datasets. This guide covers authentication, remote file access patterns, and practical workflows."]}),"\n",(0,t.jsx)(n.h2,{id:"1-how-htslib-handles-remote-files-with-random-access",children:"1. How HTSlib Handles Remote Files with Random Access"}),"\n",(0,t.jsxs)(n.p,{children:["HTSlib is a C library that powers many genomic tools. Tools built on HTSlib\u2014including ",(0,t.jsx)(n.code,{children:"bcftools"}),", ",(0,t.jsx)(n.code,{children:"samtools"}),", ",(0,t.jsx)(n.code,{children:"tabix"}),", and others\u2014inherit native support for ",(0,t.jsx)(n.strong,{children:"remote file access via random access queries"}),". This section explains how HTSlib works with remote files and which protocols are supported."]}),"\n",(0,t.jsx)(n.h3,{id:"11-random-access-mechanism-the-foundation",children:"1.1 Random Access Mechanism: The Foundation"}),"\n",(0,t.jsxs)(n.p,{children:["HTSlib enables efficient remote file access through a ",(0,t.jsx)(n.strong,{children:"byte-range request mechanism"}),". Instead of downloading entire files, it uses file indexes to determine exact byte positions and requests only those bytes from the remote server."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"How it works:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'User Request:\n  bcftools view s3://bucket/variants.vcf.gz chr1:1000-2000\n\nHTSlib Process:\n1. Reads index file (.vcf.gz.tbi) to find byte ranges\n2. Index lookup: "chr1:1000-2000 is at bytes 5000-15000"\n3. Sends byte-range request to remote server\n4. Remote server returns ONLY requested bytes (10KB, not 1GB!)\n5. HTSlib decompresses partial data\n6. Returns matching variants to user\n\nResult: 10KB downloaded instead of 1GB\nTime: 1-5 seconds instead of 5-30 minutes\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Critical requirement: Indexed files"})," (",(0,t.jsx)(n.code,{children:".tbi"}),", ",(0,t.jsx)(n.code,{children:".bai"}),", ",(0,t.jsx)(n.code,{children:".csi"}),")"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Without index: Must download entire file from start (fails on large files)"}),"\n",(0,t.jsx)(n.li,{children:"With index: Downloads only necessary bytes (efficient and fast)"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"12-all-supported-url-schemes",children:"1.2 All Supported URL Schemes"}),"\n",(0,t.jsxs)(n.p,{children:["HTSlib supports a comprehensive list of protocols via ",(0,t.jsx)(n.code,{children:"libcurl"}),". Check your installation:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# View all supported protocols\npixi run samtools --version 2>&1 | grep -A 20 "HTSlib URL"\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Complete output example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"HTSlib URL scheme handlers present:\n    built-in:        file, preload, data\n    Google Cloud:    gs+http, gs+https, gs\n    libcurl:         gophers, smtp, wss, smb, rtsp, tftp, pop3, smbs, imaps, pop3s, ws, ftps, ftp, gopher, imap, http, https, sftp, smtps, scp, dict, mqtt, telnet\n    Amazon S3:       s3+https, s3, s3+http\n    crypt4gh:        crypt4gh\n    mem:             mem\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Protocol categories:"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Category"}),(0,t.jsx)(n.th,{children:"Protocols"}),(0,t.jsx)(n.th,{children:"Typical Use"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Built-in"})}),(0,t.jsx)(n.td,{children:"file, preload, data"}),(0,t.jsx)(n.td,{children:"Local files, pipes"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Cloud Storage"})}),(0,t.jsx)(n.td,{children:"s3://, gs://"}),(0,t.jsx)(n.td,{children:"AWS, Google Cloud"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"HTTP-based"})}),(0,t.jsx)(n.td,{children:"http://, https://, ftps://"}),(0,t.jsx)(n.td,{children:"Web servers, FTP over SSL"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Other"})}),(0,t.jsx)(n.td,{children:"ftp://, sftp://, scp://, smb://"}),(0,t.jsx)(n.td,{children:"Traditional file servers"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Specialized"})}),(0,t.jsx)(n.td,{children:"mqtt, dict, imap, etc"}),(0,t.jsx)(n.td,{children:"Not typical for genomics"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note on protocol coverage:"})," This blog focuses on the most common protocols for bioinformatics: ",(0,t.jsx)(n.strong,{children:"S3, HTTPS, FTP, and GCS"}),". Many other protocols are available but less commonly used for genomic data."]}),"\n",(0,t.jsx)(n.h3,{id:"13-typical-bioinformatics-protocols-covered-in-this-blog",children:"1.3 Typical Bioinformatics Protocols (Covered in This Blog)"}),"\n",(0,t.jsx)(n.p,{children:"The following protocols are widely used for storing and accessing genomic data:"}),"\n",(0,t.jsx)(n.h4,{id:"s3-amazon-s3-and-compatible",children:"S3 (Amazon S3 and compatible)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"URL scheme"}),": ",(0,t.jsx)(n.code,{children:"s3://bucket-name/path/file.vcf.gz"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use case"}),": Cloud-based genomic repositories, AWS-hosted data"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Random access"}),": Via byte-range requests, AWS SDK for auth"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Speed"}),": Fastest (typically <1 second for indexed queries)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"See section"}),": 2 - S3 Remote File Access"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"https-web-servers",children:"HTTPS (Web servers)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"URL scheme"}),": ",(0,t.jsx)(n.code,{children:"https://server.com/path/file.vcf.gz"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use case"}),": Public databases (NCBI, Ensembl), institutional servers"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Random access"}),": Via HTTP Range header (206 Partial Content)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Speed"}),": Fast (1-2 seconds for indexed queries)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"See section"}),": 4 - HTTPS Remote File Access"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"ftp-file-transfer-protocol",children:"FTP (File Transfer Protocol)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"URL scheme"}),": ",(0,t.jsx)(n.code,{children:"ftp://server.com/path/file.vcf.gz"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use case"}),": Legacy databases, some public repositories"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Random access"}),": Via FTP REST command for seeking"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Speed"}),": Slower (3-5 seconds for indexed queries)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"See section"}),": 3 - FTP Remote File Access"]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"gcs-google-cloud-storage",children:"GCS (Google Cloud Storage)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"URL scheme"}),": ",(0,t.jsx)(n.code,{children:"gs://bucket-name/path/file.vcf.gz"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use case"}),": Google Cloud-hosted genomic data"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Random access"}),": Similar to S3 (byte-range requests)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Speed"}),": Fast (typically <1 second for indexed queries)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": Requires Google Cloud SDK credentials"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"14-key-advantages-of-remote-access",children:"1.4 Key Advantages of Remote Access"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Avoid large downloads"}),": Query specific regions without transferring entire files"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cost efficiency"}),": Pay only for data you access, not storage"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Scalability"}),": Work with datasets larger than local disk space"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Collaboration"}),": Reference shared datasets directly without copying"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Real-time access"}),": Always work with latest version of data"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"15-performance-considerations-why-indexes-matter",children:"1.5 Performance Considerations: Why Indexes Matter"}),"\n",(0,t.jsx)(n.p,{children:"Remote file access requires indexed files for efficient region-based queries:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"VCF files"}),": Must have ",(0,t.jsx)(n.code,{children:".vcf.gz.tbi"})," index"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"BAM files"}),": Must have ",(0,t.jsx)(n.code,{children:".bam.bai"})," index"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"BCF files"}),": Must have ",(0,t.jsx)(n.code,{children:".bcf.csi"})," index"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Bandwidth comparison for 1GB VCF file querying chr1:1-100000:"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Scenario"}),(0,t.jsx)(n.th,{children:"Bytes Transferred"}),(0,t.jsx)(n.th,{children:"Time"}),(0,t.jsx)(n.th,{children:"Method"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Indexed S3"})}),(0,t.jsx)(n.td,{children:"~700KB"}),(0,t.jsx)(n.td,{children:"<1 second"}),(0,t.jsx)(n.td,{children:"Byte-range request"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Indexed HTTPS"})}),(0,t.jsx)(n.td,{children:"~700KB"}),(0,t.jsx)(n.td,{children:"1-2 seconds"}),(0,t.jsx)(n.td,{children:"HTTP Range header"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Indexed FTP"})}),(0,t.jsx)(n.td,{children:"~700KB"}),(0,t.jsx)(n.td,{children:"3-5 seconds"}),(0,t.jsx)(n.td,{children:"FTP REST seek"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Unindexed remote"})}),(0,t.jsx)(n.td,{children:"1000MB+"}),(0,t.jsx)(n.td,{children:"5-30 minutes"}),(0,t.jsx)(n.td,{children:"Sequential download"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Local indexed file"})}),(0,t.jsx)(n.td,{children:"~700KB"}),(0,t.jsx)(n.td,{children:"<0.5 seconds"}),(0,t.jsx)(n.td,{children:"Direct file seek"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Critical insight"}),": Indexed remote access downloads only 0.07% of file size!"]}),"\n",(0,t.jsx)(n.h3,{id:"16-setting-up-bcftools-and-samtools-with-pixi",children:"1.6 Setting Up bcftools and samtools with Pixi"}),"\n",(0,t.jsxs)(n.p,{children:["The easiest way to install bcftools and samtools with full remote file support is using Pixi with the ",(0,t.jsx)(n.code,{children:"conda-forge"})," and ",(0,t.jsx)(n.code,{children:"bioconda"})," channels. These channels include pre-compiled binaries with S3, FTP, and HTTPS support enabled in HTSlib."]}),"\n",(0,t.jsx)(n.h4,{id:"installation-steps",children:"Installation Steps"}),"\n",(0,t.jsx)(n.p,{children:"Create a new directory for your project and initialize a Pixi environment:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Create project directory\nmkdir -p ~/htslib-project && cd ~/htslib-project\n\n# Initialize Pixi with conda-forge and bioconda channels\npixi init --channel conda-forge --channel bioconda .\n\n# Add bcftools and samtools\npixi add bcftools samtools\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This creates a ",(0,t.jsx)(n.code,{children:"pixi.toml"})," file:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[workspace]\nchannels = ["conda-forge", "bioconda"]\nname = "htslib-project"\nplatforms = ["linux-64"]\nversion = "0.1.0"\n\n[dependencies]\nbcftools = ">=1.23,<2"\nsamtools = ">=1.23,<2"\n'})}),"\n",(0,t.jsx)(n.h4,{id:"verify-installation",children:"Verify Installation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Run bcftools version\npixi run bcftools --version\n\n# Run samtools version\npixi run samtools --version\n"})}),"\n",(0,t.jsx)(n.p,{children:"Both tools will report HTSlib features including S3, GCS, and libcurl support:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"bcftools 1.23\nUsing htslib 1.23\n...\n\nSamtools 1.23\n...\nHTSlib compilation details:\n    Features:       build=configure libcurl=yes S3=yes GCS=yes ...\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The key line is ",(0,t.jsx)(n.code,{children:"S3=yes"})," indicating S3 support is enabled."]}),"\n",(0,t.jsx)(n.h4,{id:"why-pixi-for-remote-file-access",children:"Why Pixi for Remote File Access?"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Pre-compiled with remote support"}),": Bioconda packages include HTSlib compiled with libcurl, S3, and GCS support"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Easy dependency management"}),": All required libraries included automatically"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Reproducible environments"}),": ",(0,t.jsx)(n.code,{children:"pixi.lock"})," ensures the same versions across machines"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"No system-wide installation"}),": Keep tools isolated in your project environment"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"17-protocol-verification-http-range-requests",children:"1.7 Protocol Verification: HTTP Range Requests"}),"\n",(0,t.jsx)(n.p,{children:"For HTTPS/HTTP remote access to work efficiently, the server must support HTTP Range Requests. Verify this before relying on remote queries:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Test if server supports Range Requests\ncurl -I -H "Range: bytes=0-500" https://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/00-common_all_papu.vcf.gz\n\n# Expected response: HTTP/1.1 206 Partial Content\n# This means byte-range requests work! \u2713\n'})}),"\n",(0,t.jsx)(n.p,{children:"Response headers will show:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"HTTP/1.1 206 Partial Content      \u2190 supports Range requests\nAccept-Ranges: bytes              \u2190 confirms support\nContent-Length: 501               \u2190 returns partial content\n"})}),"\n",(0,t.jsx)(n.h2,{id:"2-s3-remote-file-access",children:"2. S3 Remote File Access"}),"\n",(0,t.jsxs)(n.p,{children:["AWS S3 is a common repository for genomic datasets. HTSlib supports S3 through the ",(0,t.jsx)(n.code,{children:"s3://"})," protocol."]}),"\n",(0,t.jsx)(n.h3,{id:"21-s3-authentication",children:"2.1 S3 Authentication"}),"\n",(0,t.jsx)(n.h4,{id:"using-aws-credentials",children:"Using AWS Credentials"}),"\n",(0,t.jsx)(n.p,{children:"Set AWS credentials as environment variables:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'export AWS_ACCESS_KEY_ID="your_access_key"\nexport AWS_SECRET_ACCESS_KEY="your_secret_key"\nexport AWS_DEFAULT_REGION="us-east-1"\n'})}),"\n",(0,t.jsx)(n.h4,{id:"using-aws-iam-roles-ec2-instances",children:"Using AWS IAM Roles (EC2 Instances)"}),"\n",(0,t.jsx)(n.p,{children:"If running on EC2 with an IAM role attached, HTSlib automatically uses the role's credentials\u2014no environment variables needed."}),"\n",(0,t.jsx)(n.h4,{id:"using-aws-cli-configuration",children:"Using AWS CLI Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["HTSlib respects ",(0,t.jsx)(n.code,{children:"~/.aws/credentials"})," and ",(0,t.jsx)(n.code,{children:"~/.aws/config"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aws configure  # Interactive setup\n"})}),"\n",(0,t.jsx)(n.h3,{id:"22-querying-s3-hosted-vcf-files",children:"2.2 Querying S3-hosted VCF Files"}),"\n",(0,t.jsx)(n.p,{children:"Query a specific genomic region from a remote VCF file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Query chromosome 1, positions 1-1000000\nbcftools view s3://my-bucket/data/variants.vcf.gz chr1:1-1000000\n\n# Count variants in a region\nbcftools view -H s3://my-bucket/data/variants.vcf.gz chr1:1-1000000 | wc -l\n\n# Extract samples and subset to region\nbcftools view -s sample1,sample2 s3://my-bucket/data/variants.vcf.gz chr1:1-1000000 -O v\n"})}),"\n",(0,t.jsx)(n.h3,{id:"23-querying-s3-hosted-bam-files",children:"2.3 Querying S3-hosted BAM Files"}),"\n",(0,t.jsx)(n.p,{children:"Extract reads from specific genomic regions:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Query region from remote BAM\nsamtools view s3://my-bucket/data/aligned.bam chr1:1-1000000\n\n# Count reads in region\nsamtools view -c s3://my-bucket/data/aligned.bam chr1:1-1000000\n\n# Extract to local BAM file\nsamtools view -b s3://my-bucket/data/aligned.bam chr1:1-1000000 -o region.bam\n"})}),"\n",(0,t.jsx)(n.h3,{id:"24-region-based-subsetting-workflow",children:"2.4 Region-based Subsetting Workflow"}),"\n",(0,t.jsx)(n.p,{children:"Efficient workflow for extracting subsets from S3:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# 1. List available S3 files (using AWS CLI)\naws s3 ls s3://my-bucket/data/ --recursive\n\n# 2. Query specific region from VCF\nbcftools view \\\n  s3://my-bucket/data/chr1.vcf.gz \\\n  chr1:10000000-20000000 \\\n  -O v -o local_subset.vcf\n\n# 3. Validate and compress\nbgzip -f local_subset.vcf\ntabix -p vcf local_subset.vcf.gz\n\n# 4. Annotate or further process locally\nbcftools annotate local_subset.vcf.gz -a annotation.vcf.gz -c ID\n"})}),"\n",(0,t.jsx)(n.h3,{id:"25-working-with-public-genomic-data",children:"2.5 Working with Public Genomic Data"}),"\n",(0,t.jsx)(n.p,{children:"Public genomic repositories are excellent for testing remote file access. While S3 is available, HTTPS endpoints are often more reliable for quick testing."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Query NCBI dbSNP data via HTTPS:"})}),"\n",(0,t.jsx)(n.p,{children:"NCBI provides public access to common variants. Test with real data:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Query NCBI dbSNP common variants (via HTTPS)\npixi run bcftools view \\\n  https://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/00-common_all.vcf.gz \\\n  | pixi run bcftools query -f '%CHROM\\t%POS\\t%REF\\t%ALT\\n' \\\n  | head -20\n"})}),"\n",(0,t.jsx)(n.p,{children:"Expected output showing real variants:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"1\t10177\tA\tAC\n1\t10352\tT\tTA\n1\t10352\tT\tTA\n1\t10616\tCCGCCGTTGCAAAGGCGCGCCG\tC\n1\t10642\tG\tA\n1\t11008\tC\tG\n1\t11012\tC\tG\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Discover available files:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# List NCBI FTP VCF files\ncurl -s https://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/ \\\n  | grep -i ".vcf.gz\\"" | grep -o "href=\\"[^\\"]*\\"" | cut -d\'"\' -f2\n\n# Or for 1000 Genomes in S3:\naws s3 ls s3://1000genomes/phase3/data/ --no-sign-request | head -20\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Region-based queries (with indexed files):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Query specific chromosome region\n# Note: Requires .tbi index at the remote location\npixi run bcftools view \\\n  https://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/00-common_all.vcf.gz \\\n  chr1:1000000-2000000\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Note on S3 vs HTTPS:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"HTTPS"})," (like NCBI): Reliable, requires no credentials for public data"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"S3"}),": Fastest for large datasets, requires AWS credentials or public bucket setup"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"FTP"}),": Alternative for some repositories, generally slower than HTTPS"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"3-ftp-remote-file-access",children:"3. FTP Remote File Access"}),"\n",(0,t.jsxs)(n.p,{children:["FTP servers host many public genomic datasets. HTSlib supports the ",(0,t.jsx)(n.code,{children:"ftp://"})," protocol."]}),"\n",(0,t.jsx)(n.h3,{id:"31-ftp-authentication",children:"3.1 FTP Authentication"}),"\n",(0,t.jsx)(n.h4,{id:"anonymous-access",children:"Anonymous Access"}),"\n",(0,t.jsx)(n.p,{children:"Many public repositories allow anonymous FTP:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# No credentials needed\nbcftools view ftp://ftp.ncbi.nlm.nih.gov/genomes/H_sapiens/VCF/common_all.vcf.gz chr1:1-1000000\n"})}),"\n",(0,t.jsx)(n.h4,{id:"authenticated-ftp",children:"Authenticated FTP"}),"\n",(0,t.jsx)(n.p,{children:"For private FTP servers, include credentials in the URL:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"bcftools view ftp://username:password@ftp.example.com/data/variants.vcf.gz chr1:1-1000000\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Security Note"}),": URL-embedded credentials are visible in process listings. Prefer environment variables:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'export FTP_USER="your_username"\nexport FTP_PASSWORD="your_password"\n\n# HTSlib will use these automatically\nbcftools view ftp://ftp.example.com/data/variants.vcf.gz chr1:1-1000000\n'})}),"\n",(0,t.jsx)(n.h3,{id:"32-querying-ftp-hosted-files",children:"3.2 Querying FTP-hosted Files"}),"\n",(0,t.jsx)(n.p,{children:"Common public genomic repositories accessible via FTP:"}),"\n",(0,t.jsx)(n.h4,{id:"ncbi-ftp-repository",children:"NCBI FTP Repository"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Query NCBI's common variants file\nbcftools view \\\n  ftp://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/common_all.vcf.gz \\\n  chr1:1-1000000 \\\n  | bcftools query -f '%CHROM\\t%POS\\t%AC\\t%AF\\n' \\\n  | head -10\n"})}),"\n",(0,t.jsx)(n.h4,{id:"ensembl-ftp-repository",children:"Ensembl FTP Repository"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Query Ensembl VCF (example path)\nbcftools view \\\n  ftp://ftp.ensembl.org/pub/data_files/homo_sapiens/VEP/Homo_sapiens_phenotypes_associated_variants-GRCh38.vcf.gz \\\n  1:1-1000000\n\n# List available Ensembl files\nftp ftp.ensembl.org  # Interactive FTP session\n"})}),"\n",(0,t.jsx)(n.h3,{id:"33-ftp-performance-tips",children:"3.3 FTP Performance Tips"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Network stability"}),": FTP can be slower than HTTPS for single queries. Consider batch processing."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Index availability"}),": Verify ",(0,t.jsx)(n.code,{children:".tbi"})," or ",(0,t.jsx)(n.code,{children:".csi"})," indexes are present on the FTP server for efficient region queries."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Timeout handling"}),": Set timeout environment variables for unreliable connections:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"export CURL_CONNECT_TIMEOUT=30\nexport CURL_TIMEOUT=60\n"})}),"\n",(0,t.jsx)(n.h2,{id:"4-https-remote-file-access",children:"4. HTTPS Remote File Access"}),"\n",(0,t.jsx)(n.p,{children:"HTTPS endpoints often require token-based authentication and are increasingly common for cloud-hosted data."}),"\n",(0,t.jsx)(n.h3,{id:"41-https-authentication-methods",children:"4.1 HTTPS Authentication Methods"}),"\n",(0,t.jsx)(n.h4,{id:"bearer-token-authentication",children:"Bearer Token Authentication"}),"\n",(0,t.jsx)(n.p,{children:"For endpoints that accept Bearer tokens (common in cloud platforms):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Option 1: Set environment variable\nexport HTTPS_AUTH_BEARER="your_bearer_token"\nbcftools view https://api.example.com/data/variants.vcf.gz chr1:1-1000000\n\n# Option 2: Pass in URL (less secure)\nbcftools view https://token:your_bearer_token@api.example.com/data/variants.vcf.gz chr1:1-1000000\n'})}),"\n",(0,t.jsx)(n.h4,{id:"api-keys-in-headers",children:"API Keys in Headers"}),"\n",(0,t.jsxs)(n.p,{children:["For services requiring custom headers, use ",(0,t.jsx)(n.code,{children:"curl"})," with a named pipe:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Create a wrapper using curl and process substitution\nbcftools view \\\n  <(curl -H "Authorization: Bearer TOKEN" \\\n     https://api.example.com/data/variants.vcf.gz \\\n     --output - ) \\\n  chr1:1-1000000\n'})}),"\n",(0,t.jsx)(n.h4,{id:"basic-http-authentication",children:"Basic HTTP Authentication"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# URL-embedded credentials (not recommended for security)\nbcftools view https://username:password@secure.example.com/data/variants.vcf.gz chr1:1-1000000\n"})}),"\n",(0,t.jsx)(n.h3,{id:"42-practical-https-workflows",children:"4.2 Practical HTTPS Workflows"}),"\n",(0,t.jsx)(n.h4,{id:"query-public-https-hosted-data",children:"Query Public HTTPS-hosted Data"}),"\n",(0,t.jsx)(n.p,{children:"Many databases provide HTTPS access to genomic data:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Example: Query genome annotation from HTTPS endpoint\nbcftools view https://example.genomics.org/public/variants.vcf.gz chr1:1-1000000\n\n# Extract specific information\nbcftools view https://example.genomics.org/public/variants.vcf.gz chr1:1-1000000 \\\n  | bcftools query -f '%CHROM\\t%POS\\t%REF\\t%ALT\\t%AC\\n'\n"})}),"\n",(0,t.jsx)(n.h4,{id:"download-indexed-files-locally",children:"Download Indexed Files Locally"}),"\n",(0,t.jsx)(n.p,{children:"For repeated queries, consider caching indexes locally:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Download index file (small, fast)\ncurl -o variants.vcf.gz.tbi https://api.example.com/data/variants.vcf.gz.tbi\n\n# Query still uses remote file but with local index knowledge\nbcftools view https://api.example.com/data/variants.vcf.gz chr1:1-1000000\n"})}),"\n",(0,t.jsx)(n.h3,{id:"43-ssltls-certificate-issues",children:"4.3 SSL/TLS Certificate Issues"}),"\n",(0,t.jsx)(n.p,{children:"If you encounter certificate validation errors:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Disable certificate verification (use cautiously)\nexport SSL_NO_VERIFY=1\nbcftools view https://api.example.com/data/variants.vcf.gz chr1:1-1000000\n\n# Or use curl environment variable\nexport CURL_CA_BUNDLE=""\nbcftools view https://api.example.com/data/variants.vcf.gz chr1:1-1000000\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Security Note"}),": Only disable certificate verification for trusted internal endpoints or testing."]}),"\n",(0,t.jsx)(n.h2,{id:"5-indexing-and-efficient-region-queries",children:"5. Indexing and Efficient Region Queries"}),"\n",(0,t.jsx)(n.p,{children:"Efficient remote file access depends on proper indexing. HTSlib tools use byte-range requests to fetch only necessary data."}),"\n",(0,t.jsx)(n.h3,{id:"51-creating-indexes",children:"5.1 Creating Indexes"}),"\n",(0,t.jsx)(n.h4,{id:"create-tabix-index-for-vcf-files",children:"Create Tabix Index for VCF Files"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# For bgzip-compressed VCF files\ntabix -p vcf variants.vcf.gz\n\n# Verify index\nls -lh variants.vcf.gz*\n"})}),"\n",(0,t.jsx)(n.h4,{id:"create-csi-index-for-bcf-files",children:"Create CSI Index for BCF Files"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# CSI indexes support larger files and datasets\nbcftools index -c variants.bcf\n\n# Verify index\nls -lh variants.bcf.csi\n"})}),"\n",(0,t.jsx)(n.h4,{id:"create-bai-index-for-bam-files",children:"Create BAI Index for BAM Files"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Standard BAM indexing\nsamtools index aligned.bam\n\n# Creates aligned.bam.bai\nls -lh aligned.bam.bai\n"})}),"\n",(0,t.jsx)(n.h3,{id:"52-verifying-index-integrity",children:"5.2 Verifying Index Integrity"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Check if VCF index is valid\ntabix -l variants.vcf.gz | head -10\n\n# Query a specific region (tests index)\nbcftools view variants.vcf.gz chr1:1-1000 -H | wc -l\n"})}),"\n",(0,t.jsx)(n.h3,{id:"53-performance-indexed-vs-unindexed-remote-access",children:"5.3 Performance: Indexed vs Unindexed Remote Access"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Indexed remote access"})," (with region query):"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Seeks to file index"}),"\n",(0,t.jsx)(n.li,{children:"Downloads byte-range containing target region"}),"\n",(0,t.jsx)(n.li,{children:"Returns ~100KB-1MB of data"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Unindexed remote access"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Must scan entire file sequentially"}),"\n",(0,t.jsx)(n.li,{children:"Downloads entire file"}),"\n",(0,t.jsx)(n.li,{children:"Returns all data (can be GB-sized)"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Example performance comparison:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Indexed query (fast, ~1-5 seconds)\ntime bcftools view s3://my-bucket/variants.vcf.gz chr1:1-1000000 > /dev/null\n\n# Without index (very slow, minutes or fails)\n# HTSlib automatically uses index if available, so explicitly avoid it only if needed\n"})}),"\n",(0,t.jsx)(n.h3,{id:"54-testing-remote-file-access-with-local-files",children:"5.4 Testing Remote File Access with Local Files"}),"\n",(0,t.jsx)(n.p,{children:"Before working with remote files, it's helpful to test bcftools and samtools locally. Use this workflow to verify your installation and practice region queries."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Create test VCF file:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Create test directory\nmkdir -p ~/genomics-test && cd ~/genomics-test\n\n# Create test VCF\ncat > test.vcf << \'EOF\'\n##fileformat=VCFv4.2\n##INFO=<ID=DP,Number=1,Type=Integer,Description="Total read depth">\n##FORMAT=<ID=GT,Number=1,Type=String,Description="Genotype">\n#CHROM\tPOS\tID\tREF\tALT\tQUAL\tFILTER\tINFO\tFORMAT\tsample1\tsample2\nchr1\t10000\t.\tA\tG\t60\t.\tDP=100\tGT\t0/1\t1/1\nchr1\t20000\t.\tC\tT\t50\t.\tDP=80\tGT\t0/0\t0/1\nchr1\t30000\t.\tG\tA\t70\t.\tDP=120\tGT\t1/1\t0/1\nchr1\t100000\t.\tT\tC\t55\t.\tDP=90\tGT\t0/1\t0/0\nEOF\n\n# Compress and index (requires bgzip and tabix from pixi)\npixi run bgzip -f test.vcf\npixi run tabix -p vcf test.vcf.gz\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Test bcftools region queries:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Query specific region\npixi run bcftools view test.vcf.gz chr1:1-50000\n\n# Extract specific samples\npixi run bcftools view -s sample1 test.vcf.gz chr1:10000-50000\n\n# Count variants in region\npixi run bcftools view -H test.vcf.gz chr1:1-100000 | wc -l\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Create and test BAM file:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Create test SAM file\ncat > test.sam << 'EOF'\n@HD\tVN:1.0\tSO:coordinate\n@SQ\tSN:chr1\tLN:1000000\nread1\t0\tchr1\t100\t60\t10M\t*\t0\t0\tACGTACGTAC\tIIIIIIIIII\nread2\t0\tchr1\t120\t60\t10M\t*\t0\t0\tTGCATGCATG\tIIIIIIIIII\nread3\t0\tchr1\t50000\t60\t10M\t*\t0\t0\tAAAAAAAAAA\tIIIIIIIIII\nread4\t0\tchr1\t100000\t60\t10M\t*\t0\t0\tTTTTTTTTTT\tIIIIIIIIII\nEOF\n\n# Convert to BAM and index\npixi run samtools view -b test.sam -o test.bam\npixi run samtools index test.bam\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Test samtools region queries:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# View reads in region\npixi run samtools view test.bam chr1:1-60000\n\n# Count reads in region\npixi run samtools view -c test.bam chr1:1-60000\n\n# Extract region to new file\npixi run samtools view -b test.bam chr1:50000-100000 -o region.bam\n"})}),"\n",(0,t.jsx)(n.p,{children:"Once comfortable with local files, the same commands work seamlessly with remote S3, FTP, or HTTPS URLs\u2014just replace local filenames with remote URLs."}),"\n",(0,t.jsx)(n.h2,{id:"6-common-workflows-and-recipes",children:"6. Common Workflows and Recipes"}),"\n",(0,t.jsx)(n.h3,{id:"61-extract-variants-for-specific-genes",children:"6.1 Extract Variants for Specific Genes"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Define gene regions (example: gene1, gene2)\ncat > genes.bed << 'EOF'\n1\t11869\t14409\tDDX11L1\n1\t17369\t17436\tMIR6859-1\nEOF\n\n# Extract variants from remote file for gene regions\nbcftools view \\\n  s3://my-bucket/variants.vcf.gz \\\n  -R genes.bed \\\n  -O v -o local_genes.vcf\n\n# Compress and index\nbgzip -f local_genes.vcf\ntabix -p vcf local_genes.vcf.gz\n"})}),"\n",(0,t.jsx)(n.h3,{id:"62-compare-samples-across-remote-files",children:"6.2 Compare Samples Across Remote Files"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Compare variants for two samples in different S3 files\nbcftools isec \\\n  <(bcftools view -s sample1 s3://bucket1/variants.vcf.gz) \\\n  <(bcftools view -s sample2 s3://bucket2/variants.vcf.gz) \\\n  -p comparison_output\n\n# Shows shared and unique variants\nls comparison_output/\n"})}),"\n",(0,t.jsx)(n.h3,{id:"63-annotate-remote-vcf-with-remote-annotations",children:"6.3 Annotate Remote VCF with Remote Annotations"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Annotate S3-hosted VCF using FTP-hosted annotation file\nbcftools annotate \\\n  s3://my-bucket/variants.vcf.gz \\\n  -a ftp://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/common_all.vcf.gz \\\n  -c ID \\\n  -O v -o annotated.vcf\n"})}),"\n",(0,t.jsx)(n.h3,{id:"64-extract-bam-regions-for-multiple-samples",children:"6.4 Extract BAM Regions for Multiple Samples"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Create list of regions\ncat > regions.txt << 'EOF'\nchr1:1-1000000\nchr2:2000000-3000000\nchr3:5000000-6000000\nEOF\n\n# Extract each region from remote BAM, save locally\nwhile read region; do\n  samtools view \\\n    s3://my-bucket/aligned.bam \\\n    $region \\\n    -b -o ${region//:/_}.bam\n  samtools index ${region//:/_}.bam\ndone < regions.txt\n"})}),"\n",(0,t.jsx)(n.h3,{id:"65-stream-processing-without-local-storage",children:"6.5 Stream Processing Without Local Storage"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Pipe remote data through multiple tools\nbcftools view s3://my-bucket/variants.vcf.gz chr1:1-1000000 \\\n  | bcftools query -f '%CHROM\\t%POS\\t%REF\\t%ALT\\t%AC\\t%AF\\n' \\\n  | awk '$6 > 0.05' \\\n  | tee filtered_variants.tsv \\\n  | wc -l\n"})}),"\n",(0,t.jsx)(n.h2,{id:"7-troubleshooting-and-optimization",children:"7. Troubleshooting and Optimization"}),"\n",(0,t.jsx)(n.h3,{id:"71-common-issues",children:"7.1 Common Issues"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Issue"}),': "File not found" or 404 errors']}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),": Verify S3 bucket name, path, and file permissions. Test with AWS CLI:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aws s3 ls s3://bucket-name/path/file.vcf.gz\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Issue"}),": Authentication failures with S3"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),": Verify AWS credentials:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aws sts get-caller-identity\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Issue"}),": Index not found (",(0,t.jsx)(n.code,{children:".tbi"})," or ",(0,t.jsx)(n.code,{children:".bai"})," missing)"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),": Create indexes or verify they exist on remote server:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"aws s3 ls s3://bucket-name/file.vcf.gz.tbi\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Issue"}),': "Connection timeout" on FTP']}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),": Increase timeout and try again:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"export CURL_CONNECT_TIMEOUT=60\nexport CURL_TIMEOUT=120\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Issue"}),": HTTPS SSL certificate errors"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),": Verify certificate validity or temporarily disable verification for testing:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl -k https://endpoint.com/file.vcf.gz.tbi  # -k disables cert verification\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"72-optimization-tips",children:"7.2 Optimization Tips"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"For S3 Access"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Use S3 Transfer Acceleration if available for faster downloads"}),"\n",(0,t.jsx)(n.li,{children:"Place compute resources in the same AWS region as your data"}),"\n",(0,t.jsxs)(n.li,{children:["Use bucket endpoints to avoid Internet Gateway charges:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# VPC endpoint for S3 (no data transfer charges within VPC)\ns3://bucket-name/key\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"For Large Batch Queries"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Sort region requests by chromosome for better caching"}),"\n",(0,t.jsxs)(n.li,{children:["Consider downloading entire chromosome subset once, then querying locally:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"bcftools view s3://bucket/variants.vcf.gz chr1 -o chr1.vcf.gz\nbcftools index chr1.vcf.gz\n# Then query locally multiple times\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"For FTP Performance"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Batch multiple queries when possible"}),"\n",(0,t.jsx)(n.li,{children:"Check server-side compression settings"}),"\n",(0,t.jsx)(n.li,{children:"Consider mirror/rsync services for frequently accessed data"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"73-debugging-with-verbose-output",children:"7.3 Debugging with Verbose Output"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Enable verbose output for debugging\nexport HTS_LOG_LEVEL=debug\n\n# Use bcftools verbose flag\nbcftools view -v s3://bucket/variants.vcf.gz chr1:1-1000000\n\n# Check curl verbose output\nexport CURL_VERBOSE=1\n"})}),"\n",(0,t.jsx)(n.h2,{id:"8-recap-and-key-takeaways",children:"8. Recap and Key Takeaways"}),"\n",(0,t.jsx)(n.h3,{id:"81-what-weve-covered",children:"8.1 What We've Covered"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Protocol Support"}),": HTSlib tools support S3, FTP, and HTTPS remote file access natively"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Authentication"}),": Each protocol has different auth mechanisms (AWS credentials, FTP user",":pass",", Bearer tokens)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Efficient Queries"}),": Indexed files enable byte-range requests, downloading only necessary data"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Practical Workflows"}),": Common tasks like region extraction, sample comparison, and annotation using remote files"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Troubleshooting"}),": How to diagnose and resolve common remote file access issues"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"82-key-takeaways",children:"8.2 Key Takeaways"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Always use indexes"})," for remote files to avoid downloading entire datasets"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Choose the right protocol"}),": S3 for AWS, FTP for public repositories, HTTPS for APIs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Set up authentication correctly"})," to avoid repeated connection failures"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Stream processing"})," reduces local storage requirements for large datasets"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Verify indexes exist"})," on remote servers before querying"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Optimize by region"}),": Place compute near data, batch similar queries, use appropriate timeouts"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"83-quick-reference-workflow",children:"8.3 Quick Reference Workflow"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Setup (one time):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Create project directory\nmkdir -p ~/genomics-work && cd ~/genomics-work\n\n# Initialize Pixi with conda-forge and bioconda\npixi init --channel conda-forge --channel bioconda .\n\n# Add tools\npixi add bcftools samtools\n\n# Verify installation\npixi run bcftools --version\npixi run samtools --version\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Using remote files:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# 1. Set up authentication (optional, for private buckets)\nexport AWS_ACCESS_KEY_ID="..."\nexport AWS_SECRET_ACCESS_KEY="..."\nexport AWS_DEFAULT_REGION="us-east-1"\n\n# 2. Query real remote file (NCBI dbSNP via HTTPS - no auth needed)\npixi run bcftools view \\\n  https://ftp.ncbi.nlm.nih.gov/snp/organisms/human_9606_b150_GRCh37p13/VCF/00-common_all.vcf.gz \\\n  | pixi run bcftools query -f \'%CHROM\\t%POS\\t%REF\\t%ALT\\n\' \\\n  | head -20\n\n# 3. Or for your own S3 data:\npixi run bcftools view s3://my-bucket/variants.vcf.gz chr1:1-1000000 -O v -o chr1_subset.vcf\n\n# 4. Create local index for repeated use\npixi run bgzip -f chr1_subset.vcf\npixi run tabix -p vcf chr1_subset.vcf.gz\n'})}),"\n",(0,t.jsx)(n.h3,{id:"84-next-steps",children:"8.4 Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Explore your data"}),": Start with small region queries to test setup"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Automate workflows"}),": Create scripts for common extraction and annotation tasks"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Scale up"}),": Use Nextflow or similar workflow managers for processing multiple files"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Monitor costs"}),": Track S3 data transfer and request costs if using cloud storage"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"85-additional-resources",children:"8.5 Additional Resources"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"http://www.htslib.org/doc/",children:"HTSlib documentation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"http://www.htslib.org/doc/bcftools.html",children:"bcftools manual"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"http://www.htslib.org/doc/samtools.html",children:"samtools manual"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.internationalgenome.org/",children:"1000 Genomes Project"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.ensembl.org/biomart/martview",children:"Ensembl Biomart"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},29831(e,n,s){s.d(n,{A:()=>i});const i=s.p+"assets/images/intro-7aaa912f8e48c1bb524eacaf56d8a3cd.png"},28453(e,n,s){s.d(n,{R:()=>l,x:()=>o});var i=s(96540);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}},62e3(e){e.exports=JSON.parse('{"permalink":"/river-docs/blog/remote-files-htslib-bcftools-samtools","source":"@site/blog/2026-02/2026-02-16-remote-files-htslib.md","title":"Working with Remote Files using bcftools and samtools (HTSlib)","description":"HTSlib-based tools like bcftools and samtools provide powerful capabilities for working with genomic data stored on remote servers. Whether your data is in AWS S3, accessible via FTP, or hosted on HTTPS endpoints, these tools allow you to efficiently query and subset remote files without downloading entire datasets. This guide covers authentication, remote file access patterns, and practical workflows.","date":"2026-02-16T00:00:00.000Z","tags":[{"inline":true,"label":"bioinformatics","permalink":"/river-docs/blog/tags/bioinformatics"},{"inline":true,"label":"htslib","permalink":"/river-docs/blog/tags/htslib"},{"inline":true,"label":"bcftools","permalink":"/river-docs/blog/tags/bcftools"},{"inline":true,"label":"samtools","permalink":"/river-docs/blog/tags/samtools"},{"inline":true,"label":"s3","permalink":"/river-docs/blog/tags/s-3"},{"inline":true,"label":"remote-files","permalink":"/river-docs/blog/tags/remote-files"},{"inline":true,"label":"cloud","permalink":"/river-docs/blog/tags/cloud"},{"inline":true,"label":"genomics","permalink":"/river-docs/blog/tags/genomics"}],"readingTime":17.8,"hasTruncateMarker":true,"authors":[{"name":"Thanh-Giang Tan Nguyen","title":"Founder at RIVER","url":"https://www.facebook.com/nttg8100","page":{"permalink":"/river-docs/blog/authors/river"},"email":"nttg8100@gmail.com","socials":{"linkedin":"https://www.linkedin.com/in/thanh-giang-tan-nguyen-761b28190/","github":"https://github.com/nttg8100"},"imageURL":"https://avatars.githubusercontent.com/u/64969412?v=4","key":"river"}],"frontMatter":{"slug":"remote-files-htslib-bcftools-samtools","title":"Working with Remote Files using bcftools and samtools (HTSlib)","authors":["river"],"tags":["bioinformatics","htslib","bcftools","samtools","s3","remote-files","cloud","genomics"],"image":"./imgs/intro.png"},"unlisted":false,"nextItem":{"title":"Setting Up a Local Nextflow Training Environment with Code-Server and HPC","permalink":"/river-docs/blog/setup-local-nextflow-training"}}')}}]);